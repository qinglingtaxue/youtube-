# 经验索引

> 这里记录了踩过的坑和积累的经验。
> 做决策时可以翻翻，看看有没有相关参考。
> 踩了新坑，记得更新。

---

## 什么时候查这份文档

```
默认：不看，直接动手

触发查阅：
├── 踩坑了 → 查文档看是否已有经验
├── 不确定 → 查文档看有没有相关思考
├── 重大决策 → 查文档做参考
└── 新领域 → 查文档找入门点
```

---

## 经验分类

### 持久化相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| 重启数据丢了 | 需要持久化吗？存内存还是存文件/数据库？ |
| 中断后要重来 | 需要断点恢复吗？进度存哪里？ |
| 改配置要改代码 | 配置应该外置吗？ |
| 日志查不到历史 | 关键操作有日志吗？ |

### 架构演进相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| 加功能改很多文件 | 模块边界清晰吗？ |
| 改了这里那里也坏 | 依赖是单向的吗？ |
| 想换个库太难 | 接口有抽象吗？ |
| 代码越来越乱 | 以后会变复杂吗？现在的设计能适应吗？ |

### 成本控制相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| 太贵了（token 消耗高） | AI 在循环里吗？应该只在入口 |
| 太慢了 | 哪些逻辑可以固化成脚本？ |
| 不稳定 | 有验收机制吗？ |
| 额度用完被中断 | 考虑过使用额度限制吗？ |

> 参考决策文档：`2026-01-09-决策-为什么放弃纯Playwright采用综合模式.md`

### 需求理解相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| 不是用户要的 | 需求确认了吗？有模糊的地方要先问 |
| 改来改去浪费时间 | 我真的理解需求了吗？ |
| 格式不对要重新处理 | 输入输出契约定了吗？ |
| 做的是一次性的但按长期做了 | 这是一次性任务还是要长期运行？ |

### 第三方集成相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| Schema 不对，集成失败 | 查官方文档了吗？不要猜 |
| 自己写的不如官方工具 | 有官方 CLI 吗？优先用 CLI 生成 |
| API 行为和预期不符 | 试过了吗？还是在假设？ |

> 参考决策文档：`tech-decisions.md`（Better Auth 踩坑记录）

### Skill/插件相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| 创建了 skill 但 Claude 不会自动调用 | skill 注册到 CLAUDE.md 了吗？ |
| prompts 里引用的 skill 不存在 | `.claude/skills/` 目录里有对应文件吗？ |

> **创建 skill 后必须**：在 `CLAUDE.md` 的「Skill 调用规则」表格里注册

### RPA/自动化相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| RPA 报成功但实际失败 | 有验收机制吗？（文件检测即可） |
| 页面变了脚本失效 | 元素定位稳定吗？ |
| 隐藏元素点不到 | 需要 hover 才显示吗？ |

> 参考决策文档：`2026-01-09-决策-为什么放弃纯Playwright采用综合模式.md`

### 文档同步相关

| 踩过的坑 | 事先可问 |
|----------|----------|
| 代码改了但文档没改 | 改了输出格式后，spec 文档更新了吗？ |
| 多处文档描述不一致 | 相关文档都检查了吗？(pipeline/userstory/pr/sys.spec) |
| 验收标准过时导致验收失败 | 验收标准与实际实现一致吗？ |

> **功能变更后必须同步的文档**：
> - `pipeline.spec.md` - 输出契约、后置检查
> - `userstory.spec.md` - 验收标准
> - `pr.spec.md` - 功能描述
> - `sys.spec.md` - 模块规约

---

## 什么时候不需要查

```
✓ 熟悉的小改动 → 直接做
✓ 一次性脚本 → 直接做
✓ 探索性尝试 → 先试再说
✓ 成本极低的操作 → 直接做
✓ 模式已知的任务 → 按模板执行
```

---

## 判断要不要前置思考

```
返工成本 = 代码量 × 依赖深度 × 影响范围 × 维护周期

四项都低 → 直接动手
任一项高 → 考虑查查这份文档
```

---

## 如何更新这份文档

```
踩了新坑 → 加到对应分类
发现更好的实践 → 更新原有条目
某条目不再适用 → 删除或标记过时
重大决策 → 单独写决策文档，这里加引用
```

小变化：直接改，git commit
大决策：写 `YYYY-MM-DD-决策-简要描述.md`

---

## 相关决策文档

| 文档 | 内容 |
|------|------|
| `2026-01-09-决策-为什么放弃纯Playwright采用综合模式.md` | Playwright vs RPA 的取舍 |
| `tech-decisions.md` | 技术选型和踩坑记录 |
| `关键决策参考.md` | 项目架构决策 |

---

*最后更新：2026-01-19*
