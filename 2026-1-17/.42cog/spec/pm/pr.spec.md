# 产品需求规约 (Product Requirements Specification)

> 定义产品功能边界、优先级和验收标准
>
> **引用文档**：
> - 项目元信息：`../../meta/meta.md`
> - 用户故事：`./userstory.spec.md`
> - 认知模型：`../../cog/cog.md`
> - 现实约束：`../../real/real.md`

---

## 一、产品概述

### 1.1 产品定位

**产品名称**：YouTube 端到端内容创作流水线

**一句话描述**：基于矩阵架构编排的 YouTube 内容生产系统，覆盖调研→策划→制作→发布→复盘全流程。

**核心差异**：不是"用 AI 做视频"，而是"用矩阵架构编排内容生产系统"。

### 1.2 目标用户

| 用户类型 | 描述 | 优先级 |
|----------|------|--------|
| 个人创作者 | 独立运营 YouTube 频道 | 主要 |
| 运营团队 | 批量管理多频道的自媒体团队 | 次要 |

### 1.3 核心价值主张

> 四维矩阵：广度 × 深度 × 效能 × 洞察

| 维度 | 价值主张 | 具体体现 |
|------|---------|---------|
| **广度** | 五阶段端到端 | 调研→策划→制作→发布→复盘，全流程覆盖 |
| **深度** | 42plugin 生态 | 开箱即用的 Skills + Agents + Commands + Hooks |
| **效能** | 分层执行架构 | AI 理解(低Token) → RPA 执行(零Token) → Playwright 验收 |
| **洞察** | 套利分析框架 | 有趣度公式发现被低估的创作机会 |

> **核心公式**：有趣度 = 信息价值程度 / 信息传播程度 = 中介中心性 / 程度中心性

---

## 二、功能清单

### 2.1 功能总览

```
┌───────────────────────────────────────────────────────────────────────────────────────────┐
│                                       功能架构图                                            │
├───────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                           │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌──────────┐│
│  │  调研模块  │  │  分析模块  │  │  策划模块  │  │  制作模块  │  │  发布模块  │  │ 复盘模块 ││
│  │           │  │           │  │           │  │           │  │           │  │          ││
│  │• 大规模   │  │• 市场分析 │  │• 脚本生成 │  │• 素材管理 │  │• 自动上传 │  │• 数据    ││
│  │  数据采集 │  │• AI创作   │  │• SEO优化  │  │• 字幕处理 │  │• 定时发布 │  │  收集    ││
│  │• 每日     │  │  机会识别 │  │• 规约生成 │  │• 视频合成 │  │• 批量上传 │  │• 效果    ││
│  │  自动采集 │  │• 趋势监控 │  │           │  │           │  │• 上传验收 │  │  分析    ││
│  │• 竞品分析 │  │• 综合报告 │  │           │  │           │  │           │  │• 改进    ││
│  │           │  │• 报告部署 │  │           │  │           │  │           │  │  建议    ││
│  └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘  └──────────┘│
│        │              │              │              │              │              │      │
│        └──────────────┴──────────────┴──────────────┴──────────────┴──────────────┘      │
│                                        │                                                 │
│                             ┌──────────┴──────────┐                                      │
│                             │   共享基础设施       │                                      │
│                             │ • 数据库 (SQLite)   │                                      │
│                             │ • 存储管理          │                                      │
│                             │ • 42plugin 插件系统 │                                      │
│                             │ • Vercel 部署       │                                      │
│                             └─────────────────────┘                                      │
│                                                                                           │
└───────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 功能详细列表

#### 模块 1：调研 (Research)

| 功能 ID | 功能名称 | 描述 | 优先级 | 状态 | 关联用户故事 |
|---------|----------|------|--------|------|--------------|
| F-R001 | 关键词调研 | 输入关键词，自动采集 YouTube 竞品数据 | P0 | MVP | US-R001 |
| F-R002 | 视频元数据采集 | 采集视频标题、描述、标签、数据指标 | P0 | MVP | US-R001 |
| F-R003 | 大规模数据采集 | 一次性采集 1000+ 视频，自动扩展关键词 | P0 | MVP | US-R003 |
| F-R004 | 竞品视频下载 | 下载竞品视频（≤1080p）供分析 | P0 | MVP | US-R002 |
| F-R005 | 字幕提取 | 提取视频字幕（手动/自动/Whisper） | P0 | MVP | US-R002 |
| F-R006 | 详情自动获取 | 高播放量视频（>5000）自动获取详细信息 | P0 | MVP | US-R003 |
| F-R007 | 每日自动采集 | 每天自动采集 1000 个新发布的视频 | P1 | 已实现 | US-R004 |
| F-R008 | 采集日志记录 | 记录采集结果和统计信息 | P0 | MVP | US-R003 |

#### 模块 1.5：分析 (Analysis)

| 功能 ID | 功能名称 | 描述 | 优先级 | 状态 | 关联用户故事 |
|---------|----------|------|--------|------|--------------|
| F-AN001 | 市场规模分析 | 统计视频数、总播放量、平均播放量、中位数 | P0 | 已实现 | US-AN001 |
| F-AN002 | 频道竞争分析 | 分析频道集中度、规模分布 | P0 | 已实现 | US-AN001 |
| F-AN003 | 进入壁垒分析 | 分析播放量分层、爆款率、Top10%门槛 | P0 | 已实现 | US-AN001 |
| F-AN004 | 时间上下文分析 | 分析数据时间范围、时间分布 | P0 | 已实现 | US-AN001 |
| F-AN005 | 近期爆款识别 | 按时间窗口识别高播放量视频 | P0 | 已实现 | US-AN002 |
| F-AN006 | 高日增长识别 | 识别日增长 > 500 的视频 | P0 | 已实现 | US-AN002 |
| F-AN007 | 小频道黑马识别 | 识别 1-3 视频但播放量高的频道 | P0 | 已实现 | US-AN002 |
| F-AN008 | 高互动模板识别 | 识别互动率 > 3% 的视频 | P0 | 已实现 | US-AN002 |
| F-AN009 | 播放量快照 | 定期拍摄播放量快照用于趋势追踪 | P0 | 已实现 | US-AN003 |
| F-AN010 | 增长趋势图 | 生成 1天/15天/30天 增长趋势图 | P0 | 已实现 | US-AN003 |
| F-AN011 | 综合HTML报告 | 生成6个独立页面的可视化报告（概览/套利分析/内容四象限/创作者分析/标题公式/行动建议） | P0 | 已实现 | US-AN004 |
| F-AN012 | 全局时间筛选 | 报告支持按时间窗口筛选数据 | P0 | 已实现 | US-AN004 |
| F-AN013 | 可点击链接 | 视频标题和频道名可跳转到 YouTube | P0 | 已实现 | US-AN004 |
| F-AN014 | Vercel部署 | 一键部署报告到 Vercel | P1 | 已实现 | US-AN005 |

#### 模块 1.6：套利分析 (Arbitrage)

> **核心公式**：有趣度 = 信息价值程度 / 信息传播程度 = 中介中心性 / 程度中心性

| 功能 ID | 功能名称 | 描述 | 优先级 | 状态 | 关联用户故事 |
|---------|----------|------|--------|------|--------------|
| F-ARB001 | 关键词网络构建 | 从视频标题提取关键词，建立共现网络 | P0 | 已实现 | US-ARB001 |
| F-ARB002 | 中心性计算 | 计算中介中心性和程度中心性 | P0 | 已实现 | US-ARB001 |
| F-ARB003 | 有趣度计算 | 计算有趣度（中介中心性/程度中心性） | P0 | 已实现 | US-ARB001 |
| F-ARB004 | 桥梁话题识别 | 识别高有趣度（>0.3）的桥梁话题 | P0 | 已实现 | US-ARB001 |
| F-ARB005 | 小频道爆款发现 | 识别 1-3 视频小频道中的爆款 | P0 | 已实现 | US-ARB002 |
| F-ARB006 | 频道有趣度计算 | 计算爆款播放量/频道平均播放量 | P0 | 已实现 | US-ARB002 |
| F-ARB007 | 时长分桶分析 | 将视频按时长分桶，计算各区间表现 | P0 | 已实现 | US-ARB003 |
| F-ARB008 | 时长供需分析 | 计算各时长区间的供给占比和有趣度 | P0 | 已实现 | US-ARB003 |
| F-ARB009 | 趋势比计算 | 比较话题近期频率与历史频率 | P1 | 已实现 | US-ARB004 |
| F-ARB010 | 上升/下降话题识别 | 识别趋势比 > 1.5 或 < 0.5 的话题 | P1 | 已实现 | US-ARB004 |
| F-ARB011 | 博主类型匹配 | 根据博主类型推荐适合的套利策略 | P0 | 已实现 | US-ARB005 |
| F-ARB012 | 综合套利报告 | 整合所有套利分析结果生成报告 | P0 | 已实现 | US-ARB006 |

#### 模块 2：策划 (Planning)

| 功能 ID | 功能名称 | 描述 | 优先级 | 状态 | 关联用户故事 |
|---------|----------|------|--------|------|--------------|
| F-P001 | 脚本大纲生成 | 基于调研数据生成视频脚本大纲 | P0 | MVP | US-P001 |
| F-P002 | 三事件结构 | 脚本遵循引入-展开-总结结构 | P0 | MVP | US-P001 |
| F-P003 | 时长估算 | 根据字数估算脚本时长 | P0 | MVP | US-P001 |
| F-P004 | 标题优化 | 生成 SEO 优化的候选标题 | P0 | MVP | US-P002 |
| F-P005 | 描述优化 | 生成 SEO 优化的视频描述 | P0 | MVP | US-P002 |
| F-P006 | 标签推荐 | 推荐相关标签（5-15个） | P0 | MVP | US-P002 |
| F-P007 | SEO 评分 | 计算 SEO 综合评分 | P0 | MVP | US-P002 |
| F-P008 | 视频规约生成 | 生成 42COG 格式的视频规约 | P0 | MVP | US-P003 |

#### 模块 3：制作 (Production)

| 功能 ID | 功能名称 | 描述 | 优先级 | 状态 | 关联用户故事 |
|---------|----------|------|--------|------|--------------|
| F-M001 | 素材分类存储 | 按类型存储素材（视频/图片/音频） | P1 | 计划中 | US-M001 |
| F-M002 | 素材来源记录 | 记录每个素材的来源和授权 | P1 | 计划中 | US-M001 |
| F-M003 | Whisper 转录 | 使用 Whisper 自动生成字幕 | P0 | MVP | US-M002 |
| F-M004 | 字幕格式转换 | SRT/VTT 格式互转 | P0 | MVP | US-M002 |
| F-M005 | 字幕校对修复 | 修正错别字、优化断句 | P0 | MVP | US-M002 |
| F-M006 | FFmpeg 视频合成 | 使用 FFmpeg 合成最终视频 | P0 | MVP | US-M003 |
| F-M007 | 音频混合 | 混合配音和背景音乐 | P0 | MVP | US-M003 |
| F-M008 | 字幕烧录 | 将字幕烧录到视频 | P0 | MVP | US-M003 |

#### 模块 4：发布 (Publishing)

| 功能 ID | 功能名称 | 描述 | 优先级 | 状态 | 关联用户故事 |
|---------|----------|------|--------|------|--------------|
| F-U001 | 上传配置生成 | 生成 JSON 格式的上传配置 | P0 | MVP | US-U001 |
| F-U002 | 视频上传 | 自动上传视频到 YouTube | P0 | MVP | US-U001 |
| F-U003 | 元数据填写 | 自动填写标题、描述、标签 | P0 | MVP | US-U001 |
| F-U004 | 封面上传 | 自动上传自定义封面 | P0 | MVP | US-U001 |
| F-U005 | 字幕上传 | 自动上传字幕文件 | P0 | MVP | US-U001 |
| F-U006 | 播放列表添加 | 自动添加到指定播放列表 | P0 | MVP | US-U001 |
| F-U007 | 综合模式执行 | AI理解 + RPA执行 + Playwright验收 | P0 | MVP | US-U001 |
| F-U008 | 上传状态验证 | 验证上传是否成功 | P0 | MVP | US-U004 |
| F-U009 | 验收报告生成 | 生成上传验收报告 | P0 | MVP | US-U004 |
| F-U010 | 定时发布设置 | 设置视频定时发布 | P1 | 计划中 | US-U002 |
| F-U011 | 最佳时间建议 | 提供最佳发布时间建议 | P1 | 计划中 | US-U002 |
| F-U012 | 批量上传 | 批量上传多个视频 | P2 | 未来 | US-U003 |

#### 模块 5：复盘 (Analytics)

| 功能 ID | 功能名称 | 描述 | 优先级 | 状态 | 关联用户故事 |
|---------|----------|------|--------|------|--------------|
| F-A001 | 数据采集 | 采集视频发布后的数据指标 | P0 | MVP | US-A001 |
| F-A002 | 多时间点采集 | 支持 24h/7d/30d 多时间点 | P0 | MVP | US-A001 |
| F-A003 | 数据存储 | 数据存入 SQLite 数据库 | P0 | MVP | US-A001 |
| F-A004 | 预期对比 | 对比预期目标 vs 实际表现 | P0 | MVP | US-A002 |
| F-A005 | 历史对比 | 对比历史视频平均表现 | P0 | MVP | US-A002 |
| F-A006 | 留存分析 | 分析观众留存曲线 | P0 | MVP | US-A002 |
| F-A007 | 分析报告生成 | 生成效果分析报告 | P0 | MVP | US-A002 |
| F-A008 | 改进建议生成 | 基于数据生成改进建议 | P0 | MVP | US-A003 |
| F-A009 | 下期方向建议 | 提供下期内容方向建议 | P0 | MVP | US-A003 |
| F-A010 | 周期复盘报告 | 生成周/月度复盘报告 | P1 | 计划中 | US-A004 |

---

## 三、功能优先级

### 3.1 MVP (P0) - 必须有

**目标**：完成一个视频从调研到复盘的完整流程，包含数据驱动的分析报告和套利机会发现

| 模块 | 功能数量 | 核心功能 |
|------|----------|----------|
| 调研 | 6 | 关键词调研、大规模采集、竞品下载 |
| **分析** | **13** | **市场分析、AI创作机会、趋势监控、综合报告** |
| **套利** | **10** | **话题套利、频道套利、时长套利、博主定位** |
| 策划 | 8 | 脚本生成、SEO优化、规约生成 |
| 制作 | 6 | 字幕处理、视频合成 |
| 发布 | 9 | 自动上传、验收检查 |
| 复盘 | 9 | 数据收集、效果分析、改进建议 |
| **总计** | **61** | |

### 3.2 增强 (P1) - 应该有

**目标**：提升效率和自动化程度

| 模块 | 功能数量 | 核心功能 |
|------|----------|----------|
| 调研 | 1 | 每日自动采集 |
| **分析** | **1** | **Vercel 报告部署** |
| **套利** | **2** | **趋势套利分析** |
| 制作 | 2 | 素材管理 |
| 发布 | 2 | 定时发布 |
| 复盘 | 1 | 周期复盘 |
| **总计** | **9** | |

### 3.3 未来 (P2) - 可以有

**目标**：支持团队协作和批量处理

| 模块 | 功能数量 | 核心功能 |
|------|----------|----------|
| 发布 | 1 | 批量上传 |
| **总计** | **1** | |

---

## 四、非功能需求

### 4.1 性能需求

| 指标 | 要求 | 说明 |
|------|------|------|
| 调研响应时间 | ≤15 分钟 | 50 个视频的元数据采集 |
| 上传 Token 消耗 | ≤2000 | 综合模式单次上传 |
| 存储空间 | ~140GB | 稳定占用（滚动清理后） |

### 4.2 可靠性需求

| 指标 | 要求 | 说明 |
|------|------|------|
| 上传成功率 | ≥95% | 自动重试 3 次 |
| 数据采集成功率 | ≥90% | 网络异常时重试 |

### 4.3 安全需求

引用 `real.md` 约束：

| 约束 | 要求 |
|------|------|
| YouTube 社区准则 | 不得批量上传重复/低质内容 |
| 版权合规 | 竞品视频仅供分析，不得直接使用 |
| API 限制 | YouTube Data API 每日配额有限 |
| 存储控制 | 视频文件必须执行滚动清理 |

### 4.4 兼容性需求

| 项目 | 要求 |
|------|------|
| 操作系统 | macOS (Apple Silicon) |
| Python 版本 | ≥3.10 |
| Node.js 版本 | ≥18 |
| 浏览器 | Chrome (需登录 YouTube) |

---

## 五、技术依赖

### 5.1 核心工具

| 工具 | 版本要求 | 用途 |
|------|----------|------|
| yt-dlp | ≥2025.1.0 | 视频/字幕下载 |
| FFmpeg | ≥6.0 | 音视频处理 |
| Whisper | ≥20230918 | 语音转文字 |
| Playwright | 最新 | 浏览器自动化 |
| SQLite | 3.x | 本地数据存储 |

### 5.2 42plugin 组件

| 类型 | 数量 | 代表组件 |
|------|------|----------|
| Skills | 45+ | youtube-downloader, content-creator, transcript-fixer |
| Agents | 11+ | orchestrator, marketing, seo-content-writer |
| Commands | 10+ | viral-automation, website-automation |
| Hooks | 3+ | blog-workflow, smart_agent_selection |

### 5.3 MCP 服务

| 服务 | 用途 | 端口 |
|------|------|------|
| mcp-chrome | 浏览器自动化 | 12306 |
| @playwright/mcp | Playwright 控制 | - |

---

## 六、验收标准

### 6.1 MVP 验收标准

#### 端到端流程验收

```yaml
scenario: 完成一个视频的完整生命周期
given: 用户有一个要做的视频主题
when: 用户依次执行调研→策划→制作→发布→复盘
then:
  - 调研阶段产出 ResearchReport
  - 策划阶段产出 Spec + Script + SEOReport
  - 制作阶段产出 Video + Subtitle + Thumbnail
  - 发布阶段产出 youtube_id + UploadReport
  - 复盘阶段产出 AnalyticsReport + OptimizationSuggestions
```

#### 各阶段验收标准

| 阶段 | 验收标准 |
|------|----------|
| 调研 | 成功采集 1000+ 视频，高播放量视频获取详情，数据存入数据库 |
| **分析** | **HTML报告包含5个标签页，时间筛选正常，图表正确渲染，链接可点击** |
| 策划 | SEO评分≥70，脚本符合三事件结构，规约格式正确 |
| 制作 | 视频可播放，时长误差<10%，字幕同步，封面≥1280x720 |
| 发布 | youtube_id有效，元数据完整，Token消耗<2000 |
| 复盘 | 报告包含核心指标、对比分析、可执行建议 |

### 6.2 质量指标

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| 功能覆盖率 | 100% MVP 功能可用 | 功能清单 checklist |
| 流程完成率 | ≥90% 的流程可顺利完成 | 端到端测试 |
| 用户满意度 | 减少 50% 重复操作时间 | 用户反馈 |

---

## 七、里程碑

### Phase 1: MVP (当前)

```yaml
目标: 完成五阶段基础功能
状态: 进行中
功能范围:
  - 调研: 关键词调研、竞品分析、报告生成
  - 策划: 脚本生成、SEO优化、规约生成
  - 制作: 字幕处理、视频合成
  - 发布: 自动上传、验收检查
  - 复盘: 数据收集、效果分析、改进建议
```

### Phase 2: 自动化增强

```yaml
目标: 提升效率和自动化程度
状态: 计划中
功能范围:
  - 定时调研任务
  - 趋势对比分析
  - 素材管理
  - 定时发布
  - 周期复盘
```

### Phase 3: 智能化升级

```yaml
目标: 数据驱动的智能决策
状态: 未来
功能范围:
  - 批量处理
  - A/B 测试框架
  - 个性化推荐引擎
```

---

## 八、与其他规约的关系

```
pr.spec.md (本文档)
    │
    │ 产品需求定义「产品提供什么功能」
    │
    ├── 输入自: userstory.spec.md
    │           「用户故事定义用户要什么」
    │
    ├── 输出到: pipeline.spec.md
    │           「流程规约定义系统内部如何运作」
    │
    └── 约束自: real.md
                「现实约束定义必须遵守的限制」
```

### 功能-故事-流程 追溯矩阵

| 用户故事 | 功能 | 流程阶段 |
|----------|------|----------|
| US-R001 关键词调研 | F-R001, F-R002 | Stage 1: Research |
| US-R002 竞品分析 | F-R004, F-R005 | Stage 1: Research |
| US-R003 大规模采集 | F-R003, F-R006, F-R008 | Stage 1: Research |
| US-R004 每日自动采集 | F-R007 | Stage 1: Research |
| **US-AN001 市场分析** | **F-AN001~F-AN004** | **Stage 1.5: Analysis** |
| **US-AN002 AI创作机会** | **F-AN005~F-AN008** | **Stage 1.5: Analysis** |
| **US-AN003 趋势监控** | **F-AN009, F-AN010** | **Stage 1.5: Analysis** |
| **US-AN004 综合报告** | **F-AN011~F-AN013** | **Stage 1.5: Analysis** |
| **US-AN005 报告部署** | **F-AN014** | **Stage 1.5: Analysis** |
| US-P001 脚本生成 | F-P001, F-P002, F-P003 | Stage 2: Planning |
| US-P002 SEO优化 | F-P004, F-P005, F-P006, F-P007 | Stage 2: Planning |
| US-U001 自动上传 | F-U001~F-U007 | Stage 4: Publishing |
| ... | ... | ... |

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0 | 2026-01-18 | 初始版本，定义 46 个功能，分 3 个优先级 |
| 1.1 | 2026-01-19 | 新增分析模块(14个功能)，更新调研模块，总计 59 个功能 |
| 1.2 | 2026-01-19 | 新增套利分析模块(12个功能)，更新核心价值主张，总计 71 个功能 |
| 1.3 | 2026-01-19 | 更新 F-AN011 描述，报告结构从5个标签页改为6个独立HTML页面 |

---

*引用本规约时使用：`.42cog/spec/pm/pr.spec.md`*
