<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>认知模型可视化 - Cog Visualizer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
        }

        #app {
            display: flex;
            height: 100vh;
        }

        /* 左侧图例面板 */
        #legend-panel {
            width: 240px;
            background: rgba(30, 41, 59, 0.95);
            border-right: 1px solid rgba(148, 163, 184, 0.2);
            padding: 20px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        #legend-panel h2 {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin-bottom: 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .legend-item:hover {
            background: rgba(148, 163, 184, 0.1);
        }

        .legend-item.active {
            background: rgba(148, 163, 184, 0.2);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .legend-label {
            font-size: 13px;
            color: #cbd5e1;
        }

        .legend-count {
            font-size: 11px;
            color: #64748b;
            margin-left: auto;
        }

        /* 主画布区域 */
        #graph-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #graph {
            width: 100%;
            height: 100%;
        }

        /* 顶部工具栏 */
        #toolbar {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .toolbar-btn {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #e2e8f0;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .toolbar-btn:hover {
            background: rgba(51, 65, 85, 0.9);
            border-color: rgba(148, 163, 184, 0.5);
        }

        .toolbar-btn.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
        }

        /* 语言切换 */
        #lang-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 4px;
            z-index: 100;
        }

        .lang-btn {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #94a3b8;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            color: #e2e8f0;
            border-color: rgba(148, 163, 184, 0.5);
        }

        .lang-btn.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
            color: #e2e8f0;
        }

        /* 搜索框 */
        #search-box {
            position: absolute;
            top: 20px;
            right: 130px;
            z-index: 100;
        }

        #search-input {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #e2e8f0;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            width: 200px;
            outline: none;
        }

        #search-input:focus {
            border-color: rgba(59, 130, 246, 0.6);
        }

        #search-input::placeholder {
            color: #64748b;
        }

        /* 右侧详情面板 */
        #detail-panel {
            width: 320px;
            background: rgba(30, 41, 59, 0.95);
            border-left: 1px solid rgba(148, 163, 184, 0.2);
            padding: 20px;
            overflow-y: auto;
            flex-shrink: 0;
            transition: transform 0.3s;
        }

        #detail-panel.hidden {
            transform: translateX(100%);
        }

        #detail-panel h2 {
            font-size: 18px;
            color: #f1f5f9;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #detail-panel .entity-type {
            font-size: 12px;
            color: #64748b;
            padding: 4px 8px;
            background: rgba(148, 163, 184, 0.1);
            border-radius: 4px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-section h3 {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .property-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.05);
        }

        .property-name {
            font-size: 13px;
            color: #94a3b8;
        }

        .property-value {
            font-size: 13px;
            color: #e2e8f0;
            text-align: right;
            max-width: 60%;
            word-wrap: break-word;
        }

        .relation-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: rgba(148, 163, 184, 0.05);
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .relation-item:hover {
            background: rgba(148, 163, 184, 0.1);
        }

        .relation-arrow {
            color: #64748b;
            font-size: 12px;
        }

        .relation-target {
            font-size: 13px;
            color: #cbd5e1;
        }

        .relation-type {
            font-size: 11px;
            color: #64748b;
            margin-left: auto;
        }

        .close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: #64748b;
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
        }

        .close-btn:hover {
            color: #e2e8f0;
        }

        /* SVG 样式 */
        .node {
            cursor: pointer;
        }

        .node circle {
            stroke-width: 2px;
            transition: all 0.2s;
        }

        .node:hover circle {
            stroke-width: 3px;
            filter: brightness(1.2);
        }

        .node.highlighted circle {
            stroke-width: 4px;
            filter: drop-shadow(0 0 8px currentColor);
        }

        .node.dimmed {
            opacity: 0.2;
        }

        .node text {
            font-size: 11px;
            fill: #e2e8f0;
            pointer-events: none;
            text-anchor: middle;
        }

        .link {
            stroke-opacity: 0.4;
            transition: stroke-opacity 0.2s;
        }

        .link.highlighted {
            stroke-opacity: 1;
            stroke-width: 2px;
        }

        .link.dimmed {
            stroke-opacity: 0.05;
        }

        .link-label {
            font-size: 9px;
            fill: #64748b;
            pointer-events: none;
        }

        /* 统计信息 */
        #stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.2);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            color: #94a3b8;
            z-index: 100;
        }

        #stats span {
            color: #e2e8f0;
            font-weight: 500;
        }

        /* 缩放控制 */
        #zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            z-index: 100;
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: rgba(51, 65, 85, 0.9);
        }

        /* 提示框 */
        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.3);
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 12px;
            color: #e2e8f0;
            pointer-events: none;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .tooltip-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tooltip-desc {
            color: #94a3b8;
            font-size: 11px;
        }

        /* 响应式 */
        @media (max-width: 1200px) {
            #legend-panel {
                width: 200px;
            }
            #detail-panel {
                width: 280px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="legend-panel">
            <h2>实体类别</h2>
            <div id="legend-list"></div>
        </div>

        <div id="graph-container">
            <div id="toolbar">
                <button class="toolbar-btn" id="btn-reset">重置视图</button>
                <button class="toolbar-btn" id="btn-labels" data-active="true">显示标签</button>
                <button class="toolbar-btn" id="btn-relations">显示关系</button>
            </div>

            <div id="search-box">
                <input type="text" id="search-input" placeholder="搜索实体...">
            </div>

            <div id="lang-switcher">
                <button class="lang-btn active" data-lang="zh">中文</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>

            <svg id="graph"></svg>

            <div id="stats">
                实体: <span id="node-count">0</span> | 关系: <span id="edge-count">0</span>
            </div>

            <div id="zoom-controls">
                <button class="zoom-btn" id="zoom-in">+</button>
                <button class="zoom-btn" id="zoom-out">−</button>
                <button class="zoom-btn" id="zoom-fit">◎</button>
            </div>
        </div>

        <div id="detail-panel" class="hidden">
            <button class="close-btn" id="close-detail">×</button>
            <div id="detail-content"></div>
        </div>
    </div>

    <div class="tooltip" id="tooltip" style="display: none;"></div>

    <script>
        // ==================== 国际化 ====================

        let currentLang = 'zh';

        const i18n = {
            zh: {
                title: '认知模型可视化 - Cog Visualizer',
                entityCategories: '实体类别',
                resetView: '重置视图',
                showLabels: '显示标签',
                showRelations: '显示关系',
                searchPlaceholder: '搜索实体...',
                entities: '实体',
                relations: '关系',
                coreProperties: '核心属性',
                enumValues: '枚举值',
                outgoingRels: '出向关系 (→)',
                incomingRels: '入向关系 (←)',
                categories: {
                    'data-flow': { name: '核心数据流', description: '信息源' },
                    'analysis': { name: '分析框架', description: '认知模型' },
                    'visualization': { name: '可视化层', description: '呈现系统' },
                    'report': { name: '报告实体', description: '输出物' },
                    'interaction': { name: '交互实体', description: '用户界面' },
                    'arbitrage': { name: '套利实体', description: '价值发现' },
                    'workflow': { name: '流程实体', description: '流程定义' }
                },
                relationTypes: {
                    '搜索产生': '搜索产生',
                    '属于': '属于',
                    '定时采集': '定时采集',
                    '生成快照': '生成快照',
                    '分类到': '分类到',
                    '归入': '归入',
                    '参与生成': '参与生成',
                    '出现在': '出现在',
                    '包含': '包含',
                    '关联': '关联',
                    '标记': '标记',
                    '渲染为': '渲染为',
                    '显示': '显示',
                    '构建': '构建',
                    '识别': '识别',
                    '转化为': '转化为',
                    '匹配': '匹配',
                    '汇总到': '汇总到',
                    '评估': '评估',
                    '生成': '生成',
                    '推荐对标': '推荐对标',
                    '支撑': '支撑',
                    '调用': '调用',
                    '使用': '使用',
                    '定义': '定义',
                    '筛选': '筛选'
                },
                entityNames: {
                    'CompetitorVideo': '竞品视频',
                    'Channel': '频道',
                    'TrendSnapshot': '趋势快照',
                    'ContentQuadrant': '内容四象限',
                    'DurationMatrix': '时长矩阵',
                    'ArbitrageFramework': '套利框架',
                    'InsightCard': '洞察卡片',
                    'ConfidenceBar': '置信度条',
                    'ReasoningChain': '推理链',
                    'DataSourceTag': '数据源标签',
                    'ScatterChart': '散点图',
                    'BarChart': '条形图',
                    'AnalysisReport': '分析报告',
                    'MarketReport': '市场报告',
                    'OpportunityReport': '机会报告',
                    'ArbitrageReport': '套利报告',
                    'DiagnoseReport': '诊断报告',
                    'SearchPanel': '搜索面板',
                    'FilterChip': '筛选标签',
                    'RankingList': '榜单列表',
                    'MonitorTask': '监控任务',
                    'TrendingTracker': '趋势追踪',
                    'ArbitrageOpportunity': '套利机会',
                    'BridgeTopic': '桥梁话题',
                    'CreatorProfile': '博主画像',
                    'KeywordNetwork': '关键词网络',
                    'WorkflowStage': '工作流阶段',
                    'Agent': '代理',
                    'Skill': '技能',
                    'TimeWindow': '时间窗口'
                },
                entityDescriptions: {
                    'CompetitorVideo': '竞品视频，数据采集的核心对象',
                    'Channel': 'YouTube 频道，聚合分析的维度',
                    'TrendSnapshot': '趋势快照，追踪视频增长变化',
                    'ContentQuadrant': '内容四象限，播放量×互动率的二维分类',
                    'DurationMatrix': '时长分布矩阵，时长×平均播放的供需分析',
                    'ArbitrageFramework': '套利分析框架，有趣度公式发现价值洼地',
                    'InsightCard': '洞察卡片，可折叠展开的分析单元',
                    'ConfidenceBar': '置信度条，表示洞察可靠性',
                    'ReasoningChain': '推理链，展示 AI 得出结论的过程',
                    'DataSourceTag': '数据源标签，关联原始数据',
                    'ScatterChart': '散点图，四象限可视化',
                    'BarChart': '条形图，分布可视化',
                    'AnalysisReport': '分析报告，综合数据洞察',
                    'MarketReport': '市场报告，定义市场边界和竞争格局',
                    'OpportunityReport': '机会报告，识别创作者切入点',
                    'ArbitrageReport': '套利报告，发现价值被低估的机会',
                    'DiagnoseReport': '诊断报告，频道健康度评估',
                    'SearchPanel': '搜索面板，关键词输入和筛选条件',
                    'FilterChip': '筛选标签，多维度数据过滤',
                    'RankingList': '榜单列表，视频/频道排行',
                    'MonitorTask': '监控任务，定时数据采集',
                    'TrendingTracker': '趋势追踪，增长数据监控',
                    'ArbitrageOpportunity': '套利机会，具体可执行的创作方向',
                    'BridgeTopic': '桥梁话题，连接多受众群体的关键词',
                    'CreatorProfile': '博主画像，匹配适合的套利策略',
                    'KeywordNetwork': '关键词网络，话题共现关系图',
                    'WorkflowStage': '工作流阶段',
                    'Agent': '代理实体',
                    'Skill': '技能实体',
                    'TimeWindow': '时间窗口定义'
                }
            },
            en: {
                title: 'Cognitive Model Visualizer',
                entityCategories: 'Entity Categories',
                resetView: 'Reset View',
                showLabels: 'Show Labels',
                showRelations: 'Show Relations',
                searchPlaceholder: 'Search entities...',
                entities: 'Entities',
                relations: 'Relations',
                coreProperties: 'Core Properties',
                enumValues: 'Enum Values',
                outgoingRels: 'Outgoing Relations (→)',
                incomingRels: 'Incoming Relations (←)',
                categories: {
                    'data-flow': { name: 'Data Flow', description: 'Data Sources' },
                    'analysis': { name: 'Analysis Framework', description: 'Cognitive Model' },
                    'visualization': { name: 'Visualization', description: 'Presentation Layer' },
                    'report': { name: 'Report Entities', description: 'Output Artifacts' },
                    'interaction': { name: 'Interaction', description: 'User Interface' },
                    'arbitrage': { name: 'Arbitrage', description: 'Value Discovery' },
                    'workflow': { name: 'Workflow', description: 'Process Definition' }
                },
                relationTypes: {
                    '搜索产生': 'search produces',
                    '属于': 'belongs to',
                    '定时采集': 'scheduled collection',
                    '生成快照': 'generates snapshot',
                    '分类到': 'classified into',
                    '归入': 'grouped into',
                    '参与生成': 'contributes to',
                    '出现在': 'appears in',
                    '包含': 'contains',
                    '关联': 'associated with',
                    '标记': 'tagged with',
                    '渲染为': 'rendered as',
                    '显示': 'displays',
                    '构建': 'builds',
                    '识别': 'identifies',
                    '转化为': 'converts to',
                    '匹配': 'matches',
                    '汇总到': 'summarized in',
                    '评估': 'evaluates',
                    '生成': 'generates',
                    '推荐对标': 'recommends benchmark',
                    '支撑': 'supports',
                    '调用': 'invokes',
                    '使用': 'uses',
                    '定义': 'defines',
                    '筛选': 'filters'
                },
                entityNames: {
                    'CompetitorVideo': 'Competitor Video',
                    'Channel': 'Channel',
                    'TrendSnapshot': 'Trend Snapshot',
                    'ContentQuadrant': 'Content Quadrant',
                    'DurationMatrix': 'Duration Matrix',
                    'ArbitrageFramework': 'Arbitrage Framework',
                    'InsightCard': 'Insight Card',
                    'ConfidenceBar': 'Confidence Bar',
                    'ReasoningChain': 'Reasoning Chain',
                    'DataSourceTag': 'Data Source Tag',
                    'ScatterChart': 'Scatter Chart',
                    'BarChart': 'Bar Chart',
                    'AnalysisReport': 'Analysis Report',
                    'MarketReport': 'Market Report',
                    'OpportunityReport': 'Opportunity Report',
                    'ArbitrageReport': 'Arbitrage Report',
                    'DiagnoseReport': 'Diagnose Report',
                    'SearchPanel': 'Search Panel',
                    'FilterChip': 'Filter Chip',
                    'RankingList': 'Ranking List',
                    'MonitorTask': 'Monitor Task',
                    'TrendingTracker': 'Trending Tracker',
                    'ArbitrageOpportunity': 'Arbitrage Opportunity',
                    'BridgeTopic': 'Bridge Topic',
                    'CreatorProfile': 'Creator Profile',
                    'KeywordNetwork': 'Keyword Network',
                    'WorkflowStage': 'Workflow Stage',
                    'Agent': 'Agent',
                    'Skill': 'Skill',
                    'TimeWindow': 'Time Window'
                },
                entityDescriptions: {
                    'CompetitorVideo': 'Competitor video, core object for data collection',
                    'Channel': 'YouTube channel, dimension for aggregated analysis',
                    'TrendSnapshot': 'Trend snapshot, tracks video growth changes',
                    'ContentQuadrant': 'Content quadrant, 2D classification by views × engagement',
                    'DurationMatrix': 'Duration matrix, supply-demand analysis by duration',
                    'ArbitrageFramework': 'Arbitrage framework, discovers undervalued opportunities',
                    'InsightCard': 'Insight card, collapsible analysis unit',
                    'ConfidenceBar': 'Confidence bar, indicates insight reliability',
                    'ReasoningChain': 'Reasoning chain, shows AI conclusion process',
                    'DataSourceTag': 'Data source tag, links to raw data',
                    'ScatterChart': 'Scatter chart, quadrant visualization',
                    'BarChart': 'Bar chart, distribution visualization',
                    'AnalysisReport': 'Analysis report, comprehensive data insights',
                    'MarketReport': 'Market report, defines market boundaries',
                    'OpportunityReport': 'Opportunity report, identifies creator entry points',
                    'ArbitrageReport': 'Arbitrage report, finds undervalued opportunities',
                    'DiagnoseReport': 'Diagnosis report, channel health assessment',
                    'SearchPanel': 'Search panel, keyword input and filters',
                    'FilterChip': 'Filter chip, multi-dimensional filtering',
                    'RankingList': 'Ranking list, video/channel leaderboard',
                    'MonitorTask': 'Monitor task, scheduled data collection',
                    'TrendingTracker': 'Trending tracker, growth data monitoring',
                    'ArbitrageOpportunity': 'Arbitrage opportunity, actionable content direction',
                    'BridgeTopic': 'Bridge topic, keyword connecting multiple audiences',
                    'CreatorProfile': 'Creator profile, matches suitable arbitrage strategy',
                    'KeywordNetwork': 'Keyword network, topic co-occurrence graph',
                    'WorkflowStage': 'Workflow stage',
                    'Agent': 'Agent entity',
                    'Skill': 'Skill entity',
                    'TimeWindow': 'Time window definition'
                }
            }
        };

        function t(key) {
            const keys = key.split('.');
            let value = i18n[currentLang];
            for (const k of keys) {
                value = value?.[k];
            }
            return value || key;
        }

        function getCategoryInfo(categoryKey) {
            const catInfo = i18n[currentLang].categories[categoryKey];
            return {
                name: catInfo?.name || categoryKey,
                description: catInfo?.description || ''
            };
        }

        function getEntityDescription(entityId) {
            return i18n[currentLang].entityDescriptions[entityId] || entityId;
        }

        function getRelationType(type) {
            return i18n[currentLang].relationTypes[type] || type;
        }

        function getEntityName(entityId) {
            return i18n[currentLang].entityNames[entityId] || entityId;
        }

        // ==================== 数据定义 ====================

        // 实体类别定义（颜色固定，名称通过i18n获取）
        const categories = {
            'data-flow': { color: '#3b82f6' },
            'analysis': { color: '#10b981' },
            'visualization': { color: '#8b5cf6' },
            'report': { color: '#f59e0b' },
            'interaction': { color: '#06b6d4' },
            'arbitrage': { color: '#ef4444' },
            'workflow': { color: '#eab308' }
        };

        // 实体数据（从 cog.md 提取）
        const entities = [
            // 核心数据流
            {
                id: 'CompetitorVideo',
                category: 'data-flow',
                description: '竞品视频，数据采集的核心对象',
                properties: {
                    '唯一编码': 'video_id (YouTube ID)',
                    '标题': 'title',
                    '频道名称': 'channel_name',
                    '播放量': 'views',
                    '点赞数': 'likes',
                    '评论数': 'comments',
                    '时长': 'duration (秒)',
                    '发布时间': 'published_at',
                    '互动率': 'engagement_rate (计算)',
                    '四象限': 'quadrant (star/niche/viral/dog)'
                }
            },
            {
                id: 'Channel',
                category: 'data-flow',
                description: 'YouTube 频道，聚合分析的维度',
                properties: {
                    '唯一编码': 'channel_id',
                    '频道名称': 'channel_name',
                    '订阅数': 'subscriber_count',
                    '视频总数': 'video_count',
                    '总播放量': 'total_views',
                    '平均播放量': 'avg_views',
                    '效率得分': 'efficiency_score (计算)',
                    '黑马标记': 'is_dark_horse'
                }
            },
            {
                id: 'TrendSnapshot',
                category: 'data-flow',
                description: '趋势快照，追踪视频增长变化',
                properties: {
                    '唯一编码': 'snapshot_id',
                    '视频ID': 'video_id',
                    '快照时间': 'snapshot_time',
                    '播放量': 'views',
                    '增长值': 'growth'
                }
            },

            // 分析框架
            {
                id: 'ContentQuadrant',
                category: 'analysis',
                description: '内容四象限，播放量×互动率的二维分类',
                properties: {
                    '类型': 'quadrant_type (star/niche/viral/dog)',
                    '播放量阈值': 'views_threshold',
                    '互动率阈值': 'engagement_threshold',
                    '视频列表': 'videos',
                    '数量': 'count',
                    '占比': 'percentage'
                },
                values: ['Star(爆款型)', 'Niche(粉丝向)', 'Viral(破圈型)', 'Dog(冷门型)']
            },
            {
                id: 'DurationMatrix',
                category: 'analysis',
                description: '时长分布矩阵，时长×平均播放的供需分析',
                properties: {
                    '唯一编码': 'matrix_id',
                    '分桶列表': 'buckets',
                    '最佳区间': 'best_bucket',
                    '机会区间': 'opportunity_bucket'
                }
            },
            {
                id: 'ArbitrageFramework',
                category: 'analysis',
                description: '套利分析框架，有趣度公式发现价值洼地',
                properties: {
                    '核心公式': '有趣度 = 中介中心性 / 程度中心性',
                    '套利类型': '话题/跨语言/时长/频道/趋势/跟进'
                }
            },

            // 可视化层
            {
                id: 'InsightCard',
                category: 'visualization',
                description: '洞察卡片，可折叠展开的分析单元',
                properties: {
                    '唯一编码': 'insight_id (UUID)',
                    '分类': 'market/opportunity/warning',
                    '标题': 'title',
                    '置信度': 'confidence (0-100%)',
                    '数据源': 'sources',
                    '推理链': 'reasoning_chain',
                    '是否展开': 'is_expanded'
                }
            },
            {
                id: 'ConfidenceBar',
                category: 'visualization',
                description: '置信度条，表示洞察可靠性',
                properties: {
                    '置信度值': 'value (0-100%)',
                    '颜色映射': '绿(高)/黄(中)/红(低)'
                }
            },
            {
                id: 'ReasoningChain',
                category: 'visualization',
                description: '推理链，展示 AI 得出结论的过程',
                properties: {
                    '唯一编码': 'chain_id',
                    '步骤列表': 'steps',
                    '最终结论': 'conclusion',
                    '综合置信度': 'total_confidence'
                }
            },
            {
                id: 'DataSourceTag',
                category: 'visualization',
                description: '数据源标签，关联原始数据',
                properties: {
                    '数据类型': '视频数据/频道数据/趋势数据'
                }
            },
            {
                id: 'ScatterChart',
                category: 'visualization',
                description: '散点图，四象限可视化',
                properties: {
                    'X轴': '播放量',
                    'Y轴': '互动率',
                    '象限划分': '四象限'
                }
            },
            {
                id: 'BarChart',
                category: 'visualization',
                description: '条形图，分布可视化',
                properties: {
                    '用途': '时长分布/时间分布'
                }
            },

            // 报告实体
            {
                id: 'AnalysisReport',
                category: 'report',
                description: '分析报告，综合数据洞察',
                properties: {
                    '唯一编码': 'report_id (timestamp)',
                    '分类': 'comprehensive/market/opportunity',
                    '生成时间': 'generated_at',
                    '分析主题': 'topic',
                    '样本量': 'sample_size',
                    '标签页': 'tabs (概览/市场/时间/机会/内容)'
                }
            },
            {
                id: 'MarketReport',
                category: 'report',
                description: '市场报告，定义市场边界和竞争格局',
                properties: {
                    '市场规模': 'market_size',
                    '频道竞争': 'channel_competition',
                    '进入壁垒': 'entry_barriers',
                    '时间上下文': 'time_context'
                }
            },
            {
                id: 'OpportunityReport',
                category: 'report',
                description: '机会报告，识别创作者切入点',
                properties: {
                    '近期爆款': 'recent_viral_by_window',
                    '高日增长': 'high_daily_growth',
                    '小频道黑马': 'small_channel_hits',
                    '高互动模板': 'high_engagement_templates'
                }
            },
            {
                id: 'ArbitrageReport',
                category: 'report',
                description: '套利报告，发现价值被低估的机会',
                properties: {
                    '唯一编码': 'arbitrage_report_id',
                    '分类': 'topic/channel/duration/timing/cross_language',
                    '套利类型列表': 'arbitrage_types',
                    '机会列表': 'opportunities'
                }
            },
            {
                id: 'DiagnoseReport',
                category: 'report',
                description: '诊断报告，频道健康度评估',
                properties: {
                    '频道名称': 'channel_name',
                    '评分': 'scores (A-F)',
                    '优势': 'strengths',
                    '劣势': 'weaknesses',
                    '改进建议': 'recommendations'
                }
            },

            // 交互实体
            {
                id: 'SearchPanel',
                category: 'interaction',
                description: '搜索面板，关键词输入和筛选条件',
                properties: {
                    '搜索关键词': 'topic',
                    '筛选条件': 'filters',
                    '预设关键词': 'presets'
                },
                values: ['播放量', '地区', '时长', '粉丝数', '发布时间', '排序']
            },
            {
                id: 'FilterChip',
                category: 'interaction',
                description: '筛选标签，多维度数据过滤',
                properties: {
                    '筛选维度': '播放量/地区/时长/粉丝数/发布时间'
                }
            },
            {
                id: 'RankingList',
                category: 'interaction',
                description: '榜单列表，视频/频道排行',
                properties: {
                    '榜单类型': 'list_type',
                    '视频榜': 'hot/recentHits/evergreen/potential/longform',
                    '频道榜': 'totalViews/avgViews/videoCount/darkHorse/efficiency',
                    '时间筛选': 'time_filter (0/1/7/30/90天)'
                }
            },
            {
                id: 'MonitorTask',
                category: 'interaction',
                description: '监控任务，定时数据采集',
                properties: {
                    '唯一编码': 'task_id (UUID)',
                    '监控关键词': 'keyword',
                    '采集间隔': 'interval',
                    '状态': 'status (pending/running/completed/failed)'
                }
            },
            {
                id: 'TrendingTracker',
                category: 'interaction',
                description: '趋势追踪，增长数据监控',
                properties: {
                    '追踪对象': '视频/关键词',
                    '时间窗口': '1天/15天/30天'
                }
            },

            // 套利实体
            {
                id: 'ArbitrageOpportunity',
                category: 'arbitrage',
                description: '套利机会，具体可执行的创作方向',
                properties: {
                    '唯一编码': 'opportunity_id (UUID)',
                    '套利类型': 'topic/channel/duration/timing/cross_language/follow_up',
                    '机会名称': 'name',
                    '有趣度': 'interestingness',
                    '价值程度': 'value_score',
                    '传播程度': 'spread_score',
                    '行动建议': 'recommendation'
                }
            },
            {
                id: 'BridgeTopic',
                category: 'arbitrage',
                description: '桥梁话题，连接多受众群体的关键词',
                properties: {
                    '唯一编码': 'keyword',
                    '有趣度': 'interestingness (>0.3为高)',
                    '中介中心性': 'betweenness',
                    '程度中心性': 'degree',
                    '相连话题': 'connected_topics'
                }
            },
            {
                id: 'CreatorProfile',
                category: 'arbitrage',
                description: '博主画像，匹配适合的套利策略',
                properties: {
                    '博主类型': 'beginner/mid_tier/top_tier',
                    '资源特点': 'resources',
                    '适合套利': 'suitable_arbitrage',
                    '推荐策略': 'strategy'
                },
                values: ['小白博主', '腰部博主', '头部博主']
            },
            {
                id: 'KeywordNetwork',
                category: 'arbitrage',
                description: '关键词网络，话题共现关系图',
                properties: {
                    '唯一编码': 'network_id',
                    '节点列表': 'nodes (关键词)',
                    '边列表': 'edges (共现)',
                    '网络密度': 'density',
                    '平均聚类系数': 'avg_clustering'
                }
            },

            // 流程实体
            {
                id: 'WorkflowStage',
                category: 'workflow',
                description: '工作流阶段',
                properties: {
                    '阶段名': 'stage_name',
                    '阶段顺序': 'research(1) → planning(2) → production(3) → publishing(4) → analytics(5)'
                },
                values: ['调研', '策划', '制作', '发布', '复盘']
            },
            {
                id: 'Agent',
                category: 'workflow',
                description: '代理实体',
                properties: {
                    '唯一编码': 'agent_id',
                    '分类': 'specialized/integrated/elite',
                    '层级关系': 'elite → integrated → specialized'
                }
            },
            {
                id: 'Skill',
                category: 'workflow',
                description: '技能实体',
                properties: {
                    '唯一编码': 'skill_name (slug)',
                    '分类': 'youtube/content/analysis/report'
                }
            },
            {
                id: 'TimeWindow',
                category: 'workflow',
                description: '时间窗口定义',
                properties: {
                    '窗口列表': '1天内/15天内/30天内/全部',
                    '内部分桶': '24小时/7天/30天/90天/6个月/1年/1年以上'
                }
            }
        ];

        // 关系数据
        const relations = [
            // 数据采集关系
            { source: 'SearchPanel', target: 'CompetitorVideo', type: '搜索产生', category: 'data-collection' },
            { source: 'CompetitorVideo', target: 'Channel', type: '属于', category: 'data-collection' },
            { source: 'MonitorTask', target: 'CompetitorVideo', type: '定时采集', category: 'data-collection' },
            { source: 'CompetitorVideo', target: 'TrendSnapshot', type: '生成快照', category: 'data-collection' },

            // 分析框架关系
            { source: 'CompetitorVideo', target: 'ContentQuadrant', type: '分类到', category: 'analysis' },
            { source: 'CompetitorVideo', target: 'DurationMatrix', type: '归入', category: 'analysis' },
            { source: 'CompetitorVideo', target: 'AnalysisReport', type: '参与生成', category: 'analysis' },
            { source: 'Channel', target: 'RankingList', type: '出现在', category: 'analysis' },

            // 可视化关系
            { source: 'AnalysisReport', target: 'InsightCard', type: '包含', category: 'visualization' },
            { source: 'InsightCard', target: 'ReasoningChain', type: '关联', category: 'visualization' },
            { source: 'InsightCard', target: 'DataSourceTag', type: '标记', category: 'visualization' },
            { source: 'ContentQuadrant', target: 'ScatterChart', type: '渲染为', category: 'visualization' },
            { source: 'DurationMatrix', target: 'BarChart', type: '渲染为', category: 'visualization' },
            { source: 'InsightCard', target: 'ConfidenceBar', type: '显示', category: 'visualization' },

            // 套利分析关系
            { source: 'CompetitorVideo', target: 'KeywordNetwork', type: '构建', category: 'arbitrage' },
            { source: 'KeywordNetwork', target: 'BridgeTopic', type: '识别', category: 'arbitrage' },
            { source: 'BridgeTopic', target: 'ArbitrageOpportunity', type: '转化为', category: 'arbitrage' },
            { source: 'CreatorProfile', target: 'ArbitrageOpportunity', type: '匹配', category: 'arbitrage' },
            { source: 'ArbitrageOpportunity', target: 'ArbitrageReport', type: '汇总到', category: 'arbitrage' },
            { source: 'ArbitrageFramework', target: 'ArbitrageOpportunity', type: '评估', category: 'arbitrage' },

            // 诊断关系
            { source: 'Channel', target: 'DiagnoseReport', type: '生成', category: 'diagnose' },
            { source: 'DiagnoseReport', target: 'Channel', type: '推荐对标', category: 'diagnose' },

            // 报告关系
            { source: 'AnalysisReport', target: 'MarketReport', type: '包含', category: 'report' },
            { source: 'AnalysisReport', target: 'OpportunityReport', type: '包含', category: 'report' },
            { source: 'TrendSnapshot', target: 'OpportunityReport', type: '支撑', category: 'report' },

            // 流程关系
            { source: 'WorkflowStage', target: 'Agent', type: '调用', category: 'workflow' },
            { source: 'Agent', target: 'Skill', type: '使用', category: 'workflow' },
            { source: 'TimeWindow', target: 'TrendSnapshot', type: '定义', category: 'workflow' },
            { source: 'TimeWindow', target: 'RankingList', type: '筛选', category: 'workflow' }
        ];

        // ==================== 可视化初始化 ====================

        const width = document.getElementById('graph-container').clientWidth;
        const height = document.getElementById('graph-container').clientHeight;

        const svg = d3.select('#graph')
            .attr('width', width)
            .attr('height', height);

        // 定义箭头标记
        svg.append('defs').selectAll('marker')
            .data(['arrow'])
            .enter().append('marker')
            .attr('id', d => d)
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 25)
            .attr('refY', 0)
            .attr('markerWidth', 6)
            .attr('markerHeight', 6)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', '#64748b');

        const g = svg.append('g');

        // 缩放行为
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on('zoom', (event) => {
                g.attr('transform', event.transform);
            });

        svg.call(zoom);

        // 力导向模拟
        const simulation = d3.forceSimulation(entities)
            .force('link', d3.forceLink(relations).id(d => d.id).distance(120))
            .force('charge', d3.forceManyBody().strength(-400))
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force('collision', d3.forceCollide().radius(50));

        // 绘制连线
        const link = g.append('g')
            .attr('class', 'links')
            .selectAll('line')
            .data(relations)
            .enter().append('line')
            .attr('class', 'link')
            .attr('stroke', d => {
                const colorMap = {
                    'data-collection': '#3b82f6',
                    'analysis': '#10b981',
                    'visualization': '#8b5cf6',
                    'arbitrage': '#ef4444',
                    'diagnose': '#f59e0b',
                    'report': '#f59e0b',
                    'workflow': '#eab308'
                };
                return colorMap[d.category] || '#64748b';
            })
            .attr('marker-end', 'url(#arrow)');

        // 连线标签
        const linkLabel = g.append('g')
            .attr('class', 'link-labels')
            .selectAll('text')
            .data(relations)
            .enter().append('text')
            .attr('class', 'link-label')
            .text(d => d.type)
            .style('display', 'none');

        // 绘制节点
        const node = g.append('g')
            .attr('class', 'nodes')
            .selectAll('g')
            .data(entities)
            .enter().append('g')
            .attr('class', 'node')
            .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended));

        // 节点圆形
        node.append('circle')
            .attr('r', d => {
                // 根据关系数量调整大小
                const relCount = relations.filter(r => r.source.id === d.id || r.target.id === d.id || r.source === d.id || r.target === d.id).length;
                return 15 + Math.min(relCount * 2, 15);
            })
            .attr('fill', d => categories[d.category].color)
            .attr('stroke', d => d3.color(categories[d.category].color).darker(0.5))
            .on('mouseover', showTooltip)
            .on('mouseout', hideTooltip)
            .on('click', showDetail);

        // 节点标签
        const nodeLabel = node.append('text')
            .attr('dy', d => {
                const relCount = relations.filter(r => r.source.id === d.id || r.target.id === d.id || r.source === d.id || r.target === d.id).length;
                return 25 + Math.min(relCount * 2, 15);
            })
            .text(d => getEntityName(d.id));

        // 模拟更新
        simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

            linkLabel
                .attr('x', d => (d.source.x + d.target.x) / 2)
                .attr('y', d => (d.source.y + d.target.y) / 2);

            node.attr('transform', d => `translate(${d.x},${d.y})`);
        });

        // ==================== 交互函数 ====================

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // 提示框
        const tooltip = document.getElementById('tooltip');

        function showTooltip(event, d) {
            tooltip.innerHTML = `
                <div class="tooltip-title">${getEntityName(d.id)}</div>
                <div class="tooltip-desc">${getEntityDescription(d.id)}</div>
            `;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        function hideTooltip() {
            tooltip.style.display = 'none';
        }

        // 详情面板
        function showDetail(event, d) {
            event.stopPropagation();

            const panel = document.getElementById('detail-panel');
            const content = document.getElementById('detail-content');
            const catInfo = getCategoryInfo(d.category);
            const entityDesc = getEntityDescription(d.id);

            // 构建属性列表
            let propsHtml = '';
            if (d.properties) {
                Object.entries(d.properties).forEach(([key, value]) => {
                    propsHtml += `
                        <div class="property-item">
                            <span class="property-name">${key}</span>
                            <span class="property-value">${value}</span>
                        </div>
                    `;
                });
            }

            // 构建值列表
            let valuesHtml = '';
            if (d.values && d.values.length > 0) {
                valuesHtml = `
                    <div class="detail-section">
                        <h3>${t('enumValues')}</h3>
                        ${d.values.map(v => `<span style="display: inline-block; background: rgba(148,163,184,0.1); padding: 4px 8px; margin: 2px; border-radius: 4px; font-size: 12px;">${v}</span>`).join('')}
                    </div>
                `;
            }

            // 构建关系列表
            const incomingRels = relations.filter(r => (r.target.id || r.target) === d.id);
            const outgoingRels = relations.filter(r => (r.source.id || r.source) === d.id);

            let relsHtml = '';
            if (outgoingRels.length > 0) {
                relsHtml += `<div class="detail-section"><h3>${t('outgoingRels')}</h3>`;
                outgoingRels.forEach(r => {
                    const targetId = r.target.id || r.target;
                    relsHtml += `
                        <div class="relation-item" onclick="focusNode('${targetId}')">
                            <span class="relation-arrow">→</span>
                            <span class="relation-target">${getEntityName(targetId)}</span>
                            <span class="relation-type">${getRelationType(r.type)}</span>
                        </div>
                    `;
                });
                relsHtml += `</div>`;
            }

            if (incomingRels.length > 0) {
                relsHtml += `<div class="detail-section"><h3>${t('incomingRels')}</h3>`;
                incomingRels.forEach(r => {
                    const sourceId = r.source.id || r.source;
                    relsHtml += `
                        <div class="relation-item" onclick="focusNode('${sourceId}')">
                            <span class="relation-arrow">←</span>
                            <span class="relation-target">${getEntityName(sourceId)}</span>
                            <span class="relation-type">${getRelationType(r.type)}</span>
                        </div>
                    `;
                });
                relsHtml += `</div>`;
            }

            content.innerHTML = `
                <h2>
                    <span style="width: 12px; height: 12px; border-radius: 3px; background: ${categories[d.category].color}; display: inline-block;"></span>
                    ${getEntityName(d.id)}
                </h2>
                <div class="entity-type">${catInfo.name} · ${catInfo.description}</div>
                <p style="color: #94a3b8; font-size: 13px; margin-bottom: 20px;">${entityDesc}</p>

                <div class="detail-section">
                    <h3>${t('coreProperties')}</h3>
                    ${propsHtml}
                </div>

                ${valuesHtml}
                ${relsHtml}
            `;

            panel.classList.remove('hidden');

            // 高亮相关节点和边
            highlightConnections(d.id);
        }

        function focusNode(nodeId) {
            const targetNode = entities.find(e => e.id === nodeId);
            if (targetNode) {
                // 居中显示目标节点
                const transform = d3.zoomIdentity
                    .translate(width / 2 - targetNode.x, height / 2 - targetNode.y);
                svg.transition().duration(500).call(zoom.transform, transform);

                // 显示详情
                showDetail({ stopPropagation: () => {} }, targetNode);
            }
        }

        function highlightConnections(nodeId) {
            // 找到相关的边
            const connectedLinks = relations.filter(r =>
                (r.source.id || r.source) === nodeId || (r.target.id || r.target) === nodeId
            );

            // 找到相关的节点
            const connectedNodeIds = new Set([nodeId]);
            connectedLinks.forEach(r => {
                connectedNodeIds.add(r.source.id || r.source);
                connectedNodeIds.add(r.target.id || r.target);
            });

            // 应用样式
            node.classed('highlighted', d => d.id === nodeId)
                .classed('dimmed', d => !connectedNodeIds.has(d.id));

            link.classed('highlighted', d =>
                (d.source.id || d.source) === nodeId || (d.target.id || d.target) === nodeId)
                .classed('dimmed', d =>
                    !((d.source.id || d.source) === nodeId || (d.target.id || d.target) === nodeId));
        }

        function clearHighlight() {
            node.classed('highlighted', false).classed('dimmed', false);
            link.classed('highlighted', false).classed('dimmed', false);
        }

        // ==================== 图例面板 ====================

        const legendList = document.getElementById('legend-list');
        const categoryStats = {};

        entities.forEach(e => {
            categoryStats[e.category] = (categoryStats[e.category] || 0) + 1;
        });

        Object.entries(categories).forEach(([key, cat]) => {
            const catInfo = getCategoryInfo(key);
            const item = document.createElement('div');
            item.className = 'legend-item active';
            item.dataset.category = key;
            item.innerHTML = `
                <div class="legend-color" style="background: ${cat.color}"></div>
                <span class="legend-label">${catInfo.name}</span>
                <span class="legend-count">${categoryStats[key] || 0}</span>
            `;
            item.addEventListener('click', () => toggleCategory(key, item));
            legendList.appendChild(item);
        });

        function toggleCategory(category, item) {
            item.classList.toggle('active');
            const isActive = item.classList.contains('active');

            node.filter(d => d.category === category)
                .style('display', isActive ? 'block' : 'none');

            link.filter(d =>
                (d.source.category === category || d.target.category === category))
                .style('display', isActive ? 'block' : 'none');
        }

        // ==================== 工具栏 ====================

        document.getElementById('btn-reset').addEventListener('click', () => {
            svg.transition().duration(500).call(zoom.transform, d3.zoomIdentity);
            simulation.alpha(0.3).restart();
        });

        document.getElementById('btn-labels').addEventListener('click', function() {
            const isActive = this.dataset.active === 'true';
            this.dataset.active = (!isActive).toString();
            this.classList.toggle('active', !isActive);
            nodeLabel.style('display', isActive ? 'none' : 'block');
        });

        document.getElementById('btn-relations').addEventListener('click', function() {
            const isActive = this.classList.contains('active');
            this.classList.toggle('active');
            linkLabel.style('display', isActive ? 'none' : 'block');
        });

        document.getElementById('close-detail').addEventListener('click', () => {
            document.getElementById('detail-panel').classList.add('hidden');
            clearHighlight();
        });

        // 缩放控制
        document.getElementById('zoom-in').addEventListener('click', () => {
            svg.transition().call(zoom.scaleBy, 1.3);
        });

        document.getElementById('zoom-out').addEventListener('click', () => {
            svg.transition().call(zoom.scaleBy, 0.7);
        });

        document.getElementById('zoom-fit').addEventListener('click', () => {
            svg.transition().duration(500).call(zoom.transform, d3.zoomIdentity);
        });

        // 搜索功能
        document.getElementById('search-input').addEventListener('input', function() {
            const query = this.value.toLowerCase();

            if (!query) {
                node.style('opacity', 1);
                link.style('opacity', 1);
                return;
            }

            const matchedNodes = entities.filter(e =>
                e.id.toLowerCase().includes(query) ||
                e.description.toLowerCase().includes(query)
            );
            const matchedIds = new Set(matchedNodes.map(n => n.id));

            node.style('opacity', d => matchedIds.has(d.id) ? 1 : 0.1);
            link.style('opacity', d =>
                (matchedIds.has(d.source.id || d.source) || matchedIds.has(d.target.id || d.target)) ? 1 : 0.05
            );
        });

        // 点击空白处关闭详情面板
        svg.on('click', () => {
            document.getElementById('detail-panel').classList.add('hidden');
            clearHighlight();
        });

        // 更新统计
        document.getElementById('node-count').textContent = entities.length;
        document.getElementById('edge-count').textContent = relations.length;

        // ==================== 语言切换 ====================

        function updateUILanguage() {
            // 更新标题
            document.title = t('title');

            // 更新图例标题
            document.querySelector('#legend-panel h2').textContent = t('entityCategories');

            // 更新工具栏按钮
            document.getElementById('btn-reset').textContent = t('resetView');
            document.getElementById('btn-labels').textContent = t('showLabels');
            document.getElementById('btn-relations').textContent = t('showRelations');

            // 更新搜索框
            document.getElementById('search-input').placeholder = t('searchPlaceholder');

            // 更新统计信息
            const statsEl = document.getElementById('stats');
            statsEl.innerHTML = `${t('entities')}: <span id="node-count">${entities.length}</span> | ${t('relations')}: <span id="edge-count">${relations.length}</span>`;

            // 更新图例列表
            const legendItems = document.querySelectorAll('.legend-item');
            legendItems.forEach(item => {
                const categoryKey = item.dataset.category;
                const catInfo = getCategoryInfo(categoryKey);
                item.querySelector('.legend-label').textContent = catInfo.name;
            });

            // 更新连线标签
            linkLabel.text(d => getRelationType(d.type));

            // 更新节点标签
            nodeLabel.text(d => getEntityName(d.id));

            // 关闭详情面板
            document.getElementById('detail-panel').classList.add('hidden');
            clearHighlight();
        }

        // 语言切换按钮事件
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const lang = this.dataset.lang;
                if (lang === currentLang) return;

                currentLang = lang;

                // 更新按钮状态
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                // 更新界面语言
                updateUILanguage();
            });
        });

        // 窗口大小调整
        window.addEventListener('resize', () => {
            const newWidth = document.getElementById('graph-container').clientWidth;
            const newHeight = document.getElementById('graph-container').clientHeight;
            svg.attr('width', newWidth).attr('height', newHeight);
            simulation.force('center', d3.forceCenter(newWidth / 2, newHeight / 2));
            simulation.alpha(0.3).restart();
        });

        // 初始化时激活标签显示按钮
        document.getElementById('btn-labels').classList.add('active');
    </script>
</body>
</html>
