<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥—åˆ©åˆ†æ - ä¿¡æ¯ç½‘ç»œå¯è§†åŒ–</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- vis-network ç½‘ç»œå›¾ -->
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

    <link rel="stylesheet" href="chart-styles.css">
    <style>
        /* é¡µé¢ç‰¹å®šæ ·å¼ */
        .metric-explanation {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 0 12px 12px 0;
        }
        .metric-explanation h3 {
            margin-bottom: 10px;
            color: #333;
        }
        .metric-explanation p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }
        .formula {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            text-align: center;
            margin: 15px 0;
            color: #333;
        }
        .formula .highlight {
            color: #667eea;
            font-weight: bold;
        }

        /* ä¸‰æ¦œå•å¹¶æ’å¸ƒå±€ */
        .three-rankings {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        @media (max-width: 1200px) {
            .three-rankings {
                grid-template-columns: 1fr;
            }
        }

        .ranking-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .ranking-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .ranking-card-icon {
            font-size: 24px;
        }
        .ranking-card-title {
            font-size: 16px;
            font-weight: 600;
        }
        .ranking-card-subtitle {
            font-size: 12px;
            color: #888;
        }

        /* ç½‘ç»œå›¾æ§åˆ¶é¢æ¿ */
        .network-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-group label {
            font-size: 13px;
            color: #666;
        }
        .control-group select {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            background: white;
        }

        /* èŠ‚ç‚¹é«˜äº®æ ·å¼ */
        .node-highlight-interestingness {
            box-shadow: 0 0 20px #ffd700;
        }
        .node-highlight-betweenness {
            box-shadow: 0 0 20px #667eea;
        }
        .node-highlight-degree {
            box-shadow: 0 0 20px #f5576c;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>å¥—åˆ©åˆ†æ</h1>
            <div class="meta">ç†è§£æ•°æ®åœ¨ä¿¡æ¯ç½‘ç»œä¸­çš„åˆ†å¸ƒ | å‘ç°å¥—åˆ©æœºä¼š</div>
        </div>
    </div>

    <div class="content">
        <!-- æ ¸å¿ƒå…¬å¼è¯´æ˜ -->
        <div class="metric-explanation">
            <h3>ğŸ’¡ æœ‰è¶£åº¦å…¬å¼</h3>
            <div class="formula">
                <span class="highlight">æœ‰è¶£åº¦</span> = ä¸­ä»‹ä¸­å¿ƒæ€§ Ã· ç¨‹åº¦ä¸­å¿ƒæ€§ = <span class="highlight">ä»·å€¼</span> Ã· ä¼ æ’­ = <span class="highlight">å¥—åˆ©æœºä¼š</span>
            </div>
            <p>
                <strong>ä¸­ä»‹ä¸­å¿ƒæ€§ï¼ˆBetweennessï¼‰</strong>ï¼šèŠ‚ç‚¹åœ¨ç½‘ç»œä¸­ä½œä¸º"æ¡¥æ¢"çš„é‡è¦ç¨‹åº¦ï¼Œä»£è¡¨<strong>ä¿¡æ¯ä»·å€¼</strong><br>
                <strong>ç¨‹åº¦ä¸­å¿ƒæ€§ï¼ˆDegreeï¼‰</strong>ï¼šèŠ‚ç‚¹çš„è¿æ¥æ•°é‡ï¼Œä»£è¡¨<strong>ä¼ æ’­å¹¿åº¦</strong><br>
                <strong>æœ‰è¶£åº¦ï¼ˆInterestingnessï¼‰</strong>ï¼šé«˜ä»·å€¼ä½†å°šæœªå¹¿æ³›ä¼ æ’­çš„å†…å®¹ = <strong>å¥—åˆ©æœºä¼š</strong>
            </p>
        </div>

        <!-- ä¸‰æ¦œå• -->
        <div class="three-rankings">
            <!-- æœ‰è¶£åº¦æ¦œ -->
            <div class="ranking-card" style="border-top: 4px solid #ffd700;">
                <div class="ranking-card-header">
                    <span class="ranking-card-icon">ğŸ’</span>
                    <div>
                        <div class="ranking-card-title">æœ‰è¶£åº¦æ¦œ</div>
                        <div class="ranking-card-subtitle">é«˜ä»·å€¼ + ä½ä¼ æ’­ = å¥—åˆ©æœºä¼š</div>
                    </div>
                </div>
                <ol class="ranking-list" id="interestingness-ranking">
                    <!-- åŠ¨æ€å¡«å…… -->
                </ol>
            </div>

            <!-- ä¸­ä»‹ä¸­å¿ƒæ€§æ¦œ -->
            <div class="ranking-card" style="border-top: 4px solid #667eea;">
                <div class="ranking-card-header">
                    <span class="ranking-card-icon">ğŸŒ‰</span>
                    <div>
                        <div class="ranking-card-title">ä¸­ä»‹ä¸­å¿ƒæ€§æ¦œ</div>
                        <div class="ranking-card-subtitle">ä¿¡æ¯æ¡¥æ¢ = é«˜ä»·å€¼å†…å®¹</div>
                    </div>
                </div>
                <ol class="ranking-list" id="betweenness-ranking">
                    <!-- åŠ¨æ€å¡«å…… -->
                </ol>
            </div>

            <!-- ç¨‹åº¦ä¸­å¿ƒæ€§æ¦œ -->
            <div class="ranking-card" style="border-top: 4px solid #f5576c;">
                <div class="ranking-card-header">
                    <span class="ranking-card-icon">ğŸ”¥</span>
                    <div>
                        <div class="ranking-card-title">ç¨‹åº¦ä¸­å¿ƒæ€§æ¦œ</div>
                        <div class="ranking-card-subtitle">å¹¿æ³›ä¼ æ’­ = çƒ­é—¨å†…å®¹</div>
                    </div>
                </div>
                <ol class="ranking-list" id="degree-ranking">
                    <!-- åŠ¨æ€å¡«å…… -->
                </ol>
            </div>
        </div>

        <!-- ä¿¡æ¯ç½‘ç»œå›¾ -->
        <div class="network-container">
            <div class="chart-title">ğŸ•¸ï¸ ä¿¡æ¯ç½‘ç»œå›¾</div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="network-controls">
                <div class="control-group">
                    <label>èŠ‚ç‚¹å¤§å°ï¼š</label>
                    <select id="node-size-metric" onchange="updateNetwork()">
                        <option value="interestingness" selected>æœ‰è¶£åº¦</option>
                        <option value="betweenness">ä¸­ä»‹ä¸­å¿ƒæ€§</option>
                        <option value="degree">ç¨‹åº¦ä¸­å¿ƒæ€§</option>
                        <option value="views">æ’­æ”¾é‡</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>èŠ‚ç‚¹é¢œè‰²ï¼š</label>
                    <select id="node-color-metric" onchange="updateNetwork()">
                        <option value="interestingness" selected>æœ‰è¶£åº¦</option>
                        <option value="betweenness">ä¸­ä»‹ä¸­å¿ƒæ€§</option>
                        <option value="degree">ç¨‹åº¦ä¸­å¿ƒæ€§</option>
                        <option value="category">åˆ†ç±»</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>æ˜¾ç¤ºèŠ‚ç‚¹ï¼š</label>
                    <select id="node-filter" onchange="updateNetwork()">
                        <option value="all">å…¨éƒ¨</option>
                        <option value="top-interestingness">æœ‰è¶£åº¦ Top 20</option>
                        <option value="top-betweenness">ä¸­ä»‹ä¸­å¿ƒæ€§ Top 20</option>
                        <option value="top-degree">ç¨‹åº¦ä¸­å¿ƒæ€§ Top 20</option>
                    </select>
                </div>
            </div>

            <div class="network-wrapper" id="network-graph"></div>

            <!-- å›¾ä¾‹ -->
            <div class="network-legend">
                <div class="legend-item">
                    <span class="legend-dot interesting"></span>
                    <span>é«˜æœ‰è¶£åº¦ï¼ˆå¥—åˆ©æœºä¼šï¼‰</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot hot"></span>
                    <span>é«˜ä¸­ä»‹ä¸­å¿ƒæ€§ï¼ˆä¿¡æ¯æ¡¥æ¢ï¼‰</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot medium"></span>
                    <span>ä¸­ç­‰</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot cold"></span>
                    <span>ä½ä¸­å¿ƒæ€§</span>
                </div>
            </div>
        </div>

        <!-- è¯¦ç»†è§£é‡Š -->
        <div class="grid-2">
            <div class="chart-container">
                <div class="chart-title">ğŸ“Š ä¸­å¿ƒæ€§æŒ‡æ ‡åˆ†å¸ƒ</div>
                <div class="chart-wrapper" style="height: 350px;">
                    <canvas id="centrality-distribution"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">ğŸ¯ æœ‰è¶£åº¦ vs æ’­æ”¾é‡</div>
                <div class="chart-wrapper" style="height: 350px;">
                    <canvas id="interestingness-scatter"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ç¤ºä¾‹æ•°æ®ï¼ˆå®é™…ä½¿ç”¨æ—¶æ›¿æ¢ï¼‰
        // ============================================
        const NETWORK_DATA = {
            videos: [
                { id: 1, title: 'ä¸­åŒ»å…»ç”Ÿç§˜è¯€', views: 1500000, betweenness: 0.85, degree: 0.3, interestingness: 2.83 },
                { id: 2, title: 'é™è¡€å‹é£Ÿç–—æ–¹æ³•', views: 800000, betweenness: 0.72, degree: 0.25, interestingness: 2.88 },
                { id: 3, title: 'è€å¹´äººè¿åŠ¨æŒ‡å—', views: 2000000, betweenness: 0.45, degree: 0.8, interestingness: 0.56 },
                { id: 4, title: 'è†ç›–ä¿å¥æ“', views: 500000, betweenness: 0.65, degree: 0.2, interestingness: 3.25 },
                { id: 5, title: 'å¤±çœ è°ƒç†ç§˜æ–¹', views: 1200000, betweenness: 0.78, degree: 0.35, interestingness: 2.23 },
                { id: 6, title: 'å…»ç”ŸèŒ¶æ¨è', views: 3000000, betweenness: 0.3, degree: 0.9, interestingness: 0.33 },
                { id: 7, title: 'é¢ˆæ¤ç—…è‡ªæˆ‘åº·å¤', views: 600000, betweenness: 0.82, degree: 0.28, interestingness: 2.93 },
                { id: 8, title: 'ç³–å°¿ç—…é¥®é£Ÿç¦å¿Œ', views: 900000, betweenness: 0.55, degree: 0.45, interestingness: 1.22 },
                { id: 9, title: 'è¡¥è‚¾é£Ÿç–—æ–¹', views: 400000, betweenness: 0.88, degree: 0.22, interestingness: 4.0 },
                { id: 10, title: 'é«˜è¡€å‹ç©´ä½æŒ‰æ‘©', views: 700000, betweenness: 0.7, degree: 0.32, interestingness: 2.19 },
            ],
            links: [
                { source: 1, target: 2, weight: 3 },
                { source: 1, target: 5, weight: 2 },
                { source: 2, target: 8, weight: 4 },
                { source: 3, target: 6, weight: 5 },
                { source: 4, target: 7, weight: 3 },
                { source: 5, target: 9, weight: 2 },
                { source: 6, target: 3, weight: 4 },
                { source: 7, target: 4, weight: 2 },
                { source: 8, target: 10, weight: 3 },
                { source: 9, target: 1, weight: 2 },
                { source: 10, target: 2, weight: 3 },
                { source: 1, target: 3, weight: 1 },
                { source: 4, target: 9, weight: 2 },
                { source: 5, target: 7, weight: 1 },
                { source: 6, target: 8, weight: 2 },
            ]
        };

        // ============================================
        // åˆå§‹åŒ–æ¦œå•
        // ============================================
        function initRankings() {
            // æœ‰è¶£åº¦æ¦œ
            const interestingnessRanking = [...NETWORK_DATA.videos]
                .sort((a, b) => b.interestingness - a.interestingness)
                .slice(0, 5);
            renderRanking('interestingness-ranking', interestingnessRanking, 'interestingness', '#ffd700');

            // ä¸­ä»‹ä¸­å¿ƒæ€§æ¦œ
            const betweennessRanking = [...NETWORK_DATA.videos]
                .sort((a, b) => b.betweenness - a.betweenness)
                .slice(0, 5);
            renderRanking('betweenness-ranking', betweennessRanking, 'betweenness', '#667eea');

            // ç¨‹åº¦ä¸­å¿ƒæ€§æ¦œ
            const degreeRanking = [...NETWORK_DATA.videos]
                .sort((a, b) => b.degree - a.degree)
                .slice(0, 5);
            renderRanking('degree-ranking', degreeRanking, 'degree', '#f5576c');
        }

        function renderRanking(containerId, items, metric, color) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, i) => {
                const posClass = i === 0 ? 'top-1' : i === 1 ? 'top-2' : i === 2 ? 'top-3' : 'normal';
                const score = item[metric].toFixed(2);
                return `
                    <li class="ranking-item" data-id="${item.id}">
                        <div class="ranking-position ${posClass}">${i + 1}</div>
                        <div class="ranking-content">
                            <div class="ranking-title">${item.title}</div>
                            <div class="ranking-meta">æ’­æ”¾é‡: ${item.views.toLocaleString()}</div>
                        </div>
                        <div class="ranking-score" style="color: ${color}">${score}</div>
                    </li>
                `;
            }).join('');
        }

        // ============================================
        // åˆå§‹åŒ–ç½‘ç»œå›¾
        // ============================================
        let network = null;

        function initNetwork() {
            const container = document.getElementById('network-graph');

            const sizeMetric = document.getElementById('node-size-metric').value;
            const colorMetric = document.getElementById('node-color-metric').value;

            // æ„å»ºèŠ‚ç‚¹æ•°æ®
            const nodes = NETWORK_DATA.videos.map(v => {
                // è®¡ç®—èŠ‚ç‚¹å¤§å°
                let size;
                switch(sizeMetric) {
                    case 'betweenness': size = 10 + v.betweenness * 40; break;
                    case 'degree': size = 10 + v.degree * 40; break;
                    case 'views': size = 10 + (v.views / 3000000) * 40; break;
                    case 'interestingness':
                    default: size = 10 + (v.interestingness / 4) * 40; break;
                }

                // è®¡ç®—èŠ‚ç‚¹é¢œè‰²
                let color;
                switch(colorMetric) {
                    case 'betweenness':
                        color = v.betweenness > 0.7 ? '#667eea' : v.betweenness > 0.4 ? '#a8b4ff' : '#e0e5ff';
                        break;
                    case 'degree':
                        color = v.degree > 0.7 ? '#f5576c' : v.degree > 0.4 ? '#ff9aa8' : '#ffe0e4';
                        break;
                    case 'interestingness':
                    default:
                        color = v.interestingness > 2 ? '#ffd700' : v.interestingness > 1 ? '#ffeb80' : '#fff8cc';
                        break;
                }

                return {
                    id: v.id,
                    label: v.title.substring(0, 10) + '...',
                    value: size,
                    color: { background: color, border: color },
                    title: `<b>${v.title}</b><br>
                            æ’­æ”¾é‡: ${v.views.toLocaleString()}<br>
                            æœ‰è¶£åº¦: ${v.interestingness.toFixed(2)}<br>
                            ä¸­ä»‹ä¸­å¿ƒæ€§: ${v.betweenness.toFixed(2)}<br>
                            ç¨‹åº¦ä¸­å¿ƒæ€§: ${v.degree.toFixed(2)}`
                };
            });

            // æ„å»ºè¾¹æ•°æ®
            const edges = NETWORK_DATA.links.map(l => ({
                from: l.source,
                to: l.target,
                width: l.weight,
                color: { opacity: 0.5 }
            }));

            const data = {
                nodes: new vis.DataSet(nodes),
                edges: new vis.DataSet(edges)
            };

            const options = {
                nodes: {
                    shape: 'dot',
                    scaling: {
                        min: 15,
                        max: 50,
                        label: { enabled: true, min: 12, max: 24 }
                    },
                    font: { size: 12, face: 'Arial' }
                },
                edges: {
                    smooth: { type: 'continuous' }
                },
                physics: {
                    stabilization: { iterations: 150 },
                    barnesHut: {
                        gravitationalConstant: -3000,
                        springConstant: 0.04,
                        springLength: 120
                    }
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 100
                }
            };

            if (network) {
                network.destroy();
            }
            network = new vis.Network(container, data, options);
        }

        function updateNetwork() {
            initNetwork();
        }

        // ============================================
        // åˆå§‹åŒ–å›¾è¡¨
        // ============================================
        function initCharts() {
            // ä¸­å¿ƒæ€§åˆ†å¸ƒæ•£ç‚¹å›¾
            const ctx1 = document.getElementById('centrality-distribution');
            new Chart(ctx1, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'è§†é¢‘',
                        data: NETWORK_DATA.videos.map(v => ({
                            x: v.betweenness,
                            y: v.degree
                        })),
                        backgroundColor: NETWORK_DATA.videos.map(v =>
                            v.interestingness > 2 ? 'rgba(255, 215, 0, 0.8)' :
                            v.interestingness > 1 ? 'rgba(102, 126, 234, 0.8)' :
                            'rgba(79, 172, 254, 0.8)'
                        ),
                        pointRadius: NETWORK_DATA.videos.map(v => 5 + v.interestingness * 3)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const v = NETWORK_DATA.videos[context.dataIndex];
                                    return [
                                        v.title,
                                        `ä¸­ä»‹ä¸­å¿ƒæ€§: ${v.betweenness.toFixed(2)}`,
                                        `ç¨‹åº¦ä¸­å¿ƒæ€§: ${v.degree.toFixed(2)}`,
                                        `æœ‰è¶£åº¦: ${v.interestingness.toFixed(2)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'ä¸­ä»‹ä¸­å¿ƒæ€§ï¼ˆä»·å€¼ï¼‰' },
                            min: 0, max: 1
                        },
                        y: {
                            title: { display: true, text: 'ç¨‹åº¦ä¸­å¿ƒæ€§ï¼ˆä¼ æ’­ï¼‰' },
                            min: 0, max: 1
                        }
                    }
                }
            });

            // æœ‰è¶£åº¦ vs æ’­æ”¾é‡
            const ctx2 = document.getElementById('interestingness-scatter');
            new Chart(ctx2, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'è§†é¢‘',
                        data: NETWORK_DATA.videos.map(v => ({
                            x: v.views,
                            y: v.interestingness
                        })),
                        backgroundColor: 'rgba(255, 215, 0, 0.7)',
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const v = NETWORK_DATA.videos[context.dataIndex];
                                    return [v.title, `æ’­æ”¾é‡: ${v.views.toLocaleString()}`, `æœ‰è¶£åº¦: ${v.interestingness.toFixed(2)}`];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'æ’­æ”¾é‡' } },
                        y: { title: { display: true, text: 'æœ‰è¶£åº¦ï¼ˆå¥—åˆ©æœºä¼šï¼‰' } }
                    }
                }
            });
        }

        // ============================================
        // é¡µé¢åŠ è½½
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initRankings();
            initNetwork();
            initCharts();
        });
    </script>
</body>
</html>
