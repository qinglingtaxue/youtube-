# 图表选择策略决策记录

> 日期：2026-02-04
> 状态：已完成
> 关联文档：data-visualization.skill.md, cog.md (ChartCognitionMapping)

---

## 决策背景

在设计「全局认识」和「套利分析」两个核心页面时，需要为不同的数据需求选择合适的图表类型。本文档记录图表选择的通用决策逻辑，供各页面设计引用。

**核心原则**：
- 确保图的**多样性**和**直观性**
- 根据**数据类型**和**数量级**选择图表
- 用图表帮助用户理解**抽象概念**
- 图表**模板化**，方便复用

---

## 1. 页面定位与图表策略

不同页面有不同的定位，决定了图表策略的差异：

| 维度 | 全局认识 | 套利分析 |
|------|---------|---------|
| **核心问题** | 市场长什么样？（是什么） | 哪里有机会？（怎么做） |
| **用户目标** | 建立对数据信息分布的直观理解 | 直观理解数据在信息网络中的分布 |
| **数据关系** | 分布、统计、趋势 | 网络、关联、中心性 |
| **图表策略** | **多样化**展示各维度 | **聚焦网络图**理解中心性 |
| **多样性目标** | 8/8 类型，视觉丰富 | 4/8 类型，深度优先 |

**策略选择原则**：
- **看全貌** → 追求图表多样性，让用户快速扫描各维度
- **找机会** → 聚焦核心图表（网络图），深度理解关键概念

---

## 2. 图表选择决策矩阵

### 2.1 数据类型 → 图表类型

| 数据类型 | 数量级 | 推荐图表 | 备选方案 | 不推荐 |
|---------|-------|---------|---------|-------|
| **单一指标** | 1-6个 | 数字卡片 | 仪表盘 | 图表 |
| **分类计数** | 2-5类 | 环形图/饼图 | 柱状图 | 表格 |
| **分类计数** | 6-10类 | 水平柱状图 | 树图 | 饼图 |
| **分类计数** | 10+类 | 树图 | 词云 | 饼图、柱状图 |
| **连续分布** | 任意 | 直方图 | 箱线图 | 饼图 |
| **排名数据** | ≤10 | 水平柱状图/表格 | 数字卡片 | 饼图 |
| **排名数据** | 10-50 | 表格+迷你条 | 气泡图 | 柱状图 |
| **时间趋势** | ≤12点 | 折线图（带面积） | 柱状图 | 散点图 |
| **时间趋势** | 12-50点 | 折线图 | 面积图 | 柱状图 |
| **两指标相关** | ≤500点 | 散点图 | 气泡图 | 双柱状图 |
| **两指标相关** | 500+点 | 热力散点图 | 等高线图 | 普通散点 |
| **周期数据** | 7天/12月 | 雷达图 | 柱状图 | 折线图 |
| **时间×分类** | 小时×星期 | 热力图 | 日历图 | 折线图 |
| **网络关系** | ≤50节点 | 力导向图 | 弧线图 | 矩阵图 |
| **网络关系** | 50-200节点 | 力导向图+聚类 | 邻接矩阵 | 逐点标注 |
| **网络关系** | 200+节点 | 聚合网络图 | 矩阵热力图 | 完整网络 |
| **流量流向** | 任意 | 桑基图 | 弦图 | 多柱状图 |
| **地理分布** | 任意 | 地图+标记 | 气泡地图 | 表格 |
| **关键词/标签** | 20-200词 | 词云 | 树图 | 列表 |

### 2.2 数量级决策树

```
数据点数量?
├── 1-5 个
│   ├── 是关键指标? → 数字卡片
│   └── 是分类占比? → 环形图/饼图
│
├── 6-20 个
│   ├── 是排名? → 水平柱状图
│   ├── 是时间序列? → 折线图
│   ├── 是分类统计? → 垂直柱状图
│   └── 是关键词? → 词云（小型）
│
├── 20-100 个
│   ├── 是时间序列? → 折线图（降采样）
│   ├── 是二维相关? → 散点图
│   ├── 是分类统计? → 树图 Treemap
│   ├── 是网络关系? → 力导向图
│   └── 是关键词/标签? → 词云
│
├── 100-1000 个
│   ├── 是分布数据? → 直方图 + 箱线图
│   ├── 是二维相关? → 散点图 + 趋势线
│   ├── 是网络关系? → 聚类网络图
│   └── 是文本数据? → 词云
│
└── 1000+ 个
    ├── 是分布数据? → 核密度估计图
    ├── 是二维相关? → 六边形分箱 / 热力散点
    └── 是网络关系? → 聚合矩阵
```

---

## 3. 用户认知映射：图表帮助理解抽象概念

> **用户反馈**：「信息网络图可以帮助直观的理解中介中心性、程度中心性、有趣度」

### 3.1 抽象概念 → 可视化方式

| 用户不理解的概念 | 可视化方式 | 图表类型 | 用户直观理解 |
|----------------|-----------|---------|-------------|
| **中介中心性** | 节点大小 / 连线数量 | 网络图 | 节点越大 = 越是信息桥梁 |
| **程度中心性** | 节点连线数 / 节点颜色 | 网络图 | 连线越多 = 传播越广 |
| **有趣度** | 金色高亮 + 节点大小 | 网络图 | 金色 = 套利机会 |
| **P分位数** | 标注线 + 区域 | 直方图 | 在分布图上标注分位线 |
| **置信度** | 误差棒 | 柱状图/折线图 | 误差范围表示不确定性 |
| **互动率** | 播放量 vs 点赞散点 | 散点图 | 用两个用户懂的指标展示 |
| **流量来源** | 流向宽度 | 桑基图 | 越宽 = 流量越大 |
| **内容相似度** | 节点距离 | 网络图 | 越近 = 越相似 |
| **时间分布** | 颜色深浅 | 热力图 | 越深 = 越集中 |
| **关键词重要性** | 字体大小 | 词云 | 越大 = 越重要 |

### 3.2 网络图是理解中心性的最佳工具

套利分析的核心是**有趣度公式**：
```
有趣度 = 中介中心性 ÷ 程度中心性
       = 桥梁能力 ÷ 热门程度
       = 价值被低估的程度
```

这三个指标都是**网络属性**，用户无法通过数字直接理解（如「中介中心性=0.85」毫无意义）。

**网络图展示方式**：
```
┌─────────────────────────────────────────────────────────────────┐
│   控制面板:                                                      │
│   ┌────────────────┐ ┌────────────────┐ ┌────────────────┐      │
│   │ 节点大小:      │ │ 节点颜色:      │ │ 显示节点:      │      │
│   │ [有趣度 ▼]     │ │ [有趣度 ▼]     │ │ [全部 ▼]       │      │
│   └────────────────┘ └────────────────┘ └────────────────┘      │
│                                                                 │
│   网络图区域:                                                    │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │      ●───────●                     节点大小 = 指标值     │   │
│   │     /│       │\                    金色 = 高有趣度      │   │
│   │    ● │   ◉   │ ●                   紫色 = 高中介        │   │
│   │     \│  (大) │/                    红色 = 高程度        │   │
│   │      ●───────●                                          │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   图例: [●金] 高有趣度 [●紫] 高中介 [●红] 高程度 [●灰] 低中心性 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 多样性检查清单

每个「看全貌」类型的页面应至少包含以下类型的图表：

```
□ 数字展示类（卡片/仪表盘）    - 快速扫描关键指标
□ 比例类（饼图/环形图/树图）   - 理解占比分布
□ 比较类（柱状图）             - 大小对比
□ 趋势类（折线图/面积图）      - 时间变化
□ 关系类（散点图/网络图）      - 相关性发现
□ 分布类（直方图/热力图）      - 数据分布
□ 文本类（表格/列表/词云）     - 详细信息
□ 周期类（雷达图）             - 周期规律（可选）
```

### 多样性目标

| 页面类型 | 多样性目标 | 说明 |
|---------|-----------|------|
| **看全貌** | 8/8 类型 | 多角度展示，视觉丰富 |
| **找机会** | 4/8 类型 | 聚焦核心图表，深度优先 |

---

## 5. 模板化设计原则

### 5.1 函数封装

每种图表封装为独立函数，方便复用：

```javascript
// 基础图表 (Chart.js)
createBarChart(containerId, data, options)
createLineChart(containerId, data, options)
createPieChart(containerId, data, options)
createDoughnutChart(containerId, data, options)
createRadarChart(containerId, data, options)
createScatterChart(containerId, data, options)
createHistogram(containerId, data, options)

// 高级图表
createNetworkGraph(containerId, data, options)      // vis-network
createHeatmap(containerId, data, options)           // ECharts
createTreemap(containerId, data, options)           // ECharts
createSankeyDiagram(containerId, data, options)     // ECharts
createWordCloud(containerId, data, options)         // ECharts
createMap(containerId, data, options)               // Leaflet

// UI 组件
createStatCard(containerId, data)
createStatCardsRow(containerId, cards)
createChartContainer(title, chartElement)
```

### 5.2 统一配色方案

```css
/* 主色板 */
--primary: #667eea;      /* 主色：蓝紫 */
--secondary: #764ba2;    /* 辅色：紫 */
--accent: #f5576c;       /* 强调：红 */
--warning: #ffd700;      /* 警示/有趣度：金 */
--success: #00f2fe;      /* 成功：青 */
--info: #4facfe;         /* 信息：蓝 */

/* 语义化颜色 */
高价值/套利机会 → 金色 #ffd700
热门/高传播     → 红色 #f5576c
价值/桥梁       → 蓝紫 #667eea
普通/中等       → 浅蓝 #4facfe
冷门/低值       → 灰蓝 #a8b4ff
```

### 5.3 模板文件位置

```
src/templates/charts/
├── chart-templates.js           # 16 种图表函数库
├── chart-styles.css             # 完整样式表
├── global-overview-template.html     # 全局认识页面模板
└── arbitrage-analysis-template.html  # 套利分析页面模板
```

---

## 6. 交互设计原则

| 交互类型 | 适用图表 | 实现方式 |
|---------|---------|---------|
| 悬停高亮 | 所有图表 | 显示 tooltip，高亮当前元素 |
| 点击详情 | 散点图、网络图 | 弹出详情面板或跳转 |
| 筛选联动 | 多图表页面 | 全局筛选器，图表同步更新 |
| 缩放平移 | 网络图、地图 | 滚轮缩放，拖拽平移 |
| 切换视图 | 榜单、网络图 | 指标切换器（有趣度/中介/程度） |
| 时间范围 | 趋势图 | 时间窗口选择器 |

---

## 7. 禁止做的事 ❌

### 图表选择
- ❌ 饼图超过 5 个扇区（用树图或柱状图）
- ❌ 柱状图超过 15 个柱（用水平柱或树图）
- ❌ 雷达图超过 7 个维度（用热力矩阵）
- ❌ 网络图超过 200 个节点不聚合

### 颜色使用
- ❌ 用红绿色表示对比（色盲不友好）
- ❌ 用超过 7 种颜色区分类别
- ❌ 热力图不提供颜色图例

### 用户认知
- ❌ 用数字展示用户不理解的概念（如中心性=0.85）
- ❌ 不解释专业术语
- ❌ 不提供图表说明/图例

---

## 8. 用户反馈记录

| 反馈 | 问题 | 正确做法 |
|------|------|---------|
| "还有信息网络图、地图" | 遗漏高级图表类型 | 检查是否需要网络图/地图/热力图/桑基图/词云 |
| "还有桑基图" | 遗漏流量流向图表 | 流量归因场景使用桑基图 |
| "信息网络图可以帮助直观理解中介中心性、程度中心性、有趣度" | 抽象概念用数字展示 | 用图表直观化抽象概念 |
| "什么数量级用什么图，什么数据类型用什么图" | 缺少选择决策 | 先判断数据类型和量级再选图表 |
| "要确保图的多样性和直观性" | 图表类型单一 | 每页检查多样性清单 |
| "你没提到词云" | 遗漏词云图表 | 关键词/标签场景使用词云 |
| "要把图模板化、方便后续被多次调用" | 图表代码重复 | 封装为函数库 |

---

## 9. 决策总结

| 决策 | 原因 |
|------|------|
| 按页面定位选择图表策略 | 「看全貌」追求多样性，「找机会」聚焦核心 |
| 建立数据类型→图表决策矩阵 | 避免主观选择，有据可依 |
| 建立数量级决策树 | 不同数量级需要不同图表 |
| 抽象概念必须可视化 | 用户无法理解中心性=0.85 |
| 网络图是理解中心性的最佳工具 | 用户反馈验证 |
| 多样性检查清单 | 确保页面视觉丰富 |
| 图表函数模板化 | 复用、一致性、维护性 |
| 统一配色方案 | 视觉一致性 |

---

## 10. 相关文档

- `.42cog/skills/data-visualization.skill.md` - 完整决策矩阵（技能文档）
- `.42cog/cog/cog.md` - ChartCognitionMapping 实体定义
- `src/templates/charts/chart-templates.js` - 图表函数库
- `src/templates/charts/chart-styles.css` - 统一样式表
