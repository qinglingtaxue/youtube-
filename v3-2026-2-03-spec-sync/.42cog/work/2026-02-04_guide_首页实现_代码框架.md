# é¦–é¡µå®ç°æŒ‡å—ï¼ˆä»£ç æ¡†æ¶ï¼‰

> æ—¥æœŸï¼š2026-02-04
> çŠ¶æ€ï¼šå®ç°æ¡†æ¶å·²å®š
> ä»è®¾è®¡è½¬åŒ–ä¸ºä»£ç çš„å…·ä½“æ­¥éª¤

---

## é¡¹ç›®åˆå§‹åŒ–

### 1. åˆ›å»º Next.js 15 é¡¹ç›®

```bash
# ä½¿ç”¨ bun ä½œä¸ºåŒ…ç®¡ç†å™¨
bun create next-app@latest youtube-analyzer-web \
  --typescript \
  --tailwind \
  --app \
  --no-eslint \
  --no-git

cd youtube-analyzer-web

# å®‰è£… shadcn/ui
bun install -D shadcn-ui
bunx shadcn-ui@latest init
```

### 2. é¡¹ç›®ç›®å½•ç»“æ„

```
apps/web/                          # Next.js å‰ç«¯
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€ (å¯¼èˆª/è®¤è¯)
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µ
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â””â”€â”€ page.tsx              # æœç´¢ç»“æœé¡µ
â”‚   â”œâ”€â”€ videos/
â”‚   â”‚   â”œâ”€â”€ page.tsx              # è§†é¢‘åˆ—è¡¨é¡µ
â”‚   â”‚   â””â”€â”€ [id]/page.tsx         # è§†é¢‘è¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ channels/
â”‚   â”‚   â””â”€â”€ page.tsx              # é¢‘é“æ’è¡Œé¡µ
â”‚   â”œâ”€â”€ trends/
â”‚   â”‚   â””â”€â”€ page.tsx              # è¯é¢˜è¶‹åŠ¿é¡µ
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ search/route.ts
â”‚       â”œâ”€â”€ videos/
â”‚       â”‚   â”œâ”€â”€ route.ts
â”‚       â”‚   â””â”€â”€ trending/route.ts
â”‚       â”œâ”€â”€ channels/
â”‚       â”‚   â”œâ”€â”€ route.ts
â”‚       â”‚   â””â”€â”€ trending/route.ts
â”‚       â””â”€â”€ analytics/
â”‚           â””â”€â”€ overview/route.ts
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”œâ”€â”€ SearchBox.tsx
â”‚   â”‚   â”œâ”€â”€ SearchHistory.tsx
â”‚   â”‚   â”œâ”€â”€ FilterPanel.tsx
â”‚   â”‚   â”œâ”€â”€ FeatureCards.tsx
â”‚   â”‚   â”œâ”€â”€ VideoCarousel.tsx
â”‚   â”‚   â”œâ”€â”€ ChannelTable.tsx
â”‚   â”‚   â””â”€â”€ DataOverview.tsx
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â”œâ”€â”€ SortBar.tsx
â”‚   â”‚   â”œâ”€â”€ ResultsList.tsx
â”‚   â”‚   â””â”€â”€ SearchPagination.tsx
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ ... (shadcn/ui ç»„ä»¶å¯¼å…¥)
â”‚   â””â”€â”€ shared/
â”‚       â”œâ”€â”€ Navbar.tsx
â”‚       â”œâ”€â”€ Footer.tsx
â”‚       â””â”€â”€ AuthButton.tsx
â”‚
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ searchStore.ts            # Zustand æœç´¢çŠ¶æ€
â”‚   â”œâ”€â”€ authStore.ts              # è®¤è¯çŠ¶æ€ (Better Auth)
â”‚   â””â”€â”€ uiStore.ts                # UI çŠ¶æ€ (ä¸»é¢˜ç­‰)
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts                    # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ types.ts                  # å…¨å±€ TypeScript ç±»å‹
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useSearch.ts
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ useTrendingData.ts
â”‚   â””â”€â”€ utils.ts                  # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ ... (é™æ€èµ„æº)
â”‚
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ bun.lockb
â””â”€â”€ package.json
```

---

## æ ¸å¿ƒæ–‡ä»¶å®ç°æ¡†æ¶

### 1. æ ¹å¸ƒå±€ (app/layout.tsx)

```typescript
import type { Metadata } from 'next'
import { ThemeProvider } from '@/components/providers/ThemeProvider'
import { AuthProvider } from '@/components/providers/AuthProvider'
import { Navbar } from '@/components/shared/Navbar'
import { Footer } from '@/components/shared/Footer'
import { Toaster } from '@/components/ui/toaster'
import './globals.css'

export const metadata: Metadata = {
  title: 'YouTube ç«å“åˆ†æå·¥å…·',
  description: 'è§†é¢‘é€‰é¢˜æ•°æ®é©±åŠ¨ï¼Œå‘ç°å¸‚åœºæ´å¯Ÿå’Œå¥—åˆ©æœºä¼š',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN" suppressHydrationWarning>
      <body>
        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
          <AuthProvider>
            <div className="flex flex-col min-h-screen">
              <Navbar />
              <main className="flex-1">
                {children}
              </main>
              <Footer />
            </div>
            <Toaster />
          </AuthProvider>
        </ThemeProvider>
      </body>
    </html>
  )
}
```

### 2. é¦–é¡µ (app/page.tsx)

```typescript
import { Suspense } from 'react'
import { SearchSection } from '@/components/home/SearchSection'
import { FeatureCards } from '@/components/home/FeatureCards'
import { DiscoverySection } from '@/components/home/DiscoverySection'
import { DataOverview } from '@/components/home/DataOverview'
import { Skeleton } from '@/components/ui/skeleton'

// ISR: æ¯å°æ—¶é‡æ–°ç”Ÿæˆ
export const revalidate = 3600

async function TrendingVideos() {
  try {
    const res = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/api/videos/trending?limit=5&timeRange=7d`,
      { next: { revalidate: 3600 } }
    )
    const { data } = await res.json()
    return <VideoCarousel videos={data.videos} />
  } catch (error) {
    return <div>åŠ è½½å¤±è´¥</div>
  }
}

async function TrendingChannels() {
  try {
    const res = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/api/channels/trending?limit=3`,
      { next: { revalidate: 3600 } }
    )
    const { data } = await res.json()
    return <ChannelTable channels={data.channels} />
  } catch (error) {
    return <div>åŠ è½½å¤±è´¥</div>
  }
}

async function AnalyticsData() {
  try {
    const res = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/api/analytics/overview`,
      { next: { revalidate: 3600 } }
    )
    const { data } = await res.json()
    return <DataOverview analytics={data} />
  } catch (error) {
    return <div>åŠ è½½å¤±è´¥</div>
  }
}

export default function HomePage() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* æœç´¢åŒº */}
        <SearchSection />

        {/* ä¸‰å¤§åŠŸèƒ½å…¥å£ */}
        <section className="py-8">
          <FeatureCards />
        </section>

        {/* å¿«é€Ÿå‘ç°åŒº */}
        <section className="py-8">
          <h2 className="text-2xl font-bold mb-6">å¿«é€Ÿå‘ç°</h2>
          <div className="space-y-12">
            {/* æœ¬å‘¨çˆ†æ¬¾ */}
            <div>
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-semibold">ğŸ”¥ æœ¬å‘¨çˆ†æ¬¾ (æ’­æ”¾é‡ Top 5)</h3>
                <a href="/videos?sort=views&time=7d" className="text-sm text-blue-600 hover:underline">
                  æŸ¥çœ‹å…¨éƒ¨ â†’
                </a>
              </div>
              <Suspense fallback={<div className="h-48 bg-gray-200 rounded animate-pulse" />}>
                <TrendingVideos />
              </Suspense>
            </div>

            {/* é»‘é©¬é¢‘é“ */}
            <div>
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-semibold">ğŸ† é»‘é©¬é¢‘é“ (ä½è®¢é˜…é«˜æ’­æ”¾)</h3>
                <a href="/channels?type=high-efficiency" className="text-sm text-blue-600 hover:underline">
                  æŸ¥çœ‹å…¨éƒ¨ â†’
                </a>
              </div>
              <Suspense fallback={<div className="h-48 bg-gray-200 rounded animate-pulse" />}>
                <TrendingChannels />
              </Suspense>
            </div>
          </div>
        </section>

        {/* æ•°æ®æ¦‚è§ˆ */}
        <section className="py-8 border-t">
          <h2 className="text-2xl font-bold mb-6">ğŸ“ˆ æ•°æ®æ¦‚è§ˆ</h2>
          <Suspense fallback={<div className="grid grid-cols-4 gap-4">
            {[...Array(4)].map((_, i) => <Skeleton key={i} className="h-24" />)}
          </div>}>
            <AnalyticsData />
          </Suspense>
        </section>
      </div>
    </div>
  )
}
```

### 3. Zustand Store (stores/searchStore.ts)

```typescript
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

export type SearchFilters = {
  timeRange: '24h' | '7d' | '30d' | '1y' | 'all'
  duration: 'all' | '<4min' | '4-20min' | '>20min'
  channelSize: 'all' | '<10k' | '10-100k' | '100-1M' | '>1M'
  minViews?: number
  contentTags: string[]
}

export type SortConfig = {
  timeRange: string
  sortField: 'views' | 'likes' | 'comments' | 'avgDailyViews' | 'duration'
  direction: 'asc' | 'desc'
}

export type SearchHistoryItem = {
  id: string
  query: string
  timestamp: number
  resultsCount?: number
}

interface SearchState {
  // UI çŠ¶æ€
  searchQuery: string
  isFilterOpen: boolean

  // æœç´¢å†å²
  searchHistory: SearchHistoryItem[]

  // å½“å‰ç­›é€‰
  filters: SearchFilters

  // æ’åºé…ç½®
  sortConfig: SortConfig

  // æ“ä½œ
  setSearchQuery: (query: string) => void
  toggleFilter: () => void
  addSearchHistory: (query: string, count?: number) => void
  clearSearchHistory: () => void
  removeHistoryItem: (id: string) => void
  updateFilters: (filters: Partial<SearchFilters>) => void
  resetFilters: () => void
  updateSort: (config: Partial<SortConfig>) => void

  // ç”Ÿæˆè‡ªç„¶è¯­è¨€æ’åºè¯´æ˜
  getSortDescription: () => string
}

const defaultFilters: SearchFilters = {
  timeRange: '7d',
  duration: 'all',
  channelSize: 'all',
  minViews: undefined,
  contentTags: [],
}

const defaultSort: SortConfig = {
  timeRange: '7d',
  sortField: 'views',
  direction: 'desc',
}

export const useSearchStore = create<SearchState>()(
  persist(
    (set, get) => ({
      searchQuery: '',
      isFilterOpen: false,
      searchHistory: [],
      filters: defaultFilters,
      sortConfig: defaultSort,

      setSearchQuery: (query) => set({ searchQuery: query }),

      toggleFilter: () => set((state) => ({ isFilterOpen: !state.isFilterOpen })),

      addSearchHistory: (query, count) => {
        const { searchHistory } = get()
        const newItem: SearchHistoryItem = {
          id: Date.now().toString(),
          query,
          timestamp: Date.now(),
          resultsCount: count,
        }

        const filtered = searchHistory.filter((item) => item.query !== query)
        const updated = [newItem, ...filtered].slice(0, 10) // æœ€å¤šä¿å­˜ 10 æ¡

        set({ searchHistory: updated })
      },

      clearSearchHistory: () => set({ searchHistory: [] }),

      removeHistoryItem: (id) =>
        set((state) => ({
          searchHistory: state.searchHistory.filter((item) => item.id !== id),
        })),

      updateFilters: (updates) =>
        set((state) => ({
          filters: { ...state.filters, ...updates },
        })),

      resetFilters: () => set({ filters: defaultFilters }),

      updateSort: (updates) =>
        set((state) => ({
          sortConfig: { ...state.sortConfig, ...updates },
        })),

      getSortDescription: () => {
        const { sortConfig } = get()
        const timeRangeText: Record<string, string> = {
          '24h': '24å°æ—¶å†…',
          '7d': 'è¿‡å»7å¤©',
          '30d': 'è¿‡å»30å¤©',
          '1y': 'è¿‡å»1å¹´',
          'all': 'å…¨éƒ¨æ—¶é—´',
        }

        const fieldText: Record<string, string> = {
          views: 'æ’­æ”¾é‡',
          likes: 'ç‚¹èµæ•°',
          comments: 'è¯„è®ºæ•°',
          avgDailyViews: 'æ—¥å‡æ’­æ”¾',
          duration: 'æ—¶é•¿',
        }

        const direction = sortConfig.direction === 'desc' ? 'é«˜â†’ä½' : 'ä½â†’é«˜'

        return `${timeRangeText[sortConfig.timeRange]}å‘å¸ƒçš„è§†é¢‘ï¼ŒæŒ‰${fieldText[sortConfig.sortField]}ä»${direction}æ’åº`
      },
    }),
    {
      name: 'yt-search-store',
      partialize: (state) => ({
        searchHistory: state.searchHistory,
        filters: state.filters,
        sortConfig: state.sortConfig,
      }),
    }
  )
)
```

### 4. API è·¯ç”±ç¤ºä¾‹ (app/api/search/route.ts)

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { z } from 'zod'

// è¯·æ±‚æ ¡éªŒ
const SearchRequestSchema = z.object({
  query: z.string().min(1, 'æœç´¢è¯ä¸èƒ½ä¸ºç©º'),
  filters: z.object({
    timeRange: z.enum(['24h', '7d', '30d', '1y', 'all']),
    duration: z.enum(['all', '<4min', '4-20min', '>20min']),
    channelSize: z.enum(['all', '<10k', '10-100k', '100-1M', '>1M']),
    minViews: z.number().optional(),
    contentTags: z.array(z.string()),
  }),
  sortConfig: z.object({
    timeRange: z.string(),
    sortField: z.enum(['views', 'likes', 'comments', 'avgDailyViews', 'duration']),
    direction: z.enum(['asc', 'desc']),
  }),
  page: z.number().optional(),
  limit: z.number().optional(),
})

export async function POST(req: NextRequest) {
  try {
    const body = await req.json()
    const validated = SearchRequestSchema.parse(body)

    // è°ƒç”¨åç«¯ API (Fastify)
    const backendRes = await fetch(
      `${process.env.BACKEND_API_URL}/api/search`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(validated),
      }
    )

    if (!backendRes.ok) {
      throw new Error('åç«¯æœç´¢å¤±è´¥')
    }

    const data = await backendRes.json()

    // ç”Ÿæˆè‡ªç„¶è¯­è¨€æ’åºè¯´æ˜
    const naturalLanguage = generateSortDescription(validated.sortConfig)

    return NextResponse.json({
      success: true,
      data: {
        results: data.results,
        total: data.total,
        page: validated.page || 1,
        naturalLanguage,
      },
    })
  } catch (error) {
    return NextResponse.json(
      {
        success: false,
        error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯',
      },
      { status: 400 }
    )
  }
}

function generateSortDescription(sortConfig: any): string {
  const timeRangeText: Record<string, string> = {
    '24h': '24å°æ—¶å†…',
    '7d': 'è¿‡å»7å¤©',
    '30d': 'è¿‡å»30å¤©',
    '1y': 'è¿‡å»1å¹´',
    'all': 'å…¨éƒ¨æ—¶é—´',
  }

  const fieldText: Record<string, string> = {
    views: 'æ’­æ”¾é‡',
    likes: 'ç‚¹èµæ•°',
    comments: 'è¯„è®ºæ•°',
    avgDailyViews: 'æ—¥å‡æ’­æ”¾',
    duration: 'æ—¶é•¿',
  }

  const direction = sortConfig.direction === 'desc' ? 'é«˜â†’ä½' : 'ä½â†’é«˜'

  return `${timeRangeText[sortConfig.timeRange]}å‘å¸ƒçš„è§†é¢‘ï¼ŒæŒ‰${fieldText[sortConfig.sortField]}ä»${direction}æ’åº`
}
```

### 5. SearchBox ç»„ä»¶å®Œæ•´å®ç°

```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { useSearchStore } from '@/stores/searchStore'
import { SearchIcon, Loader2 } from 'lucide-react'

export function SearchBox() {
  const router = useRouter()
  const [loading, setLoading] = useState(false)
  const { searchQuery, setSearchQuery, addSearchHistory } = useSearchStore()

  const handleSearch = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!searchQuery.trim()) return

    setLoading(true)
    try {
      // ä¿å­˜åˆ°å†å²è®°å½•
      addSearchHistory(searchQuery)

      // è·³è½¬åˆ°æœç´¢ç»“æœé¡µ
      router.push(`/search?q=${encodeURIComponent(searchQuery)}`)
    } finally {
      setLoading(false)
    }
  }

  return (
    <form onSubmit={handleSearch} className="w-full">
      <div className="relative">
        <SearchIcon className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
        <Input
          placeholder="è¾“å…¥å…³é”®è¯æœç´¢ï¼ˆå¦‚ï¼šå…»ç”Ÿã€å¤ªæã€ä¸­åŒ»ï¼‰"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          className="pl-10 pr-4 py-3 text-lg rounded-lg border-2 border-gray-200 focus:border-blue-500"
          disabled={loading}
        />
        <Button
          type="submit"
          disabled={!searchQuery.trim() || loading}
          className="absolute right-2 top-1/2 -translate-y-1/2"
        >
          {loading ? (
            <Loader2 className="w-4 h-4 animate-spin" />
          ) : (
            'æœç´¢'
          )}
        </Button>
      </div>
    </form>
  )
}
```

---

## ç¯å¢ƒå˜é‡é…ç½®

### .env.local

```env
# API é…ç½®
NEXT_PUBLIC_API_URL=http://localhost:3000
BACKEND_API_URL=http://localhost:8000

# Better Auth é…ç½®
NEXTAUTH_SECRET=your-secret-key
NEXTAUTH_URL=http://localhost:3000

# Analytics (å¯é€‰)
NEXT_PUBLIC_GA_ID=UA-XXXXXXXXX-X
```

---

## å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
bun install

# å¼€å‘æ¨¡å¼ (çƒ­é‡è½½)
bun run dev
# è®¿é—® http://localhost:3000

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
bun run build

# ç”Ÿäº§æ¨¡å¼è¿è¡Œ
bun run start

# ç±»å‹æ£€æŸ¥
bun run type-check

# Linting
bun run lint

# ä»£ç æ ¼å¼åŒ–
bun run format
```

---

## æ€§èƒ½ä¼˜åŒ–æ¸…å•

- [ ] å›¾ç‰‡ä¼˜åŒ–ï¼šä½¿ç”¨ `next/image` + WebP æ ¼å¼
- [ ] ä»£ç åˆ†å‰²ï¼šè·¯ç”±çº§åˆ«çš„ code splitting
- [ ] ç¼“å­˜ç­–ç•¥ï¼šISR + Service Worker
- [ ] Lazy Loadingï¼šIntersectionObserver for æ‡’åŠ è½½å¡ç‰‡
- [ ] å­—ä½“ä¼˜åŒ–ï¼šä½¿ç”¨ `next/font` æœ¬åœ°åŠ è½½
- [ ] åŒ…ä½“ç§¯ï¼štree-shaking + åŠ¨æ€å¯¼å…¥
- [ ] CDNï¼šTailwind é¢„ç¼–è¯‘ + minify

---

## æµ‹è¯•ç­–ç•¥

```bash
# å•å…ƒæµ‹è¯•
bun test

# E2E æµ‹è¯• (ä½¿ç”¨ Playwright)
bun run test:e2e

# æ€§èƒ½æµ‹è¯• (Lighthouse)
bun run test:performance
```

---

## éƒ¨ç½²åˆ° Vercel

```bash
# 1. è¿æ¥ GitHub ä»“åº“
git init && git add . && git commit -m "initial commit"
git remote add origin https://github.com/your-repo
git push -u origin main

# 2. åœ¨ Vercel Dashboard å¯¼å…¥é¡¹ç›®
# - é€‰æ‹© GitHub ä»“åº“
# - é…ç½®ç¯å¢ƒå˜é‡ (.env.local)
# - ç‚¹å‡» Deploy

# æˆ–ä½¿ç”¨ CLI
bun install -g vercel
vercel
```

---

## ä¸‹ä¸€æ­¥ä»»åŠ¡

1. **æœç´¢ç»“æœé¡µ** (`/search?q=...`)ï¼šå®ç°åŠ¨æ€æŸ¥è¯¢å’Œç»“æœå±•ç¤º
2. **è§†é¢‘è¯¦æƒ…é¡µ** (`/videos/[id]`ï¼‰ï¼šå±•ç¤ºå®Œæ•´è§†é¢‘æ•°æ®å’Œåˆ†æ
3. **é¢‘é“æ’è¡Œé¡µ** (`/channels`ï¼‰ï¼šé¢‘é“æ•°æ®è¡¨æ ¼å’Œæ’åº
4. **è¯é¢˜è¶‹åŠ¿é¡µ** (`/trends`)ï¼šé›†æˆ Google Trends API
5. **è®¤è¯ç³»ç»Ÿ**ï¼šä½¿ç”¨ Better Auth å®ç°ç”¨æˆ·æ³¨å†Œ/ç™»å½•
6. **æ•°æ®å¯è§†åŒ–**ï¼šé›†æˆ Recharts/ECharts for æ•°æ®å›¾è¡¨
7. **æš—è‰²æ¨¡å¼**ï¼šTailwind dark mode toggle
8. **å›½é™…åŒ–**ï¼ši18n æ”¯æŒå¤šè¯­è¨€

