# Phase 4 - é¦–é¡µå®Œæˆè®¡åˆ’

> æ—¥æœŸï¼š2026-02-04
> çŠ¶æ€ï¼šè®¡åˆ’ä¸­
> ä¼˜å…ˆçº§ï¼šğŸ”´ é«˜ï¼ˆé˜»å¡ Phase 5-7ï¼‰
> é¢„ä¼°å·¥æ—¶ï¼š2-3 å¤©

---

## ç°çŠ¶è¯„ä¼°

### âœ… å·²å®Œæˆï¼ˆ80%ï¼‰

1. **UI å¸ƒå±€ä¸äº¤äº’**
   - âœ… æœç´¢æ¡† (SearchBox)
   - âœ… æœç´¢å†å² (SearchHistory)
   - âœ… ç­›é€‰æ¡ä»¶é¢æ¿ (FilterPanel)
   - âœ… ä¸‰å¤§åŠŸèƒ½å¡ç‰‡ (Videos/Channels/Trends)
   - âœ… æš—è‰²æ¨¡å¼åˆ‡æ¢
   - âœ… å“åº”å¼è®¾è®¡

2. **çŠ¶æ€ç®¡ç†**
   - âœ… Zustand searchStore
   - âœ… localStorage æŒä¹…åŒ–
   - âœ… æœç´¢å†å²ç®¡ç†

3. **æœç´¢ç»“æœé¡µ**
   - âœ… æ’åºæ§åˆ¶é¢æ¿ (SortPanel)
   - âœ… è‡ªç„¶è¯­è¨€æ’åºè¯´æ˜
   - âœ… è§†é¢‘ç»“æœåˆ—è¡¨å±•ç¤º

### âŒ ç¼ºå¤±ï¼ˆ20%ï¼‰

1. **é¦–é¡µæ•°æ®å±•ç¤ºç»„ä»¶**
   - VideoCarouselï¼ˆæœ¬å‘¨çˆ†æ¬¾ï¼‰
   - ChannelTableï¼ˆé»‘é©¬é¢‘é“ï¼‰
   - DataOverviewï¼ˆæ•°æ®æ¦‚è§ˆï¼‰

2. **API å®ç°**
   - `GET /api/videos/trending` - çƒ­é—¨è§†é¢‘åˆ—è¡¨
   - `GET /api/channels/trending` - çƒ­é—¨é¢‘é“åˆ—è¡¨
   - `GET /api/analytics/overview` - æ•°æ®ç»Ÿè®¡æ¦‚è§ˆ

3. **æ€§èƒ½ä¼˜åŒ–**
   - ISR é…ç½®ï¼ˆæ¯å°æ—¶é‡æ–°ç”Ÿæˆï¼‰
   - Suspense å¼‚æ­¥è¾¹ç•Œ
   - æ•°æ®åŠ è½½éª¨æ¶å±

---

## å®ç°ä»»åŠ¡æ¸…å•

### ç¬¬ 1 æ­¥ï¼šå®Œæˆ VideoCarousel ç»„ä»¶ï¼ˆ6 å°æ—¶ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`components/home/VideoCarousel.tsx`

**åŠŸèƒ½éœ€æ±‚**ï¼š
- æ˜¾ç¤º 5 æ¡è§†é¢‘å¡ç‰‡çš„æ°´å¹³è½®æ’­
- æ¯å¼ å¡ç‰‡æ˜¾ç¤ºï¼šç¼©ç•¥å›¾ã€æ ‡é¢˜ã€æ’­æ”¾é‡ã€å‘å¸ƒæ—¶é—´
- å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯éšè—éƒ¨åˆ†æ–‡å­—

**æ•°æ®ç»“æ„**ï¼š
```typescript
interface Video {
  id: string
  title: string
  thumbnail: string
  views: number
  publishedAt: string
  channelName: string
  channelSubscribers: number
  duration: number
}
```

**ç»„ä»¶æ¥å£**ï¼š
```typescript
interface VideoCarouselProps {
  videos: Video[]
}
```

**å®ç°æ­¥éª¤**ï¼š
1. [ ] è®¾è®¡å¡ç‰‡ UIï¼ˆTailwindï¼‰
2. [ ] å®ç°æ°´å¹³æ»šåŠ¨å®¹å™¨
3. [ ] å¤„ç†ç¼©ç•¥å›¾åŠ è½½å’Œ fallback
4. [ ] æ·»åŠ æ•°å­—æ ¼å¼åŒ–ï¼ˆæ’­æ”¾é‡æ˜¾ç¤ºä¸º"245ä¸‡"ï¼‰
5. [ ] ç§»åŠ¨ç«¯å“åº”å¼æµ‹è¯•

---

### ç¬¬ 2 æ­¥ï¼šå®Œæˆ ChannelTable ç»„ä»¶ï¼ˆ6 å°æ—¶ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`components/home/ChannelTable.tsx`ï¼ˆå·²å­˜åœ¨ï¼Œéœ€å®Œå–„ï¼‰

**åŠŸèƒ½éœ€æ±‚**ï¼š
- æ˜¾ç¤º 3-5 ä¸ªé¢‘é“çš„æ•ˆç‡ä¿¡æ¯
- æ¡Œé¢ç‰ˆï¼šè¡¨æ ¼è§†å›¾
- ç§»åŠ¨ç‰ˆï¼šå¡ç‰‡è§†å›¾ï¼ˆ2Ã—2 ç½‘æ ¼ï¼‰
- æ˜¾ç¤ºï¼šé¢‘é“åã€è®¢é˜…æ•°ã€å¹³å‡æ’­æ”¾ã€æ•ˆç‡åˆ†æ•°ã€æ›´æ–°æ—¶é—´

**æ•°æ®ç»“æ„**ï¼š
```typescript
interface Channel {
  id: string
  name: string
  subscriberCount: number
  averageViews: number
  efficiency: number // å¹³å‡æ’­æ”¾ / è®¢é˜…
  lastUpdated: string
  avatar?: string
}
```

**å®ç°æ­¥éª¤**ï¼š
1. [ ] éªŒè¯ç°æœ‰ä»£ç é€»è¾‘
2. [ ] ä¼˜åŒ–è¡¨æ ¼æ ·å¼ï¼ˆæ–‘é©¬çº¹ã€æ‚¬åœæ•ˆæœï¼‰
3. [ ] å®ç°ç§»åŠ¨ç«¯å¡ç‰‡è§†å›¾
4. [ ] æ•ˆç‡åˆ†æ•°æ˜¾ç¤ºæ ¼å¼ï¼ˆå¦‚ 7.1xï¼‰
5. [ ] æ—¶é—´ç›¸å¯¹æ˜¾ç¤ºï¼ˆ"2å¤©å‰"ï¼‰

---

### ç¬¬ 3 æ­¥ï¼šå®Œæˆ DataOverview ç»„ä»¶ï¼ˆ4 å°æ—¶ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`components/home/DataOverview.tsx`ï¼ˆå·²å­˜åœ¨ï¼Œéœ€å®Œå–„ï¼‰

**åŠŸèƒ½éœ€æ±‚**ï¼š
- æ˜¾ç¤º 3 ä¸ªç»Ÿè®¡æ•°å­—ï¼šè§†é¢‘æ•°ã€é¢‘é“æ•°ã€è¯é¢˜æ•°
- æ˜¾ç¤ºæœ€åé‡‡é›†æ—¶é—´
- ç‚¹å‡»"é‡‡é›†è®¾ç½®"æŒ‰é’®å¯¼å‘é…ç½®é¡µé¢ï¼ˆæš‚æ—¶å¯ disabledï¼‰

**æ•°æ®ç»“æ„**ï¼š
```typescript
interface Analytics {
  videoCount: number
  channelCount: number
  topicCount: number
  lastCollectedAt: string
}
```

**å®ç°æ­¥éª¤**ï¼š
1. [ ] éªŒè¯ç°æœ‰ä»£ç é€»è¾‘
2. [ ] è®¾è®¡æ•°æ®å¡ç‰‡ UI
3. [ ] å®ç°æ•°å­—æ ¼å¼åŒ–
4. [ ] æ˜¾ç¤ºç›¸å¯¹æ—¶é—´ï¼ˆ"2å°æ—¶å‰"ï¼‰
5. [ ] "é‡‡é›†è®¾ç½®"æŒ‰é’®æ ·å¼

---

### ç¬¬ 4 æ­¥ï¼šå®ç° API è·¯ç”±ï¼ˆ8 å°æ—¶ï¼‰

#### 4.1 GET /api/videos/trending

**è·¯å¾„**ï¼š`app/api/videos/trending/route.ts`

**åŠŸèƒ½**ï¼šè¿”å›æŒ‡å®šæ—¶é—´èŒƒå›´å†…æ’­æ”¾é‡æœ€é«˜çš„è§†é¢‘

**è¯·æ±‚å‚æ•°**ï¼š
```typescript
{
  limit?: number // é»˜è®¤ 5
  timeRange?: '7d' | '30d' | '90d' | 'all'
}
```

**å“åº”æ ¼å¼**ï¼š
```typescript
{
  success: boolean
  data: {
    videos: Video[]
  }
  error?: string
}
```

**å®ç°é€»è¾‘**ï¼š
1. [ ] è°ƒç”¨åç«¯ APIï¼ˆFastifyï¼‰æˆ–æ•°æ®åº“æŸ¥è¯¢
2. [ ] æŒ‰æ’­æ”¾é‡é™åºæ’åº
3. [ ] é™åˆ¶è¿”å›è®°å½•æ•°
4. [ ] æ—¶é—´èŒƒå›´è¿‡æ»¤
5. [ ] é”™è¯¯å¤„ç†

**åç«¯ API ä¾èµ–**ï¼š
```
POST /api/videos/trending
{
  limit: 5,
  timeRange: "7d"
}
â†’ { data: Video[] }
```

#### 4.2 GET /api/channels/trending

**è·¯å¾„**ï¼š`app/api/channels/trending/route.ts`

**åŠŸèƒ½**ï¼šè¿”å›"ä½è®¢é˜…é«˜æ’­æ”¾"çš„é¢‘é“ï¼ˆé»‘é©¬é¢‘é“ï¼‰

**è¯·æ±‚å‚æ•°**ï¼š
```typescript
{
  limit?: number // é»˜è®¤ 3
  minSubscribers?: number // è¿‡æ»¤ä¸‹é™
  maxSubscribers?: number // è¿‡æ»¤ä¸Šé™
}
```

**å“åº”æ ¼å¼**ï¼š
```typescript
{
  success: boolean
  data: {
    channels: Channel[]
  }
}
```

**æ’åºé€»è¾‘**ï¼šæŒ‰æ•ˆç‡åˆ†æ•°ï¼ˆå¹³å‡æ’­æ”¾ Ã· è®¢é˜…æ•°ï¼‰é™åº

**å®ç°æ­¥éª¤**ï¼š
1. [ ] æŸ¥è¯¢æ‰€æœ‰é¢‘é“æ•°æ®
2. [ ] è®¡ç®—æ•ˆç‡åˆ†æ•°
3. [ ] æŒ‰æ•ˆç‡åˆ†æ•°æ’åºï¼ˆé«˜â†’ä½ï¼‰
4. [ ] è®¢é˜…æ•°èŒƒå›´è¿‡æ»¤ï¼ˆå¯é€‰ï¼‰
5. [ ] è¿”å› Top 3

#### 4.3 GET /api/analytics/overview

**è·¯å¾„**ï¼š`app/api/analytics/overview/route.ts`

**åŠŸèƒ½**ï¼šè¿”å›æ•°æ®é‡‡é›†çš„ç»Ÿè®¡æ¦‚è§ˆ

**å“åº”æ ¼å¼**ï¼š
```typescript
{
  success: boolean
  data: {
    videoCount: number
    channelCount: number
    topicCount: number
    lastCollectedAt: string // ISO 8601
  }
}
```

**å®ç°æ­¥éª¤**ï¼š
1. [ ] æŸ¥è¯¢æ•°æ®åº“ç»Ÿè®¡
2. [ ] è®¡ç®—æœ€åé‡‡é›†æ—¶é—´
3. [ ] è¿”å›èšåˆæ•°æ®

---

### ç¬¬ 5 æ­¥ï¼šæ•´åˆåˆ°é¦–é¡µï¼ˆ4 å°æ—¶ï¼‰

**æ–‡ä»¶**ï¼š`app/page.tsx`

**ä¿®æ”¹å†…å®¹**ï¼š
1. [ ] å¯¼å…¥ç»„ä»¶ï¼ˆVideoCarousel, ChannelTable, DataOverviewï¼‰
2. [ ] åˆ›å»ºå¼‚æ­¥æ•°æ®è·å–å‡½æ•°ï¼ˆServer Componentsï¼‰
3. [ ] æ·»åŠ  Suspense è¾¹ç•Œå’ŒåŠ è½½éª¨æ¶å±
4. [ ] é…ç½® ISRï¼ˆrevalidate = 3600ï¼‰
5. [ ] é”™è¯¯å¤„ç†ï¼ˆtry-catchï¼‰

**æ•°æ®æµç¤ºä¾‹**ï¼š
```typescript
async function TrendingVideosSection() {
  try {
    const res = await fetchTrendingVideos(5, '7d')
    return <VideoCarousel videos={res.data.videos} />
  } catch (error) {
    return <div className="text-center py-8 text-red-600">åŠ è½½å¤±è´¥</div>
  }
}

export default function HomePage() {
  return (
    <div>
      {/* ... æœç´¢åŒºåŸŸ ... */}
      <Suspense fallback={<VideoCarouselSkeleton />}>
        <TrendingVideosSection />
      </Suspense>
    </div>
  )
}
```

---

### ç¬¬ 6 æ­¥ï¼šæ·»åŠ éª¨æ¶å±åŠ è½½ç»„ä»¶ï¼ˆ3 å°æ—¶ï¼‰

**æ–‡ä»¶**ï¼š
- `components/home/VideoCarouselSkeleton.tsx`
- `components/home/ChannelTableSkeleton.tsx`
- `components/home/DataOverviewSkeleton.tsx`

**å®ç°è¦ç‚¹**ï¼š
1. [ ] åŒ¹é…çœŸå®ç»„ä»¶çš„å¸ƒå±€å®½é«˜
2. [ ] ä½¿ç”¨ Skeleton åŸå§‹ç»„ä»¶
3. [ ] æ·»åŠ åŠ è½½åŠ¨ç”»ï¼ˆpulseï¼‰

---

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] é¦–é¡µèƒ½åŠ è½½å¹¶æ˜¾ç¤ºæ‰€æœ‰ 5 ä¸ªä¸»è¦åŒºåŸŸ
- [ ] æœç´¢æ¡†èƒ½æ­£å¸¸è¾“å…¥å’Œæœç´¢
- [ ] ç­›é€‰æ¡ä»¶é¢æ¿èƒ½å±•å¼€/æ”¶èµ·
- [ ] æœ¬å‘¨çˆ†æ¬¾æ˜¾ç¤º 5 ä¸ªè§†é¢‘å¡ç‰‡
- [ ] é»‘é©¬é¢‘é“æ˜¾ç¤º 3-5 ä¸ªé¢‘é“
- [ ] æ•°æ®æ¦‚è§ˆæ˜¾ç¤ºç»Ÿè®¡æ•°å­—
- [ ] æ•°æ®åŠ è½½æ—¶æ˜¾ç¤ºéª¨æ¶å±
- [ ] æ•°æ®åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º

### æ€§èƒ½éªŒæ”¶

- [ ] é¦–å±åŠ è½½æ—¶é—´ < 2.5sï¼ˆLCP è‰¯å¥½ï¼‰
- [ ] é¦–é¡µ Core Web Vitalsï¼šLCP < 2.5s, FID < 100ms, CLS < 0.1
- [ ] æ—  hydration mismatch é”™è¯¯
- [ ] æš—è‰²æ¨¡å¼åˆ‡æ¢æ— é—ªçƒ

### å“åº”å¼éªŒæ”¶

- [ ] æ¡Œé¢ç‰ˆï¼ˆ1024px+ï¼‰ï¼š3 åˆ—å¡ç‰‡ï¼Œå®Œæ•´è¡¨æ ¼
- [ ] å¹³æ¿ç‰ˆï¼ˆ768pxï¼‰ï¼šå¸ƒå±€è°ƒæ•´æ­£ç¡®
- [ ] æ‰‹æœºç‰ˆï¼ˆ375pxï¼‰ï¼š1 åˆ—å¡ç‰‡ï¼Œå¡ç‰‡è§†å›¾é¢‘é“è¡¨ï¼Œæœç´¢æŒ‰é’®å›¾æ ‡åŒ–

### ä»£ç è´¨é‡

- [ ] TypeScript æ—  any ç±»å‹
- [ ] æ—  console.error è¾“å‡º
- [ ] ä»£ç æ³¨é‡Šæ¸…æ™°
- [ ] ç»„ä»¶å¯å¤ç”¨æ€§é«˜

---

## åç»­ä¾èµ–

- âœ… Phase 3 å·²å®Œæˆï¼ˆæš—è‰²æ¨¡å¼ã€é”™è¯¯è¾¹ç•Œã€æ€§èƒ½ç›‘æ§ï¼‰
- â­ï¸ Phase 5 ç­‰å¾…é¦–é¡µå®Œæˆï¼ˆéœ€è¦æ•°æ®è·å–èƒ½åŠ›ï¼‰
- â­ï¸ Phase 6-7 ç­‰å¾… Phase 5 å®Œæˆ

---

## å‚è€ƒæ–‡ä»¶

- è®¾è®¡æ–‡æ¡£ï¼š`.42cog/work/2026-02-04_v3_decision_é¦–é¡µå¸ƒå±€.md`
- ç°æœ‰é¡µé¢ï¼š`app/page.tsx`
- ç»„ä»¶åº“ï¼š`components/ui/`
- ç±»å‹å®šä¹‰ï¼š`lib/types.ts`

