<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›ä½œè€…åŠ©æ‰‹ - ç›´æ¥ç»™ä½ ç­”æ¡ˆ</title>
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            line-height: 1.6;
            color: #e2e8f0;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* é¡¶éƒ¨æœç´¢åŒº */
        .header {
            text-align: center;
            padding: 40px 20px 30px;
        }

        .header h1 {
            font-size: 2em;
            color: #06b6d4;
            margin-bottom: 8px;
        }

        .header p {
            color: #94a3b8;
            font-size: 1em;
        }

        .search-box {
            display: flex;
            gap: 12px;
            max-width: 500px;
            margin: 24px auto;
        }

        .search-input {
            flex: 1;
            padding: 14px 20px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 12px;
            color: white;
            font-size: 1em;
        }

        .search-input:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .search-btn {
            padding: 14px 28px;
            background: #06b6d4;
            color: #0f172a;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-btn:hover {
            background: #22d3ee;
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            background: #334155;
            color: #64748b;
            cursor: not-allowed;
            transform: none;
        }

        .quick-tags {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .quick-tag {
            padding: 6px 14px;
            background: #334155;
            color: #94a3b8;
            border: none;
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-tag:hover {
            background: #475569;
            color: white;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #334155;
            border-top: 3px solid #06b6d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æ•°æ®åŸºæ•°æç¤º */
        .data-basis {
            text-align: center;
            color: #64748b;
            font-size: 0.85em;
            margin-bottom: 24px;
        }

        /* æ¨¡å—å¡ç‰‡ */
        .modules {
            display: grid;
            gap: 24px;
        }

        .module {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 16px;
            overflow: hidden;
        }

        .module-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.1), transparent);
            border-bottom: 1px solid #334155;
        }

        .module-icon {
            font-size: 1.5em;
        }

        .module-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #f1f5f9;
        }

        .module-subtitle {
            font-size: 0.8em;
            color: #64748b;
            margin-left: auto;
        }

        .module-body {
            padding: 20px;
        }

        /* é€‰é¢˜æ¨è */
        .topic-card {
            background: #0f172a;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .topic-card:last-child {
            margin-bottom: 0;
        }

        .topic-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #22d3ee;
            margin-bottom: 8px;
        }

        .topic-reason {
            font-size: 0.9em;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .topic-reference {
            font-size: 0.85em;
            color: #64748b;
            padding: 8px 12px;
            background: #1e293b;
            border-radius: 6px;
            border-left: 3px solid #06b6d4;
        }

        .confidence-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 8px;
        }

        .confidence-high { background: #22c55e20; color: #22c55e; }
        .confidence-medium { background: #eab30820; color: #eab308; }
        .confidence-low { background: #64748b20; color: #64748b; }

        /* çˆ†æ¬¾å­¦ä¹  */
        .viral-video {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: #0f172a;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: transform 0.2s;
        }

        .viral-video:hover {
            transform: translateX(4px);
        }

        .viral-thumbnail {
            width: 160px;
            height: 90px;
            border-radius: 8px;
            object-fit: cover;
            background: #334155;
            flex-shrink: 0;
        }

        .viral-info {
            flex: 1;
            min-width: 0;
        }

        .viral-title {
            font-size: 0.95em;
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .viral-title a {
            color: inherit;
            text-decoration: none;
        }

        .viral-title a:hover {
            color: #06b6d4;
        }

        .viral-channel {
            font-size: 0.85em;
            color: #64748b;
            margin-bottom: 8px;
        }

        .viral-stats {
            display: flex;
            gap: 12px;
            font-size: 0.85em;
            color: #94a3b8;
        }

        .learning-points {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .learning-tag {
            padding: 3px 8px;
            background: #06b6d420;
            color: #22d3ee;
            border-radius: 4px;
            font-size: 0.75em;
        }

        /* æ ‡é¢˜åŠ©æ‰‹ */
        .keyword-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .keyword-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #0f172a;
            border-radius: 8px;
        }

        .keyword-word {
            font-weight: 500;
            color: #f1f5f9;
        }

        .keyword-views {
            font-size: 0.85em;
            color: #22c55e;
        }

        .template-list {
            background: #0f172a;
            border-radius: 12px;
            padding: 16px;
        }

        .template-item {
            padding: 12px 0;
            border-bottom: 1px solid #334155;
        }

        .template-item:last-child {
            border-bottom: none;
        }

        .template-formula {
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .template-example {
            font-size: 0.85em;
            color: #64748b;
        }

        /* å­¦ä¹ å¯¹è±¡ï¼ˆé¢‘é“æ¦œå•ï¼‰*/
        .ranking-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .ranking-tab {
            padding: 8px 16px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            color: #94a3b8;
            font-size: 0.9em;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .ranking-tab:hover {
            border-color: #06b6d4;
            color: #e2e8f0;
        }

        .ranking-tab.active {
            background: #06b6d4;
            border-color: #06b6d4;
            color: #0f172a;
        }

        .channel-list {
            display: grid;
            gap: 12px;
        }

        .channel-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #0f172a;
            border-radius: 12px;
        }

        .channel-rank {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #334155;
            border-radius: 8px;
            font-weight: 600;
            color: #94a3b8;
        }

        .channel-rank.top-1 { background: #fbbf2420; color: #fbbf24; }
        .channel-rank.top-2 { background: #94a3b820; color: #94a3b8; }
        .channel-rank.top-3 { background: #cd7f3220; color: #cd7f32; }

        .channel-info {
            flex: 1;
            min-width: 0;
        }

        .channel-name {
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .channel-name a {
            color: inherit;
            text-decoration: none;
        }

        .channel-name a:hover {
            color: #06b6d4;
        }

        .channel-why {
            font-size: 0.85em;
            color: #64748b;
        }

        .channel-stats {
            text-align: right;
            font-size: 0.85em;
            color: #94a3b8;
        }

        .channel-expand-btn {
            background: none;
            border: 1px solid #334155;
            color: #64748b;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            cursor: pointer;
            margin-left: 8px;
        }

        .channel-expand-btn:hover {
            border-color: #06b6d4;
            color: #06b6d4;
        }

        /* é¢‘é“è¯¦ç»†åˆ†æé¢æ¿ */
        .channel-analysis {
            margin-top: 12px;
            padding: 16px;
            background: #0f172a;
            border-radius: 8px;
            border-left: 3px solid #06b6d4;
            display: none;
        }

        .channel-analysis.show {
            display: block;
        }

        .analysis-section {
            margin-bottom: 16px;
        }

        .analysis-section:last-child {
            margin-bottom: 0;
        }

        .analysis-section h5 {
            color: #94a3b8;
            font-size: 0.8em;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .analysis-conclusion {
            color: #22d3ee;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .analysis-data-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .analysis-data-item {
            padding: 4px 10px;
            background: #1e293b;
            border-radius: 4px;
            font-size: 0.85em;
            color: #94a3b8;
        }

        .analysis-formula {
            font-size: 0.85em;
            color: #64748b;
            font-style: italic;
            padding: 8px 12px;
            background: #1e293b;
            border-radius: 4px;
        }

        .strength-item, .weakness-item {
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .strength-item {
            background: linear-gradient(90deg, #22c55e10, transparent);
            border-left: 3px solid #22c55e;
        }

        .weakness-item {
            background: linear-gradient(90deg, #eab30810, transparent);
            border-left: 3px solid #eab308;
        }

        .strength-item .point, .weakness-item .point {
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .strength-item .data, .weakness-item .data {
            font-size: 0.85em;
            color: #94a3b8;
            margin-bottom: 2px;
        }

        .strength-item .reasoning, .weakness-item .reasoning {
            font-size: 0.8em;
            color: #64748b;
        }

        /* æ’åå…¬å¼è¯´æ˜ */
        .ranking-formula {
            font-size: 0.8em;
            color: #64748b;
            font-style: italic;
            margin-bottom: 16px;
            padding: 8px 12px;
            background: #0f172a;
            border-radius: 6px;
        }

        /* æ¨ç†é“¾å¯è§†åŒ–æ ·å¼ */
        .reasoning-chain {
            background: #0f172a;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid #334155;
        }

        .reasoning-chain-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding-bottom: 12px;
            border-bottom: 1px solid #334155;
            margin-bottom: 16px;
        }

        .reasoning-chain-header h4 {
            color: #06b6d4;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reasoning-chain-toggle {
            color: #64748b;
            font-size: 0.85em;
        }

        /* æ¨ç†æ­¥éª¤æµç¨‹ */
        .reasoning-steps {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .reasoning-step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }

        .step-line {
            width: 2px;
            height: 40px;
            background: linear-gradient(to bottom, #06b6d4, transparent);
        }

        .step-content {
            flex: 1;
            padding-bottom: 8px;
        }

        .step-title {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .step-detail {
            color: #94a3b8;
            font-size: 0.9em;
            padding: 12px;
            background: #1e293b;
            border-radius: 8px;
            border-left: 3px solid #06b6d4;
        }

        .step-data-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .step-data-item {
            padding: 4px 10px;
            background: #334155;
            border-radius: 4px;
            font-size: 0.85em;
            color: #22d3ee;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background: #0f172a;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }

        .chart-title {
            color: #94a3b8;
            font-size: 0.9em;
            margin-bottom: 16px;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 280px;
            max-width: 100%;
        }

        /* å¯¹æ¯”è¡¨æ ¼ */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 0.9em;
        }

        .comparison-table th {
            background: #334155;
            color: #e2e8f0;
            padding: 12px 16px;
            text-align: left;
            font-weight: 500;
        }

        .comparison-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #334155;
            color: #94a3b8;
        }

        .comparison-table tr:hover td {
            background: #1e293b;
        }

        .comparison-table .highlight {
            color: #22c55e;
            font-weight: 500;
        }

        .comparison-table .warning {
            color: #eab308;
        }

        /* æŒ‡æ ‡å¯¹æ¯”æ¡ */
        .metric-bar-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }

        .metric-bar {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .metric-bar-label {
            width: 100px;
            font-size: 0.85em;
            color: #94a3b8;
            flex-shrink: 0;
        }

        .metric-bar-track {
            flex: 1;
            height: 20px;
            background: #334155;
            border-radius: 10px;
            overflow: hidden;
        }

        .metric-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #06b6d4, #22d3ee);
            border-radius: 10px;
            transition: width 0.5s ease-out;
        }

        .metric-bar-value {
            width: 80px;
            text-align: right;
            font-size: 0.85em;
            color: #e2e8f0;
            font-weight: 500;
        }

        /* é¢‘é“é›·è¾¾å›¾åŒ…è£…å™¨ */
        .channel-radar-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 16px;
        }

        @media (max-width: 768px) {
            .channel-radar-wrapper {
                grid-template-columns: 1fr;
            }
        }

        /* å±•å¼€/æ”¶èµ·åŠ¨ç”» */
        .collapsible-content {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.expanded {
            max-height: 2000px;
        }

        /* æ•°æ®æµå‘æŒ‡ç¤ºå™¨ */
        .data-flow-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px;
            background: #0f172a;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .flow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .flow-icon {
            font-size: 1.5em;
        }

        .flow-label {
            font-size: 0.75em;
            color: #64748b;
        }

        .flow-arrow {
            color: #06b6d4;
            font-size: 1.2em;
        }

        /* é¿å‘æé†’ */
        .warning-list {
            display: grid;
            gap: 12px;
        }

        .warning-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            border-radius: 12px;
        }

        .warning-item.high {
            background: linear-gradient(90deg, #ef444420, transparent);
            border: 1px solid #ef444440;
        }

        .warning-item.medium {
            background: linear-gradient(90deg, #eab30820, transparent);
            border: 1px solid #eab30840;
        }

        .warning-item.low {
            background: linear-gradient(90deg, #22c55e20, transparent);
            border: 1px solid #22c55e40;
        }

        .warning-icon {
            font-size: 1.5em;
        }

        .warning-content h4 {
            font-size: 1em;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .warning-content p {
            font-size: 0.9em;
            color: #94a3b8;
        }

        /* è¿”å›é“¾æ¥ */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #64748b;
            text-decoration: none;
            font-size: 0.9em;
            margin-bottom: 16px;
        }

        .back-link:hover {
            color: #06b6d4;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .viral-video {
                flex-direction: column;
            }

            .viral-thumbnail {
                width: 100%;
                height: 180px;
            }

            .keyword-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">&larr; è¿”å›å®Œæ•´ç‰ˆ</a>

        <header class="header">
            <h1>åˆ›ä½œè€…åŠ©æ‰‹</h1>
            <p>ç›´æ¥ç»™ä½ ç­”æ¡ˆï¼Œä¸ç”¨è‡ªå·±åˆ†æ</p>

            <div class="search-box">
                <input type="text" class="search-input" id="themeInput" placeholder="è¾“å…¥ä½ æƒ³åšçš„é¢†åŸŸï¼Œå¦‚ï¼šå…»ç”Ÿ" value="å…»ç”Ÿ">
                <button class="search-btn" id="searchBtn" onclick="loadData()">å¼€å§‹åˆ†æ</button>
            </div>

            <div class="quick-tags">
                <button class="quick-tag" onclick="setTheme('å…»ç”Ÿ')">å…»ç”Ÿ</button>
                <button class="quick-tag" onclick="setTheme('ç§‘æŠ€')">ç§‘æŠ€</button>
                <button class="quick-tag" onclick="setTheme('ç¾é£Ÿ')">ç¾é£Ÿ</button>
                <button class="quick-tag" onclick="setTheme('æ—…è¡Œ')">æ—…è¡Œ</button>
                <button class="quick-tag" onclick="setTheme('ç†è´¢')">ç†è´¢</button>
            </div>
        </header>

        <div id="content">
            <div class="empty-state">
                <p>è¾“å…¥é¢†åŸŸå…³é”®è¯ï¼Œè·å–åˆ›ä½œå»ºè®®</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';
        let currentRanking = 'total_views_rank';
        let rankingData = null;

        function setTheme(theme) {
            document.getElementById('themeInput').value = theme;
            loadData();
        }

        async function loadData() {
            const theme = document.getElementById('themeInput').value.trim();
            if (!theme) return;

            const btn = document.getElementById('searchBtn');
            const content = document.getElementById('content');

            btn.disabled = true;
            btn.textContent = 'åˆ†æä¸­...';
            content.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>æ­£åœ¨åˆ†æã€Œ${theme}ã€é¢†åŸŸæ•°æ®...</p>
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE}/api/creator-helper/${encodeURIComponent(theme)}`);
                const data = await response.json();

                if (data.status === 'ok') {
                    renderModules(data);
                } else {
                    content.innerHTML = `
                        <div class="empty-state">
                            <p>${data.message || 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                content.innerHTML = `
                    <div class="empty-state">
                        <p>ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ</p>
                    </div>
                `;
            }

            btn.disabled = false;
            btn.textContent = 'å¼€å§‹åˆ†æ';
        }

        function renderModules(data) {
            const m = data.modules;
            rankingData = m.channel_rankings;

            document.getElementById('content').innerHTML = `
                <p class="data-basis">åŸºäº ${data.data_basis.toLocaleString()} ä¸ªè§†é¢‘æ•°æ®åˆ†æ</p>

                <div class="modules">
                    <!-- 1. é€‰é¢˜åŠ©æ‰‹ -->
                    <div class="module">
                        <div class="module-header">
                            <span class="module-icon">ğŸ’¡</span>
                            <span class="module-title">é€‰é¢˜åŠ©æ‰‹</span>
                            <span class="module-subtitle">${m.topic_recommendations.data_source}</span>
                        </div>
                        <div class="module-body">
                            ${renderTopicRecommendations(m.topic_recommendations)}
                        </div>
                    </div>

                    <!-- 2. çˆ†æ¬¾å­¦ä¹  -->
                    <div class="module">
                        <div class="module-header">
                            <span class="module-icon">ğŸ”¥</span>
                            <span class="module-title">çˆ†æ¬¾å­¦ä¹ </span>
                            <span class="module-subtitle">${m.viral_learning.summary}</span>
                        </div>
                        <div class="module-body">
                            ${renderViralLearning(m.viral_learning)}
                        </div>
                    </div>

                    <!-- 3. æ ‡é¢˜åŠ©æ‰‹ -->
                    <div class="module">
                        <div class="module-header">
                            <span class="module-icon">âœï¸</span>
                            <span class="module-title">æ ‡é¢˜åŠ©æ‰‹</span>
                            <span class="module-subtitle">${m.title_helper.tip}</span>
                        </div>
                        <div class="module-body">
                            ${renderTitleHelper(m.title_helper)}
                        </div>
                    </div>

                    <!-- 4. å­¦ä¹ å¯¹è±¡ï¼ˆé¢‘é“æ¦œå•ï¼‰-->
                    <div class="module">
                        <div class="module-header">
                            <span class="module-icon">ğŸ¯</span>
                            <span class="module-title">å­¦ä¹ å¯¹è±¡</span>
                            <span class="module-subtitle">æ‰¾åˆ°å€¼å¾—å­¦ä¹ çš„é¢‘é“</span>
                        </div>
                        <div class="module-body">
                            ${renderChannelRankings(m.channel_rankings)}
                        </div>
                    </div>

                    <!-- 5. é¿å‘æé†’ -->
                    <div class="module">
                        <div class="module-header">
                            <span class="module-icon">âš ï¸</span>
                            <span class="module-title">é¿å‘æé†’</span>
                            <span class="module-subtitle">é‡è¦çš„äº‹è¯´ä¸‰é</span>
                        </div>
                        <div class="module-body">
                            ${renderWarnings(m.warnings)}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTopicRecommendations(data) {
            if (!data.today_picks || data.today_picks.length === 0) {
                return '<p style="color: #64748b;">æš‚æ— æ¨è</p>';
            }

            return data.today_picks.map(pick => `
                <div class="topic-card">
                    <div class="topic-name">
                        ${pick.topic}
                        <span class="confidence-badge confidence-${pick.confidence === 'é«˜' ? 'high' : pick.confidence === 'ä¸­' ? 'medium' : 'low'}">${pick.confidence}ç½®ä¿¡åº¦</span>
                    </div>
                    <div class="topic-reason">${pick.reason}</div>
                    <div class="topic-reference">å‚è€ƒæ ‡é¢˜ï¼š${pick.title_reference}</div>
                </div>
            `).join('');
        }

        function renderViralLearning(data) {
            if (!data.videos || data.videos.length === 0) {
                return '<p style="color: #64748b;">æš‚æ— çˆ†æ¬¾è§†é¢‘</p>';
            }

            return data.videos.slice(0, 5).map(video => `
                <div class="viral-video">
                    <img class="viral-thumbnail"
                         src="${video.thumbnail_url || ''}"
                         alt="${video.title}"
                         onerror="this.style.background='#334155'">
                    <div class="viral-info">
                        <div class="viral-title">
                            <a href="https://www.youtube.com/watch?v=${video.youtube_id}" target="_blank">
                                ${video.title}
                            </a>
                        </div>
                        <div class="viral-channel">${video.channel_name || 'æœªçŸ¥é¢‘é“'}</div>
                        <div class="viral-stats">
                            <span>ğŸ“Š ${formatNumber(video.view_count)} æ’­æ”¾</span>
                            <span>ğŸ“ˆ æ—¥å‡ ${formatNumber(video.daily_views)}</span>
                            <span>ğŸ“… ${video.days_old} å¤©å‰</span>
                        </div>
                        <div class="learning-points">
                            ${video.learning_points.map(p => `<span class="learning-tag">${p}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderTitleHelper(data) {
            let html = '<h4 style="color: #94a3b8; font-size: 0.9em; margin-bottom: 12px;">é«˜æ•ˆå…³é”®è¯ï¼ˆå¹³å‡æ’­æ”¾é‡æ›´é«˜ï¼‰</h4>';
            html += '<div class="keyword-grid">';
            data.efficient_keywords.slice(0, 8).forEach(kw => {
                html += `
                    <div class="keyword-item">
                        <span class="keyword-word">${kw.keyword}</span>
                        <span class="keyword-views">å‡ ${formatNumber(kw.avg_views)}</span>
                    </div>
                `;
            });
            html += '</div>';

            html += '<h4 style="color: #94a3b8; font-size: 0.9em; margin-bottom: 12px; margin-top: 20px;">æ ‡é¢˜å…¬å¼</h4>';
            html += '<div class="template-list">';
            data.title_templates.forEach(t => {
                html += `
                    <div class="template-item">
                        <div class="template-formula">${t.template}</div>
                        <div class="template-example">ä¾‹ï¼š${t.example}</div>
                    </div>
                `;
            });
            html += '</div>';

            return html;
        }

        function renderChannelRankings(data) {
            const rankings = [
                { key: 'total_views_rank', ...data.total_views_rank },
                { key: 'avg_views_rank', ...data.avg_views_rank },
                { key: 'video_count_rank', ...data.video_count_rank },
                { key: 'dark_horse_rank', ...data.dark_horse_rank },
                { key: 'efficiency_rank', ...data.efficiency_rank },
            ];

            // æ•°æ®æµå‘æŒ‡ç¤ºå™¨
            let html = `
                <div class="data-flow-indicator">
                    <div class="flow-step">
                        <span class="flow-icon">ğŸ“Š</span>
                        <span class="flow-label">åŸå§‹æ•°æ®</span>
                    </div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">
                        <span class="flow-icon">ğŸ“</span>
                        <span class="flow-label">è®¡ç®—æŒ‡æ ‡</span>
                    </div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">
                        <span class="flow-icon">âš–ï¸</span>
                        <span class="flow-label">å¯¹æ¯”æ’åº</span>
                    </div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">
                        <span class="flow-icon">ğŸ’¡</span>
                        <span class="flow-label">å¾—å‡ºç»“è®º</span>
                    </div>
                </div>
            `;

            html += '<div class="ranking-tabs">';
            rankings.forEach(r => {
                html += `
                    <button class="ranking-tab ${r.key === currentRanking ? 'active' : ''}"
                            onclick="switchRanking('${r.key}')">
                        ${r.emoji} ${r.title}
                    </button>
                `;
            });
            html += '</div>';

            html += `<p style="color: #64748b; font-size: 0.85em; margin-bottom: 8px;" id="rankingDesc">
                ${data[currentRanking].description}
            </p>`;

            html += `<div class="ranking-formula" id="rankingFormula">
                <strong>è®¡ç®—å…¬å¼ï¼š</strong>${data[currentRanking].ranking_formula || ''}
            </div>`;

            // æ·»åŠ å¯¹æ¯”å›¾è¡¨
            html += `
                <div class="chart-container" id="rankingChartContainer">
                    <div class="chart-title">é¢‘é“æŒ‡æ ‡å¯¹æ¯”å›¾</div>
                    <div class="chart-wrapper">
                        <canvas id="rankingBarChart"></canvas>
                    </div>
                </div>
            `;

            html += '<div class="channel-list" id="channelList">';
            html += renderChannelList(data[currentRanking].channels);
            html += '</div>';

            // å»¶è¿Ÿåˆå§‹åŒ–å›¾è¡¨
            setTimeout(() => initRankingChart(data[currentRanking].channels, currentRanking), 100);

            return html;
        }

        // å›¾è¡¨å®ä¾‹
        let rankingChart = null;
        const CHART_DISPLAY_LIMIT = 100;  // å›¾è¡¨å±•ç¤º Top 100ï¼ˆå¤§æ ·æœ¬å¯è§†åŒ–ï¼‰

        function initRankingChart(channels, rankType) {
            const canvas = document.getElementById('rankingBarChart');
            if (!canvas || !channels || channels.length === 0) return;

            // é”€æ¯æ—§å›¾è¡¨
            if (rankingChart) {
                rankingChart.destroy();
            }

            const displayLimit = Math.min(channels.length, CHART_DISPLAY_LIMIT);

            // 100+ æ•°æ®å…¨éƒ¨ä½¿ç”¨æ•£ç‚¹å›¾å¯è§†åŒ–ï¼Œæ›´é€‚åˆå¤§æ•°æ®é‡åˆ†æ
            rankingChart = createScatterChartForAll(canvas, channels.slice(0, displayLimit), rankType);
        }

        function createBarChart(canvas, channels, rankType) {
            const labels = channels.map((c, i) => `${i+1}. ${c.channel_name?.substring(0, 8) || 'æœªçŸ¥'}`);

            // æ ¹æ®æ¦œå•ç±»å‹é€‰æ‹©æ•°æ®
            let dataValues = [];
            let dataLabel = '';
            let bgColor = '';

            switch(rankType) {
                case 'total_views_rank':
                    dataValues = channels.map(c => c.total_views);
                    dataLabel = 'æ€»æ’­æ”¾é‡';
                    bgColor = 'rgba(6, 182, 212, 0.7)';
                    break;
                case 'avg_views_rank':
                    dataValues = channels.map(c => c.avg_views);
                    dataLabel = 'å¹³å‡æ’­æ”¾é‡';
                    bgColor = 'rgba(34, 197, 94, 0.7)';
                    break;
                case 'video_count_rank':
                    dataValues = channels.map(c => c.video_count);
                    dataLabel = 'è§†é¢‘æ•°é‡';
                    bgColor = 'rgba(234, 179, 8, 0.7)';
                    break;
            }

            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: dataLabel,
                        data: dataValues,
                        backgroundColor: bgColor,
                        borderColor: bgColor.replace('0.7', '1'),
                        borderWidth: 1,
                        borderRadius: 4,
                    }]
                },
                options: {
                    indexAxis: 'y',  // æ°´å¹³æ¡å½¢å›¾
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: `Top ${channels.length} é¢‘é“ï¼ˆå…±é‡‡é›† ${rankingData?.stats?.total_channels || '?'} ä¸ªé¢‘é“ï¼‰`,
                            color: '#94a3b8',
                            font: { size: 12 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return dataLabel + ': ' + formatNumber(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(100, 116, 139, 0.2)' },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) { return formatNumber(value); }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        }
                    }
                }
            });
        }

        // é€šç”¨æ•£ç‚¹å›¾å‡½æ•° - æ”¯æŒ 100+ æ•°æ®å¯è§†åŒ–
        function createScatterChartForAll(canvas, channels, rankType) {
            let scatterData = [];
            let xLabel = '';
            let yLabel = '';
            let bgColor = '';
            let chartTitle = '';
            let explanation = '';

            switch(rankType) {
                case 'total_views_rank':
                    // æ€»æ’­æ”¾æ¦œï¼šè§†é¢‘æ•°é‡ vs æ€»æ’­æ”¾é‡
                    scatterData = channels.map((c, i) => ({
                        x: c.video_count || 0,
                        y: c.total_views || 0,
                        label: c.channel_name,
                        rank: i + 1
                    }));
                    xLabel = 'è§†é¢‘æ•°é‡';
                    yLabel = 'æ€»æ’­æ”¾é‡';
                    bgColor = 'rgba(6, 182, 212, 0.6)';
                    explanation = 'æ°”æ³¡è¶Šé«˜æ’­æ”¾è¶Šå¤šï¼Œè¶Šå³å‘å¸ƒè¶Šå‹¤';
                    break;

                case 'avg_views_rank':
                    // å¹³å‡æ’­æ”¾æ¦œï¼šè§†é¢‘æ•°é‡ vs å¹³å‡æ’­æ”¾é‡
                    scatterData = channels.map((c, i) => ({
                        x: c.video_count || 0,
                        y: c.avg_views || 0,
                        label: c.channel_name,
                        rank: i + 1
                    }));
                    xLabel = 'è§†é¢‘æ•°é‡';
                    yLabel = 'å¹³å‡æ’­æ”¾é‡';
                    bgColor = 'rgba(34, 197, 94, 0.6)';
                    explanation = 'å³ä¸Šè§’=é«˜äº§é«˜è´¨ï¼Œå·¦ä¸Šè§’=ç²¾å“å°‘å‘';
                    break;

                case 'video_count_rank':
                    // è§†é¢‘æ•°æ¦œï¼šè§†é¢‘æ•°é‡ vs æ€»æ’­æ”¾é‡ï¼ˆæ˜¾ç¤ºé«˜äº§çš„æ•ˆæœï¼‰
                    scatterData = channels.map((c, i) => ({
                        x: c.video_count || 0,
                        y: c.total_views || 0,
                        label: c.channel_name,
                        rank: i + 1
                    }));
                    xLabel = 'è§†é¢‘æ•°é‡';
                    yLabel = 'æ€»æ’­æ”¾é‡';
                    bgColor = 'rgba(234, 179, 8, 0.6)';
                    explanation = 'é«˜äº§æ˜¯å¦å¸¦æ¥é«˜æ’­æ”¾ï¼Ÿçœ‹æ–œç‡';
                    break;

                case 'dark_horse_rank':
                    // é»‘é©¬æ¦œï¼šè®¢é˜…æ•° vs æœ€é«˜æ’­æ”¾é‡
                    scatterData = channels.map((c, i) => ({
                        x: c.subscriber_count || 0,
                        y: c.max_views || 0,
                        label: c.channel_name,
                        rank: i + 1
                    }));
                    xLabel = 'è®¢é˜…æ•°';
                    yLabel = 'æœ€é«˜æ’­æ”¾é‡';
                    bgColor = 'rgba(239, 68, 68, 0.6)';
                    explanation = 'å·¦ä¸Šæ–¹=å°è®¢é˜…å¤§çˆ†æ¬¾ï¼ˆé»‘é©¬ï¼‰';
                    break;

                case 'efficiency_rank':
                    // é«˜æ•ˆæ¦œï¼šè®¢é˜…æ•° vs å¹³å‡æ’­æ”¾é‡
                    scatterData = channels.map((c, i) => ({
                        x: c.subscriber_count || 0,
                        y: c.avg_views || 0,
                        label: c.channel_name,
                        rank: i + 1
                    }));
                    xLabel = 'è®¢é˜…æ•°';
                    yLabel = 'å¹³å‡æ’­æ”¾é‡';
                    bgColor = 'rgba(168, 85, 247, 0.6)';
                    explanation = 'å·¦ä¸Šæ–¹=è½¬åŒ–æ•ˆç‡é«˜ï¼ˆå€¼å¾—å­¦ä¹ ï¼‰';
                    break;
            }

            const totalChannels = rankingData?.stats?.total_channels || '?';
            chartTitle = `${explanation} | å±•ç¤º ${channels.length}/${totalChannels} ä¸ªé¢‘é“`;

            return new Chart(canvas, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'é¢‘é“',
                        data: scatterData,
                        backgroundColor: bgColor,
                        borderColor: bgColor.replace('0.6', '1'),
                        pointRadius: 6,
                        pointHoverRadius: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: chartTitle,
                            color: '#94a3b8',
                            font: { size: 11 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `#${point.rank} ${point.label}`,
                                        `${xLabel}: ${formatNumber(point.x)}`,
                                        `${yLabel}: ${formatNumber(point.y)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'logarithmic',  // å¯¹æ•°åˆ»åº¦ï¼Œæ›´å¥½å±•ç¤ºå¤§èŒƒå›´æ•°æ®
                            title: { display: true, text: xLabel, color: '#94a3b8' },
                            grid: { color: 'rgba(100, 116, 139, 0.2)' },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) { return formatNumber(value); }
                            }
                        },
                        y: {
                            type: 'logarithmic',  // å¯¹æ•°åˆ»åº¦
                            title: { display: true, text: yLabel, color: '#94a3b8' },
                            grid: { color: 'rgba(100, 116, 139, 0.2)' },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) { return formatNumber(value); }
                            }
                        }
                    }
                }
            });
        }

        function createScatterChart(canvas, channels, rankType) {
            // ä¿ç•™åŸå‡½æ•°ä½œä¸ºåå¤‡
            return createScatterChartForAll(canvas, channels, rankType);
        }

        function renderChannelList(channels) {
            if (!channels || channels.length === 0) {
                return '<p style="color: #64748b;">æš‚æ— æ•°æ®</p>';
            }

            return channels.map((ch, i) => {
                const analysis = ch.analysis || {};
                const hasAnalysis = analysis.strengths?.length > 0 || analysis.weaknesses?.length > 0;

                return `
                <div class="channel-card-wrapper">
                    <div class="channel-card">
                        <div class="channel-rank ${i < 3 ? 'top-' + (i + 1) : ''}">${i + 1}</div>
                        <div class="channel-info">
                            <div class="channel-name">
                                <a href="https://www.youtube.com/channel/${ch.channel_id}" target="_blank">
                                    ${ch.channel_name || 'æœªçŸ¥é¢‘é“'}
                                </a>
                                ${hasAnalysis ? `<button class="channel-expand-btn" onclick="toggleAnalysis(${i})">è¯¦ç»†åˆ†æ</button>` : ''}
                            </div>
                            <div class="channel-why">${ch.why_learn}</div>
                        </div>
                        <div class="channel-stats">
                            <div>${formatNumber(ch.total_views)} æ’­æ”¾</div>
                            <div>${ch.video_count} ä¸ªè§†é¢‘</div>
                        </div>
                    </div>
                    ${hasAnalysis ? renderChannelAnalysis(ch, i) : ''}
                </div>
            `}).join('');
        }

        function renderChannelAnalysis(ch, index) {
            const a = ch.analysis || {};
            let html = `<div class="channel-analysis" id="analysis-${index}">`;

            // æ¨ç†é“¾ï¼šå®Œæ•´å±•ç¤º æ•°æ®â†’æŒ‡æ ‡â†’å¯¹æ¯”â†’ç»“è®º
            html += `
                <div class="reasoning-chain">
                    <div class="reasoning-chain-header" onclick="toggleReasoningSteps(${index})">
                        <h4>ğŸ” æ¨ç†è¿‡ç¨‹å±•å¼€</h4>
                        <span class="reasoning-chain-toggle" id="toggle-text-${index}">ç‚¹å‡»å±•å¼€</span>
                    </div>
                    <div class="collapsible-content" id="reasoning-steps-${index}">
                        <div class="reasoning-steps">
            `;

            // æ­¥éª¤1: åŸå§‹æ•°æ®
            html += `
                <div class="reasoning-step">
                    <div class="step-indicator">
                        <div class="step-number">1</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-content">
                        <div class="step-title">ğŸ“Š é‡‡é›†åŸå§‹æ•°æ®</div>
                        <div class="step-detail">
                            ä»æ•°æ®åº“ä¸­æå–è¯¥é¢‘é“çš„è§†é¢‘æ•°æ®ï¼ŒåŒ…æ‹¬æ’­æ”¾é‡ã€ç‚¹èµæ•°ã€å‘å¸ƒæ—¶é—´ç­‰
                            <div class="step-data-items">
                                <span class="step-data-item">æ€»æ’­æ”¾: ${formatNumber(ch.total_views)}</span>
                                <span class="step-data-item">è§†é¢‘æ•°: ${ch.video_count}</span>
                                <span class="step-data-item">è®¢é˜…æ•°: ${formatNumber(ch.subscriber_count)}</span>
                                <span class="step-data-item">æœ€é«˜æ’­æ”¾: ${formatNumber(ch.max_views)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // æ­¥éª¤2: è®¡ç®—æŒ‡æ ‡
            html += `
                <div class="reasoning-step">
                    <div class="step-indicator">
                        <div class="step-number">2</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-content">
                        <div class="step-title">ğŸ“ è®¡ç®—å…³é”®æŒ‡æ ‡</div>
                        <div class="step-detail">
                            ${a.calculation || 'æŒ‰ç…§æ¦œå•å…¬å¼è®¡ç®—æ’åæŒ‡æ ‡'}
                            <div class="step-data-items">
                                <span class="step-data-item">å¹³å‡æ’­æ”¾: ${formatNumber(ch.avg_views)}</span>
                                <span class="step-data-item">äº’åŠ¨ç‡: ${ch.engagement_rate}%</span>
                                ${ch.subscriber_count > 0 ? `<span class="step-data-item">æ•ˆç‡æŒ‡æ•°: ${(ch.avg_views / ch.subscriber_count).toFixed(2)}</span>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // æ­¥éª¤3: å¯¹æ¯”åˆ†æ
            html += `
                <div class="reasoning-step">
                    <div class="step-indicator">
                        <div class="step-number">3</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-content">
                        <div class="step-title">âš–ï¸ æ¨ªå‘å¯¹æ¯”</div>
                        <div class="step-detail">
                            ä¸è¯¥é¢†åŸŸå…¶ä»–é¢‘é“è¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾å‡ºä¼˜åŠ¿å’ŒåŠ£åŠ¿
                            <div class="metric-bar-container">
                                <div class="metric-bar">
                                    <span class="metric-bar-label">æ’­æ”¾é‡</span>
                                    <div class="metric-bar-track">
                                        <div class="metric-bar-fill" style="width: ${Math.min(100, (ch.total_views / 1000000) * 100)}%"></div>
                                    </div>
                                    <span class="metric-bar-value">${formatNumber(ch.total_views)}</span>
                                </div>
                                <div class="metric-bar">
                                    <span class="metric-bar-label">è§†é¢‘æ•°é‡</span>
                                    <div class="metric-bar-track">
                                        <div class="metric-bar-fill" style="width: ${Math.min(100, ch.video_count * 5)}%; background: linear-gradient(90deg, #22c55e, #16a34a);"></div>
                                    </div>
                                    <span class="metric-bar-value">${ch.video_count}</span>
                                </div>
                                <div class="metric-bar">
                                    <span class="metric-bar-label">äº’åŠ¨ç‡</span>
                                    <div class="metric-bar-track">
                                        <div class="metric-bar-fill" style="width: ${Math.min(100, ch.engagement_rate * 10)}%; background: linear-gradient(90deg, #eab308, #ca8a04);"></div>
                                    </div>
                                    <span class="metric-bar-value">${ch.engagement_rate}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // æ­¥éª¤4: å¾—å‡ºç»“è®º
            html += `
                <div class="reasoning-step">
                    <div class="step-indicator">
                        <div class="step-number">4</div>
                    </div>
                    <div class="step-content">
                        <div class="step-title">ğŸ’¡ å¾—å‡ºç»“è®º</div>
                        <div class="step-detail">
                            <strong style="color: #22d3ee;">${a.conclusion || 'è¯¥é¢‘é“åœ¨å½“å‰æ¦œå•ä¸­è¡¨ç°çªå‡º'}</strong>
                        </div>
                    </div>
                </div>
            `;

            html += `
                        </div>
                    </div>
                </div>
            `;

            // ä¼˜ç¼ºç‚¹åˆ†æï¼ˆç®€åŒ–å±•ç¤ºï¼‰
            if ((a.strengths && a.strengths.length > 0) || (a.weaknesses && a.weaknesses.length > 0)) {
                html += `
                    <div class="analysis-section" style="margin-top: 16px;">
                        <h5 style="color: #94a3b8; font-size: 0.85em; margin-bottom: 12px;">ğŸ“‹ è¯¦ç»†è¯„ä¼°</h5>
                `;

                // ä¼˜ç‚¹
                if (a.strengths && a.strengths.length > 0) {
                    html += a.strengths.map(s => `
                        <div class="strength-item">
                            <div class="point">âœ… ${s.point}</div>
                            <div class="data">${s.data}</div>
                            <div class="reasoning">${s.reasoning}</div>
                        </div>
                    `).join('');
                }

                // ç¼ºç‚¹
                if (a.weaknesses && a.weaknesses.length > 0) {
                    html += a.weaknesses.map(w => `
                        <div class="weakness-item">
                            <div class="point">âš ï¸ ${w.point}</div>
                            <div class="data">${w.data}</div>
                            <div class="reasoning">${w.reasoning}</div>
                        </div>
                    `).join('');
                }

                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function toggleReasoningSteps(index) {
            const content = document.getElementById(`reasoning-steps-${index}`);
            const toggleText = document.getElementById(`toggle-text-${index}`);
            if (content) {
                content.classList.toggle('expanded');
                if (content.classList.contains('expanded')) {
                    toggleText.textContent = 'ç‚¹å‡»æ”¶èµ·';
                } else {
                    toggleText.textContent = 'ç‚¹å‡»å±•å¼€';
                }
            }
        }

        function toggleAnalysis(index) {
            const el = document.getElementById(`analysis-${index}`);
            if (el) {
                el.classList.toggle('show');
            }
        }

        function switchRanking(key) {
            currentRanking = key;
            document.querySelectorAll('.ranking-tab').forEach(tab => {
                tab.classList.toggle('active', tab.textContent.includes(rankingData[key].emoji));
            });
            document.getElementById('channelList').innerHTML = renderChannelList(rankingData[key].channels);

            // æ›´æ–°æè¿°
            const desc = document.getElementById('rankingDesc');
            if (desc) {
                desc.textContent = rankingData[key].description;
            }

            // æ›´æ–°è®¡ç®—å…¬å¼
            const formula = document.getElementById('rankingFormula');
            if (formula) {
                formula.innerHTML = `<strong>è®¡ç®—å…¬å¼ï¼š</strong>${rankingData[key].ranking_formula || ''}`;
            }

            // æ›´æ–°å›¾è¡¨
            initRankingChart(rankingData[key].channels, key);
        }

        function renderWarnings(warnings) {
            if (!warnings || warnings.length === 0) {
                return '<p style="color: #64748b;">æš‚æ— è­¦å‘Š</p>';
            }

            return '<div class="warning-list">' + warnings.map(w => `
                <div class="warning-item ${w.severity}">
                    <span class="warning-icon">${w.icon}</span>
                    <div class="warning-content">
                        <h4>${w.title}</h4>
                        <p>${w.content}</p>
                    </div>
                </div>
            `).join('') + '</div>';
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num?.toLocaleString() || '0';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆ†æ
        window.onload = function() {
            loadData();
        };

        // å›è½¦æœç´¢
        document.getElementById('themeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadData();
            }
        });
    </script>
</body>
</html>
