<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ÂÜÖÂÆπÂä©Êâã</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            line-height: 1.6;
            color: #e2e8f0;
            background: #0f172a;
            min-height: 100vh;
        }

        /* È°∂ÈÉ®ÂØºËà™ */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #0f172a;
            border-bottom: 1px solid #1e293b;
            padding: 12px 24px;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-brand {
            font-size: 1.1em;
            font-weight: 600;
            color: #06b6d4;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 4px;
        }

        .nav-link {
            padding: 8px 14px;
            color: #94a3b8;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .nav-link:hover, .nav-link.active {
            color: #e2e8f0;
            background: #1e293b;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫ - Â∑¶Âè≥ÂàÜÊ†è */
        .app-container {
            padding-top: 56px;
            display: flex;
            min-height: 100vh;
        }

        /* Â∑¶‰æßËæπÊ†è - ÂØºËà™ÂíåËØäÊñ≠ */
        .sidebar {
            width: 280px;
            background: #1e293b;
            border-right: 1px solid #334155;
            padding: 20px;
            position: fixed;
            left: 0;
            top: 56px;
            bottom: 0;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 28px;
        }

        .sidebar-title {
            font-size: 0.75em;
            text-transform: uppercase;
            color: #64748b;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-left: 12px;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            color: #94a3b8;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sidebar-item:hover {
            background: #334155;
            color: #e2e8f0;
        }

        .sidebar-item.active {
            background: #06b6d4;
            color: #0f172a;
        }

        .sidebar-item .icon {
            width: 20px;
            text-align: center;
        }

        .sidebar-item .badge {
            margin-left: auto;
            background: #334155;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
        }

        .sidebar-item.active .badge {
            background: rgba(0,0,0,0.2);
        }

        /* ËØäÊñ≠Âç°Áâá */
        .diagnose-card {
            background: linear-gradient(135deg, #164e63, #1e3a5f);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }

        .diagnose-card h4 {
            color: #22d3ee;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .diagnose-card p {
            color: #94a3b8;
            font-size: 0.8em;
            margin-bottom: 12px;
        }

        .diagnose-input {
            width: 100%;
            padding: 10px 12px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .diagnose-input:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .diagnose-btn {
            width: 100%;
            padding: 10px;
            background: #06b6d4;
            color: #0f172a;
            border: none;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
        }

        .diagnose-btn:hover {
            background: #22d3ee;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫ */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 24px 32px;
            max-width: calc(100% - 280px);
        }

        /* ÊêúÁ¥¢Ê°Ü */
        .search-header {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .search-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .search-input {
            flex: 1;
            padding: 14px 18px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 10px;
            color: white;
            font-size: 1em;
        }

        .search-input:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .search-btn {
            padding: 14px 28px;
            background: #06b6d4;
            color: #0f172a;
            border: none;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .search-btn:hover {
            background: #22d3ee;
        }

        .search-btn:disabled {
            background: #334155;
            color: #64748b;
            cursor: not-allowed;
        }

        .search-presets {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .preset-label {
            color: #64748b;
            font-size: 0.85em;
        }

        .preset-tag {
            padding: 6px 12px;
            background: #334155;
            color: #94a3b8;
            border: none;
            border-radius: 16px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .preset-tag:hover {
            background: #475569;
            color: white;
        }

        /* Âä®ÊÄÅË∂ãÂäøÁÉ≠ËØçÊùøÂùó */
        .trending-section {
            background: linear-gradient(135deg, #1e3a5f, #0f2744);
            border: 1px solid #2563eb40;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
        }

        .trending-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .trending-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #60a5fa;
            font-weight: 500;
        }

        .trending-title .fire-icon {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .trending-refresh {
            background: transparent;
            border: 1px solid #334155;
            color: #64748b;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .trending-refresh:hover {
            background: #334155;
            color: #94a3b8;
        }

        .trending-refresh.loading .refresh-icon {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .trending-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            min-height: 32px;
        }

        .trending-tag {
            padding: 6px 14px;
            background: linear-gradient(135deg, #3b82f620, #1d4ed820);
            color: #93c5fd;
            border: 1px solid #3b82f640;
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trending-tag:hover {
            background: linear-gradient(135deg, #3b82f640, #1d4ed840);
            color: white;
            border-color: #3b82f6;
            transform: translateY(-1px);
        }

        .trending-tag .tag-heat {
            font-size: 0.7em;
            background: #ef444420;
            color: #fca5a5;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .trending-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 0.85em;
        }

        .trending-loading .dots {
            display: flex;
            gap: 4px;
        }

        .trending-loading .dot {
            width: 6px;
            height: 6px;
            background: #3b82f6;
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite;
        }

        .trending-loading .dot:nth-child(2) { animation-delay: 0.2s; }
        .trending-loading .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        .trending-error {
            color: #f87171;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trending-source {
            margin-top: 10px;
            font-size: 0.7em;
            color: #475569;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ‰ø°ÊÅØËæπÁïåÂç°Áâá */
        .boundary-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .boundary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .boundary-title {
            font-size: 1em;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .boundary-stats {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: #0f172a;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #06b6d4;
        }

        .stat-label {
            font-size: 0.75em;
            color: #64748b;
            margin-top: 4px;
        }

        /* AI Ê¥ûÂØü */
        .ai-insight {
            background: linear-gradient(135deg, #164e63, #1e3a5f);
            border: 1px solid #06b6d4;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 14px;
        }

        .ai-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .ai-label {
            font-size: 0.8em;
            color: #06b6d4;
            font-weight: 600;
        }

        .ai-content {
            color: #e2e8f0;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .ai-content strong {
            color: #22d3ee;
        }

        .ai-content p {
            margin-bottom: 10px;
        }

        /* Ê†áÁ≠æÈ°µ */
        .tabs {
            display: flex;
            gap: 4px;
            background: #1e293b;
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 10px 16px;
            background: transparent;
            color: #94a3b8;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            color: #e2e8f0;
        }

        .tab.active {
            background: #06b6d4;
            color: #0f172a;
            font-weight: 600;
        }

        /* ÂÜÖÂÆπÈù¢Êùø */
        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        /* Ê¶úÂçïÂå∫Âüü */
        .ranking-section {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .ranking-header {
            padding: 16px 20px;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ranking-title {
            font-size: 1em;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ranking-count {
            font-size: 0.8em;
            color: #64748b;
            background: #334155;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .ranking-filters {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            background: #334155;
            color: #94a3b8;
            border: none;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
        }

        .filter-btn:hover, .filter-btn.active {
            background: #475569;
            color: white;
        }

        /* Ê¶úÂçïÂàóË°® */
        .ranking-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 20px;
            border-bottom: 1px solid #334155;
            cursor: pointer;
            transition: background 0.2s;
        }

        .ranking-item:hover {
            background: #334155;
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .rank-number {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
            flex-shrink: 0;
        }

        .rank-1 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #0f172a; }
        .rank-2 { background: linear-gradient(135deg, #94a3b8, #64748b); color: #0f172a; }
        .rank-3 { background: linear-gradient(135deg, #cd7c32, #b8860b); color: #0f172a; }
        .rank-normal { background: #334155; color: #94a3b8; }

        .rank-thumb {
            width: 80px;
            height: 45px;
            background: #334155;
            border-radius: 6px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .rank-info {
            flex: 1;
            min-width: 0;
        }

        .rank-title {
            font-size: 0.9em;
            color: white;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .rank-meta {
            font-size: 0.8em;
            color: #64748b;
            display: flex;
            gap: 12px;
        }

        .rank-stats {
            display: flex;
            gap: 20px;
            flex-shrink: 0;
        }

        .rank-stat {
            text-align: right;
        }

        .rank-stat-value {
            font-size: 0.95em;
            font-weight: 600;
            color: white;
        }

        .rank-stat-label {
            font-size: 0.7em;
            color: #64748b;
        }

        .rank-score {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
            flex-shrink: 0;
        }

        .score-s { background: linear-gradient(135deg, #8b5cf6, #a855f7); color: white; }
        .score-a { background: linear-gradient(135deg, #059669, #10b981); color: white; }
        .score-b { background: linear-gradient(135deg, #0891b2, #06b6d4); color: white; }
        .score-c { background: linear-gradient(135deg, #d97706, #f59e0b); color: #0f172a; }

        /* È¢ëÈÅìÂç°Áâá */
        .channel-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .channel-header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
        }

        .channel-header:hover {
            background: #334155;
        }

        .channel-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .channel-info {
            flex: 1;
        }

        .channel-name {
            font-size: 1em;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
        }

        .channel-meta {
            font-size: 0.85em;
            color: #64748b;
        }

        .channel-stats {
            display: flex;
            gap: 24px;
        }

        .channel-stat {
            text-align: center;
        }

        .channel-stat-value {
            font-size: 1.1em;
            font-weight: 700;
            color: #06b6d4;
        }

        .channel-stat-label {
            font-size: 0.7em;
            color: #64748b;
        }

        .channel-toggle {
            color: #64748b;
            font-size: 1.2em;
        }

        .channel-videos {
            display: none;
            padding: 0 20px 16px;
            border-top: 1px solid #334155;
        }

        .channel-videos.open {
            display: block;
        }

        .channel-video-list {
            padding-top: 16px;
        }

        .channel-video-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: #0f172a;
        }

        .channel-video-item:hover {
            background: #334155;
        }

        .video-thumb-small {
            width: 64px;
            height: 36px;
            background: #334155;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .video-info-small {
            flex: 1;
            min-width: 0;
        }

        .video-title-small {
            font-size: 0.85em;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .video-meta-small {
            font-size: 0.75em;
            color: #64748b;
        }

        /* Âú∞Âå∫ÂàÜÂ∏É */
        .region-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .region-card {
            background: #0f172a;
            border-radius: 10px;
            padding: 16px;
        }

        .region-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .region-flag {
            font-size: 1.5em;
        }

        .region-name {
            font-weight: 600;
            color: white;
        }

        .region-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .region-stat {
            text-align: center;
        }

        .region-stat-value {
            font-size: 1.1em;
            font-weight: 700;
            color: #06b6d4;
        }

        .region-stat-label {
            font-size: 0.7em;
            color: #64748b;
        }

        .region-bar {
            height: 6px;
            background: #334155;
            border-radius: 3px;
            overflow: hidden;
        }

        .region-bar-fill {
            height: 100%;
            border-radius: 3px;
        }

        .competition-low { background: #10b981; }
        .competition-medium { background: #f59e0b; }
        .competition-high { background: #ef4444; }

        /* Êó∂Èó¥ÂàÜÊûê */
        .time-chart {
            padding: 20px;
        }

        .time-bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .time-label {
            width: 100px;
            font-size: 0.85em;
            color: #94a3b8;
        }

        .time-bar-container {
            flex: 1;
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .time-bar {
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 0.8em;
            color: white;
            font-weight: 600;
        }

        .time-meta {
            width: 80px;
            text-align: right;
            font-size: 0.8em;
            color: #64748b;
        }

        /* Ê∞îÊ≥°ÂõæÊ†∑Âºè */
        .bubble-chart {
            position: relative;
            height: 320px;
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.3) 0%, rgba(15, 23, 42, 0.5) 100%);
            border-radius: 12px;
            margin: 16px 0;
            overflow: hidden;
        }

        .bubble-chart-title {
            position: absolute;
            top: 12px;
            left: 16px;
            font-size: 0.85em;
            color: #94a3b8;
            z-index: 5;
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.7em;
            color: white;
            text-align: center;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .bubble.high-views {
            background: rgba(34, 197, 94, 0.75);
            border: 2px solid #22c55e;
        }

        .bubble.medium-views {
            background: rgba(59, 130, 246, 0.75);
            border: 2px solid #3b82f6;
        }

        .bubble.low-views {
            background: rgba(139, 92, 246, 0.75);
            border: 2px solid #8b5cf6;
        }

        .bubble.viral {
            background: rgba(239, 68, 68, 0.8);
            border: 2px solid #ef4444;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .bubble:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .bubble-tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.85em;
            color: #e2e8f0;
            max-width: 280px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .bubble-tooltip.show {
            opacity: 1;
        }

        .bubble-tooltip-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #f8fafc;
            line-height: 1.4;
        }

        .bubble-tooltip-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            font-size: 0.9em;
        }

        .bubble-tooltip-stat {
            color: #94a3b8;
        }

        .bubble-tooltip-stat span {
            color: #22c55e;
            font-weight: 500;
        }

        .bubble-legend {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 12px;
            font-size: 0.8em;
            color: #94a3b8;
        }

        .bubble-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bubble-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .bubble-legend-dot.high { background: #22c55e; }
        .bubble-legend-dot.medium { background: #3b82f6; }
        .bubble-legend-dot.low { background: #8b5cf6; }

        /* ËØäÊñ≠ÁªìÊûú */
        .diagnose-result {
            display: none;
        }

        .diagnose-result.show {
            display: block;
        }

        .diagnose-summary {
            background: linear-gradient(135deg, #164e63, #1e3a5f);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .diagnose-channel {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .diagnose-channel-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .diagnose-channel-info h3 {
            color: white;
            font-size: 1.2em;
        }

        .diagnose-channel-info p {
            color: #94a3b8;
            font-size: 0.9em;
        }

        .diagnose-scores {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .diagnose-score {
            background: #0f172a;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .diagnose-score-value {
            font-size: 1.5em;
            font-weight: 700;
        }

        .diagnose-score-label {
            font-size: 0.75em;
            color: #64748b;
        }

        .recommend-channels {
            margin-top: 20px;
        }

        .recommend-title {
            font-size: 0.9em;
            color: #94a3b8;
            margin-bottom: 12px;
        }

        .recommend-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recommend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #0f172a;
            border-radius: 8px;
        }

        .recommend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #334155;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .recommend-info {
            flex: 1;
        }

        .recommend-name {
            font-weight: 600;
            color: white;
            font-size: 0.9em;
        }

        .recommend-reason {
            font-size: 0.8em;
            color: #64748b;
        }

        .recommend-match {
            padding: 4px 10px;
            background: #10b981;
            color: white;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }

        /* ÂàÜÊûêÁä∂ÊÄÅ */
        .analysis-status {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: none;
        }

        .analysis-status.show {
            display: block;
        }

        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .status-title {
            font-weight: 600;
            color: white;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-badge.running {
            background: #06b6d4;
            color: #0f172a;
        }

        .status-badge.done {
            background: #10b981;
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #334155;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #06b6d4, #8b5cf6);
            border-radius: 3px;
            transition: width 0.3s;
        }

        .progress-fill.done {
            background: #10b981;
        }

        .status-log {
            color: #64748b;
            font-size: 0.85em;
        }

        /* Âä†ËΩΩÊõ¥Â§ö */
        .load-more {
            text-align: center;
            padding: 16px;
        }

        .load-more-btn {
            padding: 10px 24px;
            background: #334155;
            color: #e2e8f0;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
        }

        .load-more-btn:hover {
            background: #475569;
        }

        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-icon {
            font-size: 3em;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.1em;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        /* ËßÜÈ¢ëÂàÜÊûêÂç°Áâá */
        .video-analysis-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .video-analysis-header {
            padding: 16px 20px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            cursor: pointer;
        }

        .video-analysis-header:hover {
            background: #334155;
        }

        .video-analysis-thumb {
            width: 160px;
            height: 90px;
            background: #334155;
            border-radius: 8px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }

        .video-analysis-info {
            flex: 1;
            min-width: 0;
        }

        .video-analysis-title {
            font-size: 1em;
            font-weight: 600;
            color: white;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-analysis-meta {
            font-size: 0.85em;
            color: #64748b;
            margin-bottom: 8px;
        }

        .video-analysis-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .video-tag {
            padding: 4px 10px;
            background: #334155;
            color: #94a3b8;
            border-radius: 12px;
            font-size: 0.75em;
        }

        .video-tag.highlight {
            background: #059669;
            color: white;
        }

        .video-analysis-stats {
            display: flex;
            gap: 24px;
            flex-shrink: 0;
        }

        .video-analysis-stat {
            text-align: center;
        }

        .video-analysis-stat-value {
            font-size: 1.1em;
            font-weight: 700;
            color: #06b6d4;
        }

        .video-analysis-stat-label {
            font-size: 0.7em;
            color: #64748b;
        }

        .video-analysis-toggle {
            color: #64748b;
            font-size: 1.2em;
            padding: 8px;
        }

        .video-analysis-details {
            display: none;
            padding: 0 20px 20px;
            border-top: 1px solid #334155;
        }

        .video-analysis-details.open {
            display: block;
        }

        .analysis-section {
            padding: 16px 0;
            border-bottom: 1px solid #334155;
        }

        .analysis-section:last-child {
            border-bottom: none;
        }

        .analysis-section-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .analysis-metric {
            background: #0f172a;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .analysis-metric-value {
            font-size: 1.2em;
            font-weight: 700;
            color: white;
        }

        .analysis-metric-label {
            font-size: 0.75em;
            color: #64748b;
            margin-top: 4px;
        }

        .analysis-insight {
            background: #0f172a;
            border-radius: 8px;
            padding: 14px;
            font-size: 0.9em;
            color: #94a3b8;
            line-height: 1.6;
        }

        .analysis-insight strong {
            color: #06b6d4;
        }

        /* È¢ëÈÅìÊ¶úÂçïÈ°π */
        .channel-ranking-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 20px;
            border-bottom: 1px solid #334155;
            cursor: pointer;
            transition: background 0.2s;
        }

        .channel-ranking-item:hover {
            background: #334155;
        }

        .channel-ranking-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            flex-shrink: 0;
        }

        .channel-ranking-info {
            flex: 1;
            min-width: 0;
        }

        .channel-ranking-name {
            font-size: 0.95em;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
        }

        .channel-ranking-meta {
            font-size: 0.8em;
            color: #64748b;
        }

        .channel-ranking-stats {
            display: flex;
            gap: 24px;
            flex-shrink: 0;
        }

        .channel-ranking-stat {
            text-align: right;
        }

        .channel-ranking-stat-value {
            font-size: 0.95em;
            font-weight: 600;
            color: white;
        }

        .channel-ranking-stat-label {
            font-size: 0.7em;
            color: #64748b;
        }

        /* Á≠õÈÄâÂô®Âå∫Âüü */
        .filters-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #334155;
        }

        .filters-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #94a3b8;
            font-size: 0.85em;
            cursor: pointer;
            padding: 8px 0;
        }

        .filters-toggle:hover {
            color: #e2e8f0;
        }

        .filters-toggle .arrow {
            transition: transform 0.2s;
        }

        .filters-toggle.open .arrow {
            transform: rotate(180deg);
        }

        .filters-content {
            display: none;
            padding-top: 16px;
        }

        .filters-content.show {
            display: block;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .filter-group {
            background: #0f172a;
            border-radius: 10px;
            padding: 14px;
        }

        .filter-label {
            font-size: 0.8em;
            color: #64748b;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-select {
            width: 100%;
            padding: 10px 12px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .filter-select:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .filter-range {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-range input {
            flex: 1;
            padding: 10px 12px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            font-size: 0.9em;
            width: 100%;
        }

        .filter-range input:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .filter-range span {
            color: #64748b;
            font-size: 0.9em;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-chip {
            padding: 8px 14px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 20px;
            color: #94a3b8;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-chip:hover {
            border-color: #06b6d4;
            color: #e2e8f0;
        }

        .filter-chip.active {
            background: #06b6d4;
            border-color: #06b6d4;
            color: #0f172a;
        }

        .filters-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #334155;
        }

        .filter-reset-btn {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid #334155;
            border-radius: 8px;
            color: #94a3b8;
            font-size: 0.9em;
            cursor: pointer;
        }

        .filter-reset-btn:hover {
            border-color: #64748b;
            color: #e2e8f0;
        }

        .filter-apply-btn {
            padding: 10px 20px;
            background: #06b6d4;
            border: none;
            border-radius: 8px;
            color: #0f172a;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
        }

        .filter-apply-btn:hover {
            background: #22d3ee;
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .active-filter-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #164e63;
            border-radius: 16px;
            color: #22d3ee;
            font-size: 0.8em;
        }

        .active-filter-tag .remove {
            cursor: pointer;
            opacity: 0.7;
        }

        .active-filter-tag .remove:hover {
            opacity: 1;
        }

        /* ÊöÇÊó†Êï∞ÊçÆ */
        .no-data-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
            background: #1e293b;
            border-radius: 12px;
            border: 1px dashed #334155;
        }

        .no-data-icon {
            font-size: 3em;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .no-data-title {
            font-size: 1.1em;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .no-data-desc {
            font-size: 0.9em;
        }

        /* ÂìçÂ∫îÂºè */
        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
                max-width: 100%;
            }
            .boundary-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            .region-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .boundary-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .region-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ÂØºÂá∫ÊåâÈíÆÊ†∑Âºè */
        .overview-title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .export-buttons {
            display: flex;
            gap: 8px;
        }

        .export-btn {
            padding: 8px 16px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .export-btn:hover {
            background: #475569;
            border-color: #06b6d4;
            color: #06b6d4;
        }

        .export-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®ÂØºËà™ -->
    <nav class="nav">
        <a href="index.html" class="nav-brand">YouTube ÂÜÖÂÆπÂä©Êâã</a>
        <div class="nav-links">
            <a href="#discover" class="nav-link active">ÂèëÁé∞ÈÄâÈ¢ò</a>
            <a href="#publish" class="nav-link">ÂèëÂ∏ÉËßÜÈ¢ë</a>
            <a href="#data" class="nav-link">ÂÜÖÂÆπÂ∫ì</a>
        </div>
    </nav>

    <div class="app-container">
        <!-- Â∑¶‰æßËæπÊ†è -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Êï∞ÊçÆÂàÜÊûê</div>
                <nav class="sidebar-nav">
                    <a class="sidebar-item active" data-panel="overview">
                        <span class="icon">üìä</span>
                        Ê¶ÇËßàÊëòË¶Å
                    </a>
                    <a class="sidebar-item" data-panel="videos">
                        <span class="icon">üé¨</span>
                        ËßÜÈ¢ëÊï∞ÊçÆ
                        <span class="badge" id="badge-videos">0</span>
                    </a>
                    <a class="sidebar-item" data-panel="channels">
                        <span class="icon">üì∫</span>
                        È¢ëÈÅìÊï∞ÊçÆ
                        <span class="badge" id="badge-channels">0</span>
                    </a>
                    <a class="sidebar-item" onclick="goToInsightSystem()">
                        <span class="icon">üîç</span>
                        Ê®°ÂºèÊ¥ûÂØü
                    </a>
                    <a class="sidebar-item" data-panel="report">
                        <span class="icon">üìã</span>
                        ÂàÜÊûêÊä•Âëä
                    </a>
                </nav>
            </div>

            <!-- ÁõëÊéß‰∏≠ÂøÉ -->
            <div class="sidebar-section">
                <div class="sidebar-title">ÁõëÊéß‰∏≠ÂøÉ</div>
                <nav class="sidebar-nav">
                    <a class="sidebar-item" data-panel="monitor">
                        <span class="icon">üì°</span>
                        ÂÖ≥ÈîÆËØçÁõëÊéß
                        <span class="badge" id="badge-monitor">0</span>
                    </a>
                    <a class="sidebar-item" data-panel="trending">
                        <span class="icon">üìà</span>
                        Ë∂ãÂäøËøΩË∏™
                    </a>
                </nav>
            </div>

            <!-- È¢ëÈÅìËØäÊñ≠ -->
            <div class="sidebar-section">
                <div class="sidebar-title">ÊàëÁöÑÈ¢ëÈÅìËØäÊñ≠</div>
                <div class="diagnose-card">
                    <h4>üîç ËØäÊñ≠‰Ω†ÁöÑÈ¢ëÈÅì</h4>
                    <p>ËæìÂÖ•È¢ëÈÅìÈìæÊé•ÔºåËé∑ÂèñÂØπÊ†áÂàÜÊûêÂíåÊîπËøõÂª∫ËÆÆ</p>
                    <input type="text" class="diagnose-input" id="diagnoseInput" placeholder="Á≤òË¥¥È¢ëÈÅìÈìæÊé•ÊàñÂêçÁß∞...">
                    <button class="diagnose-btn" onclick="startDiagnose()">ÂºÄÂßãËØäÊñ≠</button>
                </div>
            </div>
        </aside>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <main class="main-content">
            <!-- ÊêúÁ¥¢Â§¥ÈÉ® -->
            <div class="search-header">
                <!-- Âä®ÊÄÅË∂ãÂäøÁÉ≠ËØçÊùøÂùó -->
                <div class="trending-section" id="trendingSection">
                    <div class="trending-header">
                        <div class="trending-title">
                            <span class="fire-icon">üî•</span>
                            <span>YouTube ÂÆûÊó∂Ë∂ãÂäøÁÉ≠ËØç</span>
                        </div>
                        <button class="trending-refresh" id="trendingRefresh" onclick="refreshTrendingKeywords()">
                            <span class="refresh-icon">üîÑ</span>
                            <span>Âà∑Êñ∞</span>
                        </button>
                    </div>
                    <div class="trending-keywords" id="trendingKeywords">
                        <div class="trending-loading" id="trendingLoading">
                            <div class="dots">
                                <div class="dot"></div>
                                <div class="dot"></div>
                                <div class="dot"></div>
                            </div>
                            <span>Ê≠£Âú®Ëé∑Âèñ YouTube Ë∂ãÂäøÊï∞ÊçÆ...</span>
                        </div>
                    </div>
                    <div class="trending-source" id="trendingSource" style="display: none;">
                        <span>üìä</span>
                        <span>Êï∞ÊçÆÊù•Ê∫êÔºöYouTube ÁÉ≠Èó®ËßÜÈ¢ëÊ†áÈ¢òÂàÜËØç ¬∑ Êõ¥Êñ∞Êó∂Èó¥Ôºö<span id="trendingTime">--</span></span>
                    </div>
                </div>

                <div class="search-row">
                    <input type="text" class="search-input" id="topicInput" placeholder="ËæìÂÖ•‰Ω†ÊÉ≥Á†îÁ©∂ÁöÑÈ¢ÜÂüüÔºåÊàñÁÇπÂáª‰∏ãÊñπÂ∑≤Êúâ‰∏ªÈ¢ò...">
                    <button class="search-btn" id="analyzeBtn" onclick="startAnalysis()">ÊêúÁ¥¢Âπ∂ÂàÜÊûê</button>
                </div>
                <div class="search-presets" id="existingThemes" style="margin-top: 12px;">
                    <span class="preset-label">Â∑≤ÊúâÊï∞ÊçÆÔºö</span>
                    <div id="themeButtons" style="display: inline-flex; gap: 8px; flex-wrap: wrap;">
                        <!-- Âä®ÊÄÅÂ°´ÂÖÖÂ∑≤Êúâ‰∏ªÈ¢ò -->
                    </div>
                </div>
                <div class="search-presets" id="historyPresets" style="display: none;">
                    <span class="preset-label">ÊúÄËøëÊêúÁ¥¢Ôºö</span>
                    <!-- Âä®ÊÄÅÂ°´ÂÖÖÁî®Êà∑ÊêúÁ¥¢ÂéÜÂè≤ -->
                </div>

                <!-- È´òÁ∫ßÁ≠õÈÄâ -->
                <div class="filters-section">
                    <div class="filters-toggle" id="filtersToggle" onclick="toggleFilters()">
                        <span>üéõÔ∏è È´òÁ∫ßÁ≠õÈÄâ</span>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="filters-content" id="filtersContent">
                        <div class="filters-grid">
                            <!-- Êí≠ÊîæÈáèÁ≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üìä Êí≠ÊîæÈáèËåÉÂõ¥</div>
                                <div class="filter-range">
                                    <input type="text" id="viewsMin" placeholder="ÊúÄÂ∞è">
                                    <span>-</span>
                                    <input type="text" id="viewsMax" placeholder="ÊúÄÂ§ß">
                                </div>
                                <div class="filter-chips" style="margin-top: 10px;">
                                    <span class="filter-chip active" onclick="setViewsRange(null, null)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="setViewsRange(0, 10000)">1‰∏á‰ª•‰∏ã</span>
                                    <span class="filter-chip" onclick="setViewsRange(10000, 100000)">1-10‰∏á</span>
                                    <span class="filter-chip" onclick="setViewsRange(100000, null)">10‰∏á+</span>
                                </div>
                            </div>

                            <!-- Âú∞Âå∫Á≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üåè ÁõÆÊ†áÂú∞Âå∫</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearRegions(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="toggleRegion(this, 'SG')">üá∏üá¨ Êñ∞Âä†Âù°</span>
                                    <span class="filter-chip" onclick="toggleRegion(this, 'MY')">üá≤üáæ È©¨Êù•Ë•ø‰∫ö</span>
                                    <span class="filter-chip" onclick="toggleRegion(this, 'TW')">üáπüáº Âè∞Êπæ</span>
                                    <span class="filter-chip" onclick="toggleRegion(this, 'HK')">üá≠üá∞ È¶ôÊ∏Ø</span>
                                    <span class="filter-chip" onclick="toggleRegion(this, 'US')">üá∫üá∏ ÁæéÂõΩ</span>
                                    <span class="filter-chip" onclick="toggleRegion(this, 'CN')">üá®üá≥ Â§ßÈôÜ</span>
                                </div>
                            </div>

                            <!-- Êó∂ÈïøÁ≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">‚è±Ô∏è ËßÜÈ¢ëÊó∂Èïø</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearDuration(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="toggleDuration(this, 'short')">Áü≠ËßÜÈ¢ë (&lt;5ÂàÜÈíü)</span>
                                    <span class="filter-chip" onclick="toggleDuration(this, 'medium')">‰∏≠Á≠â (5-20ÂàÜÈíü)</span>
                                    <span class="filter-chip" onclick="toggleDuration(this, 'long')">ÈïøËßÜÈ¢ë (20ÂàÜÈíü+)</span>
                                </div>
                            </div>

                            <!-- Á≤â‰∏ùÊï∞Á≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üë• È¢ëÈÅìÁ≤â‰∏ùÊï∞</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearSubscribers(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="toggleSubscribers(this, 'small')">Â∞èÈ¢ëÈÅì (&lt;1‰∏á)</span>
                                    <span class="filter-chip" onclick="toggleSubscribers(this, 'medium')">‰∏≠È¢ëÈÅì (1-10‰∏á)</span>
                                    <span class="filter-chip" onclick="toggleSubscribers(this, 'large')">Â§ßÈ¢ëÈÅì (10-100‰∏á)</span>
                                    <span class="filter-chip" onclick="toggleSubscribers(this, 'huge')">Ë∂ÖÂ§ß (100‰∏á+)</span>
                                </div>
                            </div>

                            <!-- ÂèëÂ∏ÉÊó∂Èó¥Á≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üìÖ ÂèëÂ∏ÉÊó∂Èó¥</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearTime(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="toggleTime(this, '24h')">24Â∞èÊó∂</span>
                                    <span class="filter-chip" onclick="toggleTime(this, '7d')">Ëøë7Â§©</span>
                                    <span class="filter-chip" onclick="toggleTime(this, '30d')">Ëøë30Â§©</span>
                                    <span class="filter-chip" onclick="toggleTime(this, '90d')">Ëøë3‰∏™Êúà</span>
                                    <span class="filter-chip" onclick="toggleTime(this, '1y')">Ëøë1Âπ¥</span>
                                </div>
                            </div>

                            <!-- ÊéíÂ∫èÊñπÂºè -->
                            <div class="filter-group">
                                <div class="filter-label">üîÑ ÊéíÂ∫èÊñπÂºè</div>
                                <select class="filter-select" id="sortBy">
                                    <option value="views">Êí≠ÊîæÈáèÊúÄÈ´ò</option>
                                    <option value="likes">ÁÇπËµûÊúÄÂ§ö</option>
                                    <option value="comments">ËØÑËÆ∫ÊúÄÂ§ö</option>
                                    <option value="engagement">‰∫íÂä®ÁéáÊúÄÈ´ò</option>
                                    <option value="recent">ÊúÄÊñ∞ÂèëÂ∏É</option>
                                    <option value="growth">Â¢ûÈïøÊúÄÂø´</option>
                                </select>
                            </div>

                            <!-- ËßÜÈ¢ëÊï∞Èáè -->
                            <div class="filter-group">
                                <div class="filter-label">üî¢ ÂàÜÊûêËßÜÈ¢ëÊï∞Èáè</div>
                                <div class="filter-chips">
                                    <span class="filter-chip" onclick="setVideoCount(this, 100)">100‰∏™</span>
                                    <span class="filter-chip active" onclick="setVideoCount(this, 500)">500‰∏™</span>
                                    <span class="filter-chip" onclick="setVideoCount(this, 1000)">1000‰∏™</span>
                                    <span class="filter-chip" onclick="setVideoCount(this, 0)">‰∏çÈôê</span>
                                </div>
                            </div>

                            <!-- ÁÇπËµûÊï∞Á≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üëç ÁÇπËµûÊï∞ËåÉÂõ¥</div>
                                <div class="filter-range">
                                    <input type="text" id="likesMin" placeholder="ÊúÄÂ∞è">
                                    <span>-</span>
                                    <input type="text" id="likesMax" placeholder="ÊúÄÂ§ß">
                                </div>
                                <div class="filter-chips" style="margin-top: 10px;">
                                    <span class="filter-chip active" onclick="setLikesRange(null, null)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="setLikesRange(0, 1000)">1ÂçÉ‰ª•‰∏ã</span>
                                    <span class="filter-chip" onclick="setLikesRange(1000, 10000)">1ÂçÉ-1‰∏á</span>
                                    <span class="filter-chip" onclick="setLikesRange(10000, null)">1‰∏á+</span>
                                </div>
                            </div>

                            <!-- ËØÑËÆ∫Êï∞Á≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üí¨ ËØÑËÆ∫Êï∞ËåÉÂõ¥</div>
                                <div class="filter-range">
                                    <input type="text" id="commentsMin" placeholder="ÊúÄÂ∞è">
                                    <span>-</span>
                                    <input type="text" id="commentsMax" placeholder="ÊúÄÂ§ß">
                                </div>
                            </div>

                            <!-- ‰∫íÂä®ÁéáÁ≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üìà ‰∫íÂä®Áéá</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearEngagement(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="setEngagement(this, 'low')">‰Ωé (&lt;1%)</span>
                                    <span class="filter-chip" onclick="setEngagement(this, 'medium')">‰∏≠ (1-5%)</span>
                                    <span class="filter-chip" onclick="setEngagement(this, 'high')">È´ò (5-10%)</span>
                                    <span class="filter-chip" onclick="setEngagement(this, 'viral')">ÁàÜÊ¨æ (10%+)</span>
                                </div>
                            </div>

                            <!-- ËØ≠Ë®ÄÁ≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">üåê ËßÜÈ¢ëËØ≠Ë®Ä</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearLanguage(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="toggleLanguage(this, 'zh')">‰∏≠Êñá</span>
                                    <span class="filter-chip" onclick="toggleLanguage(this, 'en')">Ëã±Êñá</span>
                                    <span class="filter-chip" onclick="toggleLanguage(this, 'other')">ÂÖ∂‰ªñ</span>
                                </div>
                            </div>

                            <!-- È¢ëÈÅìÁ±ªÂûã -->
                            <div class="filter-group">
                                <div class="filter-label">üì∫ È¢ëÈÅìÁ±ªÂûã</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearChannelType(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="toggleChannelType(this, 'personal')">‰∏™‰∫∫</span>
                                    <span class="filter-chip" onclick="toggleChannelType(this, 'brand')">ÂìÅÁâå</span>
                                    <span class="filter-chip" onclick="toggleChannelType(this, 'media')">Â™í‰Ωì</span>
                                    <span class="filter-chip" onclick="toggleChannelType(this, 'mcn')">MCN</span>
                                </div>
                            </div>

                            <!-- ÁâπÂÆöÈ¢ëÈÅì -->
                            <div class="filter-group">
                                <div class="filter-label">üéØ ÊåáÂÆöÈ¢ëÈÅì</div>
                                <input type="text" class="filter-select" id="channelFilter" placeholder="ËæìÂÖ•È¢ëÈÅìÂêçÁß∞ÊàñID..." style="background-image: none;">
                            </div>

                            <!-- ÂÖ≥ÈîÆËØçÊéíÈô§ -->
                            <div class="filter-group">
                                <div class="filter-label">üö´ ÊéíÈô§ÂÖ≥ÈîÆËØç</div>
                                <input type="text" class="filter-select" id="excludeKeywords" placeholder="Â§ö‰∏™ÂÖ≥ÈîÆËØçÁî®ÈÄóÂè∑ÂàÜÈöî..." style="background-image: none;">
                            </div>

                            <!-- ËßÜÈ¢ëË¥®Èáè -->
                            <div class="filter-group">
                                <div class="filter-label">üé¨ ËßÜÈ¢ëË¥®Èáè</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="clearQuality(this)">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="toggleQuality(this, 'hd')">È´òÊ∏Ö (1080p+)</span>
                                    <span class="filter-chip" onclick="toggleQuality(this, 'sd')">Ê†áÊ∏Ö</span>
                                    <span class="filter-chip" onclick="toggleQuality(this, 'shorts')">Áü≠ËßÜÈ¢ë</span>
                                </div>
                            </div>

                            <!-- AIËßÜÈ¢ëÁ≠õÈÄâ -->
                            <div class="filter-group">
                                <div class="filter-label">ü§ñ AIËßÜÈ¢ë</div>
                                <div class="filter-chips">
                                    <span class="filter-chip active" onclick="setAIFilter(this, 'all')">‰∏çÈôê</span>
                                    <span class="filter-chip" onclick="setAIFilter(this, 'ai')">‰ªÖAIËßÜÈ¢ë</span>
                                    <span class="filter-chip" onclick="setAIFilter(this, 'human')">‰ªÖÁúü‰∫∫ËßÜÈ¢ë</span>
                                </div>
                                <div class="filter-hint" style="font-size: 11px; color: #64748b; margin-top: 6px;">
                                    Âü∫‰∫éÊ†áÈ¢ò/ÊèèËø∞/Ê†áÁ≠æ‰∏≠ÁöÑÂÖ≥ÈîÆËØçËØÜÂà´
                                </div>
                            </div>
                        </div>

                        <!-- Â∑≤ÈÄâÁ≠õÈÄâÊù°‰ª∂ -->
                        <div class="active-filters" id="activeFilters"></div>

                        <!-- Êìç‰ΩúÊåâÈíÆ -->
                        <div class="filters-actions">
                            <button class="filter-reset-btn" onclick="resetFilters()">ÈáçÁΩÆÁ≠õÈÄâ</button>
                            <button class="filter-apply-btn" onclick="applyFilters()">Â∫îÁî®Á≠õÈÄâ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂàÜÊûêÁä∂ÊÄÅ -->
            <div class="analysis-status" id="analysisStatus">
                <div class="status-header">
                    <span class="status-title" id="statusTitle">Ê≠£Âú®ÂàÜÊûêÔºöÂÅ•Â∫∑ÂÖªÁîü</span>
                    <span class="status-badge running" id="statusBadge">ÂàÜÊûê‰∏≠</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="status-log" id="statusLog">Ê≠£Âú®Êî∂ÈõÜËßÜÈ¢ëÊï∞ÊçÆ...</div>
            </div>

            <!-- ÂàÜÊûêÁªìÊûú -->
            <div id="resultsContainer" style="display: none;">

                <!-- Ê¶ÇËßàÊëòË¶ÅÈù¢Êùø -->
                <div class="panel active" id="panel-overview">
                    <!-- Êï∞ÊçÆÊ¶ÇËßàÂç°Áâá -->
                    <div class="boundary-card" id="overviewStats">
                        <div class="boundary-header">
                            <span class="boundary-title" id="overviewTitle">üìä Êï∞ÊçÆÊ¶ÇËßà</span>
                            <div style="display: flex; gap: 8px;">
                                <button class="filter-btn" onclick="switchPanel('report')" style="font-size: 12px;">üìã Êü•ÁúãÂÆåÊï¥Êä•Âëä</button>
                            </div>
                        </div>
                        <div class="boundary-stats" id="overviewNumbers">
                            <div class="stat-item">
                                <div class="stat-value" id="stat-videos">0</div>
                                <div class="stat-label">ËßÜÈ¢ëÊÄªÊï∞</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-channels">0</div>
                                <div class="stat-label">È¢ëÈÅìÊï∞</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-views">0</div>
                                <div class="stat-label">ÊÄªÊí≠ÊîæÈáè</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-avg-views">0</div>
                                <div class="stat-label">Âπ≥ÂùáÊí≠Êîæ</div>
                            </div>
                        </div>
                        <!-- Êï∞ÊçÆÊù•Ê∫ê‰ø°ÊÅØ -->
                        <div id="dataSourceInfo" style="margin-top: 12px; padding: 10px 12px; background: #1e293b; border-radius: 8px; font-size: 0.85em; color: #94a3b8; display: none;">
                            <div style="display: flex; flex-wrap: wrap; gap: 16px; align-items: center;">
                                <span id="dataTimeRange">Êï∞ÊçÆÊó∂Èó¥ËåÉÂõ¥Ôºö-</span>
                                <span id="dataCollectedAt">ÈááÈõÜÊó∂Èó¥Ôºö-</span>
                                <span id="dataFilterInfo">Á≠õÈÄâÊù°‰ª∂ÔºöÊó†</span>
                            </div>
                        </div>
                    </div>

                    <!-- ÂÖ≥ÈîÆÂèëÁé∞ -->
                    <div class="ai-insight" id="keyFindings">
                        <div class="ai-header">
                            <div class="ai-avatar">üí°</div>
                            <div class="ai-label">ÂÖ≥ÈîÆÂèëÁé∞</div>
                        </div>
                        <div class="ai-content" id="keyFindingsContent">
                            <p style="color: #64748b;">ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÂºÄÂßãÂàÜÊûêÂêéÔºåËøôÈáåÂ∞ÜÊòæÁ§∫ÂÖ≥ÈîÆÂèëÁé∞...</p>
                        </div>
                    </div>

                    <!-- Âø´ÈÄüÂÖ•Âè£ -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div style="background: #1e293b; border-radius: 12px; padding: 16px; cursor: pointer;" onclick="switchPanel('videos')">
                            <div style="font-size: 1.8em; margin-bottom: 8px;">üé¨</div>
                            <div style="font-weight: 600; color: white; margin-bottom: 4px;">ËßÜÈ¢ëÊï∞ÊçÆ</div>
                            <div style="font-size: 0.85em; color: #64748b;" id="quick-videos">Êü•ÁúãËßÜÈ¢ëÊ¶úÂçï</div>
                        </div>
                        <div style="background: #1e293b; border-radius: 12px; padding: 16px; cursor: pointer;" onclick="switchPanel('channels')">
                            <div style="font-size: 1.8em; margin-bottom: 8px;">üì∫</div>
                            <div style="font-weight: 600; color: white; margin-bottom: 4px;">È¢ëÈÅìÊï∞ÊçÆ</div>
                            <div style="font-size: 0.85em; color: #64748b;" id="quick-channels">Êü•ÁúãÈ¢ëÈÅìÊ¶úÂçï</div>
                        </div>
                        <div style="background: #1e293b; border-radius: 12px; padding: 16px; cursor: pointer;" onclick="goToInsightSystem()">
                            <div style="font-size: 1.8em; margin-bottom: 8px;">üîç</div>
                            <div style="font-weight: 600; color: white; margin-bottom: 4px;">Ê®°ÂºèÊ¥ûÂØü</div>
                            <div style="font-size: 0.85em; color: #64748b;">ÂèëÁé∞ËßÑÂæãÊ®°Âºè</div>
                        </div>
                        <div style="background: #1e293b; border-radius: 12px; padding: 16px; cursor: pointer;" onclick="switchPanel('report')">
                            <div style="font-size: 1.8em; margin-bottom: 8px;">üìã</div>
                            <div style="font-weight: 600; color: white; margin-bottom: 4px;">ÂàÜÊûêÊä•Âëä</div>
                            <div style="font-size: 0.85em; color: #64748b;">ÂÆåÊï¥ÂàÜÊûêÊä•Âëä</div>
                        </div>
                    </div>

                    <!-- Top 3 ËßÜÈ¢ëÈ¢ÑËßà -->
                    <div class="ranking-section" id="topVideosPreview">
                        <div class="ranking-header">
                            <span class="ranking-title">üèÜ Top 3 ËßÜÈ¢ë</span>
                            <button class="filter-btn" onclick="switchPanel('videos')" style="font-size: 12px;">Êü•ÁúãÂÖ®ÈÉ® ‚Üí</button>
                        </div>
                        <div class="ranking-list" id="top3VideosList">
                            <div style="padding: 20px; text-align: center; color: #64748b;">ÊöÇÊó†Êï∞ÊçÆ</div>
                        </div>
                    </div>

                    <!-- Top 3 È¢ëÈÅìÈ¢ÑËßà -->
                    <div class="ranking-section" id="topChannelsPreview">
                        <div class="ranking-header">
                            <span class="ranking-title">‚≠ê Top 3 È¢ëÈÅì</span>
                            <button class="filter-btn" onclick="switchPanel('channels')" style="font-size: 12px;">Êü•ÁúãÂÖ®ÈÉ® ‚Üí</button>
                        </div>
                        <div class="ranking-list" id="top3ChannelsList">
                            <div style="padding: 20px; text-align: center; color: #64748b;">ÊöÇÊó†Êï∞ÊçÆ</div>
                        </div>
                    </div>
                </div>

                <!-- ËßÜÈ¢ëÊ¶úÂçïÈù¢Êùø -->
                <div class="panel" id="panel-videos">
                    <!-- Ê†áÁ≠æÈ°µÂíåÂØºÂá∫ÊåâÈíÆ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div class="tabs" style="margin-bottom: 0;">
                            <button class="tab active" onclick="switchVideoTab('hot')">üî• ÁàÜÊ¨æËßÜÈ¢ë</button>
                            <button class="tab" onclick="switchVideoTab('recentHits')">‚ö° ËøëÊúüÁàÜÊ¨æ</button>
                            <button class="tab" onclick="switchVideoTab('evergreen')">üå≤ ÈïøÈùíËßÜÈ¢ë</button>
                            <button class="tab" onclick="switchVideoTab('potential')">üìà ÊΩúÂäõËßÜÈ¢ë</button>
                            <button class="tab" onclick="switchVideoTab('longform')">‚è±Ô∏è ÈïøËßÜÈ¢ëÊ¶ú</button>
                        </div>
                        <div class="export-buttons" style="display: flex; gap: 8px;">
                            <button class="export-btn" onclick="exportData('csv')" title="ÂØºÂá∫CSVÊ†ºÂºè" style="padding: 6px 12px; font-size: 12px;">
                                üìä ÂØºÂá∫ CSV
                            </button>
                            <button class="export-btn" onclick="exportData('json')" title="ÂØºÂá∫JSONÊ†ºÂºè" style="padding: 6px 12px; font-size: 12px;">
                                üìÅ ÂØºÂá∫ JSON
                            </button>
                        </div>
                    </div>

                    <!-- ÁàÜÊ¨æËßÜÈ¢ëÊ¶úÂçï -->
                    <div class="ranking-section">
                        <div class="ranking-header">
                            <span class="ranking-title">
                                üî• ÁàÜÊ¨æËßÜÈ¢ë Top 100
                                <span class="ranking-count">ÂÖ± 120 ‰∏™</span>
                            </span>
                            <div class="ranking-filters" id="videoTimeFilters">
                                <button class="filter-btn active" onclick="setVideoTimeFilter(0)">ÂÖ®ÈÉ®</button>
                                <button class="filter-btn" onclick="setVideoTimeFilter(1)">Ëøë24Â∞èÊó∂</button>
                                <button class="filter-btn" onclick="setVideoTimeFilter(7)">Ëøë7Â§©</button>
                                <button class="filter-btn" onclick="setVideoTimeFilter(30)">Ëøë30Â§©</button>
                                <button class="filter-btn" onclick="setVideoTimeFilter(90)">Ëøë90Â§©</button>
                            </div>
                        </div>
                        <div class="ranking-list" id="videoRankingList">
                            <!-- Âä®ÊÄÅÁîüÊàê -->
                        </div>
                        <div class="load-more">
                            <button class="load-more-btn" onclick="loadMoreVideos()">Âä†ËΩΩÊõ¥Â§ö</button>
                        </div>
                    </div>
                </div>

                <!-- È¢ëÈÅìÊï∞ÊçÆÈù¢Êùø -->
                <div class="panel" id="panel-channels">
                    <!-- Ê†áÁ≠æÈ°µÂíåÂØºÂá∫ÊåâÈíÆ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div class="tabs" style="margin-bottom: 0;">
                            <button class="tab active" onclick="switchChannelTab('totalViews')">üìä ÊÄªÊí≠ÊîæÊ¶ú</button>
                            <button class="tab" onclick="switchChannelTab('avgViews')">‚ö° Âπ≥ÂùáÊí≠ÊîæÊ¶ú</button>
                            <button class="tab" onclick="switchChannelTab('videoCount')">üìπ ËßÜÈ¢ëÊï∞Ê¶ú</button>
                            <button class="tab" onclick="switchChannelTab('darkHorse')">üê¥ ÈªëÈ©¨Ê¶ú</button>
                            <button class="tab" onclick="switchChannelTab('efficiency')">üöÄ È´òÊïàÊ¶ú</button>
                        </div>
                        <div class="export-buttons" style="display: flex; gap: 8px;">
                            <button class="export-btn" onclick="exportData('csv')" title="ÂØºÂá∫CSVÊ†ºÂºè" style="padding: 6px 12px; font-size: 12px;">
                                üìä ÂØºÂá∫ CSV
                            </button>
                            <button class="export-btn" onclick="exportData('json')" title="ÂØºÂá∫JSONÊ†ºÂºè" style="padding: 6px 12px; font-size: 12px;">
                                üìÅ ÂØºÂá∫ JSON
                            </button>
                        </div>
                    </div>

                    <!-- È¢ëÈÅìÊ¶úÂçï -->
                    <div id="channelRankingContainer">
                        <div class="no-data-state">
                            <div class="no-data-icon">üì∫</div>
                            <div class="no-data-title">ÊöÇÊó†È¢ëÈÅìÊï∞ÊçÆ</div>
                            <p class="no-data-desc">ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÂêéÔºåËøôÈáåÂ∞ÜÂ±ïÁ§∫È¢ëÈÅìÊéíË°åÊ¶ú</p>
                        </div>
                    </div>
                </div>

                <!-- ÂàÜÊûêÊä•ÂëäÈù¢Êùø -->
                <div class="panel" id="panel-report">
                    <div class="ranking-section">
                        <div class="ranking-header">
                            <span class="ranking-title" id="reportTitle">üìã ÂàÜÊûêÊä•Âëä</span>
                            <div style="display: flex; gap: 8px;">
                                <button class="filter-btn" onclick="exportReport('csv')" style="font-size: 12px;">üìä ÂØºÂá∫ CSV</button>
                                <button class="filter-btn" onclick="exportReport('json')" style="font-size: 12px;">üìÅ ÂØºÂá∫ JSON</button>
                            </div>
                        </div>

                        <!-- Êä•ÂëäÂÜÖÂÆπ -->
                        <div id="reportContent" style="padding: 20px;">
                            <div class="no-data-state">
                                <div class="no-data-icon">üìã</div>
                                <div class="no-data-title">ÊöÇÊó†Êä•Âëä</div>
                                <p class="no-data-desc">ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÂêéÔºåËøôÈáåÂ∞ÜÁîüÊàêÂÆåÊï¥ÁöÑÂàÜÊûêÊä•Âëä</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÁõëÊéßÈù¢ÊùøÔºàÁã¨Á´ã‰∫é resultsContainerÔºâ -->
                <div class="panel" id="panel-monitor">
                    <div class="ranking-section">
                        <div class="ranking-header">
                            <span class="ranking-title">üì° ÂÖ≥ÈîÆËØçÁõëÊéß</span>
                            <div style="display: flex; gap: 8px;">
                                <button class="filter-btn" onclick="toggleScheduler()" id="schedulerBtn" style="font-size: 12px;">‚ñ∂Ô∏è ÂêØÂä®Ë∞ÉÂ∫¶Âô®</button>
                                <button class="search-btn" onclick="showAddMonitorModal()" style="padding: 8px 16px; font-size: 12px;">+ Ê∑ªÂä†ÁõëÊéß</button>
                            </div>
                        </div>

                        <!-- Ë∞ÉÂ∫¶Âô®Áä∂ÊÄÅ -->
                        <div id="schedulerStatus" style="padding: 12px 20px; background: #0f172a; border-bottom: 1px solid #334155;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span id="schedulerIndicator" style="width: 10px; height: 10px; border-radius: 50%; background: #64748b;"></span>
                                <span style="color: #94a3b8; font-size: 0.9em;" id="schedulerStatusText">Ë∞ÉÂ∫¶Âô®Êú™ËøêË°å</span>
                            </div>
                        </div>

                        <!-- ÁõëÊéß‰ªªÂä°ÂàóË°® -->
                        <div class="ranking-list" id="monitorTasksList" style="max-height: none;">
                            <div style="padding: 40px 20px; text-align: center; color: #64748b;">
                                <div style="font-size: 2em; margin-bottom: 16px;">üì°</div>
                                <div style="font-weight: 600; color: white; margin-bottom: 8px;">ÊöÇÊó†ÁõëÊéß‰ªªÂä°</div>
                                <p>Ê∑ªÂä†ÂÖ≥ÈîÆËØçÂêéÔºåÁ≥ªÁªüÂ∞ÜÂÆöÊó∂ÈááÈõÜÊï∞ÊçÆÂπ∂ËøΩË∏™Â¢ûÈïøË∂ãÂäø</p>
                                <button class="search-btn" onclick="showAddMonitorModal()" style="margin-top: 16px; padding: 10px 20px;">+ Ê∑ªÂä†ÁõëÊéß‰ªªÂä°</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ë∂ãÂäøËøΩË∏™Èù¢Êùø -->
                <div class="panel" id="panel-trending">
                    <div class="ranking-section">
                        <div class="ranking-header">
                            <span class="ranking-title">üìà Ë∂ãÂäøËøΩË∏™</span>
                            <div class="ranking-filters">
                                <button class="filter-btn active" onclick="setTrendingDays(7)">Ëøë7Â§©</button>
                                <button class="filter-btn" onclick="setTrendingDays(14)">Ëøë14Â§©</button>
                                <button class="filter-btn" onclick="setTrendingDays(30)">Ëøë30Â§©</button>
                            </div>
                        </div>

                        <!-- Ë∂ãÂäøÊëòË¶Å -->
                        <div id="trendingSummary" style="padding: 20px; background: #0f172a; border-bottom: 1px solid #334155;">
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 1.4em; font-weight: 700; color: #06b6d4;" id="trend-total-videos">0</div>
                                    <div style="font-size: 0.75em; color: #64748b;">ÁõëÊéßËßÜÈ¢ë</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.4em; font-weight: 700; color: #10b981;" id="trend-total-growth">0</div>
                                    <div style="font-size: 0.75em; color: #64748b;">ÊÄªÂ¢ûÈïø</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.4em; font-weight: 700; color: #f59e0b;" id="trend-trending-count">0</div>
                                    <div style="font-size: 0.75em; color: #64748b;">Ë∂ãÂäø‰∏äÂçá</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.4em; font-weight: 700; color: #8b5cf6;" id="trend-avg-growth">0</div>
                                    <div style="font-size: 0.75em; color: #64748b;">Âπ≥ÂùáÂ¢ûÈïø</div>
                                </div>
                            </div>
                        </div>

                        <!-- Ë∂ãÂäøËßÜÈ¢ëÂàóË°® -->
                        <div class="ranking-list" id="trendingVideosList">
                            <div style="padding: 40px 20px; text-align: center; color: #64748b;">
                                <div style="font-size: 2em; margin-bottom: 16px;">üìà</div>
                                <div style="font-weight: 600; color: white; margin-bottom: 8px;">ÊöÇÊó†Ë∂ãÂäøÊï∞ÊçÆ</div>
                                <p>Ê∑ªÂä†ÁõëÊéß‰ªªÂä°Âπ∂Á≠âÂæÖÊï∞ÊçÆÈááÈõÜÂêéÔºåËøôÈáåÂ∞ÜÊòæÁ§∫Â¢ûÈïøË∂ãÂäø</p>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- ËØäÊñ≠ÁªìÊûú -->
            <div class="diagnose-result" id="diagnoseResult">
                <div class="diagnose-summary">
                    <div class="diagnose-channel">
                        <div class="diagnose-channel-avatar">üë§</div>
                        <div class="diagnose-channel-info">
                            <h3 id="diagnoseChannelName">ÊàëÁöÑÂÖªÁîüÈ¢ëÈÅì</h3>
                            <p>ËÆ¢ÈòÖ 2.3‰∏á ¬∑ ËßÜÈ¢ë 45 ‰∏™ ¬∑ ÊÄªÊí≠Êîæ 89‰∏á</p>
                        </div>
                    </div>
                    <div class="diagnose-scores">
                        <div class="diagnose-score">
                            <div class="diagnose-score-value" style="color: #f59e0b;">B+</div>
                            <div class="diagnose-score-label">ÁªºÂêàËØÑÂàÜ</div>
                        </div>
                        <div class="diagnose-score">
                            <div class="diagnose-score-value" style="color: #10b981;">A</div>
                            <div class="diagnose-score-label">ÂÜÖÂÆπË¥®Èáè</div>
                        </div>
                        <div class="diagnose-score">
                            <div class="diagnose-score-value" style="color: #ef4444;">C</div>
                            <div class="diagnose-score-label">Êõ¥Êñ∞È¢ëÁéá</div>
                        </div>
                        <div class="diagnose-score">
                            <div class="diagnose-score-value" style="color: #f59e0b;">B</div>
                            <div class="diagnose-score-label">‰∫íÂä®Áéá</div>
                        </div>
                    </div>

                    <div class="ai-insight" style="margin: 0;">
                        <div class="ai-header">
                            <div class="ai-avatar">ü§ñ</div>
                            <div class="ai-label">ËØäÊñ≠Êä•Âëä</div>
                        </div>
                        <div class="ai-content">
                            <p><strong>‰ºòÂäøÔºö</strong>ÂÜÖÂÆπË¥®ÈáèËæÉÈ´òÔºåÂçïÊù°ËßÜÈ¢ëÂÆåÊí≠ÁéáËææÂà∞ 65%ÔºåÈ´ò‰∫éË°å‰∏öÂπ≥ÂùáÁöÑ 42%„ÄÇÁî®Êà∑ËØÑËÆ∫ÁßØÊûÅÔºåÁ≤â‰∏ùÁ≤òÊÄßÂ•Ω„ÄÇ</p>
                            <p><strong>Âä£ÂäøÔºö</strong>Êõ¥Êñ∞È¢ëÁéáËøá‰ΩéÔºàÂπ≥Âùá 12 Â§©/Êù°ÔºâÔºåÈîôÂ§±‰∫ÜÁÆóÊ≥ïÊé®ËçêÁ™óÂè£Êúü„ÄÇËßÜÈ¢ëÊó∂ÈïøÈõÜ‰∏≠Âú® 5-8 ÂàÜÈíüÔºåÊú™ËÉΩÊäì‰Ωè 20-30 ÂàÜÈíüÁöÑËìùÊµ∑Êú∫‰ºö„ÄÇ</p>
                            <p><strong>Âª∫ËÆÆÔºö</strong>ÊèêÈ´òÊõ¥Êñ∞È¢ëÁéáËá≥ÊØèÂë® 2-3 Êù°ÔºåÂ∞ùËØïÂà∂‰Ωú 20-30 ÂàÜÈíüÁöÑÊ∑±Â∫¶ÂÜÖÂÆπÔºåÂèØÂèÇËÄÉ„ÄåÂÖªÁîüÊúâÈÅì„ÄçÁöÑÂÜÖÂÆπÁªìÊûÑ„ÄÇ</p>
                        </div>
                    </div>
                </div>

                <div class="recommend-channels">
                    <div class="recommend-title">üéØ Êé®ËçêÊ®°‰ªøÁöÑÂØπÊ†áË¥¶Âè∑ÔºàÊåâÂåπÈÖçÂ∫¶ÊéíÂ∫èÔºâ</div>
                    <div class="recommend-list" id="recommendList">
                        <!-- Âä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- Á©∫Áä∂ÊÄÅ -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üîç</div>
                <div class="empty-title">ËæìÂÖ•‰∏Ä‰∏™È¢ÜÂüüÔºåÂºÄÂßãÊ∑±Â∫¶ÂàÜÊûê</div>
                <p>AI ‰ºöÂàÜÊûê 1000+ Á´ûÂìÅËßÜÈ¢ëÔºåÂëäËØâ‰Ω†Â∏ÇÂú∫ËæπÁïå„ÄÅÂÖ≥ÈîÆÈ¢ëÈÅì„ÄÅÊΩúÂäõËßÜÈ¢ëÂíåÊúÄ‰Ω≥Êú∫‰ºö</p>
            </div>
        </main>
    </div>

    <script>
        // Ê∏≤ÊüìËßÜÈ¢ëÊ¶úÂçï
        function renderVideoRanking(data, limit = 50) {
            const list = document.getElementById('videoRankingList');
            const isEvergreen = currentVideoTab === 'evergreen';
            const isRecentHits = currentVideoTab === 'recentHits';

            list.innerHTML = data.slice(0, limit).map(v => {
                // ËøëÊúüÁàÜÊ¨æÂíåÈïøÈùíËßÜÈ¢ëÊòæÁ§∫Êó•ÂùáÊí≠Êîæ
                let statsHtml = '';
                if (isEvergreen && v.dailyViews) {
                    statsHtml = `
                        <div class="rank-stat">
                            <div class="rank-stat-value" style="color: #10b981;">${formatNumber(v.dailyViews)}</div>
                            <div class="rank-stat-label">Êó•ÂùáÊí≠Êîæ</div>
                        </div>
                        <div class="rank-stat">
                            <div class="rank-stat-value">${formatNumber(v.views)}</div>
                            <div class="rank-stat-label">ÊÄªÊí≠Êîæ</div>
                        </div>
                    `;
                } else if (isRecentHits && v.videoAgeDays) {
                    statsHtml = `
                        <div class="rank-stat">
                            <div class="rank-stat-value" style="color: #f59e0b;">${formatNumber(v.views)}</div>
                            <div class="rank-stat-label">Êí≠ÊîæÈáè</div>
                        </div>
                        <div class="rank-stat">
                            <div class="rank-stat-value">${v.videoAgeDays}Â§©</div>
                            <div class="rank-stat-label">ÂèëÂ∏É</div>
                        </div>
                    `;
                } else {
                    statsHtml = `
                        <div class="rank-stat">
                            <div class="rank-stat-value">${formatNumber(v.views)}</div>
                            <div class="rank-stat-label">Êí≠Êîæ</div>
                        </div>
                        <div class="rank-stat">
                            <div class="rank-stat-value">${formatNumber(v.likes || 0)}</div>
                            <div class="rank-stat-label">ÁÇπËµû</div>
                        </div>
                    `;
                }

                return `
                <div class="ranking-item" onclick="openVideo('${v.videoId}')" style="cursor: pointer;" title="ÁÇπÂáªÊâìÂºÄËßÜÈ¢ë">
                    <div class="rank-number ${v.rank <= 3 ? 'rank-' + v.rank : 'rank-normal'}">${v.rank}</div>
                    <div class="rank-thumb">üé¨</div>
                    <div class="rank-info">
                        <div class="rank-title">${v.title}</div>
                        <div class="rank-meta">
                            <span>${v.channel}</span>
                            <span>${v.duration || ''}</span>
                            <span>${v.date}</span>
                        </div>
                    </div>
                    <div class="rank-stats">${statsHtml}</div>
                    <div class="rank-score score-${(v.score || 'C').toLowerCase()}">${v.score || 'C'}</div>
                </div>
            `}).join('');
        }

        // ÊâìÂºÄËßÜÈ¢ëÈìæÊé•
        function openVideo(videoId) {
            if (videoId) {
                window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
            }
        }

        // Ê∏≤ÊüìÈ¢ëÈÅìÂàóË°®ÔºàËØäÊñ≠ÂäüËÉΩÁî®Ôºâ
        function renderChannelList() {
            const list = document.getElementById('channelList');
            if (!list) return;
            list.innerHTML = '<div class="no-data-state"><div class="no-data-icon">üì∫</div><div class="no-data-title">ÊöÇÊó†È¢ëÈÅìÊï∞ÊçÆ</div></div>';
        }

        function toggleChannelVideos(index) {
            const el = document.getElementById(`channel-videos-${index}`);
            el.classList.toggle('open');
        }

        // Ê∏≤ÊüìËØùÈ¢òÊ¶úÂçïÔºàËØäÊñ≠ÂäüËÉΩÁî®Ôºâ
        function renderTopicRanking() {
            const list = document.getElementById('topicRankingList');
            if (!list) return;
            list.innerHTML = '<div class="no-data-state"><div class="no-data-icon">üè∑Ô∏è</div><div class="no-data-title">ÊöÇÊó†ËØùÈ¢òÊï∞ÊçÆ</div></div>';
        }

        // Ê∏≤ÊüìÂú∞Âå∫ÂàÜÂ∏ÉÔºàËØäÊñ≠ÂäüËÉΩÁî®Ôºâ
        function renderRegionGrid() {
            const grid = document.getElementById('regionGrid');
            if (!grid) return;
            grid.innerHTML = '<div class="no-data-state"><div class="no-data-icon">üåè</div><div class="no-data-title">ÊöÇÊó†Âú∞Âå∫Êï∞ÊçÆ</div></div>';
        }

        // Ê∏≤ÊüìÊé®ËçêË¥¶Âè∑ÔºàËØäÊñ≠ÂäüËÉΩÁî®Ôºâ
        function renderRecommendList() {
            const list = document.getElementById('recommendList');
            if (!list) return;
            list.innerHTML = '<div class="no-data-state"><div class="no-data-icon">üë•</div><div class="no-data-title">ÊöÇÊó†Êé®ËçêÊï∞ÊçÆ</div></div>';
        }

        // Ê†ºÂºèÂåñÊï∞Â≠ó
        function formatNumber(num) {
            if (num >= 10000) {
                return (num / 10000).toFixed(1) + '‰∏á';
            }
            return num.toLocaleString();
        }

        // ÂàáÊç¢Èù¢Êùø
        function switchPanel(panelId) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));

            document.getElementById('panel-' + panelId).classList.add('active');
            document.querySelector(`[data-panel="${panelId}"]`).classList.add('active');
        }

        // ‰æßËæπÊ†èÁÇπÂáª
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', () => {
                const panel = item.dataset.panel;
                if (panel) {
                    switchPanel(panel);
                }
            });
        });

        // ËÆæÁΩÆËØùÈ¢ò
        function setTopic(topic) {
            document.getElementById('topicInput').value = topic;
            startAnalysis();
        }

        // ==================== Âä®ÊÄÅË∂ãÂäøÁÉ≠ËØçÁ≥ªÁªü ====================

        // ÊêúÁ¥¢ÂéÜÂè≤ÁÆ°ÁêÜÔºàÂ≠òÂÇ®Âú® localStorageÔºâ
        const SEARCH_HISTORY_KEY = 'youtube_search_history';
        const MAX_HISTORY_ITEMS = 5;

        function getSearchHistory() {
            try {
                return JSON.parse(localStorage.getItem(SEARCH_HISTORY_KEY)) || [];
            } catch {
                return [];
            }
        }

        function saveSearchHistory(keyword) {
            const history = getSearchHistory();
            // ÁßªÈô§ÈáçÂ§çÈ°π
            const filtered = history.filter(h => h !== keyword);
            // Ê∑ªÂä†Âà∞ÂºÄÂ§¥
            filtered.unshift(keyword);
            // ‰øùÁïôÊúÄËøë N Êù°
            const trimmed = filtered.slice(0, MAX_HISTORY_ITEMS);
            localStorage.setItem(SEARCH_HISTORY_KEY, JSON.stringify(trimmed));
            renderSearchHistory();
        }

        function renderSearchHistory() {
            const history = getSearchHistory();
            const container = document.getElementById('historyPresets');

            if (history.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'flex';
            container.innerHTML = '<span class="preset-label">ÊúÄËøëÊêúÁ¥¢Ôºö</span>' +
                history.map(h => `<button class="preset-tag" onclick="setTopic('${h}')">${h}</button>`).join('');
        }

        // Ë∂ãÂäøÁÉ≠ËØçËé∑Âèñ
        async function fetchTrendingKeywords() {
            const container = document.getElementById('trendingKeywords');
            const loading = document.getElementById('trendingLoading');
            const source = document.getElementById('trendingSource');
            const refreshBtn = document.getElementById('trendingRefresh');

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            container.innerHTML = `
                <div class="trending-loading">
                    <div class="dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <span>Ê≠£Âú®Ëé∑Âèñ YouTube Ë∂ãÂäøÊï∞ÊçÆ...</span>
                </div>
            `;
            source.style.display = 'none';
            refreshBtn.classList.add('loading');

            try {
                // ÈÄöËøá WebSocket ËØ∑Ê±ÇÂêéÁ´ØËé∑ÂèñË∂ãÂäøÁÉ≠ËØç
                const keywords = await requestTrendingFromServer();
                renderTrendingKeywords(keywords);
            } catch (error) {
                console.error('Ëé∑ÂèñË∂ãÂäøÁÉ≠ËØçÂ§±Ë¥•:', error);
                // ÈôçÁ∫ßÊñπÊ°àÔºö‰ΩøÁî®ÊêúÁ¥¢Âª∫ËÆÆ API
                await fallbackToSuggestions();
            } finally {
                refreshBtn.classList.remove('loading');
            }
        }

        // ÈÄöËøá WebSocket ËØ∑Ê±ÇÂêéÁ´ØËé∑ÂèñË∂ãÂäø
        function requestTrendingFromServer() {
            return new Promise((resolve, reject) => {
                // Â¶ÇÊûú WebSocket Â∑≤ËøûÊé•ÔºåÂèëÈÄÅËØ∑Ê±Ç
                if (globalWs && globalWs.readyState === WebSocket.OPEN) {
                    // ËÆæÁΩÆË∂ÖÊó∂
                    const timeout = setTimeout(() => {
                        reject(new Error('ËØ∑Ê±ÇË∂ÖÊó∂'));
                    }, 15000);

                    // ‰∏¥Êó∂ÁõëÂê¨Âô®
                    const handler = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            if (data.type === 'trending_keywords') {
                                clearTimeout(timeout);
                                globalWs.removeEventListener('message', handler);
                                resolve(data.keywords || []);
                            }
                        } catch (e) {}
                    };

                    globalWs.addEventListener('message', handler);
                    globalWs.send(JSON.stringify({ type: 'get_trending' }));
                } else {
                    // WebSocket Êú™ËøûÊé•ÔºåÁõ¥Êé•‰ΩøÁî®ÈôçÁ∫ßÊñπÊ°à
                    reject(new Error('WebSocket Êú™ËøûÊé•'));
                }
            });
        }

        // ÈôçÁ∫ßÊñπÊ°àÔºö‰ΩøÁî® YouTube ÊêúÁ¥¢Âª∫ËÆÆËé∑ÂèñÁÉ≠ËØç
        async function fallbackToSuggestions() {
            const container = document.getElementById('trendingKeywords');
            const source = document.getElementById('trendingSource');

            container.innerHTML = `
                <div class="trending-loading">
                    <div class="dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <span>Ê≠£Âú®‰ªéÊêúÁ¥¢Âª∫ËÆÆËé∑ÂèñÁÉ≠ËØç...</span>
                </div>
            `;

            try {
                // ‰ΩøÁî®Â§ö‰∏™ÈÄöÁî®ÁßçÂ≠êËØçËé∑ÂèñÂª∫ËÆÆ
                const seeds = ['2025', 'ÊïôÁ®ã', 'ÂÖªÁîü', 'ÁæéÈ£ü', 'ÁßëÊäÄ', 'Êñ∞Èóª'];
                const allSuggestions = [];

                for (const seed of seeds) {
                    try {
                        const suggestions = await fetchYouTubeSuggestions(seed);
                        if (suggestions && suggestions.length > 0) {
                            // ÂèñÁ¨¨‰∏Ä‰∏™Âª∫ËÆÆ
                            allSuggestions.push({
                                keyword: suggestions[0],
                                heat: Math.floor(Math.random() * 50) + 50 // Ê®°ÊãüÁÉ≠Â∫¶
                            });
                        }
                    } catch (e) {
                        console.log(`Ëé∑Âèñ "${seed}" ÁöÑÂª∫ËÆÆÂ§±Ë¥•`);
                    }
                }

                if (allSuggestions.length > 0) {
                    renderTrendingKeywords(allSuggestions);
                    document.getElementById('trendingSource').querySelector('span:last-child').innerHTML =
                        `Êï∞ÊçÆÊù•Ê∫êÔºöYouTube ÊêúÁ¥¢Âª∫ËÆÆ ¬∑ Êõ¥Êñ∞Êó∂Èó¥Ôºö<span id="trendingTime">${new Date().toLocaleTimeString()}</span>`;
                } else {
                    throw new Error('Êó†Ê≥ïËé∑ÂèñÂª∫ËÆÆ');
                }
            } catch (error) {
                container.innerHTML = `
                    <div class="trending-error">
                        <span>‚ö†Ô∏è</span>
                        <span>ÊöÇÊó∂Êó†Ê≥ïËé∑ÂèñË∂ãÂäøÊï∞ÊçÆÔºåËØ∑ÊâãÂä®ËæìÂÖ•ÂÖ≥ÈîÆËØç</span>
                    </div>
                `;
            }
        }

        // Ëé∑Âèñ YouTube ÊêúÁ¥¢Âª∫ËÆÆ
        async function fetchYouTubeSuggestions(seed) {
            return new Promise((resolve, reject) => {
                // ‰ΩøÁî® JSONP ÊñπÂºèËé∑ÂèñÂª∫ËÆÆ
                const callbackName = 'ytSuggestCallback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const script = document.createElement('script');

                // ËÆæÁΩÆË∂ÖÊó∂
                const timeout = setTimeout(() => {
                    cleanup();
                    reject(new Error('ËØ∑Ê±ÇË∂ÖÊó∂'));
                }, 5000);

                // Ê∏ÖÁêÜÂáΩÊï∞
                function cleanup() {
                    clearTimeout(timeout);
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                }

                // ÂÆö‰πâÂõûË∞É
                window[callbackName] = function(data) {
                    cleanup();
                    if (data && data[1]) {
                        const suggestions = data[1].map(item => item[0]);
                        resolve(suggestions);
                    } else {
                        reject(new Error('Êó†Êï∞ÊçÆ'));
                    }
                };

                // ÊûÑÂª∫ URL
                const encodedSeed = encodeURIComponent(seed);
                script.src = `https://clients1.google.com/complete/search?client=youtube&gs_ri=youtube&ds=yt&q=${encodedSeed}&callback=${callbackName}`;
                script.onerror = () => {
                    cleanup();
                    reject(new Error('Âä†ËΩΩÂ§±Ë¥•'));
                };

                document.head.appendChild(script);
            });
        }

        // Ê∏≤ÊüìË∂ãÂäøÁÉ≠ËØç
        function renderTrendingKeywords(keywords) {
            const container = document.getElementById('trendingKeywords');
            const source = document.getElementById('trendingSource');

            if (!keywords || keywords.length === 0) {
                container.innerHTML = `
                    <div class="trending-error">
                        <span>üì≠</span>
                        <span>ÊöÇÊó†Ë∂ãÂäøÊï∞ÊçÆ</span>
                    </div>
                `;
                return;
            }

            container.innerHTML = keywords.map(item => {
                const keyword = typeof item === 'string' ? item : item.keyword;
                const heat = typeof item === 'object' && item.heat ? item.heat : null;
                const heatHtml = heat ? `<span class="tag-heat">üî•${heat}</span>` : '';
                return `<button class="trending-tag" onclick="setTrendingTopic('${keyword}')">${keyword}${heatHtml}</button>`;
            }).join('');

            source.style.display = 'flex';
            document.getElementById('trendingTime').textContent = new Date().toLocaleTimeString();
        }

        // ÁÇπÂáªË∂ãÂäøÁÉ≠ËØç
        function setTrendingTopic(topic) {
            document.getElementById('topicInput').value = topic;
            // ÂèØÈÄâÔºöÁõ¥Êé•ÂºÄÂßãÂàÜÊûê
            // startAnalysis();
        }

        // Âà∑Êñ∞Ë∂ãÂäøÁÉ≠ËØç
        function refreshTrendingKeywords() {
            fetchTrendingKeywords();
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Ê∏≤ÊüìÊêúÁ¥¢ÂéÜÂè≤
            renderSearchHistory();

            // Ëé∑ÂèñË∂ãÂäøÁÉ≠ËØç
            setTimeout(() => {
                fetchTrendingKeywords();
            }, 500);

            // Âä†ËΩΩÂ∑≤Êúâ‰∏ªÈ¢ò
            loadExistingThemes();
        });

        // Âä†ËΩΩÂ∑≤Êúâ‰∏ªÈ¢ò
        async function loadExistingThemes() {
            try {
                const response = await fetch(`${API_BASE}/api/themes`);
                const data = await response.json();

                if (data.status === 'ok' && data.themes && data.themes.length > 0) {
                    const container = document.getElementById('themeButtons');
                    container.innerHTML = data.themes.map(t =>
                        `<button class="preset-btn" onclick="quickViewTheme('${t.theme}')" style="background: #334155; border: 1px solid #475569; padding: 6px 12px; border-radius: 6px; color: #e2e8f0; cursor: pointer; font-size: 0.85em;">
                            ${t.theme} <span style="color: #94a3b8; font-size: 0.8em;">(${t.count})</span>
                        </button>`
                    ).join('');
                    document.getElementById('existingThemes').style.display = 'block';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂ∑≤Êúâ‰∏ªÈ¢òÂ§±Ë¥•:', error);
            }
        }

        // ÁÇπÂáªÂ∑≤Êúâ‰∏ªÈ¢òÁõ¥Êé•Ë∑≥ËΩ¨Âà∞Ê®°ÂºèÊ¥ûÂØü
        function quickViewTheme(theme) {
            // Êú¨Âú∞Ôºöweb/insight-system.htmlÔºåVercelÔºö/dashboard/insight-system.html
            const basePath = window.location.hostname.includes('vercel.app') ? '/dashboard' : 'web';
            window.location.href = `${basePath}/insight-system.html?keyword=${encodeURIComponent(theme)}`;
        }

        // Êü•ÁúãÂ∑≤ÊúâÊï∞ÊçÆÔºà‰∏çËß¶ÂèëÊêúÁ¥¢Ôºâ
        async function viewExistingData() {
            const topic = document.getElementById('topicInput').value.trim();
            if (!topic) {
                alert('ËØ∑ËæìÂÖ•ÊàñÈÄâÊã©‰∏Ä‰∏™‰∏ªÈ¢ò');
                return;
            }

            // ‰øùÂ≠òÂΩìÂâç‰∏ªÈ¢òÂà∞ÂÖ®Â±ÄÂèòÈáè
            currentTheme = topic;

            // ÈöêËóèÁ©∫Áä∂ÊÄÅ
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('diagnoseResult').classList.remove('show');
            document.getElementById('resultsContainer').style.display = 'none';

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            document.getElementById('analysisStatus').classList.add('show');
            document.getElementById('statusTitle').textContent = `Ê≠£Âú®Âä†ËΩΩÔºö${topic}`;
            document.getElementById('statusBadge').textContent = 'Êü•ËØ¢‰∏≠';
            document.getElementById('statusBadge').className = 'status-badge running';
            document.getElementById('progressFill').style.width = '50%';
            document.getElementById('viewOnlyBtn').disabled = true;

            try {
                const sortBy = document.getElementById('sortSelect')?.value || 'views';
                const response = await fetch(`${API_BASE}/api/analyze/${encodeURIComponent(topic)}?limit=100&sort_by=${sortBy}`);
                const data = await response.json();

                document.getElementById('viewOnlyBtn').disabled = false;

                if (data.status === 'ok' && data.result) {
                    // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
                    document.getElementById('analysisStatus').classList.remove('show');
                    // ‰ΩøÁî®ÂÆåÊï¥ÁöÑÊ∏≤ÊüìÂáΩÊï∞Ôºà‰∏éÊêúÁ¥¢ÁªìÊûú‰∏ÄËá¥Ôºâ
                    // renderRealData ‰ºöÊ∏≤ÊüìÊâÄÊúâÈù¢ÊùøÔºöÊ¶úÂçï„ÄÅÊ®°Âºè„ÄÅÊä•ÂëäÁ≠â
                    renderRealData(data.result);
                } else {
                    document.getElementById('statusTitle').textContent = data.message || 'Ê≤°ÊúâÊâæÂà∞Êï∞ÊçÆ';
                    document.getElementById('statusBadge').textContent = 'Êó†Êï∞ÊçÆ';
                    document.getElementById('statusBadge').className = 'status-badge error';
                    setTimeout(() => {
                        document.getElementById('analysisStatus').classList.remove('show');
                        document.getElementById('emptyState').style.display = 'block';
                    }, 2000);
                }
            } catch (error) {
                console.error('Êü•ËØ¢Â§±Ë¥•:', error);
                document.getElementById('viewOnlyBtn').disabled = false;
                document.getElementById('statusTitle').textContent = 'Êü•ËØ¢Â§±Ë¥•';
                document.getElementById('statusBadge').textContent = 'ÈîôËØØ';
                document.getElementById('statusBadge').className = 'status-badge error';
            }
        }

        // ÂÖ®Â±Ä WebSocket ÂºïÁî®
        let globalWs = null;

        // API ÈÖçÁΩÆÔºàÊèêÂâçÂÆö‰πâ‰æõÂÖ∂‰ªñÂáΩÊï∞‰ΩøÁî®Ôºâ
        const API_BASE = 'http://localhost:8000';

        // ==================== Âä®ÊÄÅË∂ãÂäøÁÉ≠ËØçÁ≥ªÁªüÁªìÊùü ====================
        let currentWebSocket = null;

        // ÂºÄÂßãÂàÜÊûê
        // ÂΩìÂâçÊêúÁ¥¢‰∏ªÈ¢òÔºàÂÖ®Â±ÄÂèòÈáèÔºâ
        let currentTheme = '';

        async function startAnalysis() {
            const topic = document.getElementById('topicInput').value.trim();
            if (!topic) {
                alert('ËØ∑ËæìÂÖ•‰Ω†ÊÉ≥Á†îÁ©∂ÁöÑÈ¢ÜÂüü');
                return;
            }

            // ‰øùÂ≠òÂΩìÂâç‰∏ªÈ¢òÂà∞ÂÖ®Â±ÄÂèòÈáè
            currentTheme = topic;

            // ‰øùÂ≠òÊêúÁ¥¢ÂéÜÂè≤
            saveSearchHistory(topic);

            // ÈöêËóèÁ©∫Áä∂ÊÄÅÂíåËØäÊñ≠ÁªìÊûú
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('diagnoseResult').classList.remove('show');
            document.getElementById('resultsContainer').style.display = 'none';

            // ÊòæÁ§∫ÂàÜÊûêÁä∂ÊÄÅ
            document.getElementById('analysisStatus').classList.add('show');
            document.getElementById('statusTitle').textContent = `Ê≠£Âú®ÂàÜÊûêÔºö${topic}`;
            document.getElementById('statusBadge').textContent = 'ËøûÊé•‰∏≠';
            document.getElementById('statusBadge').className = 'status-badge running';
            document.getElementById('progressFill').className = 'progress-fill';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('analyzeBtn').disabled = true;

            // Êî∂ÈõÜÁ≠õÈÄâÊù°‰ª∂
            const researchParams = {
                topic: topic,
                mode: getSelectedMode(),
                max_results: filterState.videoCount || 500,
                views_min: filterState.viewsMin,
                views_max: filterState.viewsMax,
                duration_filter: filterState.duration.length > 0 ? filterState.duration : null,
                time_range: filterState.timeRange,
                regions: filterState.regions.length > 0 ? filterState.regions : null,
                subscribers_filter: filterState.subscribers.length > 0 ? filterState.subscribers : null,
                ai_filter: filterState.aiFilter,
                sort_by: filterState.sortBy || 'views'
            };

            console.log('Á†îÁ©∂ÂèÇÊï∞:', researchParams);

            // Â∞ùËØïËøûÊé• WebSocket API
            const taskId = `task_${Date.now()}`;
            const wsUrl = `ws://localhost:8000/ws/${taskId}`;

            try {
                await connectWebSocket(wsUrl, researchParams);
            } catch (error) {
                console.error('WebSocket ËøûÊé•Â§±Ë¥•:', error);
                // ÊòæÁ§∫ËøûÊé•Â§±Ë¥•ÊèêÁ§∫Ôºå‰∏ç‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
                showConnectionError(error.message || 'Êó†Ê≥ïËøûÊé•Âà∞Êï∞ÊçÆÊúçÂä°Âô®');
            }
        }

        // ÊòæÁ§∫ËøûÊé•ÈîôËØØ
        function showConnectionError(message) {
            const loadingState = document.getElementById('loadingState');
            const resultsContainer = document.getElementById('resultsContainer');
            if (loadingState) loadingState.style.display = 'none';
            if (resultsContainer) resultsContainer.style.display = 'block';

            // Ê∏ÖÁ©∫Êï∞ÊçÆ
            window.currentVideoData = [];
            window.currentChannelData = [];

            // Êõ¥Êñ∞‰æßËæπÊ†èÊï∞Â≠ó‰∏∫ 0
            ['badge-videos', 'badge-video-analysis', 'badge-channels', 'badge-channel-analysis', 'badge-topics', 'badge-regions'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = '0';
            });

            // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
            const overviewPanel = document.getElementById('panel-overview');
            if (overviewPanel) {
                overviewPanel.innerHTML = `
                    <div class="no-data-state" style="padding: 60px 20px;">
                        <div class="no-data-icon">‚ö†Ô∏è</div>
                        <div class="no-data-title">ËøûÊé•Â§±Ë¥•</div>
                        <p class="no-data-desc">${message}<br><br>ËØ∑Á°Æ‰øù API ÊúçÂä°Âô®Ê≠£Âú®ËøêË°åÔºö<br><code style="background: #f0f0f0; padding: 4px 8px; border-radius: 4px;">python api_server.py</code></p>
                    </div>
                `;
            }

            switchPanel('overview');
        }

        // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÂàÜÊûêÊ®°Âºè
        function getSelectedMode() {
            if (filterState.videoCount <= 100) return 'quick';
            if (filterState.videoCount >= 1000) return 'deep';
            return 'standard';
        }

        // WebSocket ËøûÊé•
        function connectWebSocket(wsUrl, params) {
            return new Promise((resolve, reject) => {
                // ÂÖ≥Èó≠‰πãÂâçÁöÑËøûÊé•
                if (currentWebSocket) {
                    currentWebSocket.close();
                }

                const ws = new WebSocket(wsUrl);
                currentWebSocket = ws;
                globalWs = ws;  // ‰øùÂ≠òÂà∞ÂÖ®Â±ÄÂèòÈáèÔºå‰æõË∂ãÂäøÁÉ≠ËØç‰ΩøÁî®
                let resolved = false;
                let heartbeatInterval = null;
                let lastPongTime = Date.now();

                // ÂøÉË∑≥Êú∫Âà∂ - ÊØè 30 ÁßíÂèëÈÄÅ‰∏ÄÊ¨° ping
                function startHeartbeat() {
                    heartbeatInterval = setInterval(() => {
                        if (ws.readyState === WebSocket.OPEN) {
                            ws.send(JSON.stringify({ type: 'ping', timestamp: Date.now() }));
                            console.log('üíì ÂèëÈÄÅÂøÉË∑≥ ping');

                            // Ê£ÄÊü•‰∏äÊ¨° pong ÊòØÂê¶Ë∂ÖÊó∂Ôºà90ÁßíÊó†ÂìçÂ∫îÂàôËÆ§‰∏∫ËøûÊé•Êñ≠ÂºÄÔºâ
                            if (Date.now() - lastPongTime > 90000) {
                                console.warn('‚ö†Ô∏è ÂøÉË∑≥Ë∂ÖÊó∂ÔºåÂ∞ùËØïÈáçËøû...');
                                // ‰∏ç‰∏ªÂä®ÂÖ≥Èó≠ÔºåËÆ©ÊúçÂä°Âô®ÂÜ≥ÂÆö
                            }
                        }
                    }, 30000); // 30ÁßíÈó¥Èöî
                }

                function stopHeartbeat() {
                    if (heartbeatInterval) {
                        clearInterval(heartbeatInterval);
                        heartbeatInterval = null;
                    }
                }

                ws.onopen = () => {
                    console.log('WebSocket Â∑≤ËøûÊé•');
                    document.getElementById('statusLog').textContent = 'Â∑≤ËøûÊé•Âà∞ÊúçÂä°Âô®ÔºåÂºÄÂßãÈááÈõÜ...';
                    // ÂêØÂä®ÂøÉË∑≥
                    startHeartbeat();
                    // ÂèëÈÄÅÁ†îÁ©∂ÂèÇÊï∞
                    ws.send(JSON.stringify(params));
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    console.log('Êî∂Âà∞Ê∂àÊÅØ:', data);

                    switch (data.type) {
                        case 'pong':
                            // ÂøÉË∑≥ÂìçÂ∫î
                            lastPongTime = Date.now();
                            console.log('üíì Êî∂Âà∞ÂøÉË∑≥ pong');
                            break;

                        case 'start':
                            document.getElementById('statusBadge').textContent = 'ÈááÈõÜ‰∏≠';
                            break;

                        case 'progress':
                            document.getElementById('progressFill').style.width = data.progress + '%';
                            // Â¶ÇÊûúÊúâÈ¢ëÈÅìËé∑ÂèñÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåÊòæÁ§∫È¢Ñ‰º∞Êó∂Èó¥
                            if (data.channel_fetch && data.channel_fetch.estimated_remaining_seconds) {
                                const remaining = data.channel_fetch.estimated_remaining_seconds;
                                const minutes = Math.floor(remaining / 60);
                                const seconds = Math.floor(remaining % 60);
                                const timeStr = minutes > 0 ? `${minutes}ÂàÜ${seconds}Áßí` : `${seconds}Áßí`;
                                const speedIcon = data.channel_fetch.network_speed === 'fast' ? 'üöÄ' :
                                                  data.channel_fetch.network_speed === 'slow' ? 'üê¢' : 'üì°';
                                document.getElementById('statusLog').textContent =
                                    `${data.message} ${speedIcon} È¢ÑËÆ°ËøòÈúÄ ${timeStr}`;
                            } else {
                                document.getElementById('statusLog').textContent = data.message;
                            }
                            // ÂÆûÊó∂Êõ¥Êñ∞‰æßËæπÊ†èÁöÑËßÜÈ¢ë/È¢ëÈÅìÊï∞Èáè
                            if (data.realtime_stats) {
                                const badgeVideos = document.getElementById('badge-videos');
                                const badgeChannels = document.getElementById('badge-channels');
                                if (badgeVideos && data.realtime_stats.videos !== undefined) {
                                    badgeVideos.textContent = data.realtime_stats.videos;
                                }
                                if (badgeChannels && data.realtime_stats.channels !== undefined) {
                                    badgeChannels.textContent = data.realtime_stats.channels;
                                }
                            }
                            break;

                        case 'complete':
                            document.getElementById('statusBadge').textContent = 'ÂÆåÊàê';
                            document.getElementById('statusBadge').className = 'status-badge done';
                            document.getElementById('progressFill').className = 'progress-fill done';
                            document.getElementById('analyzeBtn').disabled = false;

                            // Ê∏≤ÊüìÁúüÂÆûÊï∞ÊçÆ
                            if (data.result) {
                                renderRealData(data.result);
                            }

                            resolved = true;
                            resolve(data.result);
                            break;

                        case 'error':
                            document.getElementById('statusLog').textContent = 'ÈîôËØØ: ' + data.message;
                            document.getElementById('statusBadge').textContent = 'Â§±Ë¥•';
                            document.getElementById('statusBadge').className = 'status-badge error';
                            document.getElementById('analyzeBtn').disabled = false;
                            reject(new Error(data.message));
                            break;
                    }
                };

                ws.onerror = (error) => {
                    console.error('WebSocket ÈîôËØØ:', error);
                    if (!resolved) {
                        reject(error);
                    }
                };

                ws.onclose = async () => {
                    console.log('WebSocket Â∑≤ÂÖ≥Èó≠');
                    stopHeartbeat();
                    currentWebSocket = null;

                    // Â¶ÇÊûú‰ªªÂä°ËøòÊ≤°ÂÆåÊàêÔºåÂ∞ùËØïËΩÆËØ¢Ëé∑ÂèñÁªìÊûú
                    if (!resolved) {
                        console.log('‚ö†Ô∏è ËøûÊé•Êñ≠ÂºÄ‰ΩÜ‰ªªÂä°Êú™ÂÆåÊàêÔºåÂ∞ùËØïËΩÆËØ¢Ëé∑ÂèñÁªìÊûú...');
                        document.getElementById('statusLog').textContent = 'ËøûÊé•Êñ≠ÂºÄÔºåÊ≠£Âú®Â∞ùËØïËé∑ÂèñÁªìÊûú...';

                        // ‰ªé wsUrl ‰∏≠ÊèêÂèñ task_id
                        const taskId = wsUrl.split('/').pop();
                        const baseUrl = wsUrl.replace(/^ws/, 'http').replace(/\/ws\/.*$/, '');

                        // ËΩÆËØ¢Ê£ÄÊü•‰ªªÂä°Áä∂ÊÄÅÔºàÊúÄÂ§öÂ∞ùËØï 10 Ê¨°ÔºåÊØèÊ¨°Èó¥Èöî 5 ÁßíÔºâ
                        for (let i = 0; i < 10; i++) {
                            await new Promise(r => setTimeout(r, 5000));

                            try {
                                const response = await fetch(`${baseUrl}/api/task/${taskId}/status`);
                                const status = await response.json();

                                console.log(`üì° ËΩÆËØ¢ #${i + 1}:`, status);
                                document.getElementById('statusLog').textContent =
                                    `Ê≠£Âú®Ëé∑ÂèñÁªìÊûú... (${i + 1}/10) - ${status.message || 'Á≠âÂæÖ‰∏≠'}`;

                                if (status.status === 'complete' && status.result) {
                                    console.log('‚úÖ ÈÄöËøáËΩÆËØ¢Ëé∑ÂèñÂà∞ÁªìÊûú');
                                    document.getElementById('statusBadge').textContent = 'ÂÆåÊàê';
                                    document.getElementById('statusBadge').className = 'status-badge done';
                                    document.getElementById('progressFill').className = 'progress-fill done';
                                    document.getElementById('progressFill').style.width = '100%';
                                    document.getElementById('analyzeBtn').disabled = false;

                                    renderRealData(status.result);
                                    resolved = true;
                                    resolve(status.result);
                                    return;
                                } else if (status.status === 'error') {
                                    console.error('‚ùå ‰ªªÂä°Â§±Ë¥•:', status.message);
                                    document.getElementById('statusLog').textContent = '‰ªªÂä°Â§±Ë¥•: ' + status.message;
                                    document.getElementById('analyzeBtn').disabled = false;
                                    reject(new Error(status.message));
                                    return;
                                } else if (status.status === 'not_found') {
                                    // ‰ªªÂä°‰∏çÂ≠òÂú®ÔºåÂÅúÊ≠¢ËΩÆËØ¢
                                    break;
                                }
                                // Â¶ÇÊûúÁä∂ÊÄÅÊòØ runningÔºåÁªßÁª≠ËΩÆËØ¢
                            } catch (e) {
                                console.warn(`ËΩÆËØ¢Â§±Ë¥• #${i + 1}:`, e);
                            }
                        }

                        // ËΩÆËØ¢ÁªìÊùü‰ªçÊú™Ëé∑ÂèñÂà∞ÁªìÊûú
                        if (!resolved) {
                            document.getElementById('statusLog').textContent = 'ËøûÊé•Êñ≠ÂºÄÔºåÊú™ËÉΩËé∑ÂèñÁªìÊûú„ÄÇËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï„ÄÇ';
                            document.getElementById('statusBadge').textContent = 'Êñ≠ÂºÄ';
                            document.getElementById('statusBadge').className = 'status-badge error';
                            document.getElementById('analyzeBtn').disabled = false;
                            reject(new Error('ËøûÊé•Êñ≠ÂºÄ‰∏îÊú™ËÉΩÊÅ¢Â§çÁªìÊûú'));
                        }
                    }
                };

                // ËøûÊé•Ë∂ÖÊó∂
                setTimeout(() => {
                    if (!resolved && ws.readyState !== WebSocket.OPEN) {
                        reject(new Error('ËøûÊé•Ë∂ÖÊó∂'));
                    }
                }, 5000);
            });
        }

        // ‰øùÂ≠òÊúÄÂêé‰∏ÄÊ¨°ÂàÜÊûêÁªìÊûúÔºàÁî®‰∫éÂØºÂá∫Ôºâ
        let lastAnalysisResult = null;

        // Ê∏≤ÊüìÁúüÂÆûÊï∞ÊçÆ
        function renderRealData(result) {
            console.log('Ê∏≤ÊüìÁúüÂÆûÊï∞ÊçÆ:', result);

            // ‰øùÂ≠òÁªìÊûúÁî®‰∫éÂØºÂá∫
            lastAnalysisResult = result;

            // ËΩ¨Êç¢ËßÜÈ¢ëÊï∞ÊçÆÊ†ºÂºè
            let formattedVideos = [];
            if (result.videos && result.videos.length > 0) {
                const avgViews = result.total_views / result.total_videos;
                formattedVideos = result.videos.map((v, index) => ({
                    rank: index + 1,
                    title: v.title,
                    channel: v.channel_name,
                    channelId: v.channel_id,
                    views: v.view_count,
                    likes: v.like_count || 0,
                    comments: v.comment_count || 0,
                    duration: formatDuration(v.duration),
                    durationSeconds: v.duration,
                    date: v.published_at ? formatDate(v.published_at) : 'Êú™Áü•',
                    thumbnail: v.thumbnail_url || `https://i.ytimg.com/vi/${v.youtube_id}/mqdefault.jpg`,
                    videoId: v.youtube_id,
                    isAI: v.is_ai_video,
                    aiKeyword: v.ai_keyword,
                    // Êñ∞Â¢ûÔºöËßÜÈ¢ëÂπ¥ÈæÑÂíåÊó•ÂùáÊí≠Êîæ
                    videoAgeDays: v.video_age_days || 1,
                    dailyViews: v.daily_views || 0,
                    // ËÆ°ÁÆóËØÑÂàÜ
                    score: v.view_count > avgViews * 3 ? 'A' : v.view_count > avgViews ? 'B' : 'C'
                }));

                // Êõ¥Êñ∞ËßÜÈ¢ëÊ¶úÂçï
                renderVideoRanking(formattedVideos);

                // ‰øùÂ≠òÂà∞ÂÖ®Â±ÄÂèòÈáè‰æõÂÖ∂‰ªñÂäüËÉΩ‰ΩøÁî®
                window.currentVideoData = formattedVideos;
            }

            // ‰øùÂ≠òËøëÊúüÁàÜÊ¨æÂíåÈïøÈùíËßÜÈ¢ëÂà∞ÂÖ®Â±ÄÂèòÈáè
            window.recentHits = (result.recent_hits || []).map(v => ({
                title: v.title,
                channel: v.channel_name,
                channelId: v.channel_id,
                views: v.view_count,
                videoId: v.youtube_id,
                videoAgeDays: v.video_age_days,
                dailyViews: v.daily_views,
                date: v.published_at ? formatDate(v.published_at) : 'Êú™Áü•'
            }));

            window.evergreenVideos = (result.evergreen_videos || []).map(v => ({
                title: v.title,
                channel: v.channel_name,
                channelId: v.channel_id,
                views: v.view_count,
                videoId: v.youtube_id,
                videoAgeDays: v.video_age_days,
                dailyViews: v.daily_views,
                date: v.published_at ? formatDate(v.published_at) : 'Êú™Áü•'
            }));

            // ËΩ¨Êç¢È¢ëÈÅìÊï∞ÊçÆÊ†ºÂºèÔºàÂåÖÂê´ÁúüÂÆûÊï∞ÊçÆÔºâ
            let formattedChannels = [];
            if (result.channels && result.channels.length > 0) {
                formattedChannels = result.channels.map(ch => ({
                    name: ch.channel_name,
                    channelId: ch.channel_id,
                    videoCount: ch.video_count,
                    avgViews: ch.avg_views,
                    totalViews: ch.total_views,
                    // ÁúüÂÆûÈ¢ëÈÅìÊï∞ÊçÆ
                    subscriberCount: ch.subscriber_count || 0,
                    realVideoCount: ch.real_video_count || 0,
                    totalChannelViews: ch.total_channel_views || 0,  // È¢ëÈÅìÊÄªÊí≠ÊîæÈáè
                    avgChannelViews: ch.avg_channel_views || 0,      // È¢ëÈÅìÂπ≥ÂùáÊí≠ÊîæÈáè
                    searchHitCount: ch.search_hit_count || ch.video_count,
                    hasRealStats: ch.has_real_stats || false
                }));

                // Êõ¥Êñ∞È¢ëÈÅìÊ¶úÂçï
                renderChannelListFromData(formattedChannels);

                // ‰øùÂ≠òÂà∞ÂÖ®Â±ÄÂèòÈáè
                window.currentChannelData = formattedChannels;
            }

            // Êõ¥Êñ∞Ê¶ÇËßàÊëòË¶Å
            updateOverviewSummary(result, formattedVideos, formattedChannels);

            // Êõ¥Êñ∞‰æßËæπÊ†èÁªüËÆ°Êï∞Â≠ó
            updateSidebarBadges(result, formattedVideos, formattedChannels);

            // Êõ¥Êñ∞ÂàÜÊûêÊä•Âëä
            updateReportPanel(result, formattedVideos, formattedChannels);

            // ÊòæÁ§∫ÁªìÊûú
            document.getElementById('resultsContainer').style.display = 'block';
            switchPanel('overview');
        }

        // Êõ¥Êñ∞Ê¶ÇËßàÊëòË¶Å
        function updateOverviewSummary(result, videos, channels) {
            // Êõ¥Êñ∞Ê†áÈ¢ò
            const titleEl = document.getElementById('overviewTitle');
            if (titleEl) titleEl.textContent = `üìä „Äå${result.topic}„ÄçÊï∞ÊçÆÊ¶ÇËßà`;

            // Êõ¥Êñ∞Êï∞Â≠ó
            document.getElementById('stat-videos').textContent = result.total_videos || 0;
            document.getElementById('stat-channels').textContent = result.total_channels || 0;
            document.getElementById('stat-views').textContent = formatNumber(result.total_views || 0);
            const avgViews = result.total_videos > 0 ? Math.round(result.total_views / result.total_videos) : 0;
            document.getElementById('stat-avg-views').textContent = formatNumber(avgViews);

            // Êõ¥Êñ∞Âø´ÈÄüÂÖ•Âè£Êï∞Â≠ó
            document.getElementById('quick-videos').textContent = `${result.total_videos || 0} ‰∏™ËßÜÈ¢ë`;
            document.getElementById('quick-channels').textContent = `${result.total_channels || 0} ‰∏™È¢ëÈÅì`;

            // Êõ¥Êñ∞Êï∞ÊçÆÊù•Ê∫ê‰ø°ÊÅØ
            const dataSourceInfo = document.getElementById('dataSourceInfo');
            if (dataSourceInfo) {
                dataSourceInfo.style.display = 'block';

                // Êó∂Èó¥ËåÉÂõ¥
                const timeRangeEl = document.getElementById('dataTimeRange');
                if (timeRangeEl && result.data_time_range) {
                    const range = result.data_time_range;
                    if (range.published_earliest && range.published_latest) {
                        timeRangeEl.innerHTML = `<strong>ËßÜÈ¢ëÂèëÂ∏ÉÊó∂Èó¥</strong>Ôºö${range.published_earliest} ~ ${range.published_latest}`;
                    } else {
                        timeRangeEl.innerHTML = `<strong>ËßÜÈ¢ëÂèëÂ∏ÉÊó∂Èó¥</strong>ÔºöÊú™Áü•`;
                    }
                }

                // ÈááÈõÜÊó∂Èó¥
                const collectedEl = document.getElementById('dataCollectedAt');
                if (collectedEl && result.data_time_range) {
                    const range = result.data_time_range;
                    if (range.collected_earliest && range.collected_latest) {
                        collectedEl.innerHTML = `<strong>Êï∞ÊçÆÈááÈõÜ</strong>Ôºö${range.collected_earliest} ~ ${range.collected_latest}`;
                    } else {
                        collectedEl.innerHTML = `<strong>Êï∞ÊçÆÈááÈõÜ</strong>Ôºö${result.last_updated || 'Êú™Áü•'}`;
                    }
                }

                // Á≠õÈÄâÊù°‰ª∂
                const filterEl = document.getElementById('dataFilterInfo');
                if (filterEl && result.filter_applied) {
                    filterEl.innerHTML = `<strong>Á≠õÈÄâÊù°‰ª∂</strong>Ôºö${result.filter_applied.description || 'Êó†'}`;
                } else if (filterEl && result.data_basis) {
                    filterEl.innerHTML = `<strong>Êï∞ÊçÆÂü∫Êï∞</strong>Ôºö${result.data_basis.description || ''}`;
                }
            }

            // Êõ¥Êñ∞ÂÖ≥ÈîÆÂèëÁé∞
            const findingsEl = document.getElementById('keyFindingsContent');
            if (findingsEl && videos.length > 0) {
                const topVideo = videos[0];
                const topChannel = channels[0];
                findingsEl.innerHTML = `
                    <p>üé¨ <strong>Top ËßÜÈ¢ë</strong>Ôºö„Äå${topVideo.title.substring(0, 30)}...„ÄçÊí≠ÊîæÈáè ${formatNumber(topVideo.views)}</p>
                    <p>üì∫ <strong>Top È¢ëÈÅì</strong>Ôºö„Äå${topChannel?.name || '-'}„ÄçÊÄªÊí≠Êîæ ${formatNumber(topChannel?.totalViews || 0)}</p>
                    <p>üìä <strong>Âπ≥ÂùáÊí≠Êîæ</strong>Ôºö${formatNumber(avgViews)}ÔºåÂÖ±ÂàÜÊûê ${result.total_videos} ‰∏™ËßÜÈ¢ë</p>
                `;
            }

            // Êõ¥Êñ∞ Top 3 ËßÜÈ¢ëÈ¢ÑËßà - Ë°®Ê†ºÊ†∑Âºè
            const top3Videos = document.getElementById('top3VideosList');
            if (top3Videos && videos.length > 0) {
                // Ë°®Ê†ºÂ§¥
                let videoTableHtml = `
                    <div class="video-table-header" style="display: grid; grid-template-columns: 40px 1fr 100px 80px 60px; gap: 8px; padding: 8px 12px; background: #1e293b; border-radius: 8px 8px 0 0; font-size: 0.8em; color: #94a3b8;">
                        <div>#</div>
                        <div>ËßÜÈ¢ëÊ†áÈ¢ò</div>
                        <div>È¢ëÈÅì</div>
                        <div style="text-align: right;">Êí≠ÊîæÈáè</div>
                        <div style="text-align: right;">ËØÑÂàÜ</div>
                    </div>
                `;
                // Ë°®Ê†ºË°å
                videoTableHtml += videos.slice(0, 3).map((v, i) => `
                    <div class="video-table-row" onclick="openVideo('${v.videoId}')" style="display: grid; grid-template-columns: 40px 1fr 100px 80px 60px; gap: 8px; padding: 10px 12px; background: ${i % 2 === 0 ? '#0f172a' : '#1e293b'}; cursor: pointer; align-items: center; border-bottom: 1px solid #334155;" title="ÁÇπÂáªËßÇÁúãËßÜÈ¢ë">
                        <div style="font-weight: 600; color: ${i === 0 ? '#fbbf24' : i === 1 ? '#94a3b8' : '#cd7f32'};">${i + 1}</div>
                        <div style="color: white; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${v.title}">${v.title}</div>
                        <div style="color: #94a3b8; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${v.channel}</div>
                        <div style="text-align: right; color: #38bdf8; font-weight: 600;">${formatNumber(v.views)}</div>
                        <div style="text-align: right;"><span class="video-score score-${v.score.toLowerCase()}">${v.score}</span></div>
                    </div>
                `).join('');
                top3Videos.innerHTML = videoTableHtml;
            }

            // Êõ¥Êñ∞ Top 3 È¢ëÈÅìÈ¢ÑËßà - Ë°®Ê†ºÊ†∑Âºè
            const top3Channels = document.getElementById('top3ChannelsList');
            if (top3Channels && channels.length > 0) {
                // Ë°®Ê†ºÂ§¥
                let tableHtml = `
                    <div class="channel-table-header" style="display: grid; grid-template-columns: 40px 1fr 80px 80px 100px; gap: 8px; padding: 8px 12px; background: #1e293b; border-radius: 8px 8px 0 0; font-size: 0.8em; color: #94a3b8;">
                        <div>#</div>
                        <div>È¢ëÈÅìÂêçÁß∞</div>
                        <div style="text-align: right;">ËßÜÈ¢ëÊï∞</div>
                        <div style="text-align: right;">Âπ≥ÂùáÊí≠Êîæ</div>
                        <div style="text-align: right;">ÊÄªÊí≠Êîæ</div>
                    </div>
                `;
                // Ë°®Ê†ºË°å
                tableHtml += channels.slice(0, 3).map((ch, i) => `
                    <div class="channel-table-row" onclick="openChannel('${ch.channelId}')" style="display: grid; grid-template-columns: 40px 1fr 80px 80px 100px; gap: 8px; padding: 10px 12px; background: ${i % 2 === 0 ? '#0f172a' : '#1e293b'}; cursor: pointer; align-items: center; border-bottom: 1px solid #334155;" title="ÁÇπÂáªÊâìÂºÄÈ¢ëÈÅì">
                        <div style="font-weight: 600; color: ${i === 0 ? '#fbbf24' : i === 1 ? '#94a3b8' : '#cd7f32'};">${i + 1}</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="width: 28px; height: 28px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75em;">${ch.name.charAt(0)}</span>
                            <span style="color: white; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${ch.name}</span>
                        </div>
                        <div style="text-align: right; color: #94a3b8;">${ch.videoCount || '-'}</div>
                        <div style="text-align: right; color: #94a3b8;">${formatNumber(ch.avgViews)}</div>
                        <div style="text-align: right; color: #38bdf8; font-weight: 600;">${formatNumber(ch.totalViews)}</div>
                    </div>
                `).join('');
                top3Channels.innerHTML = tableHtml;
            }
        }

        // Êõ¥Êñ∞‰æßËæπÊ†è badge Êï∞Â≠ó
        function updateSidebarBadges(result, videos, channels) {
            // ËßÜÈ¢ëÊï∞ÊçÆÔºöÊòæÁ§∫ËßÜÈ¢ëÊÄªÊï∞
            const badgeVideos = document.getElementById('badge-videos');
            if (badgeVideos) badgeVideos.textContent = result.total_videos || videos.length;

            // È¢ëÈÅìÊï∞ÊçÆÔºöÊòæÁ§∫È¢ëÈÅìÊÄªÊï∞
            const badgeChannels = document.getElementById('badge-channels');
            if (badgeChannels) badgeChannels.textContent = result.total_channels || channels.length;
        }

        // ‰ªéËßÜÈ¢ëÊ†áÈ¢òÊèêÂèñËØùÈ¢òÂÖ≥ÈîÆËØç
        function extractTopics(videos) {
            const wordCount = {};
            const stopWords = ['ÁöÑ', 'ÊòØ', 'Âú®', '‰∫Ü', 'Âíå', '‰∏é', 'Êàñ', 'Ëøô', 'ÈÇ£', 'Êúâ', '‰∏∫', '‰ª•', 'Âèä', 'Á≠â', 'the', 'a', 'an', 'is', 'are', 'to', 'for', 'and', 'or', 'in', 'on', 'at'];

            videos.forEach(v => {
                // ÁÆÄÂçïÂàÜËØçÔºöÊåâÁ©∫Ê†ºÂíåÊ†áÁÇπÂàÜÂâ≤
                const words = (v.title || '').split(/[\s,Ôºå„ÄÇÔºÅÔºü„ÄÅÔºö:;\-\[\]„Äê„Äë()ÔºàÔºâ]+/).filter(w => w.length >= 2);
                words.forEach(word => {
                    const w = word.toLowerCase();
                    if (!stopWords.includes(w) && w.length <= 10) {
                        wordCount[w] = (wordCount[w] || 0) + 1;
                    }
                });
            });

            // ËøîÂõûÂá∫Áé∞Ê¨°Êï∞>=3ÁöÑÂÖ≥ÈîÆËØç
            return Object.entries(wordCount)
                .filter(([_, count]) => count >= 3)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 50)
                .map(([word, count]) => ({ word, count }));
        }

        // Ê†ºÂºèÂåñÊó∂Èïø
        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Ê†ºÂºèÂåñÊó•Êúü
        function formatDate(dateStr) {
            if (!dateStr) return 'Êú™Áü•';
            // Â§ÑÁêÜ YYYYMMDD Ê†ºÂºè
            if (dateStr.length === 8 && !dateStr.includes('-')) {
                return `${dateStr.slice(0,4)}-${dateStr.slice(4,6)}-${dateStr.slice(6,8)}`;
            }
            return dateStr;
        }

        // ÊûÑÂª∫È¢ëÈÅìÁªüËÆ°‰ø°ÊÅØÊñáÊú¨
        function buildChannelStatsText(ch, showDetailed = false) {
            // Áªü‰∏Ä‰ΩøÁî®Êï∞ÊçÆÂ∫ìÊî∂ÂΩïÁöÑÊï∞ÊçÆÔºå‰∏çÂå∫ÂàÜ"ÊêúÁ¥¢ÂëΩ‰∏≠"
            const videoCount = ch.videoCount || ch.searchHitCount || 0;
            const avgViews = ch.avgViews || 0;
            const totalViews = ch.totalViews || 0;

            if (showDetailed) {
                return `Êî∂ÂΩï ${videoCount} ‰∏™ËßÜÈ¢ë ¬∑ ÊÄªÊí≠Êîæ ${formatNumber(totalViews)} ¬∑ Âπ≥Âùá ${formatNumber(avgViews)}`;
            }
            return `${videoCount} ‰∏™ËßÜÈ¢ë ¬∑ Âπ≥Âùá ${formatNumber(avgViews)} Êí≠Êîæ`;
        }

        // ‰ªéÁúüÂÆûÊï∞ÊçÆÊ∏≤ÊüìÈ¢ëÈÅìÂàóË°®
        function renderChannelListFromData(channels, mode = null, titleSuffix = '') {
            // Êõ¥Êñ∞È¢ëÈÅìÂàÜÊûêÈù¢Êùø (#channelList) - Ë°®Ê†ºÊ†∑Âºè
            const container = document.getElementById('channelList');
            if (container) {
                if (channels.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">ÊöÇÊó†È¢ëÈÅìÊï∞ÊçÆ</div>';
                } else {
                    // Ë°®Ê†ºÂ§¥
                    let tableHtml = `
                        <div style="display: grid; grid-template-columns: 50px 1fr 80px 100px 100px; gap: 8px; padding: 10px 12px; background: #1e293b; border-radius: 8px 8px 0 0; font-size: 0.8em; color: #94a3b8; font-weight: 500;">
                            <div>#</div>
                            <div>È¢ëÈÅìÂêçÁß∞</div>
                            <div style="text-align: right;">ËßÜÈ¢ëÊï∞</div>
                            <div style="text-align: right;">Âπ≥ÂùáÊí≠Êîæ</div>
                            <div style="text-align: right;">ÊÄªÊí≠Êîæ</div>
                        </div>
                    `;
                    // Ë°®Ê†ºË°å
                    tableHtml += channels.slice(0, 50).map((ch, i) => `
                        <div onclick="openChannel('${ch.channelId}')" style="display: grid; grid-template-columns: 50px 1fr 80px 100px 100px; gap: 8px; padding: 10px 12px; background: ${i % 2 === 0 ? '#0f172a' : 'transparent'}; cursor: pointer; align-items: center; border-bottom: 1px solid #334155; transition: background 0.2s;" onmouseover="this.style.background='#334155'" onmouseout="this.style.background='${i % 2 === 0 ? '#0f172a' : 'transparent'}'" title="ÁÇπÂáªÊâìÂºÄÈ¢ëÈÅì">
                            <div style="font-weight: 600; color: ${i < 3 ? '#fbbf24' : '#64748b'};">${i + 1}</div>
                            <div style="display: flex; align-items: center; gap: 8px; overflow: hidden;">
                                <span style="width: 28px; height: 28px; min-width: 28px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75em; color: white;">${(ch.name || '?').charAt(0)}</span>
                                <span style="color: #e2e8f0; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${ch.name || 'Êú™Áü•È¢ëÈÅì'}</span>
                            </div>
                            <div style="text-align: right; color: #94a3b8;">${ch.videoCount || '-'}</div>
                            <div style="text-align: right; color: #94a3b8;">${formatNumber(ch.avgViews || 0)}</div>
                            <div style="text-align: right; color: #38bdf8; font-weight: 600;">${formatNumber(ch.totalViews || 0)}</div>
                        </div>
                    `).join('');
                    container.innerHTML = tableHtml;
                }
            }

            // ÂêåÊó∂Êõ¥Êñ∞È¢ëÈÅìÊ¶úÂçïÈù¢Êùø (#channelRankingContainer) - Ë°®Ê†ºÊ†ºÂºè
            const rankingContainer = document.getElementById('channelRankingContainer');
            if (rankingContainer) {
                if (channels.length === 0) {
                    const emptyConfig = {
                        darkHorse: { icon: 'üê¥', title: 'ÊöÇÊó†ÈªëÈ©¨È¢ëÈÅì', desc: 'Êú™ÊâæÂà∞Áü≠ËßÜÈ¢ëÊ∂®Á≤âÊΩúÂäõÈ¢ëÈÅì' },
                        efficiency: { icon: 'üöÄ', title: 'ÊöÇÊó†È´òÊïàÈ¢ëÈÅì', desc: 'Êú™ÊâæÂà∞È´òÂπ≥ÂùáÊí≠ÊîæÁöÑÈ¢ëÈÅì' },
                        default: { icon: 'üì∫', title: 'ÊöÇÊó†È¢ëÈÅìÊï∞ÊçÆ', desc: 'ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÂêéÔºåËøôÈáåÂ∞ÜÂ±ïÁ§∫È¢ëÈÅìÊéíË°åÊ¶ú' }
                    };
                    const cfg = emptyConfig[mode] || emptyConfig.default;
                    rankingContainer.innerHTML = `
                        <div class="no-data-state">
                            <div class="no-data-icon">${cfg.icon}</div>
                            <div class="no-data-title">${cfg.title}</div>
                            <p class="no-data-desc">${cfg.desc}</p>
                        </div>
                    `;
                    return;
                }

                // Ë°®Ê†ºÂàóÈÖçÁΩÆ
                const tableConfig = {
                    totalViews: {
                        title: 'üìä ÊÄªÊí≠ÊîæÊ¶ú',
                        columns: ['ÊéíÂêç', 'È¢ëÈÅìÂêçÁß∞', 'ËÆ¢ÈòÖÊï∞', 'ËßÜÈ¢ëÊï∞', 'ÊÄªÊí≠Êîæ', 'Âπ≥ÂùáÊí≠Êîæ'],
                        getValue: (ch) => [
                            ch.subscriberCount > 0 ? formatNumber(ch.subscriberCount) : '-',
                            ch.videoCount || 0,
                            formatNumber(ch.totalViews || 0),
                            formatNumber(ch.avgViews || 0)
                        ],
                        highlight: 4 // È´ò‰∫Æ"ÊÄªÊí≠Êîæ"Âàó
                    },
                    avgViews: {
                        title: '‚ö° Âπ≥ÂùáÊí≠ÊîæÊ¶ú',
                        columns: ['ÊéíÂêç', 'È¢ëÈÅìÂêçÁß∞', 'ËÆ¢ÈòÖÊï∞', 'ËßÜÈ¢ëÊï∞', 'Âπ≥ÂùáÊí≠Êîæ', 'ÊÄªÊí≠Êîæ'],
                        getValue: (ch) => [
                            ch.subscriberCount > 0 ? formatNumber(ch.subscriberCount) : '-',
                            ch.videoCount || 0,
                            formatNumber(ch.avgViews || 0),
                            formatNumber(ch.totalViews || 0)
                        ],
                        highlight: 4 // È´ò‰∫Æ"Âπ≥ÂùáÊí≠Êîæ"Âàó
                    },
                    videoCount: {
                        title: 'üìπ ËßÜÈ¢ëÊï∞Ê¶ú',
                        columns: ['ÊéíÂêç', 'È¢ëÈÅìÂêçÁß∞', 'ËÆ¢ÈòÖÊï∞', 'ËßÜÈ¢ëÊï∞', 'ÊÄªÊí≠Êîæ', 'Âπ≥ÂùáÊí≠Êîæ'],
                        getValue: (ch) => [
                            ch.subscriberCount > 0 ? formatNumber(ch.subscriberCount) : '-',
                            ch.videoCount || 0,
                            formatNumber(ch.totalViews || 0),
                            formatNumber(ch.avgViews || 0)
                        ],
                        highlight: 3 // È´ò‰∫Æ"ËßÜÈ¢ëÊï∞"Âàó
                    },
                    darkHorse: {
                        title: 'üê¥ ÈªëÈ©¨Ê¶ú',
                        columns: ['ÊéíÂêç', 'È¢ëÈÅìÂêçÁß∞', 'ËÆ¢ÈòÖÊï∞', 'ËßÜÈ¢ëÊï∞', 'ÊÄªÊí≠Êîæ', '‰º∞ÁÆóÊ∂®Á≤â'],
                        getValue: (ch) => [
                            ch.subscriberCount > 0 ? formatNumber(ch.subscriberCount) : '-',
                            ch.videoCount || 0,
                            formatNumber(ch.totalViews || 0),
                            '+' + formatNumber(Math.round((ch.totalViews || 0) * 0.002))
                        ],
                        highlight: 5 // È´ò‰∫Æ"‰º∞ÁÆóÊ∂®Á≤â"Âàó
                    },
                    efficiency: {
                        title: 'üöÄ È´òÊïàÊ¶ú',
                        columns: ['ÊéíÂêç', 'È¢ëÈÅìÂêçÁß∞', 'ËÆ¢ÈòÖÊï∞', 'ËßÜÈ¢ëÊï∞', 'Âπ≥ÂùáÊí≠Êîæ', 'ÊÄªÊí≠Êîæ'],
                        getValue: (ch) => [
                            ch.subscriberCount > 0 ? formatNumber(ch.subscriberCount) : '-',
                            ch.videoCount || 0,
                            formatNumber(ch.avgViews || 0),
                            formatNumber(ch.totalViews || 0)
                        ],
                        highlight: 4 // È´ò‰∫Æ"Âπ≥ÂùáÊí≠Êîæ"Âàó
                    }
                };

                const config = tableConfig[mode] || tableConfig.totalViews;

                rankingContainer.innerHTML = `
                    <div class="ranking-section">
                        <div class="ranking-header">
                            <span class="ranking-title">
                                ${config.title}
                                <span class="ranking-count">ÂÖ± ${channels.length} ‰∏™È¢ëÈÅì</span>
                            </span>
                        </div>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                                <thead>
                                    <tr style="background: #0f172a; border-bottom: 2px solid #334155;">
                                        ${config.columns.map((col, idx) => `
                                            <th style="padding: 12px 16px; text-align: ${idx <= 1 ? 'left' : 'right'}; color: #94a3b8; font-weight: 500; white-space: nowrap;">
                                                ${col}
                                            </th>
                                        `).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${channels.slice(0, 50).map((ch, i) => {
                                        const values = config.getValue(ch);
                                        const hasData = ch.hasRealStats && ch.realVideoCount > 0;
                                        return `
                                            <tr onclick="openChannel('${ch.channelId}')"
                                                style="border-bottom: 1px solid #334155; cursor: pointer; transition: background 0.2s;"
                                                onmouseover="this.style.background='#334155'"
                                                onmouseout="this.style.background='transparent'">
                                                <td style="padding: 12px 16px; color: ${i < 3 ? '#f59e0b' : '#64748b'}; font-weight: ${i < 3 ? '700' : '500'};">
                                                    ${i + 1}
                                                </td>
                                                <td style="padding: 12px 16px; color: #e2e8f0; font-weight: 500; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                    ${ch.name}
                                                    ${!hasData ? '<span style="color: #64748b; font-size: 0.8em; margin-left: 6px;">(Ëé∑Âèñ‰∏≠)</span>' : ''}
                                                </td>
                                                ${values.map((val, idx) => `
                                                    <td style="padding: 12px 16px; text-align: right; color: ${idx + 2 === config.highlight ? '#06b6d4' : '#e2e8f0'}; font-weight: ${idx + 2 === config.highlight ? '600' : '400'};">
                                                        ${val}
                                                    </td>
                                                `).join('')}
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
        }

        // ÊâìÂºÄÈ¢ëÈÅìÈìæÊé•
        function openChannel(channelId) {
            if (channelId) {
                window.open(`https://www.youtube.com/channel/${channelId}`, '_blank');
            }
        }

        // È¢ëÈÅìÁúüÂÆûÊï∞ÊçÆÁºìÂ≠ò
        const channelRealDataCache = {};

        // Ëé∑ÂèñÂçï‰∏™È¢ëÈÅìÁöÑÁúüÂÆûÊï∞ÊçÆ
        async function fetchChannelRealData(channelId) {
            // Ê£ÄÊü•ÁºìÂ≠ò
            if (channelRealDataCache[channelId]) {
                return channelRealDataCache[channelId];
            }

            try {
                const response = await fetch(`http://localhost:8000/api/channel/${channelId}`);
                if (!response.ok) {
                    throw new Error('Ëé∑ÂèñÂ§±Ë¥•');
                }
                const data = await response.json();
                // ÁºìÂ≠òÁªìÊûú
                channelRealDataCache[channelId] = data;
                return data;
            } catch (error) {
                console.error('Ëé∑ÂèñÈ¢ëÈÅìÊï∞ÊçÆÂ§±Ë¥•:', error);
                return null;
            }
        }

        // ÊòæÁ§∫È¢ëÈÅìËØ¶ÊÉÖÂºπÁ™ó
        async function showChannelDetail(channelId, channelName, event) {
            event.stopPropagation(); // ÈòªÊ≠¢Ëß¶Âèë openChannel

            // ÊâæÂà∞ÂØπÂ∫îÁöÑ ranking-item
            const btn = event.target;
            const item = btn.closest('.ranking-item');
            if (!item) return;

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            btn.textContent = '‚è≥ Âä†ËΩΩ‰∏≠...';
            btn.disabled = true;

            const data = await fetchChannelRealData(channelId);

            if (data) {
                // Êõ¥Êñ∞ÊòæÁ§∫ - Âú® video-meta ‰∏≠ËøΩÂä†ÁúüÂÆûÊï∞ÊçÆ
                const metaEl = item.querySelector('.video-meta');
                if (metaEl) {
                    // ÂàõÂª∫ÁúüÂÆûÊï∞ÊçÆÂ±ïÁ§∫Ë°å
                    const realDataHtml = `
                        <div class="channel-real-data" style="margin-top: 6px; padding-top: 6px; border-top: 1px dashed rgba(255,255,255,0.1);">
                            <span style="color: #10b981;">‚úÖ ÁúüÂÆûÊï∞ÊçÆ</span>
                            <span>ËÆ¢ÈòÖ <strong style="color: #f59e0b;">${formatNumber(data.subscriber_count)}</strong></span>
                            <span>ÂÖ± <strong>${data.video_count}</strong> ‰∏™ËßÜÈ¢ë</span>
                        </div>
                    `;
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊ∑ªÂä†Ëøá
                    if (!metaEl.querySelector('.channel-real-data')) {
                        metaEl.insertAdjacentHTML('beforeend', realDataHtml);
                    }
                }
                btn.textContent = '‚úÖ Â∑≤Âä†ËΩΩ';
                btn.style.background = 'rgba(16, 185, 129, 0.2)';
                btn.style.color = '#10b981';
            } else {
                btn.textContent = '‚ùå Â§±Ë¥•';
                btn.style.background = 'rgba(239, 68, 68, 0.2)';
                btn.style.color = '#ef4444';
                setTimeout(() => {
                    btn.textContent = 'üìä ÈáçËØï';
                    btn.disabled = false;
                    btn.style.background = '';
                    btn.style.color = '';
                }, 2000);
            }
        }

        // ÊâπÈáèËé∑ÂèñÈ¢ëÈÅìÁúüÂÆûÊï∞ÊçÆÔºàÁî®‰∫éÊ¶úÂçïÔºâ
        async function fetchChannelsBatch(channelIds) {
            // ËøáÊª§ÊéâÂ∑≤ÁºìÂ≠òÁöÑ
            const uncachedIds = channelIds.filter(id => !channelRealDataCache[id]);
            if (uncachedIds.length === 0) {
                return channelIds.map(id => channelRealDataCache[id]);
            }

            try {
                const response = await fetch('http://localhost:8000/api/channels/batch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(uncachedIds.slice(0, 10)) // ÊúÄÂ§ö10‰∏™
                });
                if (!response.ok) throw new Error('ÊâπÈáèËé∑ÂèñÂ§±Ë¥•');

                const result = await response.json();
                // ÁºìÂ≠òÁªìÊûú
                for (const [id, data] of Object.entries(result.channels)) {
                    if (data.success) {
                        channelRealDataCache[id] = data;
                    }
                }
            } catch (error) {
                console.error('ÊâπÈáèËé∑ÂèñÈ¢ëÈÅìÊï∞ÊçÆÂ§±Ë¥•:', error);
            }

            return channelIds.map(id => channelRealDataCache[id] || null);
        }

        // Êõ¥Êñ∞Ê¥ûÂØüÈù¢Êùø
        function updateInsights(result) {
            const container = document.getElementById('panel-overview');
            if (!container) return;

            const insights = result.insights;
            const summary = insights.market_summary || {};

            // ÊûÑÂª∫Ê¥ûÂØüÂç°Áâá
            let opportunitiesHtml = '';
            if (insights.opportunities && insights.opportunities.length > 0) {
                opportunitiesHtml = insights.opportunities.map(opp => `
                    <div class="insight-card">
                        <div class="insight-badge ${opp.score === 'A' ? 'high' : 'medium'}">${opp.score}</div>
                        <div class="insight-content">
                            <div class="insight-title">${opp.title}</div>
                            <div class="insight-desc">${opp.description}</div>
                        </div>
                    </div>
                `).join('');
            }

            // AI ËßÜÈ¢ëÁªüËÆ°
            const aiCount = result.ai_video_count || 0;
            const aiPct = result.total_videos > 0 ? ((aiCount / result.total_videos) * 100).toFixed(1) : 0;

            container.innerHTML = `
                <div class="overview-header">
                    <div class="overview-title-row">
                        <h2>„Äå${result.topic}„ÄçÂ∏ÇÂú∫ÂàÜÊûê</h2>
                        <div class="export-buttons">
                            <button class="export-btn" onclick="exportData('csv')" title="ÂØºÂá∫CSVÊ†ºÂºè">
                                üìä ÂØºÂá∫ CSV
                            </button>
                            <button class="export-btn" onclick="exportData('json')" title="ÂØºÂá∫JSONÊ†ºÂºè">
                                üìÅ ÂØºÂá∫ JSON
                            </button>
                        </div>
                    </div>
                    <div class="overview-stats">
                        <div class="stat-item">
                            <div class="stat-value">${formatNumber(result.total_videos)}</div>
                            <div class="stat-label">ËßÜÈ¢ëÊï∞Èáè</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${formatNumber(result.total_views)}</div>
                            <div class="stat-label">ÊÄªÊí≠ÊîæÈáè</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.total_channels}</div>
                            <div class="stat-label">È¢ëÈÅìÊï∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${aiCount} (${aiPct}%)</div>
                            <div class="stat-label">AIËßÜÈ¢ë</div>
                        </div>
                    </div>
                </div>

                <div class="insights-section">
                    <h3>ÂèëÁé∞ÁöÑÊú∫‰ºö</h3>
                    ${opportunitiesHtml || '<p class="no-data">ÊöÇÊó†ÊòéÊòæÊú∫‰ºö</p>'}
                </div>

                ${insights.top_performing ? `
                <div class="top-video-section">
                    <h3>ÊúÄ‰Ω≥Ë°®Áé∞ËßÜÈ¢ë</h3>
                    <div class="top-video-card">
                        <div class="top-video-title">${insights.top_performing.title}</div>
                        <div class="top-video-meta">
                            ${insights.top_performing.channel} ¬∑ ${formatNumber(insights.top_performing.views)} Êí≠Êîæ
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
        }

        // È¢ëÈÅìËØäÊñ≠
        async function startDiagnose() {
            const input = document.getElementById('diagnoseInput').value.trim();
            if (!input) {
                alert('ËØ∑ËæìÂÖ•È¢ëÈÅìÈìæÊé•ÊàñÂêçÁß∞');
                return;
            }

            // ÈöêËóèÂÖ∂‰ªñÂÜÖÂÆπ
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';

            // ÊòæÁ§∫ÂàÜÊûêÁä∂ÊÄÅ
            document.getElementById('analysisStatus').classList.add('show');
            document.getElementById('statusTitle').textContent = `Ê≠£Âú®ËØäÊñ≠È¢ëÈÅì...`;
            document.getElementById('statusBadge').textContent = 'ÂàÜÊûê‰∏≠';
            document.getElementById('statusBadge').className = 'status-badge running';
            document.getElementById('progressFill').className = 'progress-fill';

            const steps = [
                { progress: 20, log: 'Ê≠£Âú®Ëé∑ÂèñÈ¢ëÈÅì‰ø°ÊÅØ...' },
                { progress: 40, log: 'Ê≠£Âú®ÂàÜÊûêËßÜÈ¢ëÊï∞ÊçÆ...' },
                { progress: 60, log: 'Ê≠£Âú®ÂØπÊØîÂêåÁ±ªÈ¢ëÈÅì...' },
                { progress: 80, log: 'Ê≠£Âú®ÂåπÈÖçÂØπÊ†áË¥¶Âè∑...' },
                { progress: 100, log: 'ËØäÊñ≠ÂÆåÊàêÔºÅ' },
            ];

            for (const step of steps) {
                await new Promise(r => setTimeout(r, 500));
                document.getElementById('progressFill').style.width = step.progress + '%';
                document.getElementById('statusLog').textContent = step.log;
            }

            document.getElementById('statusBadge').textContent = 'ÂÆåÊàê';
            document.getElementById('statusBadge').className = 'status-badge done';
            document.getElementById('progressFill').className = 'progress-fill done';

            await new Promise(r => setTimeout(r, 300));
            document.getElementById('analysisStatus').classList.remove('show');

            // ÊòæÁ§∫ËØäÊñ≠ÁªìÊûú
            document.getElementById('diagnoseChannelName').textContent = input.includes('@') ? input : 'ÊàëÁöÑÂÖªÁîüÈ¢ëÈÅì';
            renderRecommendList();
            document.getElementById('diagnoseResult').classList.add('show');
        }

        let videoLimit = 50;
        function loadMoreVideos() {
            videoLimit += 50;
            const data = window.currentVideoData || [];
            renderVideoRanking(data, videoLimit);
        }

        // ÂΩìÂâçËßÜÈ¢ëÊ†áÁ≠æÁä∂ÊÄÅ
        let currentVideoTab = 'hot';
        let currentVideoTimeFilter = 0; // 0=ÂÖ®ÈÉ®, 1=24Â∞èÊó∂, 7=7Â§©, 30=30Â§©, 90=90Â§©

        // ËÆæÁΩÆÊó∂Èó¥Á≠õÈÄâ
        function setVideoTimeFilter(days) {
            currentVideoTimeFilter = days;
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('#videoTimeFilters .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            // ÈáçÊñ∞Â∫îÁî®ÂΩìÂâçÊ†áÁ≠æÁöÑÁ≠õÈÄâ
            applyVideoFilters();
        }

        // Â∫îÁî®ËßÜÈ¢ëÁ≠õÈÄâÔºàÁªìÂêàÊ†áÁ≠æÂíåÊó∂Èó¥Á≠õÈÄâÔºâ
        function applyVideoFilters() {
            const data = window.currentVideoData || [];
            if (!data || data.length === 0) return;

            let sortedData = [...data];
            let titleText = '';
            const now = new Date();

            // ÂÖàÂ∫îÁî®Êó∂Èó¥Á≠õÈÄâÔºàÂ¶ÇÊûú‰∏çÊòØ"ÂÖ®ÈÉ®"Ôºâ
            if (currentVideoTimeFilter > 0) {
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - currentVideoTimeFilter);
                sortedData = sortedData.filter(v => {
                    // Êó•ÊúüÊú™Áü•ÁöÑËßÜÈ¢ëÔºö‰∏çÂåÖÂê´Âú®Êó∂Èó¥Á≠õÈÄâ‰∏≠
                    if (!v.date || v.date === 'Êú™Áü•') return false;
                    const videoDate = new Date(v.date);
                    // Êó•ÊúüËß£ÊûêÂ§±Ë¥•‰πü‰∏çÂåÖÂê´
                    if (isNaN(videoDate.getTime())) return false;
                    return videoDate >= cutoffDate;
                });
            }

            // ÁÑ∂ÂêéÂ∫îÁî®Ê†áÁ≠æÁ≠õÈÄâ
            switch (currentVideoTab) {
                case 'hot':
                    // üî• ÁàÜÊ¨æËßÜÈ¢ëÔºöÊåâÊí≠ÊîæÈáèÈôçÂ∫è
                    sortedData.sort((a, b) => b.views - a.views);
                    titleText = 'üî• ÁàÜÊ¨æËßÜÈ¢ë Top 100';
                    break;
                case 'potential':
                    // üìà ÊΩúÂäõËßÜÈ¢ëÔºöÊåâÊí≠ÊîæÊïàÁéáÊéíÂ∫è
                    const avgViewsPotential = sortedData.reduce((sum, v) => sum + v.views, 0) / sortedData.length || 1;
                    sortedData = sortedData.filter(v => v.views >= avgViewsPotential * 0.1 && v.views <= avgViewsPotential * 2);
                    sortedData.sort((a, b) => {
                        const durationA = a.durationSeconds || parseDuration(a.duration) || 60;
                        const durationB = b.durationSeconds || parseDuration(b.duration) || 60;
                        const efficiencyA = a.views / Math.sqrt(durationA);
                        const efficiencyB = b.views / Math.sqrt(durationB);
                        return efficiencyB - efficiencyA;
                    });
                    titleText = 'üìà ÊΩúÂäõËßÜÈ¢ë Top 100';
                    break;
                case 'recent':
                    // üÜï ËøëÊúüÁÉ≠Èó®ÔºöÊåâÊó•ÂùáÊí≠ÊîæÈáèÊéíÂ∫èÔºàÊó∂Èó¥Á≠õÈÄâÂ∑≤Âú®‰∏äÈù¢Â∫îÁî®Ôºâ
                    // Â¶ÇÊûúÊ≤°ÊúâÈÄâÊó∂Èó¥Á≠õÈÄâÔºåÈªòËÆ§Á≠õÈÄâ30Â§©
                    if (currentVideoTimeFilter === 0) {
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        sortedData = sortedData.filter(v => {
                            if (!v.date || v.date === 'Êú™Áü•') return false;
                            const videoDate = new Date(v.date);
                            return !isNaN(videoDate.getTime()) && videoDate >= thirtyDaysAgo;
                        });
                    }
                    // ÊåâÊó•ÂùáÊí≠ÊîæÈáèÊéíÂ∫è
                    sortedData.sort((a, b) => {
                        const daysA = Math.max(1, (now - new Date(a.date)) / (1000 * 60 * 60 * 24));
                        const daysB = Math.max(1, (now - new Date(b.date)) / (1000 * 60 * 60 * 24));
                        return (b.views / daysB) - (a.views / daysA);
                    });
                    titleText = 'üÜï ËøëÊúüÁÉ≠Èó® Top 100';
                    break;
                case 'longform':
                    // ‚è±Ô∏è ÈïøËßÜÈ¢ëÊ¶úÔºöÊó∂Èïø >= 3ÂàÜÈíü
                    sortedData = sortedData.filter(v => {
                        const seconds = v.durationSeconds || parseDuration(v.duration);
                        return seconds >= 180;
                    });
                    sortedData.sort((a, b) => b.views - a.views);
                    titleText = '‚è±Ô∏è ÈïøËßÜÈ¢ëÊ¶ú Top 100';
                    break;
                case 'recentHits':
                    // ‚ö° ËøëÊúüÁàÜÊ¨æÔºö30Â§©ÂÜÖÂèëÂ∏ÉÔºåÊí≠ÊîæÈáè>=10‰∏áÔºà‰ΩøÁî®ÂêéÁ´ØËÆ°ÁÆóÁöÑÊï∞ÊçÆÔºâ
                    if (window.recentHits && window.recentHits.length > 0) {
                        sortedData = window.recentHits.map((v, i) => ({
                            rank: i + 1,
                            title: v.title,
                            channel: v.channel,
                            channelId: v.channelId,
                            views: v.views,
                            videoId: v.videoId,
                            date: v.date,
                            videoAgeDays: v.videoAgeDays,
                            dailyViews: v.dailyViews,
                            thumbnail: `https://i.ytimg.com/vi/${v.videoId}/mqdefault.jpg`,
                            score: v.views > 500000 ? 'A' : v.views > 200000 ? 'B' : 'C'
                        }));
                    } else {
                        // Â¶ÇÊûúÂêéÁ´ØÊ≤°ÊúâËøîÂõûÊï∞ÊçÆÔºå‰ªéÂâçÁ´ØÊï∞ÊçÆ‰∏≠Á≠õÈÄâ
                        sortedData = sortedData.filter(v => v.videoAgeDays <= 30 && v.views >= 100000);
                        sortedData.sort((a, b) => b.views - a.views);
                    }
                    titleText = '‚ö° ËøëÊúüÁàÜÊ¨æ Top 50Ôºà30Â§©ÂÜÖÔºå‚â•10‰∏áÊí≠ÊîæÔºâ';
                    break;
                case 'evergreen':
                    // üå≤ ÈïøÈùíËßÜÈ¢ëÔºö>180Â§©‰ΩÜÊó•ÂùáÊí≠Êîæ>=1000
                    if (window.evergreenVideos && window.evergreenVideos.length > 0) {
                        sortedData = window.evergreenVideos.map((v, i) => ({
                            rank: i + 1,
                            title: v.title,
                            channel: v.channel,
                            channelId: v.channelId,
                            views: v.views,
                            videoId: v.videoId,
                            date: v.date,
                            videoAgeDays: v.videoAgeDays,
                            dailyViews: v.dailyViews,
                            thumbnail: `https://i.ytimg.com/vi/${v.videoId}/mqdefault.jpg`,
                            score: v.dailyViews > 5000 ? 'A' : v.dailyViews > 2000 ? 'B' : 'C'
                        }));
                    } else {
                        // ‰ªéÂâçÁ´ØÊï∞ÊçÆ‰∏≠Á≠õÈÄâ
                        sortedData = sortedData.filter(v => v.videoAgeDays > 180 && v.dailyViews >= 1000);
                        sortedData.sort((a, b) => b.dailyViews - a.dailyViews);
                    }
                    titleText = 'üå≤ ÈïøÈùíËßÜÈ¢ë Top 50Ôºà>180Â§©ÔºåÊó•Âùá‚â•1000Êí≠ÊîæÔºâ';
                    break;
            }

            // Ê∑ªÂä†Êó∂Èó¥Á≠õÈÄâÊ†áËØÜÂà∞Ê†áÈ¢ò
            const timeLabels = { 0: '', 1: 'ÔºàËøë24Â∞èÊó∂Ôºâ', 7: 'ÔºàËøë7Â§©Ôºâ', 30: 'ÔºàËøë30Â§©Ôºâ', 90: 'ÔºàËøë90Â§©Ôºâ' };
            if (currentVideoTimeFilter > 0 && currentVideoTab !== 'recent') {
                titleText = titleText.replace(' Top 100', timeLabels[currentVideoTimeFilter] + ' Top 100');
            }

            // ÈáçÊñ∞ÁºñÊéíÊéíÂêç
            sortedData.forEach((v, i) => v.rank = i + 1);

            // Êõ¥Êñ∞Ê†áÈ¢ò
            const titleEl = document.querySelector('#panel-videos .ranking-title');
            if (titleEl) {
                titleEl.innerHTML = `${titleText} <span class="ranking-count">ÂÖ± ${sortedData.length} ‰∏™</span>`;
            }

            // Ê∏≤ÊüìÊï∞ÊçÆ
            renderVideoRanking(sortedData);
        }

        function switchVideoTab(tab) {
            document.querySelectorAll('#panel-videos .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            currentVideoTab = tab;
            // Ë∞ÉÁî®Áªü‰∏ÄÁöÑÁ≠õÈÄâÂáΩÊï∞
            applyVideoFilters();
        }

        // Ëß£ÊûêÊó∂ÈïøÂ≠óÁ¨¶‰∏≤‰∏∫ÁßíÊï∞
        function parseDuration(durationStr) {
            if (!durationStr) return 0;
            if (typeof durationStr === 'number') return durationStr;
            // ÊîØÊåÅ "12ÂàÜÈíü" Êàñ "12:34" Ê†ºÂºè
            const minMatch = durationStr.match(/(\d+)ÂàÜÈíü/);
            if (minMatch) return parseInt(minMatch[1]) * 60;
            const colonMatch = durationStr.match(/(\d+):(\d+)/);
            if (colonMatch) return parseInt(colonMatch[1]) * 60 + parseInt(colonMatch[2]);
            return 0;
        }

        // ËßÜÈ¢ëÂàÜÊûêÊ†áÁ≠æÂàáÊç¢
        let currentVideoAnalysisTab = 'hot';

        function switchVideoAnalysisTab(tab) {
            document.querySelectorAll('#panel-video-analysis .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            currentVideoAnalysisTab = tab;

            const data = window.currentVideoData;
            if (!data || data.length === 0) return;

            let filteredData = [...data];
            let titleText = '';
            let description = '';

            switch (tab) {
                case 'hot':
                    // üî• ÁàÜÊ¨æÂàÜÊûêÔºöÊí≠ÊîæÈáè > Âπ≥ÂùáÂÄºÁöÑ3ÂÄç
                    const avgViews = data.reduce((sum, v) => sum + v.views, 0) / data.length;
                    filteredData = data.filter(v => v.views > avgViews * 3);
                    filteredData.sort((a, b) => b.views - a.views);
                    titleText = 'üî• ÁàÜÊ¨æÂàÜÊûê';
                    description = `Êí≠ÊîæÈáèË∂ÖËøáÂπ≥ÂùáÂÄº3ÂÄçÔºà>${formatNumber(avgViews * 3)}ÔºâÁöÑËßÜÈ¢ë`;
                    break;
                case 'potential':
                    // üìà ÊΩúÂäõËßÜÈ¢ëÔºö‰∫íÂä®ÁéáÈ´ò‰ΩÜÊí≠ÊîæÈáè‰∏≠Á≠â
                    const medianViews = data.sort((a, b) => a.views - b.views)[Math.floor(data.length / 2)].views;
                    filteredData = data.filter(v => {
                        const engagementRate = (v.likes || 0) / (v.views || 1);
                        return v.views < medianViews * 2 && v.views > medianViews * 0.3 && engagementRate > 0.03;
                    });
                    filteredData.sort((a, b) => {
                        const rateA = (a.likes || 0) / (a.views || 1);
                        const rateB = (b.likes || 0) / (b.views || 1);
                        return rateB - rateA;
                    });
                    titleText = 'üìà ÊΩúÂäõËßÜÈ¢ë';
                    description = 'Êí≠ÊîæÈáè‰∏≠Á≠â‰ΩÜ‰∫íÂä®Áéá>3%ÁöÑËßÜÈ¢ëÔºåÊúâÁàÜÂèëÊΩúÂäõ';
                    break;
                case 'viral':
                    // üöÄ ÁóÖÊØí‰º†Êí≠ÔºöÂèëÂ∏ÉÊó∂Èó¥Áü≠‰ΩÜÊí≠ÊîæÈáèÈ´òÔºàÊó•ÂùáÊí≠ÊîæÈ´òÔºâ
                    const now = new Date();
                    filteredData = data.map(v => {
                        const pubDate = new Date(v.date);
                        const daysSincePublish = Math.max(1, (now - pubDate) / (1000 * 60 * 60 * 24));
                        return { ...v, dailyViews: v.views / daysSincePublish };
                    }).filter(v => v.dailyViews > 1000); // Êó•ÂùáÊí≠Êîæ > 1000
                    filteredData.sort((a, b) => b.dailyViews - a.dailyViews);
                    titleText = 'üöÄ ÁóÖÊØí‰º†Êí≠';
                    description = 'Êó•ÂùáÊí≠ÊîæÈáè>1000ÁöÑËßÜÈ¢ëÔºå‰º†Êí≠ÈÄüÂ∫¶Âø´';
                    break;
                case 'benchmark':
                    // üéØ ÂØπÊ†áËßÜÈ¢ëÔºöÁªºÂêàËØÑÂàÜÈ´òÔºàÊí≠Êîæ+‰∫íÂä®+Êó∂ÈïøÂπ≥Ë°°Ôºâ
                    filteredData = data.map(v => {
                        const viewScore = Math.min(v.views / 100000, 10); // 10‰∏áÊí≠Êîæ=10ÂàÜ
                        const engageScore = ((v.likes || 0) / (v.views || 1)) * 200; // 5%‰∫íÂä®Áéá=10ÂàÜ
                        const durationScore = Math.min((v.durationSeconds || 300) / 60, 10); // 10ÂàÜÈíü=10ÂàÜ
                        return { ...v, benchmarkScore: viewScore + engageScore + durationScore };
                    });
                    filteredData.sort((a, b) => b.benchmarkScore - a.benchmarkScore);
                    titleText = 'üéØ ÂØπÊ†áËßÜÈ¢ë';
                    description = 'ÁªºÂêàËØÑÂàÜÈ´òÁöÑËßÜÈ¢ëÔºåÈÄÇÂêà‰Ωú‰∏∫ÂÜÖÂÆπÂèÇËÄÉ';
                    break;
            }

            // ÈáçÊñ∞ÁºñÊéíÊéíÂêç
            filteredData.forEach((v, i) => v.rank = i + 1);

            // Ê∏≤ÊüìËßÜÈ¢ëÂàÜÊûêÂàóË°®
            renderVideoAnalysisList(filteredData, titleText, description);
        }

        // Ê∏≤ÊüìËßÜÈ¢ëÂàÜÊûêÂàóË°®
        function renderVideoAnalysisList(data, title, description) {
            const container = document.getElementById('videoAnalysisList');
            if (!data || data.length === 0) {
                container.innerHTML = `
                    <div class="no-data-state">
                        <div class="no-data-icon">üîç</div>
                        <div class="no-data-title">ÊöÇÊó†Á¨¶ÂêàÊù°‰ª∂ÁöÑËßÜÈ¢ë</div>
                        <p class="no-data-desc">${description}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="ai-insight" style="margin-bottom: 16px;">
                    <div class="ai-content">
                        <p><strong>${title}</strong>Ôºö${description}</p>
                        <p>ÂÖ±ÊâæÂà∞ <strong>${data.length}</strong> ‰∏™Á¨¶ÂêàÊù°‰ª∂ÁöÑËßÜÈ¢ë</p>
                    </div>
                </div>
                <div class="ranking-list">
                    ${data.slice(0, 50).map(v => `
                        <div class="ranking-item" onclick="openVideo('${v.videoId}')" style="cursor: pointer;">
                            <div class="rank-number ${v.rank <= 3 ? 'rank-' + v.rank : 'rank-normal'}">${v.rank}</div>
                            <div class="rank-thumb">üé¨</div>
                            <div class="rank-info">
                                <div class="rank-title">${v.title}</div>
                                <div class="rank-meta">
                                    <span>${v.channel}</span>
                                    <span>${v.duration}</span>
                                    <span>${v.date}</span>
                                    ${v.dailyViews ? `<span>Êó•Âùá${formatNumber(Math.round(v.dailyViews))}</span>` : ''}
                                    ${v.benchmarkScore ? `<span>ËØÑÂàÜ${v.benchmarkScore.toFixed(1)}</span>` : ''}
                                </div>
                            </div>
                            <div class="rank-stats">
                                <div class="rank-stat">
                                    <div class="rank-stat-value">${formatNumber(v.views)}</div>
                                    <div class="rank-stat-label">Êí≠Êîæ</div>
                                </div>
                                <div class="rank-stat">
                                    <div class="rank-stat-value">${((v.likes || 0) / (v.views || 1) * 100).toFixed(1)}%</div>
                                    <div class="rank-stat-label">‰∫íÂä®Áéá</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ÂΩìÂâçÈ¢ëÈÅìÊ†áÁ≠æÁä∂ÊÄÅ
        let currentChannelTab = 'totalViews';

        function switchChannelTab(tab) {
            document.querySelectorAll('#panel-channels .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            currentChannelTab = tab;

            const channelData = window.currentChannelData;
            const videoData = window.currentVideoData;
            if (!channelData || channelData.length === 0) return;

            let sortedData = [...channelData];
            let titleSuffix = '';

            switch (tab) {
                case 'totalViews':
                    sortedData.sort((a, b) => (b.totalViews || 0) - (a.totalViews || 0));
                    break;
                case 'avgViews':
                    sortedData.sort((a, b) => (b.avgViews || 0) - (a.avgViews || 0));
                    break;
                case 'videoCount':
                    sortedData.sort((a, b) => (b.videoCount || 0) - (a.videoCount || 0));
                    break;
                case 'darkHorse':
                    // üê¥ ÈªëÈ©¨Ê¶úÔºöÁü≠ËßÜÈ¢ëÔºà<60ÁßíÔºâÊ∂®Á≤âÊΩúÂäõÈ¢ëÈÅì
                    // Á≠õÈÄâÊù°‰ª∂ÔºöÊúâÁü≠ËßÜÈ¢ë‰∏î‰º∞ÁÆóÊ∂®Á≤â>1000
                    // Ê∂®Á≤â‰º∞ÁÆóÂÖ¨ÂºèÔºöÁü≠ËßÜÈ¢ëÊÄªÊí≠ÊîæÈáè * 0.002ÔºàÂÅáËÆæ0.2%ËΩ¨ÂåñÁéáÔºâ
                    if (videoData && videoData.length > 0) {
                        // ÁªüËÆ°ÊØè‰∏™È¢ëÈÅìÁöÑÁü≠ËßÜÈ¢ëÊï∞ÊçÆ
                        const channelShortStats = {};
                        videoData.forEach(v => {
                            const seconds = v.durationSeconds || 0;
                            if (seconds > 0 && seconds <= 60) { // Áü≠ËßÜÈ¢ëÂÆö‰πâÔºö<=60Áßí
                                const chId = v.channelId;
                                if (!channelShortStats[chId]) {
                                    channelShortStats[chId] = {
                                        shortVideoCount: 0,
                                        shortVideoViews: 0,
                                        channelName: v.channel
                                    };
                                }
                                channelShortStats[chId].shortVideoCount++;
                                channelShortStats[chId].shortVideoViews += v.views || 0;
                            }
                        });

                        // ËÆ°ÁÆóÊ∂®Á≤â‰º∞ÁÆóÂπ∂Á≠õÈÄâ
                        sortedData = channelData
                            .map(ch => {
                                const stats = channelShortStats[ch.channelId] || { shortVideoCount: 0, shortVideoViews: 0 };
                                const estimatedFollowers = Math.round(stats.shortVideoViews * 0.002); // 0.2%ËΩ¨ÂåñÁéá
                                return {
                                    ...ch,
                                    shortVideoCount: stats.shortVideoCount,
                                    shortVideoViews: stats.shortVideoViews,
                                    estimatedFollowers: estimatedFollowers
                                };
                            })
                            .filter(ch => ch.shortVideoCount > 0 && ch.estimatedFollowers >= 1000)
                            .sort((a, b) => b.estimatedFollowers - a.estimatedFollowers);

                        titleSuffix = ` (Áü≠ËßÜÈ¢ëÊ∂®Á≤â‚â•1000)`;
                    } else {
                        sortedData = [];
                    }
                    break;
                case 'efficiency':
                    // üöÄ È´òÊïàÊ¶úÔºöÊåâÊêúÁ¥¢ÁªìÊûú‰∏≠ÁöÑÂπ≥ÂùáÊí≠ÊîæÈáèÊéíÂ∫è
                    // ÂèçÊò†ËØ•È¢ëÈÅìÂú®Ê≠§È¢ÜÂüüÁöÑËßÜÈ¢ëË°®Áé∞
                    sortedData = channelData
                        .filter(ch => (ch.avgViews || 0) >= 50000) // Âπ≥ÂùáÊí≠Êîæ‚â•5‰∏á
                        .sort((a, b) => (b.avgViews || 0) - (a.avgViews || 0));

                    titleSuffix = ` (ÊêúÁ¥¢ÁªìÊûú‰∏≠Âπ≥ÂùáÊí≠Êîæ‚â•5‰∏á)`;
                    break;
            }

            const modeMap = { darkHorse: 'darkHorse', efficiency: 'efficiency' };
            renderChannelListFromData(sortedData, modeMap[tab] || null, titleSuffix);
        }

        let channelLimit = 50;
        function loadMoreChannels() {
            channelLimit += 50;
            const data = window.currentChannelData;
            if (data) {
                renderChannelListFromData(data.slice(0, channelLimit));
            }
        }

        // È¢ëÈÅìÂàÜÊûêÊ†áÁ≠æÂàáÊç¢
        let currentChannelAnalysisTab = 'worthy';

        function switchChannelAnalysisTab(tab) {
            document.querySelectorAll('#panel-channels .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            currentChannelAnalysisTab = tab;

            const data = window.currentChannelData;
            if (!data || data.length === 0) return;

            let filteredData = [...data];
            let titleText = '';
            let description = '';

            switch (tab) {
                case 'worthy':
                    // ‚≠ê ÂÄºÂæóÁ†îÁ©∂ÔºöÁªºÂêàË°®Áé∞Â•ΩÔºàËßÜÈ¢ëÂ§ö+Êí≠ÊîæÈ´òÔºâ
                    filteredData = data.filter(ch => ch.videoCount >= 5 && ch.avgViews >= 10000);
                    filteredData.sort((a, b) => {
                        const scoreA = (a.avgViews || 0) * Math.log10(a.videoCount || 1);
                        const scoreB = (b.avgViews || 0) * Math.log10(b.videoCount || 1);
                        return scoreB - scoreA;
                    });
                    titleText = '‚≠ê ÂÄºÂæóÁ†îÁ©∂';
                    description = 'ËßÜÈ¢ëÊï∞‚â•5‰∏îÂπ≥ÂùáÊí≠Êîæ‚â•1‰∏áÁöÑ‰ºòË¥®È¢ëÈÅì';
                    break;
                case 'growing':
                    // üìà Âø´ÈÄüÊàêÈïøÔºöËßÜÈ¢ëÂ∞ë‰ΩÜÊí≠ÊîæÈ´òÔºàÊñ∞È¢ëÈÅìÊΩúÂäõÂ§ßÔºâ
                    filteredData = data.filter(ch => ch.videoCount <= 20 && ch.avgViews >= 20000);
                    filteredData.sort((a, b) => (b.avgViews || 0) - (a.avgViews || 0));
                    titleText = 'üìà Âø´ÈÄüÊàêÈïø';
                    description = 'ËßÜÈ¢ëÊï∞‚â§20‰ΩÜÂπ≥ÂùáÊí≠Êîæ‚â•2‰∏áÁöÑÊñ∞ÂÖ¥È¢ëÈÅì';
                    break;
                case 'leader':
                    // üéØ ÁªÜÂàÜÈæôÂ§¥ÔºöËßÜÈ¢ëÂ§ö+ÊÄªÊí≠ÊîæÈ´ò
                    filteredData = data.filter(ch => ch.videoCount >= 10);
                    filteredData.sort((a, b) => (b.totalViews || 0) - (a.totalViews || 0));
                    titleText = 'üéØ ÁªÜÂàÜÈæôÂ§¥';
                    description = 'ËßÜÈ¢ëÊï∞‚â•10ÁöÑÂ§¥ÈÉ®È¢ëÈÅìÔºåÊåâÊÄªÊí≠ÊîæÈáèÊéíÂ∫è';
                    break;
                case 'emerging':
                    // üÜï Êñ∞ÂÖ¥È¢ëÈÅìÔºöËßÜÈ¢ëÂ∞ëÔºà‚â§10Ôºâ‰ΩÜÊúâ‰∏ÄÂÆöÊí≠Êîæ
                    filteredData = data.filter(ch => ch.videoCount <= 10 && ch.avgViews >= 5000);
                    filteredData.sort((a, b) => (b.avgViews || 0) - (a.avgViews || 0));
                    titleText = 'üÜï Êñ∞ÂÖ¥È¢ëÈÅì';
                    description = 'ËßÜÈ¢ëÊï∞‚â§10ÁöÑÊñ∞È¢ëÈÅìÔºåÊúâÂèëÂ±ïÊΩúÂäõ';
                    break;
            }

            // Ê∏≤ÊüìÈ¢ëÈÅìÂàÜÊûêÂàóË°®
            renderChannelAnalysisList(filteredData, titleText, description);
        }

        // Ê∏≤ÊüìÈ¢ëÈÅìÂàÜÊûêÂàóË°®
        function renderChannelAnalysisList(data, title, description) {
            const container = document.getElementById('channelList');
            if (!data || data.length === 0) {
                container.innerHTML = `
                    <div class="no-data-state">
                        <div class="no-data-icon">üì∫</div>
                        <div class="no-data-title">ÊöÇÊó†Á¨¶ÂêàÊù°‰ª∂ÁöÑÈ¢ëÈÅì</div>
                        <p class="no-data-desc">${description}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="ai-insight" style="margin-bottom: 16px;">
                    <div class="ai-content">
                        <p><strong>${title}</strong>Ôºö${description}</p>
                        <p>ÂÖ±ÊâæÂà∞ <strong>${data.length}</strong> ‰∏™Á¨¶ÂêàÊù°‰ª∂ÁöÑÈ¢ëÈÅì</p>
                    </div>
                </div>
                ${data.slice(0, 30).map((ch, i) => `
                    <div class="channel-card">
                        <div class="channel-header">
                            <div class="channel-avatar">${ch.name ? ch.name[0] : '?'}</div>
                            <div class="channel-info">
                                <div class="channel-name">${ch.name || 'Êú™Áü•È¢ëÈÅì'}</div>
                                <div class="channel-meta">
                                    ${ch.videoCount || 0} ‰∏™ËßÜÈ¢ë ¬∑
                                    ÂùáÊí≠ ${formatNumber(ch.avgViews || 0)} ¬∑
                                    ÊÄªÊí≠Êîæ ${formatNumber(ch.totalViews || 0)}
                                </div>
                            </div>
                            <div class="channel-stats">
                                <div class="channel-stat">
                                    <div class="channel-stat-value">${formatNumber(ch.avgViews || 0)}</div>
                                    <div class="channel-stat-label">ÂùáÊí≠</div>
                                </div>
                                <div class="channel-stat">
                                    <div class="channel-stat-value">${ch.videoCount || 0}</div>
                                    <div class="channel-stat-label">ËßÜÈ¢ë</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function toggleVideoAnalysis(index) {
            const el = document.getElementById(`video-analysis-${index}`);
            if (el) {
                el.classList.toggle('open');
            }
        }

        // ËØùÈ¢òÊú∫‰ºöÊ†áÁ≠æÂàáÊç¢
        let currentTopicTab = 'opportunity';

        function switchTopicTab(tab) {
            document.querySelectorAll('#panel-topics .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            currentTopicTab = tab;

            const data = window.currentVideoData;
            if (!data || data.length === 0) return;

            // ‰ªéËßÜÈ¢ëÊ†áÈ¢ò‰∏≠ÊèêÂèñËØùÈ¢òÂÖ≥ÈîÆËØç
            const topicStats = extractTopicStats(data);
            let filteredTopics = [...topicStats];
            let titleText = '';
            let description = '';

            switch (tab) {
                case 'opportunity':
                    // üéØ È´òÊú∫‰ºöËØùÈ¢òÔºöÈúÄÊ±ÇÈ´òÔºàÂá∫Áé∞Â§öÔºâ‰ΩÜÁ´û‰∫â‰ΩéÔºàÂπ≥ÂùáÊí≠ÊîæÈ´òÔºâ
                    filteredTopics = topicStats.filter(t => t.count >= 3 && t.avgViews >= 50000);
                    filteredTopics.sort((a, b) => (b.avgViews * Math.log10(b.count)) - (a.avgViews * Math.log10(a.count)));
                    titleText = 'üéØ È´òÊú∫‰ºöËØùÈ¢ò';
                    description = 'Âá∫Áé∞‚â•3Ê¨°‰∏îÂπ≥ÂùáÊí≠Êîæ‚â•5‰∏áÁöÑËØùÈ¢òÔºåÈúÄÊ±ÇÂ§ßÁ´û‰∫âÂ∞è';
                    break;
                case 'bridge':
                    // üîó Ê°•Ê¢ÅËØùÈ¢òÔºöËøûÊé•Â§ö‰∏™È¢ÜÂüüÁöÑËØùÈ¢ò
                    filteredTopics = topicStats.filter(t => t.count >= 5);
                    filteredTopics.sort((a, b) => b.count - a.count);
                    titleText = 'üîó Ê°•Ê¢ÅËØùÈ¢ò';
                    description = 'Âá∫Áé∞‚â•5Ê¨°ÁöÑÈ´òÈ¢ëËØùÈ¢òÔºåÂèØ‰Ωú‰∏∫ÂÜÖÂÆπËøûÊé•ÁÇπ';
                    break;
                case 'saturated':
                    // üìä ÁÉ≠Èó®‰ΩÜÈ•±ÂíåÔºöÂá∫Áé∞Â§ö‰ΩÜÂπ≥ÂùáÊí≠Êîæ‰Ωé
                    filteredTopics = topicStats.filter(t => t.count >= 5 && t.avgViews < 30000);
                    filteredTopics.sort((a, b) => b.count - a.count);
                    titleText = 'üìä ÁÉ≠Èó®‰ΩÜÈ•±Âíå';
                    description = 'Âá∫Áé∞‚â•5Ê¨°‰ΩÜÂπ≥ÂùáÊí≠Êîæ<3‰∏áÁöÑËØùÈ¢òÔºåÁ´û‰∫âÊøÄÁÉà';
                    break;
            }

            // Ê∏≤ÊüìËØùÈ¢òÂàóË°®
            renderTopicList(filteredTopics, titleText, description);
        }

        // ‰ªéËßÜÈ¢ëÊï∞ÊçÆ‰∏≠ÊèêÂèñËØùÈ¢òÁªüËÆ°
        function extractTopicStats(videos) {
            const topicMap = new Map();
            const stopWords = ['ÁöÑ', 'ÊòØ', 'Âú®', '‰∫Ü', 'Âíå', '‰∏é', 'Êàñ', 'Ëøô', 'ÈÇ£', 'Êúâ', '‰∏∫', '‰ª•', 'Âèä', 'Á≠â', '‰Ω†', 'Êàë', '‰ªñ', 'Â•π', 'the', 'a', 'an', 'is', 'are', 'to', 'for', 'and', 'or', 'in', 'on', 'at', 'how', 'what', 'why'];

            videos.forEach(v => {
                const words = (v.title || '').split(/[\s,Ôºå„ÄÇÔºÅÔºü„ÄÅÔºö:;\-\[\]„Äê„Äë()ÔºàÔºâ]+/).filter(w => w.length >= 2 && !stopWords.includes(w.toLowerCase()));
                words.forEach(word => {
                    if (!topicMap.has(word)) {
                        topicMap.set(word, { name: word, count: 0, totalViews: 0, videos: [] });
                    }
                    const topic = topicMap.get(word);
                    topic.count++;
                    topic.totalViews += v.views || 0;
                    topic.videos.push(v);
                });
            });

            // ËÆ°ÁÆóÂπ≥ÂùáÊí≠ÊîæÂπ∂ËΩ¨‰∏∫Êï∞ÁªÑ
            return Array.from(topicMap.values())
                .map(t => ({ ...t, avgViews: t.totalViews / t.count }))
                .filter(t => t.count >= 2); // Ëá≥Â∞ëÂá∫Áé∞2Ê¨°
        }

        // Ê∏≤ÊüìËØùÈ¢òÂàóË°®
        function renderTopicList(topics, title, description) {
            const container = document.getElementById('topicRankingList');
            if (!topics || topics.length === 0) {
                container.innerHTML = `
                    <div class="no-data-state">
                        <div class="no-data-icon">üí°</div>
                        <div class="no-data-title">ÊöÇÊó†Á¨¶ÂêàÊù°‰ª∂ÁöÑËØùÈ¢ò</div>
                        <p class="no-data-desc">${description}</p>
                    </div>
                `;
                // Êõ¥Êñ∞Ê†áÈ¢ò
                const titleEl = document.querySelector('#panel-topics .ranking-title');
                if (titleEl) titleEl.innerHTML = `${title} <span class="ranking-count">ÂÖ± 0 ‰∏™</span>`;
                return;
            }

            // Êõ¥Êñ∞Ê†áÈ¢ò
            const titleEl = document.querySelector('#panel-topics .ranking-title');
            if (titleEl) titleEl.innerHTML = `${title} <span class="ranking-count">ÂÖ± ${topics.length} ‰∏™</span>`;

            container.innerHTML = topics.slice(0, 30).map((t, i) => `
                <div class="ranking-item">
                    <div class="rank-number ${i < 3 ? 'rank-' + (i + 1) : 'rank-normal'}">${i + 1}</div>
                    <div class="rank-info" style="flex: 1;">
                        <div class="rank-title">${t.name}</div>
                        <div class="rank-meta">
                            <span>Âá∫Áé∞ ${t.count} Ê¨°</span>
                            <span>ÂùáÊí≠ ${formatNumber(Math.round(t.avgViews))}</span>
                            <span>ÊÄªÊí≠Êîæ ${formatNumber(t.totalViews)}</span>
                        </div>
                    </div>
                    <div class="rank-stats">
                        <div class="rank-stat">
                            <div class="rank-stat-value">${t.count}</div>
                            <div class="rank-stat-label">ËßÜÈ¢ëÊï∞</div>
                        </div>
                        <div class="rank-stat">
                            <div class="rank-stat-value">${formatNumber(Math.round(t.avgViews))}</div>
                            <div class="rank-stat-label">ÂùáÊí≠</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Êó∂Èó¥Ë∂ãÂäøÊ†áÁ≠æÂàáÊç¢
        let currentTimelineTab = 'monthly';

        function switchTimelineTab(tab) {
            document.querySelectorAll('#panel-timeline .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            currentTimelineTab = tab;

            const data = window.currentVideoData;
            if (!data || data.length === 0) return;

            let titleText = '';
            let chartData = [];

            switch (tab) {
                case 'monthly':
                    // üìÖ ÊúàÂ∫¶Ë∂ãÂäø
                    chartData = aggregateByMonth(data);
                    titleText = 'üìÖ ÊúàÂ∫¶ËßÜÈ¢ëË°®Áé∞';
                    break;
                case 'quarterly':
                    // üìÜ Â≠£Â∫¶ÂØπÊØî
                    chartData = aggregateByQuarter(data);
                    titleText = 'üìÜ Â≠£Â∫¶ËßÜÈ¢ëÂØπÊØî';
                    break;
                case 'publishTime':
                    // üïê ÂèëÂ∏ÉÊó∂Èó¥ÂàÜÂ∏É
                    chartData = aggregateByPublishHour(data);
                    titleText = 'üïê ÂèëÂ∏ÉÊó∂Èó¥ÂàÜÂ∏É';
                    break;
            }

            renderTimelineChart(chartData, titleText, tab);
        }

        // ÊåâÊúàËÅöÂêà
        function aggregateByMonth(videos) {
            const monthMap = new Map();
            videos.forEach(v => {
                if (!v.date) return;
                const month = v.date.substring(0, 7); // YYYY-MM
                if (!monthMap.has(month)) {
                    monthMap.set(month, { label: month, count: 0, totalViews: 0 });
                }
                const m = monthMap.get(month);
                m.count++;
                m.totalViews += v.views || 0;
            });
            return Array.from(monthMap.values())
                .map(m => ({ ...m, avgViews: m.totalViews / m.count }))
                .sort((a, b) => b.label.localeCompare(a.label));
        }

        // ÊåâÂ≠£Â∫¶ËÅöÂêà
        function aggregateByQuarter(videos) {
            const quarterMap = new Map();
            videos.forEach(v => {
                if (!v.date) return;
                const year = v.date.substring(0, 4);
                const month = parseInt(v.date.substring(5, 7));
                const quarter = `${year} Q${Math.ceil(month / 3)}`;
                if (!quarterMap.has(quarter)) {
                    quarterMap.set(quarter, { label: quarter, count: 0, totalViews: 0 });
                }
                const q = quarterMap.get(quarter);
                q.count++;
                q.totalViews += v.views || 0;
            });
            return Array.from(quarterMap.values())
                .map(q => ({ ...q, avgViews: q.totalViews / q.count }))
                .sort((a, b) => b.label.localeCompare(a.label));
        }

        // ÊåâÂèëÂ∏ÉÂ∞èÊó∂ËÅöÂêà
        function aggregateByPublishHour(videos) {
            // Áî±‰∫éÊ≤°ÊúâÁ≤æÁ°ÆÊó∂Èó¥ÔºåËøôÈáåÊ®°ÊãüÊåâÊó∂Èó¥ÊÆµÂàÜÂ∏É
            const periods = [
                { label: 'Êó©Èó¥ (6-9ÁÇπ)', count: 0, totalViews: 0 },
                { label: '‰∏äÂçà (9-12ÁÇπ)', count: 0, totalViews: 0 },
                { label: '‰∏ãÂçà (12-18ÁÇπ)', count: 0, totalViews: 0 },
                { label: 'ÊôöÈó¥ (18-22ÁÇπ)', count: 0, totalViews: 0 },
                { label: 'Ê∑±Â§ú (22-6ÁÇπ)', count: 0, totalViews: 0 }
            ];
            // ÈöèÊú∫ÂàÜÈÖçÔºàÂÆûÈôÖÂ∫î‰ªéÊï∞ÊçÆ‰∏≠Ëé∑ÂèñÔºâ
            videos.forEach((v, i) => {
                const idx = i % 5;
                periods[idx].count++;
                periods[idx].totalViews += v.views || 0;
            });
            return periods.map(p => ({ ...p, avgViews: p.count > 0 ? p.totalViews / p.count : 0 }));
        }

        // Ê∏≤ÊüìÊó∂Èó¥Ë∂ãÂäøÂõæË°®
        function renderTimelineChart(data, title, tab) {
            const container = document.getElementById('timelineChart');
            const titleEl = document.querySelector('#panel-timeline .ranking-title');
            if (titleEl) titleEl.textContent = title;

            if (!data || data.length === 0) {
                container.innerHTML = `
                    <div class="no-data-state">
                        <div class="no-data-icon">üìà</div>
                        <div class="no-data-title">ÊöÇÊó†Êó∂Èó¥Ë∂ãÂäøÊï∞ÊçÆ</div>
                    </div>
                `;
                return;
            }

            const maxViews = Math.max(...data.map(d => d.avgViews));
            const colors = ['#059669', '#0891b2', '#7c3aed', '#db2777', '#ea580c'];

            container.innerHTML = data.slice(0, 12).map((d, i) => `
                <div class="time-bar-row">
                    <span class="time-label">${d.label}</span>
                    <div class="time-bar-container">
                        <div class="time-bar" style="width: ${(d.avgViews / maxViews * 100).toFixed(1)}%; background: linear-gradient(90deg, ${colors[i % colors.length]}, ${colors[(i + 1) % colors.length]});">
                            ${d.count} ‰∏™ËßÜÈ¢ë
                        </div>
                    </div>
                    <span class="time-meta">ÂùáÊí≠ ${formatNumber(Math.round(d.avgViews))}</span>
                </div>
            `).join('');
        }

        // Á≠õÈÄâÂô®Áä∂ÊÄÅ
        const filterState = {
            viewsMin: null,
            viewsMax: null,
            regions: [],
            duration: [],
            subscribers: [],
            timeRange: null,
            sortBy: 'views'
        };

        // ÂàáÊç¢Á≠õÈÄâÂô®ÊòæÁ§∫
        function toggleFilters() {
            const toggle = document.getElementById('filtersToggle');
            const content = document.getElementById('filtersContent');
            toggle.classList.toggle('open');
            content.classList.toggle('show');
        }

        // ËÆæÁΩÆÊí≠ÊîæÈáèËåÉÂõ¥
        function setViewsRange(min, max) {
            const parent = event.target.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('viewsMin').value = min ? min : '';
            document.getElementById('viewsMax').value = max ? max : '';
            filterState.viewsMin = min;
            filterState.viewsMax = max;
            updateActiveFilters();
        }

        // Ê∏ÖÈô§Âú∞Âå∫ÈÄâÊã©
        function clearRegions(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.regions = [];
            updateActiveFilters();
        }

        // ÂàáÊç¢Âú∞Âå∫ÈÄâÊã©
        function toggleRegion(el, region) {
            const parent = el.closest('.filter-chips');
            parent.querySelector('.filter-chip:first-child').classList.remove('active'); // ÁßªÈô§"‰∏çÈôê"
            el.classList.toggle('active');
            const idx = filterState.regions.indexOf(region);
            if (idx > -1) {
                filterState.regions.splice(idx, 1);
            } else {
                filterState.regions.push(region);
            }
            // Â¶ÇÊûúÊ≤°ÊúâÈÄâ‰∏≠‰ªª‰ΩïÂú∞Âå∫ÔºåÈáçÊñ∞ÈÄâ‰∏≠"‰∏çÈôê"
            if (filterState.regions.length === 0) {
                parent.querySelector('.filter-chip:first-child').classList.add('active');
            }
            updateActiveFilters();
        }

        // Ê∏ÖÈô§Êó∂ÈïøÈÄâÊã©
        function clearDuration(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.duration = [];
            updateActiveFilters();
        }

        // ÂàáÊç¢Êó∂ÈïøÈÄâÊã©
        function toggleDuration(el, duration) {
            const parent = el.closest('.filter-chips');
            parent.querySelector('.filter-chip:first-child').classList.remove('active'); // ÁßªÈô§"‰∏çÈôê"
            el.classList.toggle('active');
            const idx = filterState.duration.indexOf(duration);
            if (idx > -1) {
                filterState.duration.splice(idx, 1);
            } else {
                filterState.duration.push(duration);
            }
            if (filterState.duration.length === 0) {
                parent.querySelector('.filter-chip:first-child').classList.add('active');
            }
            updateActiveFilters();
        }

        // Ê∏ÖÈô§Á≤â‰∏ùÊï∞ÈÄâÊã©
        function clearSubscribers(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.subscribers = [];
            updateActiveFilters();
        }

        // ÂàáÊç¢Á≤â‰∏ùÊï∞ÈÄâÊã©
        function toggleSubscribers(el, size) {
            const parent = el.closest('.filter-chips');
            parent.querySelector('.filter-chip:first-child').classList.remove('active'); // ÁßªÈô§"‰∏çÈôê"
            el.classList.toggle('active');
            const idx = filterState.subscribers.indexOf(size);
            if (idx > -1) {
                filterState.subscribers.splice(idx, 1);
            } else {
                filterState.subscribers.push(size);
            }
            if (filterState.subscribers.length === 0) {
                parent.querySelector('.filter-chip:first-child').classList.add('active');
            }
            updateActiveFilters();
        }

        // Ê∏ÖÈô§Êó∂Èó¥ËåÉÂõ¥
        function clearTime(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.timeRange = null;

            // Ê∏ÖÈô§Êó∂Èó¥ËåÉÂõ¥ÂêéÔºåÊÅ¢Â§çÈªòËÆ§ÊéíÂ∫èÔºàÊí≠ÊîæÈáèÊúÄÈ´òÔºâ
            const sortSelect = document.getElementById('sortBy');
            if (sortSelect) {
                sortSelect.value = 'views';
                filterState.sortBy = 'views';
            }

            updateActiveFilters();
        }

        // ÂàáÊç¢Êó∂Èó¥ËåÉÂõ¥
        function toggleTime(el, time) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.timeRange = time;

            // ÈÄâÊã©Êó∂Èó¥ËåÉÂõ¥ÂêéÔºåËá™Âä®ÂàáÊç¢‰∏∫Êåâ"ÊúÄÊñ∞ÂèëÂ∏É"ÊéíÂ∫è
            const sortSelect = document.getElementById('sortBy');
            if (sortSelect) {
                sortSelect.value = 'recent';
                filterState.sortBy = 'recent';
            }

            updateActiveFilters();
        }

        // Êõ¥Êñ∞Â∑≤ÈÄâÁ≠õÈÄâÊù°‰ª∂ÊòæÁ§∫
        function updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            let html = '';

            if (filterState.viewsMin || filterState.viewsMax) {
                const min = filterState.viewsMin ? formatNumber(filterState.viewsMin) : '0';
                const max = filterState.viewsMax ? formatNumber(filterState.viewsMax) : '‰∏çÈôê';
                html += `<span class="active-filter-tag">Êí≠ÊîæÈáè: ${min} - ${max} <span class="remove" onclick="clearViewsFilter()">‚úï</span></span>`;
            }

            filterState.regions.forEach(r => {
                const names = { SG: 'üá∏üá¨ Êñ∞Âä†Âù°', MY: 'üá≤üáæ È©¨Êù•Ë•ø‰∫ö', TW: 'üáπüáº Âè∞Êπæ', HK: 'üá≠üá∞ È¶ôÊ∏Ø', US: 'üá∫üá∏ ÁæéÂõΩ', CN: 'üá®üá≥ Â§ßÈôÜ' };
                html += `<span class="active-filter-tag">${names[r]} <span class="remove" onclick="removeRegion('${r}')">‚úï</span></span>`;
            });

            filterState.duration.forEach(d => {
                const names = { short: 'Áü≠ËßÜÈ¢ë', medium: '‰∏≠Á≠âÊó∂Èïø', long: 'ÈïøËßÜÈ¢ë' };
                html += `<span class="active-filter-tag">${names[d]} <span class="remove" onclick="removeDuration('${d}')">‚úï</span></span>`;
            });

            filterState.subscribers.forEach(s => {
                const names = { small: 'Â∞èÈ¢ëÈÅì', medium: '‰∏≠È¢ëÈÅì', large: 'Â§ßÈ¢ëÈÅì', huge: 'Ë∂ÖÂ§ßÈ¢ëÈÅì' };
                html += `<span class="active-filter-tag">${names[s]} <span class="remove" onclick="removeSubscribers('${s}')">‚úï</span></span>`;
            });

            if (filterState.timeRange) {
                const names = { '24h': '24Â∞èÊó∂', '7d': 'Ëøë7Â§©', '30d': 'Ëøë30Â§©', '90d': 'Ëøë3‰∏™Êúà', '1y': 'Ëøë1Âπ¥' };
                html += `<span class="active-filter-tag">${names[filterState.timeRange]} <span class="remove" onclick="clearTimeFilter()">‚úï</span></span>`;
            }

            if (filterState.aiFilter) {
                const names = { 'ai': 'ü§ñ ‰ªÖAIËßÜÈ¢ë', 'human': 'üë§ ‰ªÖÁúü‰∫∫ËßÜÈ¢ë' };
                html += `<span class="active-filter-tag">${names[filterState.aiFilter]} <span class="remove" onclick="clearAIFilter()">‚úï</span></span>`;
            }

            container.innerHTML = html;
        }

        // Ê∏ÖÈô§Êí≠ÊîæÈáèÁ≠õÈÄâ
        function clearViewsFilter() {
            document.getElementById('viewsMin').value = '';
            document.getElementById('viewsMax').value = '';
            filterState.viewsMin = null;
            filterState.viewsMax = null;
            updateActiveFilters();
        }

        // ÁßªÈô§Âú∞Âå∫
        function removeRegion(region) {
            const idx = filterState.regions.indexOf(region);
            if (idx > -1) filterState.regions.splice(idx, 1);
            document.querySelectorAll('.filter-group:nth-child(2) .filter-chip').forEach(c => {
                if (c.textContent.includes(region === 'SG' ? 'Êñ∞Âä†Âù°' : region === 'MY' ? 'È©¨Êù•Ë•ø‰∫ö' : region === 'TW' ? 'Âè∞Êπæ' : region === 'HK' ? 'È¶ôÊ∏Ø' : region === 'US' ? 'ÁæéÂõΩ' : 'Â§ßÈôÜ')) {
                    c.classList.remove('active');
                }
            });
            updateActiveFilters();
        }

        // ÁßªÈô§Êó∂Èïø
        function removeDuration(duration) {
            const idx = filterState.duration.indexOf(duration);
            if (idx > -1) filterState.duration.splice(idx, 1);
            document.querySelectorAll('.filter-group:nth-child(3) .filter-chip').forEach(c => {
                if ((duration === 'short' && c.textContent.includes('Áü≠ËßÜÈ¢ë')) ||
                    (duration === 'medium' && c.textContent.includes('‰∏≠Á≠â')) ||
                    (duration === 'long' && c.textContent.includes('ÈïøËßÜÈ¢ë'))) {
                    c.classList.remove('active');
                }
            });
            updateActiveFilters();
        }

        // ÁßªÈô§Á≤â‰∏ùÊï∞
        function removeSubscribers(size) {
            const idx = filterState.subscribers.indexOf(size);
            if (idx > -1) filterState.subscribers.splice(idx, 1);
            document.querySelectorAll('.filter-group:nth-child(4) .filter-chip').forEach(c => {
                if ((size === 'small' && c.textContent.includes('Â∞èÈ¢ëÈÅì')) ||
                    (size === 'medium' && c.textContent.includes('‰∏≠È¢ëÈÅì')) ||
                    (size === 'large' && c.textContent.includes('Â§ßÈ¢ëÈÅì')) ||
                    (size === 'huge' && c.textContent.includes('Ë∂ÖÂ§ß'))) {
                    c.classList.remove('active');
                }
            });
            updateActiveFilters();
        }

        // Ê∏ÖÈô§Êó∂Èó¥Á≠õÈÄâ
        function clearTimeFilter() {
            filterState.timeRange = null;
            document.querySelectorAll('.filter-group:nth-child(5) .filter-chip').forEach(c => c.classList.remove('active'));
            updateActiveFilters();
        }

        // Ê∏ÖÈô§AIÁ≠õÈÄâ
        function clearAIFilter() {
            filterState.aiFilter = null;
            // ÊâæÂà∞AIËßÜÈ¢ëÁ≠õÈÄâÁªÑÂπ∂ÈáçÁΩÆ
            document.querySelectorAll('.filter-group').forEach(group => {
                if (group.querySelector('.filter-label')?.textContent.includes('AIËßÜÈ¢ë')) {
                    group.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    group.querySelector('.filter-chip:first-child').classList.add('active');
                }
            });
            updateActiveFilters();
        }

        // ÈáçÁΩÆÊâÄÊúâÁ≠õÈÄâ
        function resetFilters() {
            filterState.viewsMin = null;
            filterState.viewsMax = null;
            filterState.regions = [];
            filterState.duration = [];
            filterState.subscribers = [];
            filterState.timeRange = null;
            filterState.sortBy = 'views';
            filterState.likesMin = null;
            filterState.likesMax = null;
            filterState.engagement = null;
            filterState.languages = [];
            filterState.channelTypes = [];
            filterState.quality = [];
            filterState.aiFilter = null;

            document.getElementById('viewsMin').value = '';
            document.getElementById('viewsMax').value = '';
            document.getElementById('likesMin').value = '';
            document.getElementById('likesMax').value = '';
            document.getElementById('commentsMin').value = '';
            document.getElementById('commentsMax').value = '';
            document.getElementById('sortBy').value = 'views';
            document.getElementById('dateStart').value = '';
            document.getElementById('dateEnd').value = '';
            document.getElementById('channelFilter').value = '';
            document.getElementById('excludeKeywords').value = '';
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            // ÈáçÊñ∞ÊøÄÊ¥ªÊâÄÊúâ"‰∏çÈôê"ÊåâÈíÆ
            document.querySelectorAll('.filter-chips').forEach(chips => {
                const first = chips.querySelector('.filter-chip:first-child');
                if (first && first.textContent === '‰∏çÈôê') {
                    first.classList.add('active');
                }
            });
            updateActiveFilters();
        }

        // ËÆæÁΩÆËßÜÈ¢ëÊï∞Èáè
        function setVideoCount(el, count) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.videoCount = count;
        }

        // ËÆæÁΩÆÁÇπËµûËåÉÂõ¥
        function setLikesRange(min, max) {
            const parent = event.target.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('likesMin').value = min ? min : '';
            document.getElementById('likesMax').value = max ? max : '';
            filterState.likesMin = min;
            filterState.likesMax = max;
        }

        // Ê∏ÖÈô§‰∫íÂä®Áéá
        function clearEngagement(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.engagement = null;
        }

        // ËÆæÁΩÆ‰∫íÂä®Áéá
        function setEngagement(el, level) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.engagement = level;
        }

        // Ê∏ÖÈô§ËØ≠Ë®Ä
        function clearLanguage(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.languages = [];
        }

        // ÂàáÊç¢ËØ≠Ë®Ä
        function toggleLanguage(el, lang) {
            const parent = el.closest('.filter-chips');
            parent.querySelector('.filter-chip:first-child').classList.remove('active'); // ÁßªÈô§"‰∏çÈôê"
            el.classList.toggle('active');
            if (!filterState.languages) filterState.languages = [];
            const idx = filterState.languages.indexOf(lang);
            if (idx > -1) {
                filterState.languages.splice(idx, 1);
            } else {
                filterState.languages.push(lang);
            }
            if (filterState.languages.length === 0) {
                parent.querySelector('.filter-chip:first-child').classList.add('active');
            }
        }

        // Ê∏ÖÈô§È¢ëÈÅìÁ±ªÂûã
        function clearChannelType(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.channelTypes = [];
        }

        // ÂàáÊç¢È¢ëÈÅìÁ±ªÂûã
        function toggleChannelType(el, type) {
            const parent = el.closest('.filter-chips');
            parent.querySelector('.filter-chip:first-child').classList.remove('active'); // ÁßªÈô§"‰∏çÈôê"
            el.classList.toggle('active');
            if (!filterState.channelTypes) filterState.channelTypes = [];
            const idx = filterState.channelTypes.indexOf(type);
            if (idx > -1) {
                filterState.channelTypes.splice(idx, 1);
            } else {
                filterState.channelTypes.push(type);
            }
            if (filterState.channelTypes.length === 0) {
                parent.querySelector('.filter-chip:first-child').classList.add('active');
            }
        }

        // Ê∏ÖÈô§ËßÜÈ¢ëË¥®Èáè
        function clearQuality(el) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.quality = [];
        }

        // ÂàáÊç¢ËßÜÈ¢ëË¥®Èáè
        function toggleQuality(el, quality) {
            const parent = el.closest('.filter-chips');
            parent.querySelector('.filter-chip:first-child').classList.remove('active'); // ÁßªÈô§"‰∏çÈôê"
            el.classList.toggle('active');
            if (!filterState.quality) filterState.quality = [];
            const idx = filterState.quality.indexOf(quality);
            if (idx > -1) {
                filterState.quality.splice(idx, 1);
            } else {
                filterState.quality.push(quality);
            }
            if (filterState.quality.length === 0) {
                parent.querySelector('.filter-chip:first-child').classList.add('active');
            }
        }

        // AIËßÜÈ¢ëÁ≠õÈÄâ
        function setAIFilter(el, type) {
            const parent = el.closest('.filter-chips');
            parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            filterState.aiFilter = type === 'all' ? null : type;
            updateActiveFilters();
        }

        // AIËßÜÈ¢ëÊ£ÄÊµãÂÖ≥ÈîÆËØç
        const AI_VIDEO_KEYWORDS = [
            // Â∑•ÂÖ∑ÂêçÁß∞
            'sora', 'runway', 'pika', 'heygen', 'synthesia', 'd-id', 'midjourney',
            'stable diffusion', 'kling', 'luma', 'gen-2', 'gen-3', 'vidu', 'cogvideo',
            // ‰∏≠ÊñáÂÖ≥ÈîÆËØç
            'aiÁîüÊàê', 'aiËßÜÈ¢ë', 'aiÂà∂‰Ωú', 'aiÂàõ‰Ωú', 'aiÈÖçÈü≥', 'aiÊç¢ËÑ∏', 'aiÊï∞Â≠ó‰∫∫',
            'Êï∞Â≠ó‰∫∫', 'ËôöÊãü‰∫∫', '‰∫∫Â∑•Êô∫ËÉΩÁîüÊàê', 'aigc',
            // Ëã±ÊñáÂÖ≥ÈîÆËØç
            'ai generated', 'ai video', 'ai-generated', 'text to video', 'ai avatar'
        ];

        // Ê£ÄÊµãÊòØÂê¶‰∏∫AIËßÜÈ¢ë
        function detectAIVideo(title, description, tags) {
            const text = `${title || ''} ${description || ''} ${(tags || []).join(' ')}`.toLowerCase();
            for (const kw of AI_VIDEO_KEYWORDS) {
                if (text.includes(kw.toLowerCase())) {
                    return { isAI: true, keyword: kw };
                }
            }
            return { isAI: false, keyword: null };
        }

        // Â∫îÁî®Á≠õÈÄâ
        function applyFilters() {
            filterState.sortBy = document.getElementById('sortBy').value;
            filterState.dateStart = document.getElementById('dateStart').value;
            filterState.dateEnd = document.getElementById('dateEnd').value;
            filterState.channelFilter = document.getElementById('channelFilter').value;
            filterState.excludeKeywords = document.getElementById('excludeKeywords').value;
            filterState.commentsMin = document.getElementById('commentsMin').value;
            filterState.commentsMax = document.getElementById('commentsMax').value;

            console.log('Â∫îÁî®Á≠õÈÄâ:', filterState);
            // ËøôÈáåÂ∞ÜÊù•Êé•ÂÖ•ÁúüÂÆûÊï∞ÊçÆÂêéÔºå‰ºöÊ†πÊçÆÁ≠õÈÄâÊù°‰ª∂ÈáçÊñ∞Ëé∑ÂèñÊï∞ÊçÆ
            alert('Á≠õÈÄâÊù°‰ª∂Â∑≤‰øùÂ≠òÔºÅÁÇπÂáª"ÂºÄÂßãÂàÜÊûê"ÂêéÁîüÊïà„ÄÇ');
        }

        // ============ Êï∞ÊçÆÂØºÂá∫ÂäüËÉΩ ============

        // ÂØºÂá∫Êï∞ÊçÆ
        function exportData(format) {
            if (!lastAnalysisResult) {
                alert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÊï∞ÊçÆÔºåËØ∑ÂÖàËøõË°åÂàÜÊûê');
                return;
            }

            const data = lastAnalysisResult;
            const timestamp = new Date().toISOString().slice(0, 10);
            const topic = data.topic || 'analysis';
            const filename = `youtube_${topic}_${timestamp}`;

            if (format === 'csv') {
                exportCSV(data, filename);
            } else if (format === 'json') {
                exportJSON(data, filename);
            }
        }

        // ÂØºÂá∫‰∏∫ CSV
        function exportCSV(data, filename) {
            // ËßÜÈ¢ëÊï∞ÊçÆ CSV
            const videoHeaders = [
                'YouTube ID',
                'Ê†áÈ¢ò',
                'È¢ëÈÅìÂêçÁß∞',
                'È¢ëÈÅìID',
                'Êí≠ÊîæÈáè',
                'ÁÇπËµûÊï∞',
                'ËØÑËÆ∫Êï∞',
                'Êó∂Èïø(Áßí)',
                'ÂèëÂ∏ÉÊó•Êúü',
                'ÊòØÂê¶AIËßÜÈ¢ë',
                'AIÂÖ≥ÈîÆËØç',
                'ËßÜÈ¢ëÈìæÊé•'
            ];

            const videoRows = data.videos.map(v => [
                v.youtube_id,
                `"${(v.title || '').replace(/"/g, '""')}"`,  // Â§ÑÁêÜÊ†áÈ¢ò‰∏≠ÁöÑÂºïÂè∑
                `"${(v.channel_name || '').replace(/"/g, '""')}"`,
                v.channel_id || '',
                v.view_count || 0,
                v.like_count || 0,
                v.comment_count || 0,
                v.duration || 0,
                v.published_at || '',
                v.is_ai_video ? 'ÊòØ' : 'Âê¶',
                v.ai_keyword || '',
                `https://www.youtube.com/watch?v=${v.youtube_id}`
            ].join(','));

            const csvContent = [videoHeaders.join(','), ...videoRows].join('\n');

            // Ê∑ªÂä† BOM ‰ª•ÊîØÊåÅ‰∏≠Êñá
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            downloadBlob(blob, `${filename}_videos.csv`);

            // È¢ëÈÅìÊï∞ÊçÆ CSV
            if (data.channels && data.channels.length > 0) {
                const channelHeaders = ['È¢ëÈÅìÂêçÁß∞', 'È¢ëÈÅìID', 'ËßÜÈ¢ëÊï∞Èáè', 'ÊÄªÊí≠ÊîæÈáè', 'Âπ≥ÂùáÊí≠ÊîæÈáè'];
                const channelRows = data.channels.map(ch => [
                    `"${(ch.channel_name || '').replace(/"/g, '""')}"`,
                    ch.channel_id || '',
                    ch.video_count || 0,
                    ch.total_views || 0,
                    ch.avg_views || 0
                ].join(','));

                const channelCsv = [channelHeaders.join(','), ...channelRows].join('\n');
                const channelBlob = new Blob(['\ufeff' + channelCsv], { type: 'text/csv;charset=utf-8;' });
                downloadBlob(channelBlob, `${filename}_channels.csv`);
            }

            console.log(`Â∑≤ÂØºÂá∫ ${data.videos.length} ‰∏™ËßÜÈ¢ëÂíå ${data.channels?.length || 0} ‰∏™È¢ëÈÅìÊï∞ÊçÆ`);
        }

        // ÂØºÂá∫‰∏∫ JSON
        function exportJSON(data, filename) {
            // ÂÆåÊï¥Êï∞ÊçÆÂØºÂá∫
            const exportData = {
                meta: {
                    topic: data.topic,
                    exportTime: new Date().toISOString(),
                    totalVideos: data.total_videos,
                    totalViews: data.total_views,
                    totalChannels: data.total_channels,
                    aiVideoCount: data.ai_video_count
                },
                insights: data.insights,
                durationDistribution: data.duration_distribution,
                videos: data.videos.map(v => ({
                    ...v,
                    url: `https://www.youtube.com/watch?v=${v.youtube_id}`
                })),
                channels: data.channels
            };

            const jsonContent = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });
            downloadBlob(blob, `${filename}_full.json`);

            console.log(`Â∑≤ÂØºÂá∫ÂÆåÊï¥Êï∞ÊçÆ (JSON)`);
        }

        // ‰∏ãËΩΩÊñá‰ª∂
        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Ë∑≥ËΩ¨Âà∞Ê®°ÂºèÊ¥ûÂØüÁ≥ªÁªü
        function goToInsightSystem() {
            const keyword = currentTheme || 'ÂÖªÁîü';
            // Êú¨Âú∞Ôºöweb/insight-system.htmlÔºåVercelÔºö/insight-system.html
            const basePath = window.location.hostname.includes('vercel.app') ? '' : 'web';
            window.location.href = `${basePath}/insight-system.html?keyword=${encodeURIComponent(keyword)}`;
        }

        // Êõ¥Êñ∞ÂàÜÊûêÊä•ÂëäÈù¢Êùø
        function updateReportPanel(result, videos, channels) {
            const container = document.getElementById('reportContent');
            const titleEl = document.getElementById('reportTitle');

            if (!container) return;

            if (!result || !videos || videos.length === 0) {
                container.innerHTML = `
                    <div class="no-data-state">
                        <div class="no-data-icon">üìã</div>
                        <div class="no-data-title">ÊöÇÊó†Êä•Âëä</div>
                        <p class="no-data-desc">ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÂêéÔºåËøôÈáåÂ∞ÜÁîüÊàêÂÆåÊï¥ÁöÑÂàÜÊûêÊä•Âëä</p>
                    </div>
                `;
                return;
            }

            if (titleEl) titleEl.textContent = `üìã „Äå${result.topic}„ÄçÂàÜÊûêÊä•Âëä`;

            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const avgViews = result.total_videos > 0 ? Math.round(result.total_views / result.total_videos) : 0;
            const topVideos = videos.slice(0, 5);
            const topChannels = channels.slice(0, 5);

            // Êó∂ÈïøÂàÜÂ∏É
            const durationStats = {
                short: videos.filter(v => (v.durationSeconds || 0) < 180).length,
                medium: videos.filter(v => (v.durationSeconds || 0) >= 180 && (v.durationSeconds || 0) < 600).length,
                long: videos.filter(v => (v.durationSeconds || 0) >= 600).length
            };

            container.innerHTML = `
                <div class="report-section" style="margin-bottom: 24px;">
                    <h3 style="color: #1e293b; font-size: 16px; margin: 0 0 12px; display: flex; align-items: center; gap: 8px;">
                        <span>üìä</span> Êï∞ÊçÆÊ¶ÇËßà
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: #3b82f6;">${result.total_videos}</div>
                            <div style="font-size: 12px; color: #64748b;">ËßÜÈ¢ëÊÄªÊï∞</div>
                        </div>
                        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: #10b981;">${result.total_channels}</div>
                            <div style="font-size: 12px; color: #64748b;">È¢ëÈÅìÊï∞Èáè</div>
                        </div>
                        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: #8b5cf6;">${formatNumber(result.total_views)}</div>
                            <div style="font-size: 12px; color: #64748b;">ÊÄªÊí≠ÊîæÈáè</div>
                        </div>
                        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: #f59e0b;">${formatNumber(avgViews)}</div>
                            <div style="font-size: 12px; color: #64748b;">Âπ≥ÂùáÊí≠Êîæ</div>
                        </div>
                    </div>
                </div>

                <div class="report-section" style="margin-bottom: 24px;">
                    <h3 style="color: #1e293b; font-size: 16px; margin: 0 0 12px; display: flex; align-items: center; gap: 8px;">
                        <span>üé¨</span> Top 5 ËßÜÈ¢ë
                    </h3>
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0;">#</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0;">Ê†áÈ¢ò</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0;">È¢ëÈÅì</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 1px solid #e2e8f0;">Êí≠ÊîæÈáè</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topVideos.map((v, i) => `
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 10px; color: #64748b;">${i + 1}</td>
                                    <td style="padding: 10px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${v.title}</td>
                                    <td style="padding: 10px; color: #64748b;">${v.channel}</td>
                                    <td style="padding: 10px; text-align: right; font-weight: 500;">${formatNumber(v.views)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div class="report-section" style="margin-bottom: 24px;">
                    <h3 style="color: #1e293b; font-size: 16px; margin: 0 0 12px; display: flex; align-items: center; gap: 8px;">
                        <span>üì∫</span> Top 5 È¢ëÈÅì
                    </h3>
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0;">#</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0;">È¢ëÈÅìÂêçÁß∞</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 1px solid #e2e8f0;">ËßÜÈ¢ëÊï∞</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 1px solid #e2e8f0;">ÊÄªÊí≠Êîæ</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 1px solid #e2e8f0;">Âπ≥ÂùáÊí≠Êîæ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topChannels.map((ch, i) => `
                                <tr style="border-bottom: 1px solid #f1f5f9;">
                                    <td style="padding: 10px; color: #64748b;">${i + 1}</td>
                                    <td style="padding: 10px;">${ch.name}</td>
                                    <td style="padding: 10px; text-align: right;">${ch.videoCount}</td>
                                    <td style="padding: 10px; text-align: right; font-weight: 500;">${formatNumber(ch.totalViews)}</td>
                                    <td style="padding: 10px; text-align: right;">${formatNumber(ch.avgViews)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div class="report-section">
                    <h3 style="color: #1e293b; font-size: 16px; margin: 0 0 12px; display: flex; align-items: center; gap: 8px;">
                        <span>‚è±Ô∏è</span> Êó∂ÈïøÂàÜÂ∏É
                    </h3>
                    <div style="display: flex; gap: 16px;">
                        <div style="flex: 1; background: #fef3c7; padding: 16px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 20px; font-weight: 600; color: #d97706;">${durationStats.short}</div>
                            <div style="font-size: 12px; color: #92400e;">Áü≠ËßÜÈ¢ë (&lt;3ÂàÜÈíü)</div>
                        </div>
                        <div style="flex: 1; background: #dbeafe; padding: 16px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 20px; font-weight: 600; color: #2563eb;">${durationStats.medium}</div>
                            <div style="font-size: 12px; color: #1e40af;">‰∏≠Á≠â (3-10ÂàÜÈíü)</div>
                        </div>
                        <div style="flex: 1; background: #ede9fe; padding: 16px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 20px; font-weight: 600; color: #7c3aed;">${durationStats.long}</div>
                            <div style="font-size: 12px; color: #5b21b6;">ÈïøËßÜÈ¢ë (&gt;10ÂàÜÈíü)</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÂØºÂá∫Êä•Âëä
        function exportReport(format) {
            const data = lastAnalysisResult;
            if (!data) {
                alert('ÊöÇÊó†Êï∞ÊçÆÂèØÂØºÂá∫ÔºåËØ∑ÂÖàÊêúÁ¥¢ÂàÜÊûê');
                return;
            }

            const filename = `${data.topic}_report_${new Date().toISOString().slice(0, 10)}`;

            if (format === 'csv') {
                exportCSV(data, filename);
            } else if (format === 'json') {
                exportJSON(data, filename);
            }
        }

        // ==================== ÁõëÊéßÂäüËÉΩ ====================

        let monitorTasks = [];
        let schedulerRunning = false;
        let trendingDays = 7;

        // Âä†ËΩΩÁõëÊéß‰ªªÂä°ÂàóË°®
        async function loadMonitorTasks() {
            try {
                const response = await fetch(`${API_BASE}/api/monitor/tasks`);
                const data = await response.json();
                monitorTasks = data.tasks || [];
                renderMonitorTasks();
                document.getElementById('badge-monitor').textContent = monitorTasks.length;
            } catch (error) {
                console.error('Âä†ËΩΩÁõëÊéß‰ªªÂä°Â§±Ë¥•:', error);
            }
        }

        // Ê∏≤ÊüìÁõëÊéß‰ªªÂä°ÂàóË°®
        function renderMonitorTasks() {
            const container = document.getElementById('monitorTasksList');

            if (monitorTasks.length === 0) {
                container.innerHTML = `
                    <div style="padding: 40px 20px; text-align: center; color: #64748b;">
                        <div style="font-size: 2em; margin-bottom: 16px;">üì°</div>
                        <div style="font-weight: 600; color: white; margin-bottom: 8px;">ÊöÇÊó†ÁõëÊéß‰ªªÂä°</div>
                        <p>Ê∑ªÂä†ÂÖ≥ÈîÆËØçÂêéÔºåÁ≥ªÁªüÂ∞ÜÂÆöÊó∂ÈááÈõÜÊï∞ÊçÆÂπ∂ËøΩË∏™Â¢ûÈïøË∂ãÂäø</p>
                        <button class="search-btn" onclick="showAddMonitorModal()" style="margin-top: 16px; padding: 10px 20px;">+ Ê∑ªÂä†ÁõëÊéß‰ªªÂä°</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = monitorTasks.map((task, index) => `
                <div class="ranking-item" style="flex-wrap: wrap;">
                    <div class="rank-number" style="background: ${task.is_active ? '#06b6d4' : '#64748b'};">
                        ${index + 1}
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <div style="font-weight: 600; color: white; margin-bottom: 4px;">
                            ${task.keyword}
                            ${task.is_active ? '<span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; margin-left: 8px;">ËøêË°å‰∏≠</span>' : '<span style="background: #64748b; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; margin-left: 8px;">Â∑≤ÊöÇÂÅú</span>'}
                        </div>
                        <div style="font-size: 0.85em; color: #94a3b8;">
                            È¢ëÁéá: ${task.frequency === 'hourly' ? 'ÊØèÂ∞èÊó∂' : task.frequency === 'weekly' ? 'ÊØèÂë®' : 'ÊØèÂ§©'}
                            ¬∑ ‰∏äÊ¨°ËøêË°å: ${task.last_run_at ? new Date(task.last_run_at).toLocaleString() : '‰ªéÊú™'}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="filter-btn" onclick="runMonitorNow(${task.id})" style="font-size: 11px;">‚ñ∂Ô∏è Á´ãÂç≥ÊâßË°å</button>
                        <button class="filter-btn" onclick="toggleMonitorTask(${task.id})" style="font-size: 11px;">${task.is_active ? '‚è∏Ô∏è ÊöÇÂÅú' : '‚ñ∂Ô∏è ÂêØÁî®'}</button>
                        <button class="filter-btn" onclick="viewMonitorGrowth(${task.id})" style="font-size: 11px;">üìà Êü•ÁúãÂ¢ûÈïø</button>
                        <button class="filter-btn" onclick="deleteMonitorTask(${task.id})" style="font-size: 11px; color: #ef4444;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // ÊòæÁ§∫Ê∑ªÂä†ÁõëÊéßÊ®°ÊÄÅÊ°Ü
        function showAddMonitorModal() {
            const modal = document.createElement('div');
            modal.id = 'addMonitorModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); display: flex;
                align-items: center; justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: #1e293b; border-radius: 16px; padding: 24px; width: 400px; max-width: 90%;">
                    <h3 style="color: white; margin-bottom: 20px;">üì° Ê∑ªÂä†ÁõëÊéß‰ªªÂä°</h3>
                    <div style="margin-bottom: 16px;">
                        <label style="color: #94a3b8; font-size: 0.85em; display: block; margin-bottom: 6px;">ÁõëÊéßÂÖ≥ÈîÆËØç</label>
                        <input type="text" id="monitorKeyword" class="search-input" placeholder="‰æãÂ¶ÇÔºöPythonÊïôÁ®ã„ÄÅÂÅ•Â∫∑ÂÖªÁîü" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="color: #94a3b8; font-size: 0.85em; display: block; margin-bottom: 6px;">ÈááÈõÜÈ¢ëÁéá</label>
                        <select id="monitorFrequency" style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 8px; color: white;">
                            <option value="daily">ÊØèÂ§©</option>
                            <option value="hourly">ÊØèÂ∞èÊó∂</option>
                            <option value="weekly">ÊØèÂë®</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #94a3b8; font-size: 0.85em; display: block; margin-bottom: 6px;">ÊØèÊ¨°ÈááÈõÜÊï∞Èáè</label>
                        <input type="number" id="monitorMaxResults" value="500" style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 8px; color: white;">
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button onclick="closeAddMonitorModal()" style="flex: 1; padding: 12px; background: #334155; color: white; border: none; border-radius: 8px; cursor: pointer;">ÂèñÊ∂à</button>
                        <button onclick="createMonitorTask()" class="search-btn" style="flex: 1; padding: 12px;">ÂàõÂª∫ÁõëÊéß</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeAddMonitorModal() {
            const modal = document.getElementById('addMonitorModal');
            if (modal) modal.remove();
        }

        // ÂàõÂª∫ÁõëÊéß‰ªªÂä°
        async function createMonitorTask() {
            const keyword = document.getElementById('monitorKeyword').value.trim();
            const frequency = document.getElementById('monitorFrequency').value;
            const maxResults = parseInt(document.getElementById('monitorMaxResults').value) || 500;

            if (!keyword) {
                alert('ËØ∑ËæìÂÖ•ÁõëÊéßÂÖ≥ÈîÆËØç');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/monitor/tasks`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ keyword, frequency, max_results: maxResults })
                });

                const data = await response.json();
                if (data.success) {
                    closeAddMonitorModal();
                    loadMonitorTasks();
                    alert(`ÁõëÊéß‰ªªÂä°Â∑≤ÂàõÂª∫: ${keyword}`);
                } else {
                    alert(data.detail || 'ÂàõÂª∫Â§±Ë¥•');
                }
            } catch (error) {
                alert('ÂàõÂª∫ÁõëÊéß‰ªªÂä°Â§±Ë¥•: ' + error.message);
            }
        }

        // Á´ãÂç≥ÊâßË°åÁõëÊéß‰ªªÂä°
        async function runMonitorNow(taskId) {
            try {
                const response = await fetch(`${API_BASE}/api/monitor/tasks/${taskId}/run`, {
                    method: 'POST'
                });
                const data = await response.json();
                alert(data.message || '‰ªªÂä°Â∑≤ÂºÄÂßãÊâßË°å');
            } catch (error) {
                alert('ÊâßË°åÂ§±Ë¥•: ' + error.message);
            }
        }

        // ÂàáÊç¢ÁõëÊéß‰ªªÂä°Áä∂ÊÄÅ
        async function toggleMonitorTask(taskId) {
            try {
                const response = await fetch(`${API_BASE}/api/monitor/tasks/${taskId}/toggle`, {
                    method: 'POST'
                });
                const data = await response.json();
                loadMonitorTasks();
            } catch (error) {
                alert('Êìç‰ΩúÂ§±Ë¥•: ' + error.message);
            }
        }

        // Âà†Èô§ÁõëÊéß‰ªªÂä°
        async function deleteMonitorTask(taskId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÁõëÊéß‰ªªÂä°ÂêóÔºü')) return;

            try {
                const response = await fetch(`${API_BASE}/api/monitor/tasks/${taskId}`, {
                    method: 'DELETE'
                });
                loadMonitorTasks();
            } catch (error) {
                alert('Âà†Èô§Â§±Ë¥•: ' + error.message);
            }
        }

        // Êü•ÁúãÂ¢ûÈïøÊï∞ÊçÆ
        async function viewMonitorGrowth(taskId) {
            try {
                const response = await fetch(`${API_BASE}/api/monitor/tasks/${taskId}/growth?days=${trendingDays}`);
                const data = await response.json();

                // ÂàáÊç¢Âà∞Ë∂ãÂäøÈù¢ÊùøÂπ∂ÊòæÁ§∫Êï∞ÊçÆ
                switchPanel('trending');
                renderTrendingData(data);
            } catch (error) {
                alert('Ëé∑ÂèñÂ¢ûÈïøÊï∞ÊçÆÂ§±Ë¥•: ' + error.message);
            }
        }

        // Ê∏≤ÊüìË∂ãÂäøÊï∞ÊçÆ
        function renderTrendingData(data) {
            // Êõ¥Êñ∞ÊëòË¶Å
            const summary = data.summary || {};
            document.getElementById('trend-total-videos').textContent = formatNumber(summary.total_videos || 0);
            document.getElementById('trend-total-growth').textContent = formatNumber(summary.total_growth || 0);
            document.getElementById('trend-trending-count').textContent = formatNumber(summary.trending_count || 0);
            document.getElementById('trend-avg-growth').textContent = formatNumber(Math.round(summary.avg_growth || 0));

            // Ê∏≤ÊüìË∂ãÂäøËßÜÈ¢ëÂàóË°®
            const container = document.getElementById('trendingVideosList');
            const trending = data.trending_videos || [];

            if (trending.length === 0) {
                container.innerHTML = `
                    <div style="padding: 40px 20px; text-align: center; color: #64748b;">
                        <div style="font-size: 2em; margin-bottom: 16px;">üìà</div>
                        <div style="font-weight: 600; color: white; margin-bottom: 8px;">ÊöÇÊó†Ë∂ãÂäøÊï∞ÊçÆ</div>
                        <p>ÈúÄË¶ÅËá≥Â∞ë2Â§©ÁöÑÊï∞ÊçÆÊâçËÉΩËÆ°ÁÆóÂ¢ûÈïøË∂ãÂäø</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = trending.map((video, index) => `
                <div class="ranking-item">
                    <div class="rank-number" style="background: ${index < 3 ? '#f59e0b' : '#334155'};">
                        ${index + 1}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: white; margin-bottom: 4px;">
                            ${video.video_id}
                        </div>
                        <div style="font-size: 0.85em; color: #94a3b8;">
                            Ë∂ãÂäøÂ§©Êï∞: ${video.trending_days || 0} Â§©
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: #10b981; font-size: 1.1em;">
                            +${formatNumber(video.total_growth || 0)}
                        </div>
                        <div style="font-size: 0.8em; color: #94a3b8;">
                            Âπ≥Âùá ${(video.avg_growth_rate || 0).toFixed(1)}%
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Ë∞ÉÂ∫¶Âô®ÊéßÂà∂
        async function toggleScheduler() {
            try {
                const endpoint = schedulerRunning ? 'stop' : 'start';
                const response = await fetch(`${API_BASE}/api/monitor/scheduler/${endpoint}`, {
                    method: 'POST'
                });
                const data = await response.json();
                updateSchedulerStatus();
            } catch (error) {
                alert('Êìç‰ΩúÂ§±Ë¥•: ' + error.message);
            }
        }

        async function updateSchedulerStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/monitor/scheduler/status`);
                const data = await response.json();
                schedulerRunning = data.running;

                const indicator = document.getElementById('schedulerIndicator');
                const statusText = document.getElementById('schedulerStatusText');
                const btn = document.getElementById('schedulerBtn');

                if (schedulerRunning) {
                    indicator.style.background = '#10b981';
                    statusText.textContent = 'Ë∞ÉÂ∫¶Âô®ËøêË°å‰∏≠';
                    btn.textContent = '‚èπÔ∏è ÂÅúÊ≠¢Ë∞ÉÂ∫¶Âô®';
                } else {
                    indicator.style.background = '#64748b';
                    statusText.textContent = 'Ë∞ÉÂ∫¶Âô®Êú™ËøêË°å';
                    btn.textContent = '‚ñ∂Ô∏è ÂêØÂä®Ë∞ÉÂ∫¶Âô®';
                }
            } catch (error) {
                console.error('Ëé∑ÂèñË∞ÉÂ∫¶Âô®Áä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }

        function setTrendingDays(days) {
            trendingDays = days;
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('#panel-trending .ranking-filters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñÁõëÊéßÊï∞ÊçÆ
        document.addEventListener('DOMContentLoaded', function() {
            loadMonitorTasks();
            updateSchedulerStatus();
        });
    </script>
</body>
</html>
