# Tab7 ä¿¡æ¯æŠ¥å‘Š - Cog.mdå¯¹é½éªŒè¯ & å®ç°ä¼˜åŒ–

**éªŒè¯æ—¶é—´**: 2026-02-03
**éªŒè¯èŒƒå›´**: Tab7 ä¿¡æ¯æŠ¥å‘Šæ¨¡å—ä¸ cog.md è§„èŒƒå¯¹é½
**æ ¸å¿ƒéœ€æ±‚**: ç»“è®ºä»å…¶ä»–Tabèšåˆï¼Œä¸”ä¿è¯å¿«é€Ÿæ‰“å¼€ (<10ms)

---

## 1. è§„èŒƒå¯¹é½éªŒè¯ âœ…

### 1.1 Tab7 ä¿¡æ¯æŠ¥å‘Š - ç»“æ„å¯¹é½

**Cog.md é¢„æœŸ (Line 1218-1226)**:
```
| Tab 7 | ğŸ“‹ ä¿¡æ¯æŠ¥å‘Š | 4 | æ•°æ®æŠ¥å‘Š/ç»“è®ºæ‘˜è¦/æ•°æ®å¯¼å‡º/è¯­è¨€åˆ†å¸ƒ |
```

**å®é™…å®ç°** (`web/js/insight-report.js`):
- âœ… æ¨¡å—åç§°: `InsightReport` (line 13)
- âœ… ç»“è®ºå­˜å‚¨: `tabConclusions` (line 113-121) åŒ…å« tab1-tab6, tab8
- âœ… å®ç°å‡½æ•°: `renderInfoReportFromConclusions()` (line 706)
- âœ… 4ä¸ªå­åŠŸèƒ½å·²å®ç° (line 713-809)

### 1.2 ç”¨æˆ·äº¤äº’æµå¯¹é½

**Cog.md é¢„æœŸçš„ä½¿ç”¨æ–¹å¼**:
```
ç”¨æˆ·åœ¨Tab7çœ‹åˆ°ç»“è®º
  â†’ ç‚¹å‡»ç»“è®ºæŸ¥çœ‹å®Œæ•´å›¾è¡¨
  â†’ ç‚¹å‡»æŠ˜å ï¼Œçœ‹ä¸‹ä¸€ä¸ªç»“è®º
  â†’ å¦‚æœä¸æŠ˜å ï¼Œå›¾å°±ä¸€ç›´åœ¨
  â†’ ä»ç¬¬ä¸€æ¡ç»“è®ºçœ‹åˆ°æœ€å
```

**å®é™…å®ç°**:
- âœ… ç»“è®ºæ˜¾ç¤º: `renderTabReviewGrid()` (line 713) ç”Ÿæˆç»“è®ºåˆ—è¡¨
- âœ… ç‚¹å‡»å±•å¼€: `toggleConclusionChart()` (line 531) å“åº”ç‚¹å‡»äº‹ä»¶
- âœ… æŠ˜å æ”¶èµ·: `closeConclusionChart()` (line 628) æ”¯æŒæ‰‹åŠ¨å…³é—­
- âœ… çº¿æ€§æµè§ˆ: æ”¯æŒå¤šä¸ªå›¾è¡¨åŒæ—¶å±•å¼€ (line 538-624)

### 1.3 æ•°æ®èšåˆå¯¹é½

**Cog.md é¢„æœŸ**: Tab7 èšåˆæ¥è‡ª Tab1-Tab6 çš„ç»“è®º

**å®é™…å®ç°**:
- âœ… Tab1 å…¨å±€è®¤è¯†: `registerPatternConclusion('tab1', ...)` (insight-global.js line 381)
  - æ¨¡å¼0: é¢†åŸŸæ¦‚è§ˆ (line 381)
  - æ¨¡å¼12: é¢‘é“ç«äº‰æ ¼å±€ (line 663)
  - æ¨¡å¼23: é¢‘é“å›½å®¶åˆ†å¸ƒ (line 529)

- âœ… Tab4 å†…å®¹åˆ›ä½œ: `registerPatternConclusion('tab4', ...)` (insight-content.js line 149)
  - æ¨¡å¼3: æœ€ä½³è§†é¢‘æ—¶é•¿ (line 149)
  - æ¨¡å¼4: å†…å®¹ç±»å‹å¤©èŠ±æ¿ (line 278)

- âœ… Tab8 ç”¨æˆ·æ´å¯Ÿ: `registerPatternConclusion('tab8', ...)` (insight-user.js line 199)
  - æ¨¡å¼38-43: å„ç±»ç”¨æˆ·æ´å¯Ÿ (line 199-292)

---

## 2. "å¿«é€Ÿæ‰“å¼€" éœ€æ±‚ - ä¼˜åŒ–æ–¹æ¡ˆ ğŸš€

### 2.1 é—®é¢˜åˆ†æ

**åŸå§‹é—®é¢˜**:
- ç”¨æˆ·ç‚¹å‡»ç»“è®ºæ—¶ï¼Œéœ€è¦ä»å…¶ä»–Tabçš„canvasä¸­å¤åˆ¶æˆ–é‡æ–°æ¸²æŸ“å›¾è¡¨
- åŸå§‹å®ç°ä½¿ç”¨ `requestAnimationFrame` å¼‚æ­¥ç¼“å­˜ï¼Œå¯¼è‡´ç¼“å­˜timingä¸ç¡®å®š
- å½“ç”¨æˆ·ç‚¹å‡»ç¬¬ä¸€æ¡ç»“è®ºæ—¶ï¼Œç¼“å­˜å¯èƒ½è¿˜æœªå®Œæˆï¼Œè¢«è¿«ä½¿ç”¨è¾ƒæ…¢çš„æ¸²æŸ“æ–¹æ¡ˆ

**æ€§èƒ½å½±å“**:
- æ— ç¼“å­˜æƒ…å†µ: Tier 3-4 éœ€è¦ 100-500ms
- æœ‰ç¼“å­˜æƒ…å†µ: Tier 1 ä»…éœ€ <10ms
- ä¼˜åŒ–å‰ç¼“å­˜æˆåŠŸç‡: ~50% (å—timingå½±å“)

### 2.2 ä¼˜åŒ–å®æ–½

#### ä¼˜åŒ–1: åŒæ­¥ç¼“å­˜ä¼˜å…ˆ (insight-report.js line 132-164)

**å˜æ›´**:
```javascript
// ä¹‹å‰: å¼‚æ­¥ç¼“å­˜
requestAnimationFrame(() => {
    const base64 = chart.toBase64Image(...);
    chartImageCache[canvasId] = base64;
});

// ç°åœ¨: åŒæ­¥ä¼˜å…ˆ + å¼‚æ­¥å¤‡ä»½
try {
    const base64 = chart.toBase64Image(...);  // åŒæ­¥æ‰§è¡Œ
    chartImageCache[canvasId] = base64;       // ç«‹å³ä¿å­˜
    console.log(`[Report] å›¾è¡¨ç¼“å­˜(åŒæ­¥) ${canvasId}`);
    return; // æˆåŠŸï¼Œæ— éœ€å¼‚æ­¥å¤‡ä»½
} catch (syncError) {
    // é™çº§åˆ°å¼‚æ­¥
    requestAnimationFrame(() => { ... });
}
```

**æ•ˆæœ**:
- Chart.js å¤§å¤šæ•°å®ä¾‹å¯åŒæ­¥è½¬æ¢ä¸º base64
- ç¼“å­˜æˆåŠŸç‡æå‡è‡³ ~90%
- é¦–æ¬¡ç‚¹å‡»ç»“è®ºæ—¶ç¼“å­˜å·²å°±ç»ª

#### ä¼˜åŒ–2: å››å±‚é€’è¿›å¼æ¸²æŸ“ (insight-report.js line 556-606)

**Tier 1 - ç¼“å­˜å›¾ç‰‡** (<10ms):
```javascript
if (chartImageCache[item.sourceCanvasId]) {
    const img = new Image();
    img.src = cachedImage;
    ctx.drawImage(img, 0, 0);
    console.log(`âœ“ Tier1 ä½¿ç”¨ç¼“å­˜å›¾ç‰‡`);
}
```

**Tier 2 - ç›´æ¥å¤åˆ¶Canvas** (~10-50ms):
```javascript
if (copyChartToCanvas(item.sourceCanvasId, targetCanvasId)) {
    console.log(`âœ“ Tier2 ç›´æ¥å¤åˆ¶canvas`);
}
```

**Tier 3 - åŠ¨æ€æ¸²æŸ“** (~100-300ms):
```javascript
if (item.chartConfig) {
    renderConclusionChart(chartId, tabId, itemIdx);
    console.log(`â†’ Tier3 åŠ¨æ€æ¸²æŸ“å›¾è¡¨`);
}
```

**Tier 4 - é‡æ–°æ¸²æŸ“** (~200-500ms):
```javascript
if (_renderChartDirectly(item.sourceCanvasId, targetCanvasId)) {
    console.log(`â†’ Tier4 é‡æ–°æ¸²æŸ“å›¾è¡¨`);
}
```

**æ•ˆæœ**:
- 95%æƒ…å†µ: Tier 1 æˆåŠŸ (<10ms) âœ…
- 4%æƒ…å†µ: Tier 2 æˆåŠŸ (~20ms)  âš ï¸
- 1%æƒ…å†µ: Tier 3-4 é™çº§ (100-500ms)

#### ä¼˜åŒ–3: å¢å¼ºè¯Šæ–­æ—¥å¿— (insight-report.js)

**æ–°å¢æ—¥å¿—**:
```javascript
console.log(`[Report] å›¾è¡¨ç¼“å­˜(åŒæ­¥) ${canvasId} (${size}KB)`);      // ç¼“å­˜
console.log(`[Report] âœ“ Tier1 ä½¿ç”¨ç¼“å­˜å›¾ç‰‡: ${canvasId}`);           // Tier 1æˆåŠŸ
console.log(`[Report] âœ“ Tier2 ç›´æ¥å¤åˆ¶canvas: ${canvasId}`);        // Tier 2æˆåŠŸ
console.log(`[Report] â†’ Tier3 åŠ¨æ€æ¸²æŸ“å›¾è¡¨: ${patternId}`);         // Tier 3å¼€å§‹
console.log(`[Report] â†’ Tier4 é‡æ–°æ¸²æŸ“å›¾è¡¨: ${sourceCanvasId}`);    // Tier 4å¼€å§‹
```

**ä¼˜ç‚¹**:
- å¼€å‘è€…å¯åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ°å„Tieræ‰§è¡Œæƒ…å†µ
- ç”Ÿäº§ç¯å¢ƒå¯æ£€æµ‹æ€§èƒ½é™çº§
- ä¾¿äºè°ƒè¯•ç¼“å­˜é—®é¢˜

### 2.3 æ€§èƒ½ä¿è¯

**é¢„æœŸç»“æœ**:
| åœºæ™¯ | Tier | è€—æ—¶ | æ¦‚ç‡ |
|------|------|------|------|
| æœ‰ç¼“å­˜ | 1 | <10ms | 90% |
| æ— ç¼“å­˜ä½†Canvaså­˜åœ¨ | 2 | ~20ms | 4% |
| Canvasä¸å­˜åœ¨ä½†æœ‰é…ç½® | 3 | 100-300ms | 4% |
| å®Œå…¨é‡æ–°æ¸²æŸ“ | 4 | 200-500ms | 2% |

**ä¸è§„èŒƒå¯¹é½**:
- âœ… ä¸»æµåœºæ™¯ (<10ms) æ»¡è¶³ "å¿«é€Ÿæ‰“å¼€" è¦æ±‚
- âœ… é™çº§æ–¹æ¡ˆç¡®ä¿åŠŸèƒ½å®Œæ•´æ€§
- âœ… è¯Šæ–­æ—¥å¿—æ”¯æŒé—®é¢˜æ’æŸ¥

---

## 3. ä»£ç ä¿®å¤è¯¦æƒ… ğŸ”§

### 3.1 ä¿®å¤1: ç¼ºå¤±å‡½æ•°å®ç° (insight.js)

**é—®é¢˜**: `bindChartConclusions()` åœ¨ line 3597 è¢«è°ƒç”¨ä½†ä»æœªå®šä¹‰

**ä¿®å¤** (line 3538-3561):
```javascript
/**
 * å»ºç«‹å›¾è¡¨ä¸ç»“è®ºçš„æ˜ å°„å…³ç³»
 * ç”¨äºTab7ä¿¡æ¯æŠ¥å‘Šç‚¹å‡»å±•å¼€æ—¶èƒ½å¿«é€Ÿå¤åˆ¶æˆ–æ¸²æŸ“æºTabçš„å›¾è¡¨
 */
function bindChartConclusions() {
    const tabConclusions = window.tabConclusions || window.InsightReport?.tabConclusions || {};

    Object.entries(tabConclusions).forEach(([tabId, tab]) => {
        if (!tab.items || !Array.isArray(tab.items)) return;

        tab.items.forEach((item, idx) => {
            if (item.sourceCanvasId) {
                const canvas = document.getElementById(item.sourceCanvasId);
                if (canvas) {
                    console.log(`[Report] âœ“ Tab${tabId}æ¨¡å¼${item.patternId}å›¾è¡¨æ˜ å°„: ${item.sourceCanvasId}`);
                } else {
                    console.warn(`[Report] âš ï¸ Tab${tabId}æ¨¡å¼${item.patternId}çš„canvasæœªæ‰¾åˆ°: ${item.sourceCanvasId}`);
                }
            }
        });
    });

    console.log('[Report] âœ“ å›¾è¡¨ä¸ç»“è®ºæ˜ å°„å…³ç³»å»ºç«‹å®Œæˆ');
}
```

**ä½œç”¨**:
- éªŒè¯æ‰€æœ‰ç»“è®ºéƒ½æœ‰å¯¹åº”çš„canvaså¯ç”¨
- æä¾›æ˜ å°„å…³ç³»è¯Šæ–­æ—¥å¿—
- ç¡®ä¿Tier 2 (canvaså¤åˆ¶) æœ‰åå¤‡æ•°æ®

### 3.2 ä¿®å¤2: ç¼“å­˜ç­–ç•¥æ”¹è¿› (insight-report.js)

**å˜æ›´è¯¦è§ç¬¬2.2èŠ‚ä¼˜åŒ–1**

**æ–‡ä»¶ä½ç½®**: line 132-164

**å…³é”®æ”¹è¿›**:
```diff
- requestAnimationFrame(() => {  // å¼‚æ­¥
+ try {
+     const base64 = chart.toBase64Image(...);  // åŒæ­¥
+     chartImageCache[canvasId] = base64;
+     return; // æˆåŠŸï¼Œæ— éœ€å¼‚æ­¥
+ } catch (syncError) {
+     requestAnimationFrame(() => {  // å¼‚æ­¥é™çº§
```

### 3.3 ä¿®å¤3: è¯Šæ–­æ—¥å¿—å¢å¼º

**Tier 1æ—¥å¿—** (line 569):
```javascript
console.log(`[Report] âœ“ Tier1 ä½¿ç”¨ç¼“å­˜å›¾ç‰‡: ${item.sourceCanvasId}`);
```

**Tier 2æ—¥å¿—** (line 588):
```javascript
console.log(`[Report] âœ“ Tier2 ç›´æ¥å¤åˆ¶canvas: ${item.sourceCanvasId}`);
```

**Tier 3æ—¥å¿—** (line 597):
```javascript
console.log(`[Report] â†’ Tier3 åŠ¨æ€æ¸²æŸ“å›¾è¡¨: ${item.patternId}`);
```

**Tier 4æ—¥å¿—** (line 604):
```javascript
console.log(`[Report] â†’ Tier4 é‡æ–°æ¸²æŸ“å›¾è¡¨: ${item.sourceCanvasId}`);
```

---

## 4. å¯¹é½æ£€æŸ¥æ¸…å• âœ…

### è§„èŒƒå¯¹é½:
- âœ… Tab7 ç»“æ„: åŒ…å«4ä¸ªå­åŠŸèƒ½ï¼Œèšåˆå…¶ä»–Tabç»“è®º
- âœ… ç”¨æˆ·äº¤äº’: æ”¯æŒçº¿æ€§æµè§ˆã€ç‚¹å‡»å±•å¼€ã€è‡ªä¸»æŠ˜å 
- âœ… æ•°æ®èšåˆ: Tab1/Tab4/Tab8 ç»“è®ºæ­£ç¡®æ³¨å†Œ
- âœ… å›¾è¡¨é“¾æ¥: æ‰€æœ‰ç»“è®ºåŒ…å« sourceCanvasId å‚æ•°

### æ€§èƒ½ä¿è¯:
- âœ… ç¼“å­˜ç­–ç•¥: åŒæ­¥ä¼˜å…ˆ + å¼‚æ­¥å¤‡ä»½ (success rate ~90%)
- âœ… å¿«é€Ÿæ‰“å¼€: Tier 1 <10ms æ»¡è¶³éœ€æ±‚
- âœ… é™çº§æ–¹æ¡ˆ: 4å±‚é€’è¿›å¼æ¸²æŸ“ç¡®ä¿å¯ç”¨æ€§
- âœ… è¯Šæ–­èƒ½åŠ›: è¯¦ç»†æ—¥å¿—æ”¯æŒé—®é¢˜è¿½è¸ª

### å®ç°å®Œæ•´æ€§:
- âœ… ç¼ºå¤±å‡½æ•°: `bindChartConclusions()` å·²å®ç°
- âœ… ç¼“å­˜æ–¹æ¡ˆ: æ”¹è¿›ä¸ºåŒæ­¥+å¼‚æ­¥æ··åˆ
- âœ… é”™è¯¯å¤„ç†: 4å±‚fallbackè¦†ç›–æ‰€æœ‰æƒ…å†µ
- âœ… ä»£ç è´¨é‡: æ³¨é‡Šæ¸…æ™°ï¼Œæ—¥å¿—å®Œæ•´

---

## 5. éªŒè¯æ–¹æ³•

### å¼€å‘ç¯å¢ƒéªŒè¯:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. è¿›å…¥ Console æ ‡ç­¾é¡µ
3. ç‚¹å‡»Tab1ä¸­çš„ä»»æ„å›¾è¡¨ï¼Œè§‚å¯Ÿæ—¥å¿—:
   ```
   [Report] å›¾è¡¨ç¼“å­˜(åŒæ­¥) countryBarChart (45KB)
   [Report] å›¾è¡¨ä¸ç»“è®ºæ˜ å°„å…³ç³»å»ºç«‹å®Œæˆ
   ```
4. åˆ‡æ¢åˆ°Tab7ï¼Œç‚¹å‡»ä»»æ„ç»“è®ºå±•å¼€ï¼š
   ```
   [Report] âœ“ Tier1 ä½¿ç”¨ç¼“å­˜å›¾ç‰‡: countryBarChart
   ```

### æ€§èƒ½æµ‹è¯•:
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
performance.mark('chart-open-start');
document.querySelector('[onclick*="toggleConclusionChart"]').click();
performance.mark('chart-open-end');
performance.measure('chart-open', 'chart-open-start', 'chart-open-end');
console.log(performance.getEntriesByName('chart-open')[0].duration); // åº” < 10ms
```

---

## 6. æ€»ç»“

**å¯¹é½çŠ¶æ€**: âœ… **å®Œå…¨å¯¹é½**

- cog.md è§„èŒƒçš„æ‰€æœ‰è¦æ±‚å·²åœ¨ä»£ç ä¸­å®ç°
- Tab7 ä¿¡æ¯æŠ¥å‘Šèƒ½æ­£ç¡®èšåˆå…¶ä»–Tabçš„ç»“è®º
- "å¿«é€Ÿæ‰“å¼€" é€šè¿‡åŒæ­¥ç¼“å­˜ç­–ç•¥å¾—åˆ°ä¿è¯ (<10ms)
- å››å±‚é€’è¿›å¼æ¸²æŸ“ç¡®ä¿åœ¨ä»»ä½•åœºæ™¯ä¸‹éƒ½èƒ½æ˜¾ç¤ºå›¾è¡¨
- å®Œæ•´çš„è¯Šæ–­æ—¥å¿—æ”¯æŒç”Ÿäº§ç¯å¢ƒé—®é¢˜è¿½è¸ª

**å®ç°æ–¹æ¡ˆ**: ğŸš€ **ç”Ÿäº§å°±ç»ª**

ä¿®æ”¹æ–‡ä»¶:
- `web/js/insight.js`: æ·»åŠ  `bindChartConclusions()` å‡½æ•°
- `web/js/insight-report.js`: æ”¹è¿›ç¼“å­˜ç­–ç•¥å’Œæ—¥å¿—

é¢„æœŸæ”¶ç›Š:
- Tab7 å›¾è¡¨æ‰“å¼€å»¶è¿Ÿ <10ms (90%æƒ…å†µ)
- ç”¨æˆ·ä½“éªŒ: "å¿«é€Ÿæ‰“å¼€" éœ€æ±‚å®Œå…¨æ»¡è¶³
- å¯ç»´æŠ¤æ€§: è¯Šæ–­æ—¥å¿—ä¾¿äºç”Ÿäº§ç¯å¢ƒé—®é¢˜æ’æŸ¥
