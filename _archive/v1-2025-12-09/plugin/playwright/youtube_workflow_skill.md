# YouTube 视频工作流技能

## 概述

将下载和上传技能组合成完整的工作流，支持：
- 从多种渠道下载视频 → 上传到 YouTube
- 视频迁移和备份
- 上传完成后自动删除本地文件

## 支持的下载源

| 下载源 | 说明 | 工具/方法 |
|--------|------|-----------|
| YouTube Studio | 下载自己频道的视频 | Playwright MCP |
| YouTube 公开视频 | 下载他人公开视频 | yt-dlp |
| 百度网盘 | 从网盘下载 | 百度网盘客户端 / Playwright MCP |
| 阿里云盘 | 从网盘下载 | 阿里云盘客户端 |
| 本地文件夹 | 已有的本地视频 | 直接使用 |

## 工作流模式

### 模式 1: 下载 → 上传 → 删除本地文件

```
下载源 ──下载──> 本地文件夹 ──上传──> YouTube 频道 ──删除──> 清理本地
```

### 模式 2: 下载 → 上传 → 删除源视频

```
YouTube A 频道 ──下载──> 本地 ──上传──> YouTube B 频道 ──删除──> 删除 A 频道视频
```

### 模式 3: 仅备份

```
下载源 ──下载──> 本地文件夹 (保留)
```

---

## 使用前必须确认的参数

### 1. 工作流模式
```
请选择工作流模式：
□ 下载 → 上传 → 删除本地文件
□ 下载 → 上传 → 删除源视频（谨慎！）
□ 仅下载备份
□ 仅上传（已有本地文件）
```

### 2. 下载源选择
```
请选择视频来源：
□ YouTube Studio（自己频道）
□ YouTube 公开视频（使用 yt-dlp）
□ 百度网盘
□ 阿里云盘
□ 本地文件夹（已有视频，跳过下载）
```

### 3. 源信息（根据下载源填写）

**如果是 YouTube Studio**:
```
- 播放列表 URL: ____________
- 要下载的视频: □ 全部 □ 指定关键词 ____________
```

**如果是 YouTube 公开视频**:
```
- 视频/播放列表 URL: ____________
- 视频质量: □ 最高质量 □ 1080p □ 720p
```

**如果是百度网盘**:
```
- 分享链接: ____________
- 提取码: ____________
- 或网盘路径: ____________
```

**如果是本地文件夹**:
```
- 文件夹路径: ____________（默认: /Users/su/Downloads/3d_games/上传/）
- 文件匹配: □ 全部 .mp4 □ 指定关键词 ____________
```

### 4. 目标频道信息（如需上传）
```
- 目标频道的 Chrome Profile: ____________（默认: Profile 3）
- 播放列表名称: ____________

- 标题设置:
  □ 使用文件名作为标题（默认）
  □ 自定义标题 → 提供标题列表
  □ 使用模板 → 模板格式: ____________

- 封面设置:
  □ 情况1: 不需要封面（使用 YouTube 自动生成）
  □ 情况2: 系列视频用同一个封面
    → 封面路径: ____________
  □ 情况3: 每个视频用不同封面
    → 封面文件夹: ____________（文件名需与视频匹配）

- A/B 测试:
  □ 不启用（默认）
  □ 启用 → 每个视频最多 3 个标题 + 3 张封面

- 盈利设置: □ 开启 □ 关闭

- 可见性:
  □ Public（公开）
  □ Unlisted（不公开）
  □ Private（私有）
  □ Scheduled（定时发布）
    - 开始时间: ____________
    - 间隔: ____________ 分钟（推荐 13-16 分钟）

### 6. 定时发布时间计算规则
```
时间计算规则（重要！）：
- 第一个视频时间 = 当前时间 + 5-10 分钟（预留程序运行缓冲）
- 日期选择 = 使用当前日期（不要设置到未来日期）
- 后续视频间隔 = 比前一个视频晚 13-16 分钟

示例（当前时间 20:32）：
- 视频1: 20:45（最近的 15 分钟间隔）
- 视频2: 21:00
- 视频3: 21:15
- ...
```

### 5. 清理设置
```
上传完成后：
□ 删除本地视频文件
□ 保留本地视频文件
□ 移动到归档文件夹: ____________
```

---

## 完整工作流步骤

### 阶段 1: 下载视频

根据下载源选择对应方法：

#### 方法 A: 从 YouTube Studio 下载（自己频道）

参考 [YouTube Studio 下载技能](youtube_studio_download_skill.md)

1. 登录源频道的 YouTube Studio
2. 导航到播放列表页面
3. 批量下载目标视频
4. 验证下载完成

**下载目录**: `/Users/su/Downloads/3d_games/.playwright-mcp/`

#### 方法 B: 从 YouTube 公开视频下载（yt-dlp）

```bash
# 安装 yt-dlp
brew install yt-dlp

# 下载单个视频
yt-dlp -o "%(title)s.%(ext)s" "https://www.youtube.com/watch?v=VIDEO_ID"

# 下载整个播放列表
yt-dlp -o "%(playlist_index)s-%(title)s.%(ext)s" "https://www.youtube.com/playlist?list=PLAYLIST_ID"

# 下载最高质量
yt-dlp -f "bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]" -o "%(title)s.%(ext)s" URL
```

**下载目录**: 当前工作目录，建议 `/Users/su/Downloads/3d_games/上传/`

#### 方法 C: 从百度网盘下载

**方式 1: 百度网盘客户端**
1. 打开百度网盘客户端
2. 找到目标视频文件
3. 右键 → 下载
4. 等待下载完成

**方式 2: Playwright MCP 自动化**
```javascript
// 导航到百度网盘
mcp__playwright__browser_navigate({
  url: "https://pan.baidu.com"
})

// 登录后导航到目标文件夹
// 选择文件 → 下载
```

**下载目录**: 百度网盘默认下载目录或自定义目录

#### 方法 D: 从阿里云盘下载

1. 打开阿里云盘客户端
2. 找到目标视频文件
3. 右键 → 下载
4. 等待下载完成

#### 方法 E: 本地文件夹

直接指定已有视频文件的路径，无需下载。

**默认上传目录**: `/Users/su/Downloads/3d_games/上传/`

### 阶段 2: 准备上传

1. 确认下载的视频文件
2. 准备封面图片（根据封面设置情况）：
   - **情况1**: 不需要封面 → 跳过此步骤
   - **情况2**: 系列视频同封面 → 准备一张封面图片
   - **情况3**: 独立视频各配封面 → 准备与视频同名的封面文件
3. 切换到目标频道（可能需要切换 Chrome Profile）

### 阶段 3: 上传视频

参考 [YouTube 自动上传技能](youtube_auto_upload_skill.md)

对每个视频执行：
1. 上传视频文件
2. 设置标题（使用原标题或自定义）
3. 上传封面（根据封面设置情况）：
   - **情况1**: 跳过，使用自动生成封面
   - **情况2**: 每个视频都上传同一张封面
   - **情况3**: 上传与当前视频匹配的封面
4. 选择播放列表
5. 开启盈利
6. 完成广告适宜性问卷（None of the above）
7. 设置定时发布
8. 点击 Schedule
9. 验证状态为 "Scheduled"

### 阶段 4: 清理

#### 删除本地文件

```bash
# 删除已上传的视频文件
rm "/Users/su/Downloads/3d_games/.playwright-mcp/毛泽东选集-第33集-*.mp4"

# 或删除整个下载目录的视频
rm /Users/su/Downloads/3d_games/.playwright-mcp/*.mp4
```

#### 删除源频道视频（谨慎操作！）

**警告**：此操作不可逆，请确保视频已成功上传到目标频道后再执行。

```javascript
// 在源频道的 YouTube Studio 中
// 1. 导航到视频列表
mcp__playwright__browser_navigate({
  url: "https://studio.youtube.com/channel/UC.../videos"
})

// 2. 选择要删除的视频
// 3. 点击删除按钮
// 4. 确认删除
```

---

## 操作约束

| 约束项 | 标准值 | 说明 |
|--------|--------|------|
| 单次下载数量 | ≤ 20 个 | 避免下载中断 |
| 单次上传数量 | ≤ 15 个 | 避免触发检测 |
| 下载间隔 | ≥ 3 秒 | 每个视频下载间隔 |
| 上传操作间隔 | ≥ 30 秒 | 每个视频设置间隔 |
| 定时发布间隔 | 13-16 分钟 | 相邻视频发布间隔（推荐 15 分钟） |

## 定时发布时间计算规则

| 规则 | 说明 |
|------|------|
| **第一个视频时间** | 当前时间 + 5-10 分钟（程序运行需要时间，预留缓冲） |
| **日期选择** | 使用当前日期，不要设置到未来日期 |
| **后续视频间隔** | 比前一个视频晚 13-16 分钟（推荐 15 分钟） |
| **时间选择器精度** | YouTube 以 15 分钟为间隔（如 21:00, 21:15, 21:30） |

**为什么使用当前日期？**
- 视频尽早发布可以尽早获得观看量
- 如果程序运行时间长导致时间过期，往后推几分钟即可，不需要改日期

**时间过期处理（重要！）**：
- 如果运行到某个视频时，原定的发布时间已过期
- **正确做法**：将当前及后续所有视频的发布时间都往后推，保持间隔不变
- 例如：原定 21:00 过期 → 改为 21:15，后续 21:15→21:30, 21:30→21:45...

**计算示例**（当前时间 20:32）：
- 视频1: 20:45（当前时间 + 约 10 分钟，选最近的 15 分钟间隔）
- 视频2: 21:00
- 视频3: 21:15
- ...

---

## 验收标准

### 下载阶段
- [ ] 所有目标视频已下载
- [ ] 文件大小正常（非空、非截断）
- [ ] 文件名包含正确的视频标题

### 上传阶段
- [ ] 所有视频状态为 "Scheduled"
- [ ] 封面、播放列表、盈利设置正确
- [ ] 定时发布时间按计划设置
- [ ] 未触发验证码或安全警告

### 清理阶段
- [ ] 本地文件已按设置处理（删除/保留/归档）
- [ ] 确认目标频道视频可正常播放后再删除源视频

---

## 中断恢复流程

工作流执行过程中可能因网络问题、程序崩溃、用户中断等原因中断。根据中断后的恢复方式，分为两种场景：

### 场景一：在原 Claude 会话中重启

**情况**：用户在同一个 Claude Code 会话中说"继续"。

| 特点 | 说明 |
|------|------|
| 浏览器状态 | ✅ 可能仍然打开 |
| 页面状态 | ✅ 可能保持在中断时的位置 |
| 操作 | 先获取 `browser_snapshot` 判断当前状态 |

**恢复流程**：
```
1. browser_snapshot → 获取当前页面状态
2. 判断位置：
   - 在上传对话框 → 继续完成当前视频设置
   - 在 Dashboard → 检查视频列表
   - 浏览器已关闭 → 按场景二处理
3. 继续操作
```

---

### 场景二：在新 Claude 会话中恢复

**情况**：用户开启了新的 Claude Code 会话。

| 特点 | 说明 |
|------|------|
| 浏览器状态 | ❌ 已关闭（会话结束时关闭） |
| 登录状态 | ✅ 保留在 Playwright MCP 缓存目录 |
| 操作 | 需要重新打开浏览器并导航 |

**恢复流程**：
```
1. browser_navigate → https://studio.youtube.com
2. 导航到 Content 页面
3. 获取已上传视频列表
4. 对比源文件夹，识别：
   - ✅ Scheduled（已完成）
   - ⚠️ Draft（需完成设置）
   - ❌ 未上传
5. 优先处理 Draft 视频
6. 继续上传剩余视频
```

---

### 两种场景对比

| 对比项 | 场景一（原会话） | 场景二（新会话） |
|--------|-----------------|-----------------|
| 浏览器 | 可能仍打开 | 已关闭 |
| 登录状态 | 保持 | 保持 |
| 页面状态 | 可能保持 | 需重新导航 |
| 首要操作 | `browser_snapshot` | `browser_navigate` |
| 恢复速度 | 快 | 较慢 |

---

### 恢复步骤概览

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  1. 检查    │ ──> │  2. 识别    │ ──> │  3. 处理    │ ──> │  4. 继续    │
│  YouTube    │     │  中断点     │     │  草稿视频   │     │  剩余上传   │
│  Studio     │     │             │     │             │     │             │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

### 详细恢复步骤

| 步骤 | 操作 | 命令/动作 |
|------|------|-----------|
| **1** | 打开 YouTube Studio Content 页面 | 导航到视频列表页面 |
| **2** | 获取已上传视频列表 | 记录所有 Scheduled/Draft 状态的视频 |
| **3** | 对比源文件夹 | 确定哪些已完成、哪些是草稿、哪些未上传 |
| **4** | 处理草稿视频 | 优先完成草稿视频的设置 |
| **5** | 继续上传 | 从未上传的视频继续 |
| **6** | 重新计算时间 | 根据当前时间和已有发布时间重新规划 |

### 视频状态识别

| 状态 | 图标 | 含义 | 恢复操作 |
|------|------|------|----------|
| Scheduled | ✅ | 已完成所有设置 | 跳过 |
| Draft | ⚠️ | 上传完成但设置未完成 | 完成设置 → Schedule |
| Processing | ⏳ | 正在处理中 | 等待后继续设置 |
| 不存在 | ❌ | 未上传 | 需要上传 |

### 恢复时的时间计算规则

| 场景 | 计算方式 |
|------|----------|
| 有已 Scheduled 的视频 | 下一个视频 = 最晚发布���间 + 15分钟 |
| 无已 Scheduled 的视频 | 第一个视频 = 当前时间 + 10分钟 |
| 当前时间已超过计划时间 | 全部往后推，保持间隔 |

### 恢复操作示例

**场景**：批量上传10个视频，在第4个视频中断

```
中断前状态：
├── 视频1: Scheduled 14:00 ✅
├── 视频2: Scheduled 14:15 ✅
├── 视频3: Scheduled 14:30 ✅
├── 视频4: Draft ⚠️ (标题已填，其他未完成)
├── 视频5-10: 未上传 ❌

恢复时间：15:40

恢复操作：
1. 完成视频4设置 → Schedule 15:45
2. 上传���频5 → Schedule 16:00
3. 上传视频6 → Schedule 16:15
... 以此类推
```

### 注意事项

1. **优先处理草稿**：草稿视频已占用上传时间，应优先完成
2. **检查重复上传**：恢复前务必确认哪些视频已经上传��避免重复
3. **重新确认设置**：恢复时可能需要重新确认封面、播放列表等设置
4. **时间可能过期**：如果原定发布时间已过，需要往后调整

---

## 实战案例

### 案例: 迁移"毛泽东选集"第33-43集

**参数配置**:
- 源频道播放列表: `PLjDLbyA7SjEkQP6HvRznReRYSJJyQQrQk`
- 目标频道 Profile: `Profile 3`
- 目标播放列表: `毛泽东全集`
- 封面: `/Users/su/Downloads/视频封面/毛泽东选集.jpg`
- 盈利: 开启
- 广告适宜性: None of the above
- 定时发布: 2026-01-06 21:00 开始，间隔 15 分钟
- 清理: 上传完成后删除本地文件

**执行结果**:
- 下载: 11 个视频，共 1.6GB
- 上传: 11 个视频全部 Scheduled
- 清理: 本地文件已删除

---

## 常见问题

### Q: 下载和上传用的是同一个频道怎么办？
A: 不需要切换 Profile，直接使用同一个登录状态即可。

### Q: 上传失败了，但本地文件已删除怎么办？
A: 建议先验证所有视频上传成功后再删除本地文件。可以设置"移动到归档文件夹"而非直接删除。

### Q: 如何验证目标频道视频正常？
A:
1. 检查 YouTube Studio 中视频状态为 "Scheduled"
2. 等待第一个视频发布后，在前台确认可正常播放
3. 确认无误后再删除源视频

### Q: 可以自动化删除源频道视频吗？
A: 技术上可以，但**强烈不建议**自动化删除操作。建议手动确认后再删除。

---

## 相关技能

- [YouTube Studio 下载技能](youtube_studio_download_skill.md)
- [YouTube 自动上传技能](youtube_auto_upload_skill.md)
